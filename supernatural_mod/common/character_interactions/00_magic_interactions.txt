cast_curse = {
	
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
				has_perk = evil_eye_perk
				is_imprisoned = no
		}
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			custom_description = {
				text = is_incapable_custom
				NOT = { has_trait = incapable }
			}
		}
		scope:recipient = {
			#custom_description = {
			#	text = "cast_curse_custom_desc"
			#	}
			custom_description = {
			text = magic_protection_custom
				OR = {
					AND = {
						scope:actor = {
							OR = {
								any_character_artifact = { has_variable = catalyst }
								is_legendary_mage_trigger = yes
							}
						}
						NOR = {
							any_character_artifact = { has_variable = magic_ring }
							has_character_modifier = amp_modifier
						}
					}
					NOR = {
						has_perk = protective_runes_perk
						has_trait = demon
						#has_character_modifier = cursed_modifier
						any_character_artifact = { has_variable = magic_ring }
						has_character_modifier = amp_modifier
						AND = {
							any_parent = { has_perk = protective_runes_perk }
							NOT = { is_child_of = scope:actor }
						}
						AND = {
							exists = scope:recipient.liege
							scope:recipient.liege = { has_perk = protective_runes_perk }
							is_councillor = yes
							NOT = { is_councillor_of = scope:actor }
						}
						AND = {
							any_consort = { has_perk = protective_runes_perk }
							NOT = { is_consort_of = scope:actor }
						}
						AND = {
							employs_court_position = mage_court_position
							any_court_position_holder = {
				        		type = mage_court_position
								has_perk = protective_runes_perk
								NOT = { scope:actor = this }
							}
						}
					}
				}
				
			}
		}
	}
	icon = icon_magic
	common_interaction = yes
	interface_priority = 90
	popup_on_receive = no
	category = interaction_category_magic
	desc = "cast_curse_desc"
	#prompt = "cast_curse_prompt_text"
	#custom_description="cast_curse_custom_desc"
	#notification_text = cast_curse_notification_text

	cooldown_against_recipient = { years = 5 } 
	cooldown = { years = 2 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = no
	#hidden = yes
	
	on_accept = {
		scope:actor = {
			save_scope_as = magic_user
			#add_character_flag = {
			#	flag = magic_user
			#	years = 5
			#}
			#every_courtier_or_guest = {
			#			limit = { has_perk = magical_senses_perk }
			#	trigger_event = magic_ev.4
			#}
			
			#location = {
			#	duchy = {
			#		every_de_jure_county_holder = {
			#			limit = { 
			#				AND = {
			#					NOT = { this = scope:actor }
			#					has_perk = magical_senses_perk
			#				}
			#			}
			#				trigger_event = magic_ev.4
			#		}
			#
			#	}
			#}
			send_message_4_magic_sense_effect = yes
			send_interface_message = {
				type = event_generic_neutral
				title = cast_curse
				desc = "send_interface_message_text"
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = use_magic_custom_tooltip
				#tooltip="tooltip0"
				stress_impact = {
					compassionate = medium_stress_impact_gain
					honest = medium_stress_impact_gain
					just = medium_stress_impact_gain
				}
				scope:recipient = {
					trigger_event = magic_ev.3
					if = {
						limit = {
							scope:actor = {
								exists = dynasty
								dynasty = {
									has_dynasty_perk = witchcraft_legacy_4
								}
							}
						}
						custom_tooltip = chance_to_cursed2_custom_tooltip
					}
					else = {
						custom_tooltip = chance_to_cursed_custom_tooltip
					}
					
				}
			}
		}
	}
	
	auto_accept = yes
	ai_potential = {
		NOT = {
			has_trait = compassionate
		}
	}
	
	ai_targets = {
		ai_recipients = neighboring_rulers
		ai_recipients = peer_vassals
		ai_recipients = vassals
		ai_recipients = liege
		ai_recipients = dynasty
		ai_recipients = spouses
		ai_recipients = war_enemies
		ai_recipients = scripted_relations
	}

	ai_frequency = 24

	ai_will_do = {
		base = 0
		
		modifier = {
			add = 100
			scope:recipient = {
				OR = {
					has_relation_rival = scope:actor
					has_relation_nemesis = scope:actor
					#has_relation_potential_rival = scope:actor
					is_at_war_with = scope:actor
				}
			}
		}
		modifier = {
			add = 50
			scope:actor = {
				OR = {
					has_character_modifier = yaga_modifier
					has_character_modifier = yagas_blood_modifier
				}
				NOT = {
					has_witch_house_trigger = yes
				}
			}
			scope:recipient = {
				NOR = {
					has_character_modifier = yaga_modifier
					has_character_modifier = yagas_blood_modifier
				}
				has_witch_house_trigger = yes
			}
		}
		modifier = {
			add = -100
			scope:recipient = {
				OR = {
					has_relation_lover = scope:actor
					has_relation_friend = scope:actor
					has_relation_best_friend = scope:actor
					has_relation_soulmate = scope:actor
				}
			}
		}
	}
}

magic_domination = {
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
			is_imprisoned = no
			OR = {
				has_perk = mind_control_p6_perk
				has_trait = demon
			}
		}
		scope:recipient = {
			NOR = {
				has_relation_mminion = scope:actor
				has_relation_mmaster = scope:actor
				
			}
		}	
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			custom_description = {
				text = is_incapable_custom
				NOT = { has_trait = incapable }
			}
		}
		scope:recipient = {
			custom_description = {
				text = magic_protection_custom
				OR = {
					NOR = {
						has_perk = protective_runes_perk
						has_trait = demon
						has_trait = possessed_1
						has_trait = possessed_genetic
						any_character_artifact = { has_variable = magic_ring }
						has_character_modifier = amp_modifier
						AND = {
							any_parent = { has_perk = protective_runes_perk }
							NOT = { is_child_of = scope:actor }
						}
						AND = {
							#scope:recipient.liege = { has_perk = protective_runes_perk }
							exists = liege
							liege = { has_perk = protective_runes_perk }
							is_councillor = yes
							NOT = { is_councillor_of = scope:actor }
						}
						AND = {
							any_consort = { has_perk = protective_runes_perk }
							NOT = { is_consort_of = scope:actor }
						}
						AND = {
							employs_court_position = mage_court_position
							any_court_position_holder = {
				        		type = mage_court_position
								has_perk = protective_runes_perk
								NOT = { scope:actor = this }
							}
						}
					}
					AND = {
						scope:actor = {
							OR = {
								any_character_artifact = { has_variable = catalyst }
								is_legendary_mage_trigger = yes
							}
						}
						NOR = {
							any_character_artifact = { has_variable = magic_ring }
							has_character_modifier = amp_modifier
						}
					}
				}
			}
		}
		scope:actor = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			
			custom_description = {
				text = not_war_against
				NOT = { is_at_war_with = scope:recipient }
			}
		}
	}
	icon = icon_magic
	common_interaction = yes
	interface_priority = 90
	category = interaction_category_magic

	cooldown_against_recipient = { years = 5 } 
	cooldown = { months = 1 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = no
	#hidden = yes
	
	on_accept = {
		scope:actor = {
			save_scope_as = magic_user
			hidden_effect = {
				if = {
					limit = {
						any_character_artifact = {
							has_variable = magic1
						}
						is_ai = no
						any_living_character = {
							has_trait = true_witch
							count < 4
						}
					}
					random = {
						chance = 40
						create_true_witch_effect = yes
					}
				}
			}
			#add_character_flag = {
			#	flag = magic_user
			#	years = 5
			#}
			send_message_4_magic_sense_effect = yes
			#add_gold=-10
			scope:recipient = {
				every_relation = {
					type = mmaster
					remove_relation_mminion = scope:recipient
				}
			}
			set_relation_mminion = scope:recipient
			spend_standard_ps_effect = yes
			#desnt work?-->#remove_magic_sat_effect = yes
			send_interface_message = {
				type = event_generic_neutral
				title = magic_domination
				desc = "send_interface_message_text"
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = use_magic_custom_tooltip
				gain_sc_xp1_effect = yes

				stress_impact = {
					compassionate = medium_stress_impact_gain
					honest = medium_stress_impact_gain
					just = medium_stress_impact_gain
				}
				hidden_effect = {
					if = {
						limit = {
							has_hook = scope:recipient
						}
						remove_hook = {
							target = scope:recipient
						}
					}
				}
				add_hook = {
						type = magic_domination_hook
						target = scope:recipient
				}
				metamagic_effect = yes
				if = {
					limit = {
						has_character_flag = better_domination_spell
					}
					scope:recipient = {
						custom_tooltip = mind_control_custom_tooltip
						set_culture_same_as = scope:actor
						set_character_faith = scope:actor.faith
					}
				}
				else = {
					scope:recipient = {
						custom_tooltip = mind_control_custom_tooltip
					}
				}
				
			}
		}
	}
	
	auto_accept = yes
	ai_potential = {
		NOT = {
			has_trait = compassionate
		}
	}
	
	ai_targets = {
		ai_recipients = neighboring_rulers
		ai_recipients = vassals
		ai_recipients = liege
		ai_recipients = courtiers
		ai_recipients = spouses
	}

	ai_frequency = 24

	ai_will_do = {
		base = 0
		
		modifier = {
			add = 40
			scope:recipient = {
				OR = {
					has_relation_rival = scope:actor
					has_relation_nemesis = scope:actor
					has_relation_potential_rival = scope:actor
				}
			}
		}
		modifier = {
			add = 20
			scope:recipient = {
				is_powerful_vassal = yes
			}
		}
		modifier = {
			add = 20
			scope:recipient = {
				opinion = {
					target = scope:actor
					value < -70
				}
			}
		}
		modifier = {
			add = 50
			scope:recipient = {
				is_spouse_of = scope:actor
				NOR = {
					has_relation_lover = scope:actor
					has_relation_soulmate = scope:actor
					has_relation_friend = scope:actor
					has_relation_best_friend = scope:actor
				}
			}
		}
		modifier = {
			add = -100
			scope:recipient = {
				is_ai = no
			}
		}
	}
}

magic_healing = {
	
	is_shown = {
		#NOT = { scope:recipient = scope:actor }
		scope:actor = {
			OR = {
				has_perk = healer_p9_perk
				has_trait = demon
			}
			is_imprisoned = no
		}
		scope:recipient = {
			OR = {
				has_trait = ill
				has_trait = pneumonic
				has_trait = great_pox
				has_trait = early_great_pox
				has_trait = lovers_pox
				has_trait = leper
				has_trait = wounded_1
				has_trait = wounded_2
				has_trait = wounded_3
				has_trait = maimed
				has_trait = infirm
				has_trait = incapable
				has_trait = gout_ridden
				has_trait = consumption
				has_trait = cancer
				has_trait = typhus
				has_trait = bubonic_plague
				has_trait = smallpox
				has_trait = sickly
				has_trait = blind
			}
		}	
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = is_incapable_custom
				NOT = { has_trait = incapable }
			}
		}
	}
	icon = icon_magic
	common_interaction = yes
	interface_priority = 90
	category = interaction_category_magic

	cooldown_against_recipient = { years = 2 } 
	cooldown = { months = 6 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = no
	#hidden = yes
	
	on_accept = {
		scope:actor = {
			save_scope_as = magic_user
			#add_character_flag = {
			#	flag = magic_user
			#	years = 5
			#}
			send_message_4_magic_sense_effect = yes
			#add_gold=-10
			spend_standard_ps_effect = yes

			send_interface_message = {
				type = event_generic_neutral
				title = magic_healing
				desc = magic_healing_text
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = use_magic_custom_tooltip
				metamagic_effect = yes
				stress_impact = {
					compassionate = medium_stress_impact_loss
				}
				#scope:recipient = {
				#	custom_tooltip = magic_healing_custom_tooltip
				#
				#}
			}
		}
		scope:recipient = {
					
					if = { limit = { has_trait = ill }
						remove_trait = ill
					}
					if = { limit = { has_trait = pneumonic }
						remove_trait = pneumonic
					}
					if = { limit = { has_trait = great_pox }
						remove_trait = great_pox
					}
					if = { limit = { has_trait = early_great_pox }
						remove_trait = early_great_pox
					}
					if = { limit = { has_trait = lovers_pox }
						remove_trait = lovers_pox
					}
					if = { limit = { has_trait = leper }
						remove_trait = leper
					}
					if = { limit = { has_trait = wounded_1 }
						remove_trait = wounded_1
					}
					if = { limit = { has_trait = wounded_2 }
						remove_trait = wounded_2
					}
					if = { limit = { has_trait = wounded_3 }
						remove_trait = wounded_3
					}
					if = { limit = { has_trait = maimed }
						remove_trait = maimed
					}
					if = { limit = { has_trait = infirm }
						remove_trait = infirm
					}
					if = { limit = { has_trait = incapable }
						remove_trait = incapable
					}
					if = { limit = { has_trait = gout_ridden }
						remove_trait = gout_ridden
					}
					if = { limit = { has_trait = consumption }
						remove_trait = consumption
					}
					if = { limit = { has_trait = cancer }
						remove_trait = cancer
					}
					if = { limit = { has_trait = typhus }
						remove_trait = typhus
					}
					if = { limit = { has_trait = bubonic_plague }
						remove_trait = bubonic_plague
					}
					if = { limit = { has_trait = smallpox }
						remove_trait = smallpox
					}
					if = { limit = { has_trait = sickly }
						remove_trait = sickly
					}
					if = { limit = { has_trait = blind }
						remove_trait = blind
					}
		}
	}
	
	auto_accept = yes
	ai_targets = {
		ai_recipients = self
	}

	ai_frequency = 12

	ai_will_do = {
		base = 100
		modifier = {
			add = -100
			scope:actor = {
				has_trait = demon
			}
		}
	}
}


cast_powerfull_curse = {
	
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
			OR = {
				has_perk = fate_weaver_p10_perk
				has_trait = demon
				has_character_flag = powerful_curse_one_time
			}
			is_imprisoned = no
		}
		scope:recipient = {
			NOR = {
				has_relation_mminion = scope:actor
				#has_relation_mmaster = scope:actor
			}
		}	
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			custom_description = {
				text = is_incapable_custom
				NOT = { has_trait = incapable }
			}
		}
		scope:recipient = {
			custom_description = {
				text = magic_protection_custom
				OR = {
					NOR = {
						has_perk = protective_runes_perk
						has_trait = demon
						#has_character_modifier = cursed_modifier
						any_character_artifact = { has_variable = magic_ring }
						has_character_modifier = amp_modifier
						AND = {
							any_parent = { has_perk = protective_runes_perk }
							NOT = { is_child_of = scope:actor }
						}
						AND = {
							exists = liege
							liege = { has_perk = protective_runes_perk }
							is_councillor = yes
							NOT = { is_councillor_of = scope:actor }
						}
						AND = {
							any_consort = { has_perk = protective_runes_perk }
							NOT = { is_consort_of = scope:actor }
						}
						AND = {
							employs_court_position = mage_court_position
							any_court_position_holder = {
				        		type = mage_court_position
								has_perk = protective_runes_perk
								NOT = { scope:actor = this }
							}
						}
					}
					AND = {
						scope:actor = {
							OR = {
								any_character_artifact = { has_variable = catalyst }
								is_legendary_mage_trigger = yes
							}
						}
						#NOT = { has_character_modifier = cursed_modifier }
						NOR = {
							any_character_artifact = { has_variable = magic_ring }
							has_character_modifier = amp_modifier
						}
					}
				}
			}
		}
		scope:actor = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
		}
	}
	icon = icon_magic
	common_interaction = yes
	interface_priority = 90
	popup_on_receive = no
	category = interaction_category_magic

	cooldown_against_recipient = { years = 5 } 
	cooldown = { months = 1 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = no
	#hidden = yes
	
	on_accept = {
		scope:actor = {
			save_scope_as = magic_user
			#add_character_flag = {
			#	flag = magic_user
			#	years = 5
			#}
			send_message_4_magic_sense_effect = yes
			scope:recipient = {
				save_scope_as = reci
			}
			hidden_effect = {
				random = {
					chance = 4
					if = {
						limit = {
							NOT = {
								any_courtier_or_guest = {
									has_trait = witch_hunter
								}
							}
						}
						create_character = {
							employer = scope:actor
							template = witch_hunter_character
							save_scope_as = whunter
						}
						scope:whunter = {
							add_perk = protective_runes_perk
							add_perk = magical_senses_perk
						}
					}
				}
				if = {
					limit = {
						has_character_flag = powerful_curse_one_time
					}
					remove_character_flag = powerful_curse_one_time
				}
			}
			
			trigger_event = magic_ev.10
			send_interface_message = {
				type = event_generic_neutral
				title = cast_powerfull_curse
				#desc = "send_interface_message_text"
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = use_magic_custom_tooltip
				show_as_tooltip = {
					spend_standard_ps_effect = yes
					gain_sc_xp1_effect = yes
				}
				stress_impact = {
					compassionate = medium_stress_impact_gain
					honest = medium_stress_impact_gain
					just = medium_stress_impact_gain
				}

				scope:recipient = {
					custom_tooltip = cast_powerfull_curse_ct
				}
			}
		}
	}
	
	auto_accept = yes
	ai_potential = {
		NOT = {
			has_trait = compassionate
		}
	}
	
	ai_targets = {
		ai_recipients = neighboring_rulers
		ai_recipients = vassals
		ai_recipients = liege
		ai_recipients = courtiers
		ai_recipients = spouses
		ai_recipients = war_enemies
		ai_recipients = scripted_relations
	}

	ai_frequency = 24

	ai_will_do = {
		base = 0
		
		modifier = {
			add = 90
			scope:recipient = {
				OR = {
					has_relation_rival = scope:actor
					has_relation_nemesis = scope:actor
					#has_relation_potential_rival = scope:actor
					is_at_war_with = scope:actor
				}
			}
		}
		modifier = {
			add = 50
			scope:recipient = {
				opinion = {
					target = scope:actor
					value < -40
				}
			}
		}
		modifier = {
			add = 50
			scope:actor = {
				OR = {
					has_character_modifier = yaga_modifier
					has_character_modifier = yagas_blood_modifier
				}
				NOT = {
					has_witch_house_trigger = yes
				}
			}
			scope:recipient = {
				NOR = {
					has_character_modifier = yaga_modifier
					has_character_modifier = yagas_blood_modifier
				}
				has_witch_house_trigger = yes
			}
		}
		modifier = {
			add = -100
			scope:recipient = {
				OR = {
					has_relation_lover = scope:actor
					has_relation_friend = scope:actor
					has_relation_best_friend = scope:actor
					has_relation_soulmate = scope:actor
				}
			}
		}
	}
}

banish_demon = {
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
			any_character_artifact = { has_variable = blackgrimoire }
			is_imprisoned = no
			has_trait = archmage
			
		}
		scope:recipient = {
			has_trait = demon
			NOT = { has_relation_mminion = scope:actor }
		}	
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = is_incapable_custom
				NOT = { has_trait = incapable }
			}
		}
		scope:recipient = {
			custom_description = {
				text = magic_protection_custom
				NOR = {
					any_character_artifact = { has_variable = magic_ring }
					has_character_modifier = amp_modifier
				}
			}
		}
	}
	icon = icon_magic
	common_interaction = yes
	interface_priority = 90
	category = interaction_category_magic

	cooldown_against_recipient = { years = 5 } 
	cooldown = { months = 1 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = no
	popup_on_receive = no
	#hidden = yes
	
	on_accept = {
		scope:actor = {
			save_scope_as = magic_user
			#add_character_flag = {
			#	flag = magic_user
			#	years = 5
			#}
			send_message_4_magic_sense_effect = yes
			scope:recipient = {
				save_scope_as = reci
			}
			
			send_interface_message = {
				type = event_generic_neutral
				title = banish_demon
				#desc = "send_interface_message_text"
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = use_magic2_custom_tooltip
				spend_standard_ps_effect = yes
				gain_sc_xp1_effect = yes

				metamagic_effect = yes
				scope:recipient = {
					custom_tooltip = banish_demon_ct
					hidden_effect = {
						death = natural
					}
				}
			}
		}
	}
	
	auto_accept = yes
	ai_potential = {
		NOT = {
			has_trait = compassionate
		}
	}
	
	ai_targets = {
		ai_recipients = neighboring_rulers
		ai_recipients = vassals
		ai_recipients = liege
		ai_recipients = courtiers
		ai_recipients = war_enemies
		ai_recipients = scripted_relations
	}

	ai_frequency = 24

	ai_will_do = {
		base = 0
		
		modifier = {
			add = 100
			scope:recipient = {
				OR = {
					has_relation_rival = scope:actor
					has_relation_nemesis = scope:actor
					#has_relation_potential_rival = scope:actor
					is_at_war_with = scope:actor
				}
			}
		}
	}
}

consume_child = {
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
			is_imprisoned = no
			OR = {
				has_trait = cannibal
				any_secret = {
					secret_type = secret_cannibal
				}
			}
			OR = {
				has_trait = witch
				any_secret = {
					secret_type = secret_witch
				}
			}
			
		}
		scope:recipient = {
			age < 16
		}	
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			custom_description = {
				text = is_incapable_custom
				NOT = { has_trait = incapable }
			}
		}
		scope:recipient = {
			custom_description = {
				text = only_specified_child
				OR = {
					is_courtier_of = scope:actor
					has_relation_guardian = scope:actor
					is_imprisoned_by = scope:actor
					is_foreign_court_or_pool_guest_of = scope:actor
				}
			}
			custom_description = {
				text = only_specified_child2
				OR = {
					NOT = {
						is_child_of = scope:actor
					}
					scope:actor = {
						has_trait = sadistic
					}
				}
				
			}
		}
	}
	icon = icon_cann
	common_interaction = yes
	interface_priority = 90
	popup_on_receive = no
	category = interaction_category_magic

	cooldown_against_recipient = { years = 1 } 
	cooldown = { months = 1 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = yes
	#hidden = yes
	
	on_accept = {
		scope:actor = {
			hidden_effect = {
				if = {
					limit = {
						NOT = {
							any_courtier_or_guest = {
								has_trait = witch_hunter
							}
						}
					}
					if = {
						limit = {
							is_ai = no
						}
						random = {
							chance = 10
							create_character = {
								employer = scope:actor
								template = witch_hunter_character
								save_scope_as = whunter
							}
							scope:whunter = {
								add_perk = protective_runes_perk
								add_perk = magical_senses_perk
							}
						}
					}
					else = {
						random = {
							chance = 1
							create_character = {
								employer = scope:actor
								template = witch_hunter_character
								save_scope_as = whunter
							}
							scope:whunter = {
								add_perk = protective_runes_perk
								add_perk = magical_senses_perk
							}
						}
					}
				}
				random = {
					chance = 40
					send_message_4_child_missing_effect = yes
				}
			}
			
			send_interface_message = {
				type = event_generic_neutral
				title = consume_child
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = absorb_good_traits_ct
				#hidden_effect = {
				#	add_secret = {
				#		type = secret_murder
				#		target = scope:recipient
				#	}
				#}
				if = {
					limit = {
						NOR = {
							has_trait = compassionate
							has_trait = honest
							has_trait = just
						}
					}
					add_stress = -40
				}
				
				stress_impact = {
					compassionate = major_stress_impact_gain
					honest = minor_stress_impact_gain
					just = minor_stress_impact_gain
				}
				if = {
					limit = {
						OR = {
							has_relation_guardian = scope:recipient
							has_relation_ward = scope:recipient
						}
					}
					if = {
						limit = { NOT = { has_character_flag = dubious_guardian } }
						add_character_flag = dubious_guardian
					}
					else_if = {
						limit = {
							NOT = { has_character_modifier = dubious_guardian_modifier }
						}
						random = {
							chance = 50
							add_character_modifier = {
								modifier = dubious_guardian_modifier
								years = 10
							}
						}
					}
				}
				
				scope:recipient = {
					custom_tooltip = consume_child_ct
					if = {
						limit = {
							num_of_bad_genetic_traits = 0
						}
						scope:actor = {
							add_character_modifier = {
								modifier = ate_good_meal
								years = 3
							}
						}
					}
					hidden_effect = {
						
						random = {
							chance = 50
							#physique
							if = {
								limit = {
									OR = {
										has_trait = physique_good_3
										has_trait = physique_good_2
										has_trait = physique_good_1
									}
									scope:actor = {
										NOT = {
											has_trait = physique_good_3
										}
									}
								}
								scope:actor = {
									if = {
										limit = {
											has_trait = physique_bad_3
										}
										remove_trait = physique_bad_3
										add_trait = physique_bad_2
									}
									else_if = {
										limit = {
											has_trait = physique_bad_2
										}
										remove_trait = physique_bad_2
										add_trait = physique_bad_1
									}
									else_if = {
										limit = {
											has_trait = physique_bad_1
										}
										remove_trait = physique_bad_1
									}
									else_if = {
										limit = {
											has_trait = physique_good_1
											scope:recipient = {
												OR = {
													has_trait = physique_good_3
													has_trait = physique_good_2
												}
												
											}
										}
										remove_trait = physique_good_1
										add_trait = physique_good_2
									}
									else_if = {
										limit = {
											has_trait = physique_good_2
											scope:recipient = {
												has_trait = physique_good_3
											}
										}
										remove_trait = physique_good_2
										add_trait = physique_good_3
									}
									else = {
										add_trait = physique_good_1
									}
								}	
							}
						}
						random = {
							chance = 50
							#beuty
							if = {
								limit = {
									OR = {
										has_trait = beauty_good_3
										has_trait = beauty_good_2
										has_trait = beauty_good_1
									}
									scope:actor = {
										NOT = {
											has_trait = beauty_good_3
										}
									}
								}
								scope:actor = {
									if = {
										limit = {
											has_trait = beauty_bad_3
										}
										remove_trait = beauty_bad_3
										add_trait = beauty_bad_2
									}
									else_if = {
										limit = {
											has_trait = beauty_bad_2
										}
										remove_trait = beauty_bad_2
										add_trait = beauty_bad_1
									}
									else_if = {
										limit = {
											has_trait = beauty_bad_1
										}
										remove_trait = beauty_bad_1
									}
									else_if = {
										limit = {
											has_trait = beauty_good_1
											scope:recipient = {
												OR = {
													has_trait = beauty_good_3
													has_trait = beauty_good_2
												}
												
											}
										}
										remove_trait = beauty_good_1
										add_trait = beauty_good_2
									}
									else_if = {
										limit = {
											has_trait = beauty_good_2
											scope:recipient = {
												has_trait = beauty_good_3
											}
										}
										remove_trait = beauty_good_2
										add_trait = beauty_good_3
									}
									else = {
										add_trait = beauty_good_1
									}
								}	
							}
						}
						random = {
							chance = 50
							#intellect
							if = {
								limit = {
									OR = {
										has_trait = intellect_good_3
										has_trait = intellect_good_2
										has_trait = intellect_good_1
									}
									scope:actor = {
										NOT = {
											has_trait = intellect_good_3
										}
									}
								}
								scope:actor = {
									if = {
										limit = {
											has_trait = intellect_bad_3
										}
										remove_trait = intellect_bad_3
										add_trait = intellect_bad_2
									}
									else_if = {
										limit = {
											has_trait = intellect_bad_2
										}
										remove_trait = intellect_bad_2
										add_trait = intellect_bad_1
									}
									else_if = {
										limit = {
											has_trait = intellect_bad_1
										}
										remove_trait = intellect_bad_1
									}
									else_if = {
										limit = {
											has_trait = intellect_good_1
											scope:recipient = {
												OR = {
													has_trait = intellect_good_3
													has_trait = intellect_good_2
												}
												
											}
										}
										remove_trait = intellect_good_1
										add_trait = intellect_good_2
									}
									else_if = {
										limit = {
											has_trait = intellect_good_2
											scope:recipient = {
												has_trait = intellect_good_3
											}
										}
										remove_trait = intellect_good_2
										add_trait = intellect_good_3
									}
									else = {
										add_trait = intellect_good_1
									}
								}	
							}
						}
							
							
						if = {
							limit = {
								has_trait = pure_blooded
							}
							scope:actor = {
								random = {
									chance = 75
									random_list = {
										10 = {
											trigger = {
												NOT = {
													has_trait = pure_blooded
												}
											}
											add_trait = pure_blooded
										}
										10 = {
											random_list = {
												10 = {
													send_interface_toast = {
														title = ic_pure_meal
														add_diplomacy_skill = 1
													}
												}
												10 = {
													send_interface_toast = {
														title = ic_pure_meal
														add_martial_skill = 1
													}
												}
												10 = {
													send_interface_toast = {
														title = ic_pure_meal
														add_stewardship_skill = 1
													}
												}
												10 = {
													send_interface_toast = {
														title = ic_pure_meal
														add_intrigue_skill = 1
													}
												}
												10 = {
													send_interface_toast = {
														title = ic_pure_meal
														add_learning_skill = 1
													}
												}
											}
										}
									}
								}
								
							}
						}
						if = {
							limit = {
								has_trait = source
								scope:actor = {
									NOR = {
										has_trait = source
										has_trait = source2
									}
								}
							}
							scope:actor = {
								random = {
									chance = 50
									add_trait = source
								}
							}
						}
	
						if = {
							limit = {
								has_trait = strong
								scope:actor = {
									NOT = {
										has_trait = strong
									}
								}
							}
							scope:actor = {
								random = {
									chance = 50
									if = {
										limit = {
											has_trait = weak
										}
										remove_trait = weak
									}
									else = {
										add_trait = strong
									}
									
								}
							}
						}

						if = {
							limit = {
								has_trait = fecund
								scope:actor = {
									NOT = {
										has_trait = fecund
									}
								}
							}
							scope:actor = {
								random = {
									chance = 50
									if = {
										limit = {
											has_trait = infertile
										}
										remove_trait = infertile
									}
									else = {
										add_trait = fecund
									}
								}
							}
						}

						if = {
							limit = {
								has_trait = shrewd
								scope:actor = {
									NOT = {
										has_trait = shrewd
									}
								}
							}
							scope:actor = {
								random = {
									chance = 50
									if = {
										limit = {
											has_trait = dull
										}
										remove_trait = dull
									}
									else = {
										add_trait = shrewd
									}
								}
							}
						}
					}
					
					if = {
						limit = {
							can_spend_standard_ps_trigger = yes
							scope:actor = {
								can_be_power_saturated_trigger = yes
							}
						}
						scope:actor = {
							gain_source_ps_effect = yes
						}
					}

					
					
					hidden_effect = {
						death = {
							killer = scope:actor
							#death_reason = death_eaten
							death_reason = death_murder
						}
					}
					
					
				}
				hidden_effect = {
					add_secret = {
						type = secret_murder
						target = scope:recipient
					}
				}
			}
		}
	}
	
	auto_accept = yes
	ai_potential = {
		NOR = {
			has_trait = compassionate
			has_trait = forgiving
			has_trait = temperate
		}
	}
	
	ai_targets = {
		ai_recipients = courtiers
		ai_recipients = prisoners
		ai_recipients = guests
		ai_recipients = scripted_relations
	}

	ai_frequency = 24

	ai_will_do = {
		base = 50
		modifier = {
			add = -150
			scope:recipient = {
				is_primary_heir_of = scope:actor
			}
		}
		modifier = {
			add = 30
			has_character_modifier = yaga_modifier
		}
		modifier = {
			add = -250
			has_character_modifier = yaga_modifier
			scope:recipient = {
				has_trait = source2
			}
		}
		modifier = {
			add = -250
			has_trait = source2
			scope:recipient = {
				has_trait = source2
			}
		}
	}
}


use_singularity = {
	target_type = title
	target_filter = recipient_domain_titles
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
			any_character_artifact = {
				has_variable = singularity
				NOT = {
					has_variable = singularity_sleeping
				}
			}
			is_imprisoned = no
			has_character_flag = singularity_solved2
		}
		scope:recipient = {
			is_landed = yes
		}	
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = is_incapable_custom
				NOT = { has_trait = incapable }
			}
		}
	}
	icon = icon_magic
	common_interaction = yes
	interface_priority = 90
	category = interaction_category_magic

	cooldown_against_recipient = { months = 6 } 
	cooldown = { months = 6 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = no
	#hidden = yes
	can_be_picked_title = {
		scope:target = {
			is_leased_out = no
			tier = tier_county
		}
	}
	on_accept = {
		scope:target = {
			save_scope_as = ttile
		}
		scope:actor = {
			add_dread = 50
			gain_sc_xp1_effect = yes
		}
		
		custom_tooltip = use_singularity_ct
		scope:target.title_province = {
			add_province_modifier = {
				modifier = magical_radiation_modifier
				years = 50
			}
		}
		custom_tooltip = use_singularity_ct2
		
		hidden_effect = {
			scope:actor = {
				save_scope_as = magic_user
				send_message_4all_magic_sense_effect = yes
				spend_standard_ps_effect = yes
			}
			every_living_character = {
				limit = {
					exists = location
					location = scope:target.title_province
					NOR = {
						any_character_artifact = { has_variable = magic_ring }
						has_character_modifier = amp_modifier
					}
				}
				random_list = {
					80 = {
						death = natural
					}
					5 = {
						add_trait = incapable
					}
					5 = {
						add_trait = cancer
						add_trait = wounded_2
						add_trait = infertile
					}
					3 = {
						add_trait = cancer
						add_trait = wounded_1
						add_trait = disfigured
						add_trait = infertile
					}
					2 = {
						add_trait = cancer
						add_trait = wounded_1
						add_trait = lunatic_1
						add_trait = infertile
					}
					5 = {
						add_trait = cancer
						add_trait = wounded_1
						add_trait = blind
						add_trait = infertile
					}
				}
				
			}
			every_living_character = {
				limit = {
					is_ai = no
				}
				trigger_event = {
					id = magic_ev2.74
					days = { 2 6 }
				}
			}
			
			scope:actor = {
				random = {
					chance = 10
					if = {
						limit = {
							NOT = {
								any_courtier_or_guest = {
									has_trait = witch_hunter
								}
							}
						}
						create_character = {
							employer = scope:actor
							template = witch_hunter_character
							save_scope_as = whunter
						}
						scope:whunter = {
							add_perk = protective_runes_perk
							add_perk = magical_senses_perk
						}
					}
				}
				metamagic_effect = yes
			}
			trigger_event = {
				id = magic_ev2.77
				days = { 6 12 }
			}
			random = {
				chance = 40
				trigger_event = {
					id = magic_ev2.79
					days = { 21 24 }
				}
			}
		}
		
	}
	
	auto_accept = yes
	ai_potential = {
		NOT = {
			has_trait = compassionate
		}
	}
	
	ai_targets = {
		ai_recipients = neighboring_rulers
		ai_recipients = war_enemies
		ai_recipients = scripted_relations
	}

	ai_frequency = 60

	ai_will_do = {
		base = 0
		
		modifier = {
			add = 50
			scope:recipient = {
				OR = {
					has_relation_rival = scope:actor
					has_relation_nemesis = scope:actor
					#has_relation_potential_rival = scope:actor
					is_at_war_with = scope:actor
				}
			}
		}
	}
}

death_wish = {
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
			has_character_flag = death_wish
			is_imprisoned = no
		}
		scope:recipient = {
			NOT = { has_relation_mminion = scope:actor }
		}	
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			custom_description = {
				text = is_incapable_custom
				NOT = { has_trait = incapable }
			}
		}
		scope:recipient = {
			custom_description = {
				text = magic_protection_custom
				NOR = {
					any_character_artifact = { has_variable = magic_ring }
					is_immortal = yes
					has_character_modifier = samael_blessing
					has_character_modifier = amp_modifier
					AND = {
						has_trait = archmage
						has_trait_xp = {
							trait = archmage
							track = secret_knowledge
							value > 99
						}
					}
				}
			}
		}
	}
	icon = icon_magic
	common_interaction = yes
	interface_priority = 90
	popup_on_receive = no
	category = interaction_category_magic

	cooldown_against_recipient = { years = 1 } 
	cooldown = { months = 1 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = no
	#hidden = yes
	
	on_accept = {
		scope:actor = {
			save_scope_as = magic_user
			#add_character_flag = {
			#	flag = magic_user
			#	years = 5
			#}
			send_message_4_magic_sense_effect = yes
			scope:recipient = {
				save_scope_as = reci
			}
			
			send_interface_message = {
				type = event_generic_neutral
				title = death_wish_title
				#desc = "send_interface_message_text"
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = use_magic_custom_tooltip
				custom_tooltip = death_wish_ct
				gain_sc_xp1_effect = yes
				remove_character_flag = death_wish
				scope:recipient = {
					death = natural
				}
			}
		}
	}
	
	auto_accept = yes
	ai_potential = {
		NOT = {
			has_trait = compassionate
		}
	}
	
	ai_targets = {
		ai_recipients = neighboring_rulers
		ai_recipients = vassals
		ai_recipients = liege
		ai_recipients = courtiers
		ai_recipients = war_enemies
		ai_recipients = scripted_relations
	}

	ai_frequency = 24

	ai_will_do = {
		base = 0
		
		modifier = {
			add = 80
			scope:recipient = {
				OR = {
					has_relation_rival = scope:actor
					has_relation_nemesis = scope:actor
					#has_relation_potential_rival = scope:actor
					is_at_war_with = scope:actor
				}
			}
		}
	}
}


teach_sorcery = {
	
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
			OR = {
				has_trait = archmage
				has_trait = archmage2
			}
			is_imprisoned = no
		}
		scope:recipient = {
			is_adult = yes
			NOR = {
				has_trait = demon
				has_trait = witch_hunter
			}
		}	
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			custom_description = {
				text = is_incapable_custom
				NOT = { has_trait = incapable }
			}
		}
		scope:recipient = {
			#custom_description = {
			#	text = "cast_curse_custom_desc"
			#	}
			custom_description = {
				text = must_be_witch_custom
				OR = {
					has_trait = witch
					has_trait = true_witch
					any_secret = {
						secret_type = secret_witch
						is_known_by = scope:actor
					}
				}
			}
			custom_description = {
				text = is_sorcer_custom
				NOR = {
					has_focus = arcane_focus
					has_trait = archmage
					has_character_flag = start_sorcery_training
					has_perk = magical_experiments_p1_perk
				}
			}
		}
	}
	icon = icon_learning
	common_interaction = yes
	interface_priority = 90
	category = interaction_category_magic
	desc = teach_sorcery_desc
	#prompt = "cast_curse_prompt_text"
	#custom_description="cast_curse_custom_desc"
	#notification_text = cast_curse_notification_text

	cooldown_against_recipient = { years = 20 } 
	cooldown = { years = 20 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = yes
	#hidden = yes
	
	on_accept = {
		scope:actor = {
			
			send_interface_message = {
				type = event_generic_neutral
				title = teach_sorcery
				desc = "send_interface_message_text"
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = teach_sorcery_custom_tooltip
				custom_tooltip =  teach_sorcery_custom_tooltip3
				#tooltip="tooltip0"
				stress_impact = {
					arrogant = minor_stress_impact_gain
					paranoid = major_stress_impact_gain
					lazy = medium_stress_impact_gain
					trusting = minor_stress_impact_loss
				}
				scope:recipient = {
					trigger_event = magic_ev3.10
					custom_tooltip = teach_sorcery_custom_tooltip2
				}
			}
		}
	}
	
	auto_accept = yes
	ai_potential = {
		NOT = {
			has_trait = paranoid
			has_trait = lazy
		}
	}
	
	ai_targets = {
		ai_recipients = children
		ai_recipients = scripted_relations
	}

	ai_frequency = 24

	ai_will_do = {
		base = -30
		
		modifier = {
			add = 80
			scope:recipient = {
				OR = {
					has_relation_friend = scope:actor
					has_relation_best_friend = scope:actor
					has_relation_soulmate = scope:actor
					is_heir_of = scope:actor
				}
			}
		}
		modifier = {
			add = 10
			scope:recipient = {
				has_trait = lifestyle_mystic
			}
		}
		modifier = {
			add = 20
			scope:recipient = {
				OR = {
					has_trait = shrewd
					has_trait = intellect_good_1
					has_trait = intellect_good_2
					has_trait = intellect_good_3
				}
			}
		}
		modifier = {
			add = -50
			scope:actor = {
				OR = {
					has_trait = paranoid
					has_trait = lazy
				}
			}
		}
	}
}

witch_trial = {
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
				is_adult = yes
				has_trait = witch_hunter
				#has_trait_xp = {
				#	trait = supernatural_hunter
				#	track = witch_hunting
				#	value > 29
				#}
				is_imprisoned = no
		}
		scope:recipient = {
			is_adult = yes
			is_imprisoned_by = scope:actor
		}	
	}
	#is_valid_showing_failures_only = {
	#	
	#}
	icon = torture_interaction
	common_interaction = yes
	interface_priority = 90
	category = interaction_category_prison
	desc = witch_trial_desc
	#prompt = "cast_curse_prompt_text"
	#custom_description="cast_curse_custom_desc"
	#notification_text = cast_curse_notification_text

	cooldown_against_recipient = { days = 7 } 
	cooldown = { days = 7 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = yes
	#hidden = yes
	
	on_accept = {
		scope:actor = {
			
			send_interface_message = {
				type = event_generic_neutral
				title = witch_trial
				desc = "send_interface_message_text"
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = witch_trial_ct
				custom_tooltip = witch_trial_ct3
				#tooltip="tooltip0"
				stress_impact = {
					compassionate = minor_stress_impact_gain
				}
				scope:recipient = {
					custom_tooltip = witch_trial_ct2
				}
				trigger_event = magic_ev3.54
			}
		}
	}
	
	auto_accept = yes
}

stop_the_witch = {
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
				is_ruler = yes
				is_adult = yes
				has_trait = witch_hunter
				has_trait_xp = {
					trait = supernatural_hunter
					track = witch_hunting
					value > 29
				}
				is_imprisoned = no
		}
		scope:recipient = {
			is_adult = yes
			is_imprisoned = no
			OR = {
				has_trait = witch
				has_trait = true_witch
				has_trait = archmage
				has_trait = demon
				has_focus = witch_focus
				has_focus = magic_focus
				any_secret = {
					secret_type = secret_witch
					is_known_by = scope:actor
				}
			}
		}	
	}
	is_valid_showing_failures_only = {
		scope:recipient = {
			custom_description = {
				text = has_hook_on_you_custom
				NOT = { has_hook = scope:actor }
			}
		}
	}
	icon = torture_interaction
	common_interaction = yes
	interface_priority = 90
	popup_on_receive = no
	category = interaction_category_hostile
	desc = stop_the_witch_desc
	#cooldown_against_recipient = { years = 4 } 
	#cooldown = { years = 4 } 

	cooldown_against_recipient = { years = 2 } 
	cooldown = { years = 2 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = yes
	
	on_accept = {
		scope:actor = {
			
			send_interface_message = {
				type = event_generic_neutral
				title = stop_the_witch
				desc = "send_interface_message_text"
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = stop_the_witch_ct
				#custom_tooltip = witch_trial_ct3
				#tooltip="tooltip0"
				stress_impact = {
					compassionate = minor_stress_impact_gain
				}
				scope:recipient = {
					custom_tooltip = stop_the_witch_ct2
				}
				if = {
					limit = {
						scope:recipient = {
							is_landed = yes
						}
					}
					trigger_event = {
						id = magic_ev4.10
						#days = { 2 5 }
					}
				}
				else = {
					trigger_event = {
						id = magic_ev4.2
						#days = { 2 4 }
					}
				}
			}
		}
	}
	
	auto_accept = yes
}

fed_dark_blade_interaction = {
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {	any_equipped_character_artifact = {	has_variable = dark_blade	}	is_imprisoned = no	}
		scope:recipient = {	is_imprisoned_by = scope:actor	}
	}
	#is_valid_showing_failures_only = {
	#	
	#}
	icon = icon_magic
	common_interaction = yes
	interface_priority = 90
	popup_on_receive = no
	category = interaction_category_hostile
	desc = fed_dark_blade_interaction_desc
	cooldown_against_recipient = { months = 1 } 
	cooldown = { months = 1 } 

	#cooldown_against_recipient = { days = 1 } 
	#cooldown = { days = 1 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = yes
	
	on_accept = {
		scope:actor = {
			send_interface_message = {
				type = event_generic_neutral
				title = fed_dark_blade_interaction
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = fed_dark_blade_interaction_ct
				custom_tooltip = use_magic_custom_tooltip
				send_interface_toast = {
					title=dark_blade_fed
					custom_tooltip = dark_blade_fed_ct
					if = {
						limit = {
							can_be_power_saturated_trigger = yes
						}
						gain_standard_ps_effect = yes
					}
				}
				
				#custom_tooltip = witch_trial_ct3
				#tooltip="tooltip0"
				stress_impact = {
					compassionate = major_stress_impact_gain
				}
				scope:recipient = {
					death = {
						death_reason = death_murder
						killer = scope:actor
					}
				}
			}
			dark_blade_grows_stronger = yes
		}
	}
	
	auto_accept = yes
}

demand_submission_cgm_interaction = {
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {	
			is_imprisoned = no
			is_adult = yes
			exists = house
			has_trait = grandmaster_coven
		}
		scope:recipient = {
			is_imprisoned = no
			is_adult = yes
			OR = {
				has_trait = witch
				any_secret = {
					secret_type = secret_witch
					is_known_by = scope:actor
				}
			}
		}
		OR = {
			AND = {
				scope:actor = {	
					has_trait_xp = {
						trait = grandmaster_coven
						value > 29
					}
				}
				scope:recipient = {	
					exists = house
					house = scope:actor.house
				}
			}
			AND = {
				scope:actor = {	
					has_trait_xp = {
						trait = grandmaster_coven
						value > 99
					}
					OR = {
						any_vassal_or_below = {
							this = scope:recipient
						}
						any_vassal_or_below = {
							any_courtier_or_guest = {
								this = scope:recipient
							}
						}
						any_courtier_or_guest = {
							this = scope:recipient
						}
					}
				}
				scope:recipient = {	
					OR = {
						AND = {
							exists = house
							house = {
								NOT = {
									has_house_modifier = witch_coven
								}
							}
						}
						is_lowborn = yes
					}
				}
			}
		}
	}
	#is_valid_showing_failures_only = {
	#	
	#}
	icon = icon_grandmaster_coven
	ai_maybe = yes
	ai_min_reply_days = 1
	ai_max_reply_days = 1
	common_interaction = yes
	interface_priority = 100
	category = interaction_category_diplomacy
	desc = demand_submission_cgm_interaction_desc
	greeting = negative
	notification_text = DEMAND_SUBMISSION_PROPOSAL
	cooldown_against_recipient = { years = 20 } 
	cooldown = { years = 1 }
	can_send_despite_rejection = yes
	popup_on_receive = yes
	pause_on_receive = yes


	#answer_accept_key = SEND_GIFT_ACCEPT
	#answer_reject_key = SEND_GIFT_REJECT
	
	#pre_answer_maybe_key = ANSWER_MIGHT_SUCCEED
	#pre_answer_no_key = ANSWER_CANT_SUCCEED
	#pre_answer_yes_key = ANSWER_WILL_SUCCEED
	#pre_answer_maybe_breakdown_key = ANSWER_SUM_CHANCE

	use_diplomatic_range = yes
	#send_options_exclusive = no
	#on_decline_summary = imprison_decline_summary
	
	on_accept = {
		scope:actor = {
			hidden_effect = {
				if = {
					limit = {
						has_hook = scope:recipient
					}
					remove_hook = {
						target = scope:recipient
					}
				}
			}
			send_interface_message = {
				type = event_generic_neutral
				title = demand_submission_cgm_interaction
				left_icon = scope:actor
				right_icon = scope:recipient
				add_hook = {
					type = loyalty_hook
					target = scope:recipient
				}
				add_trait_xp = {
					trait = grandmaster_coven
					value = 5
				}
				
				scope:recipient = {
					add_opinion = {
						target = scope:actor
						modifier = disgusted_opinion
						opinion = -5
					}
					if = {
						limit = {
							NOT = {	faith = scope:actor.faith	}
						}
						set_character_faith_with_conversion = scope:actor.faith
					}
					if = {
						limit = {
							is_independent_ruler = yes
							highest_held_title_tier < scope:actor.highest_held_title_tier
						}
						create_title_and_vassal_change = {
							type = swear_fealty
							save_scope_as = change
						}
						change_liege = {
							liege = scope:actor
							change = scope:change
						}
						resolve_title_and_vassal_change = scope:change
					}
				}
			}
		}
	}
	on_decline = {
		scope:actor = {
			send_interface_message = {
				type = event_generic_neutral
				title = demand_submission_cgm_interaction
				left_icon = scope:actor
				right_icon = scope:recipient
				#add_opinion = {
				#	target = scope:recipient
				#	modifier = disgusted_opinion
				#	opinion = -30
				#}
				if = {
					limit = {
						has_trait_xp = {
							trait = grandmaster_coven
							value > 4
						}
					}
					add_trait_xp = {
						trait = grandmaster_coven
						value = -5
					}
				}
				add_opinion = {
					target = scope:recipient
					modifier = treasonous_imprison_refusal
					#opinion = -30
				}
				
				scope:recipient = {
					add_opinion = {
						target = scope:actor
						modifier = disgusted_opinion
						opinion = -30
					}
				}
			}
		}
	}
	
	ai_accept = {
		base = 0
		modifier = {
			add = {
				value = scope:actor.diplomacy
				multiply = 3
			}
			desc = DS_DIPLOMACY_ACTOR
		}
		modifier = {
			add = -50
			scope:recipient = {
				has_trait = arrogant
			}
			desc = DS_IS_ARROGANT
		}
		modifier = {
			add = 20
			scope:recipient = {
				has_trait = craven
			}
			desc = DS_IS_CRAVEN
		}
		opinion_modifier = { # Opinion Factor
			who = scope:recipient
			opinion_target = scope:actor
			multiplier = 0.5
			desc = AI_OPINION_REASON
		}
		modifier = {
			add = 20
			scope:actor = {
				any_vassal_or_below = { this = scope:recipient }
			}
			desc = DS_IS_VASSAL
		}
		modifier = {
			add = 50
			scope:actor = {
				any_courtier_or_guest = { this = scope:recipient }
			}
			desc = DS_IS_VASSAL
		}
		modifier = {
			add = 20
			scope:recipient = {
				is_lowborn = yes
			}
			desc = DS_I_AM_NOBODY
		}
		modifier = {
			add = 20
			scope:actor = {
				has_trait_xp = {
					trait = grandmaster_coven
					value > 99
				}
			}
			desc = DS_HIGH_AUTH
		}
		modifier = {
			add = -200
			scope:actor = {
				OR = {
					has_relation_rival = scope:recipient
					has_relation_nemesis = scope:recipient
				}
			}
			desc = DS_YOUR_RIVAL
		}
		modifier = {
			add = intimidated_halved_reason_value
			scope:recipient = {
				target_is_liege_or_above = scope:actor
				has_dread_level_towards = {
					target = scope:actor
					level = 1
				}
			}
			desc = INTIMIDATED_REASON
		}
		modifier = {
			add = intimidated_external_reason_value
			scope:recipient = {
				NOT = { target_is_liege_or_above = scope:actor }
				has_dread_level_towards = {
					target = scope:actor
					level = 1
				}
			}
			desc = INTIMIDATED_REASON
		}
	}
	ai_targets = {
		ai_recipients = vassals
		chance = 0.5
	}
	ai_targets = {
		ai_recipients = family
		chance = 0.25
	}
	ai_targets = {
		ai_recipients = courtiers
		chance = 0.25
	}
	ai_frequency = 24
	ai_will_do = {
		base = 50
	}
	auto_accept = no
}

send_agent_cgm_interaction = {
	is_shown = {
		NOT = { scope:recipient = scope:actor }
		scope:actor = {	
			is_imprisoned = no
			is_adult = yes
			exists = house
			has_trait = grandmaster_coven
			has_trait_xp = {
				trait = grandmaster_coven
				value > 64
			}
		}
		scope:recipient = {	
			is_ruler = yes
			is_landed = yes
		}
	}
	#is_valid_showing_failures_only = {
	#	
	#}
	icon = icon_grandmaster_coven
	common_interaction = yes
	interface_priority = 90
	popup_on_receive = no
	category = interaction_category_hostile
	desc = send_agent_cgm_interaction_desc
	cooldown_against_recipient = { years = 2 } 
	cooldown = { years = 2 } 

	#cooldown_against_recipient = { days = 1 } 
	#cooldown = { days = 1 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = yes
	
	on_accept = {
		scope:actor = {
			send_interface_message = {
				type = event_generic_neutral
				title = send_agent_cgm_interaction
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = send_agent_cgm_interaction_ct
				custom_tooltip = send_agent_cgm_interaction_ct2
				if = {
					limit = {
						scope:send_agent_cgm_secrets = yes
					}
					custom_tooltip = send_agent_cgm_interaction_ct4
				}
				else_if = {
					limit = {
						scope:send_agent_cgm_magic_item = yes
					}
					custom_tooltip = send_agent_cgm_interaction_ct6
				}
				
				scope:recipient = {
					custom_tooltip = send_agent_cgm_interaction_ct3
					if = {
						limit = {
							scope:send_agent_cgm_sow_dis = yes
						}
						hidden_effect = {
							capital_county = {
								add_county_modifier = {
									modifier = medium_investment_in_revolt_modifier
									years = 2
								}
							}
							add_character_modifier = {
								modifier = problems_with_merchants_modifier
								years = 2
							}
						}
						custom_tooltip = send_agent_cgm_interaction_ct5
					}
					else_if = {
						limit = {
							scope:send_agent_cgm_rep_sab = yes
						}
						add_character_modifier = {
							modifier = harmful_rumors_modifier
							years = 1
						}
					}
				}
			}
		}
		hidden_effect = {
			create_common_witch_effect3 = yes
			scope:created_witch = {
				add_secret = {
					type = secret_witch
					target = scope:created_witch
				}
				random_secret = {
					limit = {
						secret_type = secret_witch
					}
					reveal_to = scope:actor
				}
				set_relation_mmaster = scope:actor
				add_character_modifier = {
					modifier = special_task_modifier
					years = 1
				}
				add_opinion = {
					target = scope:recipient
					modifier = friendliness_opinion
					opinion = 50
				}
			}
			scope:actor = {
				send_interface_toast = {
					title = send_agent_cgm_interaction
					left_icon = scope:created_witch
					add_hook_no_toast = {
						type = loyalty_hook
						target = scope:created_witch
					}
				}
				if = {
					limit = {
						scope:send_agent_cgm_secrets = yes
					}
					trigger_event = {
						id = magic_ev4.80
						months = { 2 3 }
					}
				}
				if = {
					limit = {
						scope:send_agent_cgm_magic_item = yes
					}
					scope:recipient = {
						trigger_event = {
							id = magic_ev4.81
							months = { 2 3 }
						}
					}
				}
			}
		}
	}
	options_heading = send_agent_cgm_option_title
	send_option = {
		flag = send_agent_cgm_secrets
		localization = SEND_AGENT_CMG_O1
	}
	send_option = {
		flag = send_agent_cgm_sow_dis
		localization = SEND_AGENT_CMG_O2
	}
	send_option = {
		flag = send_agent_cgm_rep_sab
		localization = SEND_AGENT_CMG_O3
	}
	send_option = {
		is_shown = {
			scope:recipient = {
				OR = {
					any_character_artifact = { has_variable = magic1 }
					any_courtier_or_guest = {
						any_character_artifact = { has_variable = magic1 }
					}
				}
			}
		}
		flag = send_agent_cgm_magic_item
		localization = SEND_AGENT_CMG_O4
	}

	auto_accept = yes
}