namespace = magic_ev3
#set_local_variable=htargets
#Samael - intro
magic_ev3.1 = {
	title = ev3.1.title
	type = character_event
	desc = ev3.1.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	#immediate = {
	#
	#}

	option = {
		#Let's get down to business
		name = ev3.101.a
		trigger_event = magic_ev3.2
	}
	option = {
		#Maybe I'll release you
		name = ev3.101.b
		trigger = {
			OR = {
				any_living_character = {
					has_character_flag = bael_flag
				}
				any_living_character = {
					has_character_flag = belial
				}
				any_living_character = {
					has_character_flag = astaroth_flag
				}
				any_living_character = {
					has_character_flag = lilith
				}
				any_living_character = {
					has_character_flag = moloch
				}
			}
			
		}
		trigger_event = magic_ev3.5
	}
	option = {
		#I dont need you
		name = ev3.101.c
		add_stress = medium_stress_loss
		trigger_event = magic_ev.18
	}
}

#Samael - speak, mage
magic_ev3.2 = {
	title = ev3.1.title
	type = character_event
	desc = ev3.2.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	
	option = {
		#What can you offer me?
		name = ev3.102.a
		trigger_event = magic_ev3.3
	}
	option = {
		#fulfil my will!
		name = ev3.102.b
		trigger_event = magic_ev3.4
	}
}

#Samaels offer
magic_ev3.3 = {
	title = ev3.1.title
	type = character_event
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:wwar
				}
				desc = ev3.3.desc2
			}
			desc = ev3.3.desc
		}
	}
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	immediate = {
		if = {
			limit = {
				OR = {
					any_character_war = {
						primary_attacker = root
					}
					any_character_war = {
						primary_defender = root
					}
				}
			}
			random_character_war = {
				limit = {
					OR = {
						primary_attacker = root
						primary_defender = root
					}
				}
				save_scope_as = wwar
			}
		}
		
	}
	option = {
		#death wish
		name = ev3.103.a
		custom_tooltip = ev3.103.a_ct
		add_character_flag = death_wish
		trigger_event = magic_ev.18
	}
	option = {
		#protect my heir
		name = ev3.103.b
		trigger = {
			exists = root.primary_heir
		}
		root.primary_heir = {
			if = {
				limit = {
					NOT = { has_character_modifier = samael_blessing }
				}
				add_character_modifier = samael_blessing
			}
			else = {
				add_diplomacy_skill = 2
				add_martial_skill = 2
				add_stewardship_skill = 2
				add_intrigue_skill = 2
				add_learning_skill = 2
				add_prowess_skill = 2
			}
			if = {
				limit = {
					NOT = { has_trait = source }
				}
				random = {
					chance = 25
					add_trait = source
				}
			}
		}
		trigger_event = magic_ev.18
	}
	option = {
		#win my war
		name = ev3.103.c
		trigger = {
			exists = scope:wwar
		}
		scope:wwar = {
			if = {
				limit = {
					primary_attacker = root
				}
				end_war = attacker
			}
			else = {
				end_war = defender
			}
		}
		trigger_event = magic_ev.18
		clear_saved_scope = wwar
	}
}

#Samael - I fullfil your will
magic_ev3.4 = {
	title = ev3.1.title
	type = character_event
	desc = ev3.4.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	
	option = {
		#clear my mind
		name = ev3.4.a
		trigger = {
			OR = {
				has_trait = lunatic_1
				has_trait = lunatic_genetic
				has_trait = depressed_1
				has_trait = depressed_genetic
				has_trait = dull
				has_trait = intellect_bad_1
				has_trait = intellect_bad_2
				has_trait = intellect_bad_3
			}
		}
		add_stress = major_stress_loss
		if = {
			limit = {
				has_trait = dull
			}
			remove_trait = dull
		}
		if = {
			limit = {
				has_trait = intellect_bad_1
			}
			remove_trait = intellect_bad_1
		}
		if = {
			limit = {
				has_trait = intellect_bad_2
			}
			remove_trait = intellect_bad_2
		}
		if = {
			limit = {
				has_trait = intellect_bad_3
			}
			remove_trait = intellect_bad_3
		}
		if = {
			limit = {
				has_trait = lunatic_1
			}
			remove_trait = lunatic_1
		}
		if = {
			limit = {
				has_trait = lunatic_genetic
			}
			remove_trait = lunatic_genetic
		}
		if = {
			limit = {
				has_trait = depressed_1
			}
			remove_trait = depressed_1
		}
		if = {
			limit = {
				has_trait = depressed_genetic
			}
			remove_trait = depressed_genetic
		}
		trigger_event = magic_ev.18
	}
	option = {
		#clear my soul
		name = ev3.4.b
		trigger = {
			OR = {
				has_trait = possessed_1
				has_trait = possessed_genetic
				has_character_modifier = cursed_modifier
				has_character_modifier = lifestolen_modifier
				has_character_modifier = infertile_modifier
				has_character_modifier = cursed_gold_modifier
				has_character_modifier = fucked_by_demon_modifier
			}
		}
		if = {
			limit = {
				has_character_modifier = fucked_by_demon_modifier
			}
			remove_character_modifier = fucked_by_demon_modifier
		}
		if = {
			limit = {
				has_character_modifier = cursed_gold_modifier
			}
			remove_character_modifier = cursed_gold_modifier
		}
		if = {
			limit = {
				has_character_modifier = infertile_modifier
			}
			remove_character_modifier = infertile_modifier
		}
		if = {
			limit = {
				has_character_modifier = lifestolen_modifier
			}
			remove_character_modifier = lifestolen_modifier
		}
		if = {
			limit = {
				has_character_modifier = cursed_modifier
			}
			remove_character_modifier = cursed_modifier
		}
		if = {
			limit = {
				has_trait = possessed_1
			}
			remove_trait = possessed_1
		}
		if = {
			limit = {
				has_trait = possessed_genetic
			}
			remove_trait = possessed_genetic
		}
		trigger_event = magic_ev.18
	}
	option = {
		#Give me amp
		name = ev3.4.c
		trigger = {
			has_trait = craven
			NOT = {
				has_trait = paranoid
			}
		}
		trait = craven
		add_character_modifier = {
			modifier = amp_modifier
			years = 25
		}
		trigger_event = magic_ev.18
	}
	option = {
		#Give me amp
		name = ev3.4.c
		trigger = {
			has_trait = paranoid
		}
		trait = paranoid
		add_character_modifier = {
			modifier = amp_modifier
			years = 25
		}
		trigger_event = magic_ev.18
	}
	option = {
		#Give me secret knowledge
		name = ev3.4.d
		
		add_character_modifier = {
			modifier = secret_knowledge_modifier
			years = 15
		}
		trigger_event = magic_ev.18
	}
	option = {
		#strengthen my mind
		name = ev3.4.e
		add_diplomacy_skill = 1
		add_martial_skill = 1
		add_stewardship_skill = 1
		add_intrigue_skill = 1
		add_learning_skill = 1
		add_prowess_skill = 1
		hidden_effect = {
			if = {
				limit = {
					has_trait = dull
				}
				remove_trait = dull
			}
		}
		
		if = {
			limit = {
				NOT = {
					has_trait = shrewd
				}
			}
			add_trait_force_tooltip = shrewd
		}

		trigger_event = magic_ev.18
	}
	option = {
		name = ev3.4.f
		if = {
			limit = {
				NOR = {
					has_trait = blademaster_1
					has_trait = blademaster_2
					has_trait = blademaster_3
				}
			}
			add_trait = blademaster_2
			add_prowess_skill = 3
		}
		else_if = {
			limit = {
				has_trait = blademaster_3
			}
			add_prowess_skill = 8
		}
		else_if = {
			limit = {
				has_trait = blademaster_1
			}
			hidden_effect = {
				remove_trait = blademaster_1
			}
			add_trait_force_tooltip = blademaster_3
			add_prowess_skill = 3
		}
		else_if = {
			limit = {
				has_trait = blademaster_2
			}
			hidden_effect = {
				remove_trait = blademaster_2
			}
			add_trait_force_tooltip = blademaster_3
			add_prowess_skill = 3
		}
		trigger_event = magic_ev.18
	}
}

#Samael - where's the catch?
magic_ev3.5 = {
	title = ev3.1.title
	type = character_event
	desc = ev3.5.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	
	option = {
		#Kill Bael
		name = ev3.5.a
		trigger = {
			any_living_character = {
				has_character_flag = bael_flag
			}
		}
		trigger_event = {
			id = magic_ev3.6
			days = { 4 8 }
		}
		custom_tooltip = ev3.5_ct
		random_living_character = {
			limit = {
				has_character_flag = bael_flag
			}
			death = natural
		}
	}
	option = {
		#Kill Belial
		name = ev3.5.b
		trigger = {
			any_living_character = {
				has_character_flag = belial
			}
		}
		trigger_event = {
			id = magic_ev3.6
			days = { 4 8 }
		}
		custom_tooltip = ev3.5_ct
		random_living_character = {
			limit = {
				has_character_flag = belial
			}
			death = natural
		}
	}
	option = {
		#Kill Astaroth
		name = ev3.5.c
		trigger = {
			any_living_character = {
				has_character_flag = astaroth_flag
			}
		}
		trigger_event = {
			id = magic_ev3.6
			days = { 4 8 }
		}
		custom_tooltip = ev3.5_ct
		random_living_character = {
			limit = {
				has_character_flag = astaroth_flag
			}
			death = natural
		}
	}
	option = {
		#Kill Lilith
		name = ev3.5.d
		trigger = {
			any_living_character = {
				has_character_flag = lilith
			}
		}
		trigger_event = {
			id = magic_ev3.6
			days = { 4 8 }
		}
		custom_tooltip = ev3.5_ct
		random_living_character = {
			limit = {
				has_character_flag = lilith
			}
			death = natural
		}
	}
	option = {
		#Kill Moloch
		name = ev3.5.f
		trigger = {
			any_living_character = {
				has_character_flag = moloch
			}
		}
		trigger_event = {
			id = magic_ev3.6
			days = { 4 8 }
		}
		custom_tooltip = ev3.5_ct
		random_living_character = {
			limit = {
				has_character_flag = moloch
			}
			death = natural
		}
	}
	option = {
		#I changed my mind
		name = ev3.5.e
		trigger_event = magic_ev3.3
	}
}

#Samael - return
magic_ev3.6 = {
	title = ev3.1.title
	type = character_event
	desc = ev3.6.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	immediate = {
		random_character_artifact = {
			limit = {
				has_variable=magic1
			}
			save_scope_as = aart
		}
	}
	option = {
		#Take my courtiers
		name = ev3.6.a
		every_courtier_or_guest = {
			limit = {
				NOR = {
					root.primary_spouse = this
					root.primary_partner = this
				}
			}
			death = {
				death_reason = death_murder
				killer = scope:demon
			}
		}
		trigger_event = magic_ev3.9
	}
	option = {
		#take my magic items
		name = ev3.6.b
		trigger = {
			exists = scope:aart
		}
		scope:aart = {
			set_owner = {
				target = scope:demon
				history = {
					type = given
					actor = root
					recipient = scope:demon
					location = root.location
				}
			}
		}
		trigger_event = magic_ev3.9
	}
	option = {
		#I can banish you...
		name = ev3.6.c
		trigger = {
			has_trait = archmage
			any_character_artifact = {
				has_variable = blackgrimoire
			}
		}
		trait = archmage
		trigger_event = magic_ev3.8
	}
	option = {
		#Im banishing you!
		name = ev3.6.d
		trigger = {
			has_trait = archmage
			any_character_artifact = {
				has_variable = blackgrimoire
			}
			OR = {
				has_character_modifier = power_saturated1
				has_character_modifier = power_saturated2
			}
		}
		trait = archmage
		scope:demon = {
			death = natural
		}
		if = { limit = { has_character_modifier = power_saturated1 }
			remove_character_modifier = power_saturated1
		}
		if = { limit = { has_character_modifier = power_saturated2 }
			remove_character_modifier = power_saturated2
		}
		clear_saved_scope = demon
		if = {
			limit = {
				exists = scope:aart
			}
			clear_saved_scope = aart
		}
	}
	option = {
		#Ive got something better for you
		name = ev3.6.e
		trigger = {
			is_male = no
			has_trait = lustful
			is_attracted_to_gender_of = scope:demon
		}
		trait = lustful
		had_sex_with_effect = {
			CHARACTER = scope:demon
			PREGNANCY_CHANCE = seduce_pregnancy_chance
		}
		trigger_event = magic_ev3.7
	}
}

#Samael - bye1
magic_ev3.7 = {
	title = ev3.1.title
	type = character_event
	desc = ev3.7.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	trigger = {
		is_alive = yes
	}

	option = {
		#farewell
		name = ev3.7.a
		scope:demon = {
			move_to_pool = yes
		}
	}
	after = {
		clear_saved_scope = demon
	}
}

#Samael - bye2
magic_ev3.8 = {
	title = ev3.1.title
	type = character_event
	desc = ev3.8.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	trigger = {
		is_alive = yes
	}

	option = {
		#May we never meet again
		name = ev3.9.a
		scope:demon = {
			move_to_pool = yes
		}
	}
	after = {
		clear_saved_scope = demon
	}
}

#Samael - bye3
magic_ev3.9 = {
	title = ev3.1.title
	type = character_event
	desc = ev3.7.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	trigger = {
		is_alive = yes
	}

	option = {
		#May we never meet again
		name = ev3.9.a
		scope:demon = {
			move_to_pool = yes
		}
	}
	after = {
		clear_saved_scope = demon
		if = {
			limit = {
				exists = scope:aart
			}
			clear_saved_scope = aart
		}
	}
}

#Sorcery Teaching - Offer Sent
magic_ev3.10 = {
	title = ev3.10.title
	type = character_event
	desc = ev3.10.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:actor
	trigger = {
		is_alive = yes
	}
	immediate = {
		save_scope_as = disciple
		clear_saved_scope = recipient
	}

	option = {
		#yes, teach me!
		name = ev3.10.a
		custom_tooltip = ev3.10.a_ct
		show_as_tooltip = {
			scope:actor = {
				add_hook = {
					type = loyalty_hook
					target = root
				}
			}
		}
		scope:actor = {
			trigger_event = magic_ev3.11
		}
		hidden_effect = {
			add_character_flag = {
				flag = start_sorcery_training
				years = 10
			}
		}
		
		ai_chance = {
			base = 100
			modifier = {
				add = -200
				scope:actor = {
					OR = {
						has_relation_rival = root
						has_relation_nemesis = root

					}
				}
			}
		}
	}
	option = {
		#I dont need this...
		name = ev3.10.b
		stress_impact = {
			arrogant = medium_stress_loss
		}
		scope:actor = {
			add_opinion = {
				target = root
				modifier = refuse_sorcery_training_modifier
			}
			trigger_event = magic_ev3.12
		}
		#clear_saved_scope = actor
		#clear_saved_scope = recipient
		ai_chance = {
			base = 1
			
		}
	}
}

#Sorcery teaching - offer accepted
magic_ev3.11 = {
	title = ev3.10.title
	type = character_event
	desc = ev3.11.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:disciple
	trigger = {
		is_alive = yes
	}
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					has_hook = scope:disciple
				}
				remove_hook = {
					target = scope:disciple
				}
			}
		}
		save_scope_as = mteacher
		clear_saved_scope = actor
	}
	option = {
		
		name = ev3.11.a
		custom_tooltip = ev3.10.a_ct
		trigger_event = {
			id = magic_ev3.13
			days = { 15 30 }
		}
		add_hook = {
			type = loyalty_hook
			target = scope:disciple
		}
		scope:actor = {
			add_opinion = {
				target = root
				modifier = sorcery_training_modifier
			}
		}
	}
}

#Sorcery teaching - offer not accepted
magic_ev3.12 = {
	title = ev3.10.title
	type = character_event
	desc = ev3.12.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:disciple
	trigger = {
		is_alive = yes
	}

	option = {
		
		name = ev3.12.a

		add_stress = minor_stress_gain
	}
	after = {
		clear_saved_scope = actor
		clear_saved_scope = disciple
	}
}

#Sorcery teaching - first lesson - teacher
magic_ev3.13 = {
	title = ev3.13.title
	type = character_event
	desc = ev3.13.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:disciple
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:disciple = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.13.a
		show_as_tooltip = {
			scope:disciple = {
				add_character_modifier = {
					modifier = mage_guidance
					years = 5
				}
			}
		}
		scope:disciple = {
			trigger_event = magic_ev3.14
		}
		trigger_event = {
			id = magic_ev3.15
			months = 6
		}
	}
	option = {
		name = ev3.13.b
		custom_tooltip = ev3.13.b_ct
		trigger_event = {
			id = magic_ev3.16
			months = 6
		}
	}
}

#Sorcery teaching - first lesson - disciple
magic_ev3.14 = {
	title = ev3.13.title
	type = character_event
	desc = ev3.14.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:mteacher
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:mteacher = {
			is_alive = yes
			is_imprisoned = no
		}
	}
	option = {
		name = ev3.14.a
		add_character_modifier = {
			modifier = mage_guidance
			years = 5
		}
	}
}

#Sorcery teaching - second lesson - teacher
magic_ev3.15 = {
	title = ev3.10.title
	type = character_event
	desc = ev3.15.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:disciple
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:disciple = {
			is_alive = yes
			is_imprisoned = no
		}
	}


	option = {
		name = ev3.15.a
		custom_tooltip = ev3.13.b_ct
		trigger_event = {
			id = magic_ev3.16
			months = 4
		}
	}
}

#Sorcery teaching - rules of magic - teacher
magic_ev3.16 = {
	title = ev3.16.title
	type = character_event
	desc = ev3.16.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:disciple
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:disciple = {
			is_alive = yes
			is_imprisoned = no
		}
	}
	immediate = {
		save_scope_as = mteacher
	}

	option = {
		name = ev3.16.a
		custom_tooltip = ev3.13.b_ct
		show_as_tooltip = {
			scope:disciple = {
				random_list = {
					1 = {
						add_learning_skill = 2
					}
					1 = {
						add_learning_skill = 1
					}
				}
			}
		}
		scope:disciple = {
			trigger_event = magic_ev3.17
		}
		trigger_event = {
			id = magic_ev3.18
			months = { 6 10 }
		}
	}
}

#Sorcery teaching - rules of magic - disciple
magic_ev3.17 = {
	title = ev3.16.title
	type = character_event
	desc = ev3.17.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:mteacher
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:mteacher = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.17.a
		custom_tooltip = ev3.13.b_ct
		#random = {
		#	chance = 50
		#	add_learning_skill = 1
		#}
		random_list = {
			1 = {
				add_learning_skill = 2
			}
			1 = {
				add_learning_skill = 1
			}
		}
	}
}

#Sorcery teaching - practical aspects - teacher
magic_ev3.18 = {
	title = ev3.18.title
	type = character_event
	desc = ev3.18.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:disciple
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:disciple = {
			is_alive = yes
			is_imprisoned = no
		}
	}
	immediate = {
		save_scope_as = mteacher
		scope:disciple = {
			save_scope_as = wwitch
		}
	}

	option = {
		name = ev3.18.a
		trigger = {
			any_character_artifact = { has_variable = magic1 }
		}
		custom_tooltip = ev3.13.b_ct
		custom_tooltip = ev2.47.a_ct2
		scope:disciple = {
			trigger_event = magic_ev3.19
		}
		trigger_event = {
			id = magic_ev3.20
			months = 8
		}
	}

	option = {
		name = ev3.18.b
		trigger = {
			OR = {
				has_character_modifier = power_saturated1
				has_character_modifier = power_saturated2
			}
		}
		if = { limit = { has_character_modifier = power_saturated1 }
			remove_character_modifier = power_saturated1
		}
		if = { limit = { has_character_modifier = power_saturated2 }
			remove_character_modifier = power_saturated2
		}
		custom_tooltip = ev3.13.b_ct
		custom_tooltip = ev2.47.a_ct2
		scope:disciple = {
			trigger_event = magic_ev3.19
		}
		trigger_event = {
			id = magic_ev3.20
			months = 8
		}
	}
	option = {
		name = ev3.18.c
		add_stress = medium_stress_gain
		custom_tooltip = ev3.13.b_ct
		trigger_event = {
			id = magic_ev3.20
			months = 10
		}
	}
	after = {
		clear_saved_scope = wwitch
	}
}

#Sorcery teaching - rules of magic - disciple
magic_ev3.19 = {
	title = ev3.18.title
	type = character_event
	desc = ev3.19.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:mteacher
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:mteacher = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.19.a
		custom_tooltip = ev3.13.b_ct
		if = {
			limit = {
				NAND = {
					has_trait = true_witch
					has_trait = archmage
				}
			}
			custom_tooltip = ev2.47.a_ct
			hidden_effect = {
				add_magic_lifestyle_perk_points=1
			}
		}
		else = {
			add_learning_skill = 2
		}
	}
}

#Sorcery teaching - ends - teacher
magic_ev3.20 = {
	title = ev3.20.title
	type = character_event
	desc = ev3.20.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:disciple
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:disciple = {
			is_alive = yes
			is_imprisoned = no
		}
	}
	immediate = {
		save_scope_as = mteacher
	}

	option = {
		name = ev3.20.a
		custom_tooltip = ev3.20.a_ct
		add_stress = minor_stress_loss
		scope:disciple = {
			trigger_event = magic_ev3.21
		}
	}
}

#Sorcery teaching - ends - disciple
magic_ev3.21 = {
	title = ev3.20.title
	type = character_event
	desc = ev3.21.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:mteacher
	trigger = {
		is_alive = yes
		is_imprisoned = no
		NOT = {
			has_perk = magical_experiments_p1_perk
		}
	}

	option = {
		name = ev3.21.a
		custom_tooltip = ev3.20.a_ct
		duel = {
			skill = learning
			value = 13
			5 = {
				desc = ev3.21.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.21.a_1
					add_perk = magical_experiments_p1_perk
				}
				
				hidden_effect = {
					if = {
						limit = {
							is_ai = yes
						}
						if = {
							limit = {
								is_landed = yes
							}
							set_focus = arcane_focus
						}
						add_magic_lifestyle_perk_points = 1
					}
				}
			}
			5 = {
				desc = ev3.21.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.21.a_2
					custom_tooltip = ev3.21.a_ct
				}
			}
		}
	}
	after = {
		hidden_effect = {
			scope:mteacher = {
				random_character_artifact = {
					limit = {
						has_variable = magic1
					}
					save_scope_as = artart
				}
			}
			if = {
				limit = {
					exists = scope:artart
				}
				add_personal_artifact_claim = scope:artart
			}
		}
		clear_saved_scope = artart
		clear_saved_scope = disciple
		clear_saved_scope = mteacher
	}
}

#magic epic
magic_ev3.22 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.22.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	immediate = {
		
	}

	option = {
		#book
		name = ev3.22.a
		trigger_event = {
			id = magic_ev3.23
			days = { 10 20 }
		}
		add_character_flag = magic_epic_book
	}
	option = {
		#spells
		name = ev3.22.b
		trigger_event = {
			id = magic_ev3.29
			days = { 10 20 }
		}
		add_character_flag = magic_epic_magic
	}
}

#magic epic - book
magic_ev3.23 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.23.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}

	option = {
		#rituals
		name = ev3.23.a
		add_character_flag = book_rituals
	}
	option = {
		#artifacts
		name = ev3.23.b
		trigger = {
			any_character_artifact = { has_variable = magic1 }
		}
		add_character_flag = book_artifacts
	}
	option = {
		#undeads
		name = ev3.23.c
		trigger = {
			has_trait = necromancer
		}
		trait = necromancer
		add_character_flag = book_undeads
	}
	option = {
		#Power flows
		name = ev3.23.d
		trigger = {
			has_trait = source
		}
		trait = source
		add_character_flag = book_flows
	}
	option = {
		#Demons
		name = ev3.23.e
		add_character_flag = book_demons
	}
	option = {
		#Horned god
		name = ev3.23.f
		trigger = {
			has_trait = theologian
		}
		trait = theologian
		add_character_flag = book_hordned_one
	}
	after = {
		trigger_event = {
			id = magic_ev3.24
			months = { 1 2 }
		}
	}
}

#magic epic - book2
magic_ev3.24 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.24.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}

	option = {
		#Ill force myself...
		name = ev3.24.a
		add_stress = major_stress_gain
		trigger_event = {
			id = magic_ev3.25
			months = { 1 2 }
		}
	}
	option = {
		#Ill take a break
		name = ev3.24.b
		custom_tooltip = ev3.24.b_ct
		trigger_event = {
			id = magic_ev3.25
			months = { 10 14 }
		}
	}
	option = {
		#meditation
		name = ev3.24.c
		trigger = {
			has_trait = mystic_3
		}
		trait = mystic_3
		trigger_event = {
			id = magic_ev3.25
			months = { 1 2 }
		}
	}
}

#magic epic - book3
magic_ev3.25 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.25.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}

	option = {
		#cheap option
		name = ev3.25.a
		stress_impact = {
			greedy = minor_stress_gain
		}
		remove_short_term_gold = {
			add = 40
		}
		custom_tooltip = ev3.25.a_ct
		hidden_effect = {
			set_variable = {
				name = magic_epic_q
				value = 0
			}
		}
	}
	option = {
		#medium option
		name = ev3.25.b
		stress_impact = {
			greedy = medium_stress_gain
		}
		remove_short_term_gold = {
			add = half_demon_gold_value
		}
		#hidden_effect = {
		#	add_character_flag = medium_magic_epic
		#}
		custom_tooltip = ev3.25.a_ct
		custom_tooltip = ev3.25.b_ct
		hidden_effect = {
			set_variable = {
				name = magic_epic_q
				value = 1
			}
		}
	}
	option = {
		#reach option
		name = ev3.25.c
		stress_impact = {
			greedy = major_stress_gain
		}
		remove_short_term_gold = {
			add = demon_gold_value
		}
		#hidden_effect = {
		#	add_character_flag = major_magic_epic
		#}
		custom_tooltip = ev3.25.a_ct
		custom_tooltip = ev3.25.b_ct
		hidden_effect = {
			set_variable = {
				name = magic_epic_q
				value = 2
			}
		}
	}
	after = {
		if = {
			limit = {
				has_character_flag = magic_epic_book
			}
			trigger_event = {
				id = magic_ev3.26
				months = { 2 3 }
			}
		}
		else = {
			trigger_event = {
				id = magic_ev3.31
				months = { 2 3 }
			}
		}
	}
}

#magic epic - book4
magic_ev3.26 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.26.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}

	option = {
		#I can handle it
		name = ev3.26.a
		duel = {
			skill = learning
			value = 26
			5 = {
				desc = ev3.26.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.26.a_1
					custom_tooltip = ev3.25.a_ct
					custom_tooltip = ev3.25.b_ct
				}
				#hidden_effect = {
				#	add_character_flag = medium_magic_epic2
				#}
				hidden_effect = {
					change_variable = {
						name = magic_epic_q
						add = 1
					}
				}
			}
			5 = {
				desc = ev3.26.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.26.a_2
					custom_tooltip = ev3.25.a_ct
				}
			}
		}
	}
	option = {
		#Ill use magic
		name = ev3.26.b
		trigger = {
			OR = {
				has_character_modifier = power_saturated1
				has_character_modifier = power_saturated2
			}
			has_trait = archmage
		}
		trait = archmage
		if = { limit = { has_character_modifier = power_saturated1 }
			remove_character_modifier = power_saturated1
		}
		if = { limit = { has_character_modifier = power_saturated2 }
			remove_character_modifier = power_saturated2
		}
		custom_tooltip = ev3.25.a_ct
		custom_tooltip = ev3.25.b_ct
		#hidden_effect = {
		#	add_character_flag = medium_magic_epic2
		#}
		hidden_effect = {
			change_variable = {
				name = magic_epic_q
				add = 1
			}
		}
	}
	option = {
		#Ill use blackgrimoire
		name = ev3.26.c
		trigger = {
			any_character_artifact = { has_variable = blackgrimoire }
			learning > 17
		}
		skill = learning
		
		custom_tooltip = ev3.25.a_ct
		custom_tooltip = ev3.25.b_ct
		#hidden_effect = {
		#	add_character_flag = medium_magic_epic2
		#}
		hidden_effect = {
			change_variable = {
				name = magic_epic_q
				add = 1
			}
		}
	}

	after = {
		trigger_event = {
			id = magic_ev3.27
			months = { 3 4 }
		}
	}
}

#magic epic - book5
magic_ev3.27 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.27.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	immediate = {
		custom_tooltip = ev3.25.a_ct
	}
	option = {
		name = ev3.27.a
		trigger = {
			has_character_flag = book_rituals
		}
		if = {
			limit = {
				NOR = {
					has_character_modifier = power_saturated1
					has_character_modifier = power_saturated2
				}
			}
			if = { limit = { has_perk = combat_spells_p3_perk }
				add_character_modifier = power_saturated2
			}
			else = {
				add_character_modifier = power_saturated1
			}
		}
		add_stress = major_stress_loss
		add_prestige = medium_prestige_gain
		add_piety = medium_piety_gain
	}
	option = {
		name = ev3.27.b
		trigger = {
			has_character_flag = book_rituals
		}
		if = {
			limit = {
				has_trait = mystic_1
			}
			hidden_effect = {
				remove_trait = mystic_1
			}
			add_trait_force_tooltip = mystic_2
		}
		else_if = {
			limit = {
				has_trait = mystic_2
			}
			hidden_effect = {
				remove_trait = mystic_2
			}
			add_trait_force_tooltip = mystic_3
		}
		else_if = {
			limit = {
				has_trait = mystic_3
			}
			add_learning_skill = 1
		}
		else = {
			add_trait_force_tooltip = mystic_1
		}
	}
	option = {
		name = ev3.27.c
		trigger = {
			has_character_flag = book_artifacts
		}
		if = {
			limit = {
				has_trait = mystic_1
			}
			hidden_effect = {
				remove_trait = mystic_1
			}
			add_trait_force_tooltip = mystic_2
		}
		else_if = {
			limit = {
				has_trait = mystic_2
			}
			hidden_effect = {
				remove_trait = mystic_2
			}
			add_trait_force_tooltip = mystic_3
		}
		else_if = {
			limit = {
				has_trait = mystic_3
			}
			add_learning_skill = 1
		}
		else = {
			add_trait_force_tooltip = mystic_1
		}
	}
	option = {
		name = ev3.27.d
		trigger = {
			has_character_flag = book_artifacts
		}
		if = {
			limit = {
				any_living_character = {
					any_character_artifact = { has_variable = magic1 }
					NOT = {
						THIS = ROOT
					}
				}
			}
			random_living_character = {
				limit = {
					any_character_artifact = { has_variable = magic1 }
					NOT = {
						THIS = ROOT
					}
				}
				random_character_artifact = {
					limit = {
						has_variable = magic1
					}
					save_scope_as = mart
				}
			}
			add_personal_artifact_claim = scope:mart
			clear_saved_scope = mart
		}
		else = {
			add_diplomacy_skill = 1
			add_learning_skill = 1
		}
	}
	option = {
		name = ev3.27.e
		trigger = {
			has_character_flag = book_undeads
		}
		add_learning_skill = 2
		add_stress = major_stress_loss
	}
	option = {
		name = ev3.27.f
		trigger = {
			has_character_flag = book_undeads
		}
		custom_tooltip = ev3.27.f_ct
		add_character_flag = skeleton_warriors
	}
	option = {
		name = ev3.27.g
		trigger = {
			has_character_flag = book_flows
		}
		add_learning_skill = 2
	}
	option = {
		name = ev3.27.h
		trigger = {
			has_character_flag = book_flows
		}
		add_learning_skill = 1
		if = {
			limit = {
				number_of_personality_traits < 4
				NOT = {
					has_trait = humble
				}
			}
			add_trait = arrogant
		}
		add_stress = major_stress_loss
	}
	option = {
		name = ev3.27.i
		trigger = {
			has_character_flag = book_demons
		}
		add_learning_skill = 2
	}
	option = {
		name = ev3.27.j
		trigger = {
			has_character_flag = book_demons
		}
		add_stewardship_skill = 1
		add_learning_skill = 1
	}
	option = {
		name = ev3.27.k
		trigger = {
			has_character_flag = book_hordned_one
		}
		add_learning_skill = 2
	}
	option = {
		#
		name = ev3.27.l
		trigger = {
			has_character_flag = book_hordned_one
		}
		if = {
			limit = {
				has_any_nickname = yes
			}
			remove_nickname = yes
		}
		give_nickname = horned_nickname
		add_learning_skill = 1
	}
	option = {
		name = ev3.27.m
		trigger = {
			has_character_flag = book_hordned_one
			has_trait = cynical
		}
		trait = cynical
		add_diplomacy_skill = 1
		add_learning_skill = 1
		add_stress = major_stress_loss
	}

	after = {
		trigger_event = {
			id = magic_ev3.28
			months = { 1 2 }
		}
	}
}

#magic epic - book6
magic_ev3.28 = {
	title = ev3.28.title
	type = character_event
	desc = ev3.28.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			create_magic_book_artifact_effect = yes
			scope:new_book = {
				add_artifact_modifier = artifact_monthly_magic_lifestyle_xp_2_modifier
				set_artifact_rarity = famed
			}
			if = {
				limit = {
					has_character_flag = book_rituals
				}
				scope:new_book = {
				random_list = {
					1 = {
						set_artifact_name = mbook1_name
						add_artifact_modifier = artifact_intrigue_1_modifier
						add_artifact_modifier = artifact_intrigue_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
					}
					1 = {
						set_artifact_name = mbook2_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_monthly_learning_lifestyle_xp_4_modifier
					}
				}
				set_artifact_description = mbook1_desc
				}
			}
			else_if = {
				limit = {
					has_character_flag = book_artifacts
				}
				scope:new_book = {
				random_list = {
					1 = {
						set_artifact_name = mbook3_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_stewardship_1_modifier
						add_artifact_modifier = artifact_stewardship_1_modifier
					}
					1 = {
						set_artifact_name = mbook4_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_monthly_magic_lifestyle_xp_1_modifier
					}
				}
				set_artifact_description = mbook3_desc
				}
			}
			else_if = {
				limit = {
					has_character_flag = book_undeads
				}
				scope:new_book = {
				random_list = {
					1 = {
						set_artifact_name = mbook5_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_monthly_intrigue_lifestyle_xp_4_modifier
					}
					1 = {
						set_artifact_name = mbook6_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_stress_gain_4_modifier
						add_artifact_modifier = artifact_negate_health_penalty_add_4_modifier
					}
				}
				set_artifact_description = mbook5_desc
				}
			}
			else_if = {
				limit = {
					has_character_flag = book_flows
				}
				scope:new_book = {
				random_list = {
					1 = {
						set_artifact_name = mbook7_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_health_gain_4_modifier
						add_artifact_modifier = artifact_monthly_magic_lifestyle_xp_1_modifier
					}
					1 = {
						set_artifact_name = mbook8_name
						add_artifact_modifier = artifact_development_growth_12_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_monthly_magic_lifestyle_xp_1_modifier
					}
				}
				set_artifact_description = mbook7_desc
				}
			}
			else_if = {
				limit = {
					has_character_flag = book_demons
				}
				scope:new_book = {
				random_list = {
					1 = {
						set_artifact_name = mbook9_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_monthly_learning_lifestyle_xp_4_modifier
					}
					1 = {
						set_artifact_name = mbook10_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_monthly_lifestyle_xp_1_modifier
					}
				}
				set_artifact_description = mbook9_desc
				}
			}
			else_if = {
				limit = {
					has_character_flag = book_hordned_one
				}
				scope:new_book = {
				random_list = {
					1 = {
						set_artifact_name = mbook11_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_stewardship_1_modifier
						add_artifact_modifier = artifact_stewardship_1_modifier
						add_artifact_modifier = artifact_intrigue_1_modifier
						add_artifact_modifier = artifact_intrigue_1_modifier
					}
					1 = {
						set_artifact_name = mbook12_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_diplomacy_1_modifier
						add_artifact_modifier = artifact_diplomacy_1_modifier
						add_artifact_modifier = artifact_intrigue_1_modifier
						add_artifact_modifier = artifact_intrigue_1_modifier
					}
					1 = {
						set_artifact_name = mbook13_name
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_learning_1_modifier
						add_artifact_modifier = artifact_martial_1_modifier
						add_artifact_modifier = artifact_martial_1_modifier
						add_artifact_modifier = artifact_intrigue_1_modifier
						add_artifact_modifier = artifact_intrigue_1_modifier
					}
				}
				set_artifact_description = mbook11_desc
				}
			}
			
		}
	}
	option = {
		name = ev3.28.a
		custom_tooltip = ev3.28.a_ct
		if = {
			limit = {
				NOT = { has_trait = journaller }
			}
			add_trait = journaller
		}
		add_stress = medium_stress_loss
		hidden_effect = {
			scope:new_book = {
				add_artifact_modifier = artifact_monthly_prestige_7_modifier
				add_artifact_modifier = artifact_court_grandeur_baseline_add_5_modifier
				if = {
					limit = {
						#OR = {
						#	has_character_flag = medium_magic_epic
						#	has_character_flag = major_magic_epic
						#}
						root = {
							var:magic_epic_q > -1
						}
						
					}
					random_list = {
						1 = {
							add_artifact_modifier = artifact_monthly_magic_lifestyle_xp_1_modifier
						}
						1 = {
							add_artifact_modifier = artifact_monthly_lifestyle_xp_1_modifier
						}
						1 = {
							add_artifact_modifier = artifact_owned_scheme_secrecy_add_10_modifier
						}
						1= {
							add_artifact_modifier = artifact_hostile_scheme_power_add_5_modifier
						}
						1 = {
							add_artifact_modifier = artifact_owned_personal_scheme_success_chance_add_5_modifier
						}
					}
				}
				if = {
					limit = {
						#has_character_flag = major_magic_epic
						root = {
							var:magic_epic_q > 0
						}
						
					}
					random_list = {
						1 = {
							add_artifact_modifier = artifact_monthly_prestige_7_modifier
							add_artifact_modifier = artifact_owned_hostile_scheme_success_chance_add_10_modifier
						}
						1 = {
							add_artifact_modifier = artifact_court_grandeur_baseline_add_5_modifier
							add_artifact_modifier = artifact_owned_hostile_scheme_success_chance_add_10_modifier
						}
						1 = {
							add_artifact_modifier = artifact_monthly_prestige_add_8_modifier
							add_artifact_modifier = artifact_owned_hostile_scheme_success_chance_add_10_modifier
						}
						1= {
							add_artifact_modifier = artifact_hostile_scheme_power_add_5_modifier
							add_artifact_modifier = artifact_owned_hostile_scheme_success_chance_add_5_modifier
						}
						1 = {
							add_artifact_modifier = artifact_owned_personal_scheme_success_chance_add_5_modifier
							add_artifact_modifier = artifact_owned_hostile_scheme_success_chance_add_5_modifier
						}
					}
				}
				if = {
					limit = {
						#has_character_flag = medium_magic_epic2
						root = {
							var:magic_epic_q > 1
						}
						
					}
					random_list = {
						1 = {
							add_artifact_modifier = artifact_men_at_arms_maintenance_8_modifier
							add_artifact_modifier = artifact_monthly_martial_lifestyle_xp_2_modifier
						}
						1 = {
							add_artifact_modifier = artifact_domain_limit_1_modifier
							add_artifact_modifier = artifact_scheme_resistance_add_2_modifier
						}
						1 = {
							add_artifact_modifier = artifact_monthly_prestige_add_8_modifier
							add_artifact_modifier = artifact_fertility_gain_3_modifier
						}
						1= {
							add_artifact_modifier = artifact_owned_hostile_scheme_success_chance_add_10_modifier
							add_artifact_modifier = artifact_stress_gain_4_modifier
						}
						1 = {
							add_artifact_modifier = artifact_owned_personal_scheme_success_chance_add_5_modifier
							add_artifact_modifier = artifact_scheme_resistance_add_2_modifier
						}
					}
				}
				if = {
					limit = {
						#has_character_flag = medium_magic_epic2
						#has_character_flag = major_magic_epic
						root = {
							var:magic_epic_q > 2
						}
						
					}
					set_artifact_rarity = illustrious
					random_list = {
						1 = {
							add_artifact_modifier = artifact_men_at_arms_maintenance_8_modifier
						}
						1 = {
							add_artifact_modifier = artifact_domain_limit_1_modifier
						}
						1 = {
							add_artifact_modifier = artifact_monthly_prestige_add_8_modifier
						}
						1= {
							add_artifact_modifier = artifact_owned_hostile_scheme_success_chance_add_10_modifier
						}
						1 = {
							add_artifact_modifier = artifact_owned_personal_scheme_success_chance_add_5_modifier
						}
						1 = {
							add_artifact_modifier = artifact_monthly_magic_lifestyle_xp_1_modifier
						}
						1 = {
							add_artifact_modifier = artifact_monthly_lifestyle_xp_1_modifier
						}
						1 = {
							add_artifact_modifier = artifact_monthly_diplomacy_lifestyle_xp_2_modifier
						}
						1= {
							add_artifact_modifier = artifact_hostile_scheme_power_add_5_modifier
						}
						1 = {
							add_artifact_modifier = artifact_monthly_intrigue_lifestyle_xp_2_modifier
						}
						1 = {
							add_artifact_modifier = artifact_monthly_magic_lifestyle_xp_1_modifier
						}
						1 = {
							add_artifact_modifier = artifact_monthly_lifestyle_xp_1_modifier
						}
						1 = {
							add_artifact_modifier = artifact_health_gain_4_modifier
						}
						1= {
							add_artifact_modifier = artifact_hostile_scheme_power_add_5_modifier
						}
						1 = {
							add_artifact_modifier = artifact_owned_personal_scheme_success_chance_add_5_modifier
						}
					}
				}
				
			}
			
		}
	}
	after = {
		hidden_effect = {
			#if = {
			#	limit = {
			#		has_character_flag = medium_magic_epic2
			#	}
			#	remove_character_flag = medium_magic_epic2
			#}
			#if = {
			#	limit = {
			#		has_character_flag = major_magic_epic
			#	}
			#	remove_character_flag = major_magic_epic
			#}
			#if = {
			#	limit = {
			#		has_character_flag = medium_magic_epic
			#	}
			#	remove_character_flag = medium_magic_epic
			#}
			if = {
				limit = {
					has_character_flag = book_rituals
				}
				remove_character_flag = book_rituals
			}
			if = {
				limit = {
					has_character_flag = book_undeads
				}
				remove_character_flag = book_undeads
			}
			if = {
				limit = {
					has_character_flag = book_artifacts
				}
				remove_character_flag = book_artifacts
			}
			if = {
				limit = {
					has_character_flag = book_flows
				}
				remove_character_flag = book_flows
			}
			if = {
				limit = {
					has_character_flag = book_demons
				}
				remove_character_flag = book_demons
			}
			if = {
				limit = {
					has_character_flag = book_hordned_one
				}
				remove_character_flag = book_hordned_one
			}
			if = {
				limit = {
					has_character_flag = magic_epic_book
				}
				remove_character_flag = magic_epic_book
			}
			remove_variable = magic_epic_q
			clear_saved_scope = new_book
		}
	}
}

#magic epic - spell
magic_ev3.29 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.29.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	#immediate = {
	#	
	#}

	option = {
		#Alteration
		name = ev3.29.a
		add_character_flag = alteration_flag
	}
	option = {
		#Necromancy
		name = ev3.29.c
		trigger = {
			has_trait = necromancer
		}
		trait = necromancer
		add_character_flag = necromancy_flag
	}
	option = {
		#Psionics
		name = ev3.29.d
		trigger = {
			NOT = { has_character_modifier = mind_reader_modifier }
			has_trait = schemer
		}
		trait = schemer
		add_character_flag = psionics_flag
	}
	option = {
		#Psionics
		name = ev3.29.d
		trigger = {
			has_character_modifier = mind_reader_modifier
		}
		add_character_flag = psionics_flag
	}
	option = {
		#Metamagic
		name = ev3.29.e
		trigger = {
			learning > 29
		}
		skill = learning
		add_character_flag = metamagic_flag
	}
	option = {
		#body enhancement
		name = ev3.29.f
		trigger = {
			has_trait = whole_of_body
		}
		trait = whole_of_body
		add_character_flag = enhancement_flag
	}
	option = {
		#other worlds
		name = ev3.29.g
		trigger = {
			has_trait = mystic_2
		}
		trait = mystic_2
		add_character_flag = other_worlds_flag
	}
	option = {
		#other worlds
		name = ev3.29.g
		trigger = {
			has_trait = mystic_3
		}
		trait = mystic_3
		add_character_flag = other_worlds_flag
	}
	after = {
		trigger_event = {
			id = magic_ev3.30
			months = { 4 7 }
		}
	}
}

#magic epic - spell
magic_ev3.30 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.30.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}

	option = {
		name = ev3.30.a
		trigger_event = {
			id = magic_ev3.25
			months = { 10 12 }
		}
	}
	option = {
		name = ev3.30.b
		add_stress = major_stress_gain
		custom_tooltip = ev3.30.b_ct
		trigger_event = {
			id = magic_ev3.25
			months = { 2 6 }
		}
	}
	option = {
		name = ev3.30.c
		add_prestige = -200
		add_stress = minor_stress_gain
		custom_tooltip = ev3.30.b_ct
		trigger_event = {
			id = magic_ev3.25
			months = { 2 6 }
		}
	}
	option = {
		name = ev3.30.d
		trigger = {
			has_trait = diligent
		}
		trait = diligent
		custom_tooltip = ev3.30.b_ct
		trigger_event = {
			id = magic_ev3.25
			months = { 2 6 }
		}
	}
}

#magic epic - spell
magic_ev3.31 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.31.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}

	option = {
		name = ev3.31.a
		custom_tooltip = ev3.30.b_ct
	}
	option = {
		name = ev3.31.b
		custom_tooltip = ev3.31.b_ct
		custom_tooltip = ev3.30.b_ct
		hidden_effect = {
			add_character_flag = defence_magic_flag
		if = {
			limit = {
				has_character_flag = alteration_flag
			}
			remove_character_flag = alteration_flag
		}
		if = {
			limit = {
				has_character_flag = necromancy_flag
			}
			remove_character_flag = necromancy_flag
		}
		if = {
			limit = {
				has_character_flag = psionics_flag
			}
			remove_character_flag = psionics_flag
		}
		if = {
			limit = {
				has_character_flag = metamagic_flag
			}
			remove_character_flag = metamagic_flag
		}
		if = {
			limit = {
				has_character_flag = enhancement_flag
			}
			remove_character_flag = enhancement_flag
		}
		if = {
			limit = {
				has_character_flag = other_worlds_flag
			}
			remove_character_flag = other_worlds_flag
		}
		}
	}
	after = {
		trigger_event = {
			id = magic_ev3.32
			months = { 2 4 }
		}
	}
}

#magic epic - spell
magic_ev3.32 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.32.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}

	option = {
		name = ev3.32.a
		custom_tooltip = ev3.30.b_ct
	}
	option = {
		name = ev3.32.b
		trigger = {
			any_character_artifact = { has_variable = catalyst }
		}
		custom_tooltip = ev3.30.b_ct
		custom_tooltip = ev3.25.b_ct
		#add_character_flag = medium_magic_epic2
		hidden_effect = {
			change_variable = {
				name = magic_epic_q
				add = 1
			}
		}
	}
	option = {
		name = ev3.32.c
		trigger = {
			has_trait = intellect_good_3
			NOT = { has_trait = shrewd }
		}
		trait = intellect_good_3
		custom_tooltip = ev3.30.b_ct
		custom_tooltip = ev3.25.b_ct
		#add_character_flag = medium_magic_epic2
		hidden_effect = {
			change_variable = {
				name = magic_epic_q
				add = 1
			}
		}
	}
	option = {
		name = ev3.32.c
		trigger = {
			has_trait = shrewd
		}
		trait = shrewd
		custom_tooltip = ev3.30.b_ct
		custom_tooltip = ev3.25.b_ct
		#add_character_flag = medium_magic_epic2
		hidden_effect = {
			change_variable = {
				name = magic_epic_q
				add = 1
			}
		}
	}
	
	after = {
		trigger_event = {
			id = magic_ev3.33
			months = { 3 4 }
		}
	}
}

#magic epic - spell
magic_ev3.33 = {
	title = ev3.22.title
	type = character_event
	desc = ev3.33.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	option = {
		name = ev3.33.a
		duel = {
			skill = learning
			value = 26
			5 = {
				desc = ev3.33.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.33.a_1
					custom_tooltip = ev3.30.b_ct
					custom_tooltip = ev3.25.b_ct
				}
				#hidden_effect = {
				#	add_character_flag = medium_magic_epic3
				#}
				hidden_effect = {
					change_variable = {
						name = magic_epic_q
						add = 1
					}
				}
			}
			5 = {
				desc = ev3.33.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.33.a_2
					custom_tooltip = ev3.30.b_ct
				}
			}
		}
	}
	
	after = {
		trigger_event = {
			id = magic_ev3.34
			months = 1
		}
	}
}

#magic epic - spell
magic_ev3.34 = {
	title = ev3.34.title
	type = character_event
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = other_worlds_flag
					var:magic_epic_q > 0
				}
				desc = ev3.34.desc3
			}
			triggered_desc = {
				trigger = {
					#OR = {
					#	has_character_flag = medium_magic_epic3
					#	has_character_flag = medium_magic_epic2
					#	has_character_flag = medium_magic_epic
					#	has_character_flag = major_magic_epic
					#}
					var:magic_epic_q > 0
				}
				desc = ev3.34.desc
			}
			desc = ev3.34.desc2
		}
	}
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							var:magic_epic_q > 2
						}
						desc = ev3.34.a
					}
					desc = ev3.34.a2
				}
			}
		}
		trigger = {
			#OR = {
			#	has_character_flag = medium_magic_epic3
			#	has_character_flag = medium_magic_epic2
			#	has_character_flag = medium_magic_epic
			#	has_character_flag = major_magic_epic
			#}
			var:magic_epic_q > 0
			has_character_flag = alteration_flag
		}
		custom_tooltip = ev3.34.a2_ct
		add_character_flag = magic_transmutation
		add_stress = medium_stress_loss
		if = {
			limit = {
				var:magic_epic_q = 1
			}
			add_prestige = medium_prestige_gain
		}
		else_if = {
			limit = {
				var:magic_epic_q = 2
			}
			add_prestige = major_prestige_gain
			add_stewardship_skill = 1
			add_learning_skill = 1
		}
		else_if = {
			limit = {
				var:magic_epic_q > 2
			}
			add_prestige = major_prestige_gain
			add_stewardship_skill = 1
			add_learning_skill = 1
			add_character_modifier = master_alteration_modifier
		}
		
	}
	option = {
		name = ev3.34.b
		trigger = {
			var:magic_epic_q > 0
			has_character_flag = necromancy_flag
		}
		custom_tooltip = ev3.27.f_ct
		add_character_flag = skeleton_warriors
		add_stress = medium_stress_loss
		if = {
			limit = {
				var:magic_epic_q = 1
			}
			add_prestige = medium_prestige_gain
		}
		else_if = {
			limit = {
				var:magic_epic_q = 2
			}
			add_prestige = major_prestige_gain
			add_martial_skill = 1
			add_learning_skill = 1
		}
		else_if = {
			limit = {
				var:magic_epic_q > 2
			}
			add_prestige = major_prestige_gain
			add_martial_skill = 1
			add_learning_skill = 1
			add_character_modifier = master_necromancer_modifier
		}
	}
	option = {
		name = ev3.34.c
		trigger = {
			var:magic_epic_q > 0
			has_character_flag = psionics_flag
		}
		custom_tooltip = ev3.34.c_ct
		add_character_flag = better_domination_spell
		add_stress = medium_stress_loss
		if = {
			limit = {
				var:magic_epic_q = 1
			}
			add_prestige = medium_prestige_gain
		}
		else_if = {
			limit = {
				var:magic_epic_q = 2
			}
			add_prestige = major_prestige_gain
			add_intrigue_skill = 1
			add_diplomacy_skill = 1
		}
		else_if = {
			limit = {
				var:magic_epic_q > 2
			}
			add_prestige = major_prestige_gain
			add_intrigue_skill = 1
			add_diplomacy_skill = 1
			add_character_modifier = master_psionic_modifier
		}
	}
	option = {
		name = ev3.34.d
		trigger = {
			var:magic_epic_q > 0
			has_character_flag = metamagic_flag
		}
		custom_tooltip = ev3.34.d_ct
		add_character_flag = master_metamagic
		add_stress = medium_stress_loss
		if = {
			limit = {
				var:magic_epic_q = 1
			}
			add_prestige = medium_prestige_gain
		}
		else_if = {
			limit = {
				var:magic_epic_q = 2
			}
			add_prestige = major_prestige_gain
			add_learning_skill = 2
		}
		else_if = {
			limit = {
				var:magic_epic_q > 2
			}
			add_prestige = major_prestige_gain
			add_learning_skill = 2
			add_character_modifier = master_metamagic_modifier
		}
	}
	option = {
		name = ev3.34.e
		trigger = {
			var:magic_epic_q > 0
			has_character_flag = enhancement_flag
		}
		add_stress = medium_stress_loss
		if = {
			limit = {
				var:magic_epic_q = 1
			}
			add_prestige = medium_prestige_gain
			add_diplomacy_skill = 5
			add_martial_skill = 5
			add_stewardship_skill = 5
			add_intrigue_skill = 5
			add_learning_skill = 5
			add_prowess_skill = 5
		}
		else_if = {
			limit = {
				var:magic_epic_q = 2
			}
			add_prestige = major_prestige_gain
			add_diplomacy_skill = 5
			add_martial_skill = 5
			add_stewardship_skill = 5
			add_intrigue_skill = 5
			add_learning_skill = 5
			add_prowess_skill = 5
			if = {
				limit = {
					NOT = { has_trait = source }
				}
				add_trait = source
			}
			add_character_modifier = upgraded_body_modifier
		}
		else_if = {
			limit = {
				var:magic_epic_q > 2
			}
			add_prestige = major_prestige_gain
			add_diplomacy_skill = 5
			add_martial_skill = 5
			add_stewardship_skill = 5
			add_intrigue_skill = 5
			add_learning_skill = 5
			add_prowess_skill = 5
			if = {
				limit = {
					NOT = { has_trait = source }
				}
				add_trait = source
			}
			else = {
				add_trait_force_tooltip = demon
			}
			add_character_modifier = upgraded_body_modifier
		}
	}
	option = {
		name = ev3.34.f
		trigger = {
			var:magic_epic_q > 0
			has_character_flag = defence_magic_flag
		}
		stress_impact = {
			paranoid = medium_stress_loss
		}
		custom_tooltip = ev3.34.f_ct
		add_character_flag = protection_ritual
		add_stress = medium_stress_loss
		if = {
			limit = {
				var:magic_epic_q = 1
			}
			add_prestige = medium_prestige_gain
		}
		else_if = {
			limit = {
				var:magic_epic_q = 2
			}
			add_prestige = major_prestige_gain
			add_learning_skill = 1
			add_intrigue_skill = 1
		}
		else_if = {
			limit = {
				var:magic_epic_q > 2
			}
			add_prestige = major_prestige_gain
			add_learning_skill = 2
			add_intrigue_skill = 2
			add_character_modifier = master_defence_modifier
		}
	}
	option = {
		name = ev3.34.g
		trigger = {
			var:magic_epic_q > 0
			has_character_flag = other_worlds_flag
		}
		add_stress = medium_stress_loss
		add_character_modifier = contact_other_worlds_modifier
		if = {
			limit = {
				var:magic_epic_q = 1
			}
			add_prestige = medium_prestige_gain
		}
		else_if = {
			limit = {
				var:magic_epic_q = 2
			}
			add_prestige = major_prestige_gain
			add_stewardship_skill = 2
			add_diplomacy_skill = 2
		}
		else_if = {
			limit = {
				var:magic_epic_q > 2
			}
			add_prestige = major_prestige_gain
			add_stewardship_skill = 2
			add_diplomacy_skill = 2
			custom_tooltip = ev3.34.g_ct
			add_character_flag = blorg_flag
		}
	}
	option = {
		name = ev3.34.z
		trigger = {
			#NOR = {
			#	has_character_flag = medium_magic_epic3
			#	has_character_flag = medium_magic_epic2
			#	has_character_flag = medium_magic_epic
			#	has_character_flag = major_magic_epic
			#}
			var:magic_epic_q = 0
		}
		add_learning_skill = 1
		#add_diplomacy_skill = 1
		#add_martial_skill = 1
		#add_stewardship_skill = 1
		#add_intrigue_skill = 1
		
		add_prestige = medium_prestige_gain
		add_stress = minor_stress_loss
		#custom_tooltip = ev3.28.a_ct
	}
	
	after = {
		if = {
			limit = {
				NOR = {
					has_character_modifier = power_saturated1
					has_character_modifier = power_saturated2
				}
			}
			if = { limit = { has_perk = combat_spells_p3_perk }
				add_character_modifier = power_saturated2
			}
			else = {
				add_character_modifier = power_saturated1
			}
		}
		custom_tooltip = ev3.28.a_ct
		hidden_effect = {
			remove_variable = magic_epic_q
			if = {
				limit = {
					has_character_flag = other_worlds_flag
				}
				remove_character_flag = other_worlds_flag
			}
			if = {
				limit = {
					has_character_flag = defence_magic_flag
				}
				remove_character_flag = defence_magic_flag
			}
			if = {
				limit = {
					has_character_flag = enhancement_flag
				}
				remove_character_flag = enhancement_flag
			}
			if = {
				limit = {
					has_character_flag = metamagic_flag
				}
				remove_character_flag = metamagic_flag
			}
			if = {
				limit = {
					has_character_flag = psionics_flag
				}
				remove_character_flag = psionics_flag
			}
			if = {
				limit = {
					has_character_flag = necromancy_flag
				}
				remove_character_flag = necromancy_flag
			}
			if = {
				limit = {
					has_character_flag = alteration_flag
				}
				remove_character_flag = alteration_flag
			}
			if = {
				limit = {
					has_character_flag = magic_epic_magic
				}
				remove_character_flag = magic_epic_magic
			}
			
		}
	}
}

#witch hunter
magic_ev3.341 = {
	title = ev3.341.title
	type = character_event
	desc = ev3.341.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			create_character = {
				location = root.capital_province
				template = witch_hunter_character
				save_scope_as = whunter
			}
			scope:whunter = {
				add_perk = protective_runes_perk
				add_perk = magical_senses_perk
				set_character_faith = root
				#start_scheme = {
				#	type = murder
				#	target = scope:witch
				#}
			}
		}
	}

	option = {
		name = ev3.341.a
		trigger_event = magic_ev3.35
		stress_impact = {
			greedy = minor_stress_gain
		}
		pay_short_term_gold = {
			target = scope:whunter
			gold = potion_gold_value
		}
		recruit_courtier = scope:whunter

	}
	option = {
		name = ev3.341.b
		#scope:whunter = {
		#	move_to_pool = yes
		#}
		clear_saved_scope = whunter
	}
}

#witch hunter 2
magic_ev3.35 = {
	title = ev3.341.title
	type = character_event
	desc = ev3.35.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}

	option = {
		name = ev3.35.a
		custom_tooltip = ev3.35.a_ct
		trigger_event = {
			id = magic_ev3.36
			months = { 1 2 }
		}
	}
	option = {
		name = ev3.35.b
		trigger = {
			has_trait = zealous
		}
		trait = zealous
		trigger_event = magic_ev3.41
	}
	option = {
		name = ev3.35.b
		trigger = {
			NOT = { has_trait = zealous }
			has_trait = brave
		}
		trait = brave
		trigger_event = magic_ev3.41
	}
}

#witch hunter hunts
magic_ev3.36 = {
	hidden = yes
	type = character_event
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:whunter = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	immediate = {
		if = {
			limit = {
				exists = scope:htarget
			}
			clear_saved_scope = htarget
		}
		if = {
			limit = {
				exists = var:htargets
			}
			clear_variable_list = htargets
		}
		random_vassal_or_below = {
			limit = {
				is_ai = yes
				is_imprisoned = no
				OR = {
					has_trait = witch
					any_secret = { secret_type = secret_witch }
				}
			}
			add_to_list = htargets
		}
		random_close_or_extended_family_member = {
			limit = {
				is_ai = yes
				is_imprisoned = no
				OR = {
					has_trait = witch
					any_secret = { secret_type = secret_witch }
				}
			}
			add_to_list = htargets
		}
		random_courtier_or_guest = {
			limit = {
				is_ai = yes
				is_imprisoned = no
				OR = {
					has_trait = witch
					any_secret = { secret_type = secret_witch }
				}
			}
			add_to_list = htargets
		}
		random_in_list = {
			list = htargets
			save_scope_as = htarget
		}
		if = {
			limit = {
				exists = scope:htarget
			}
			if = {
				limit = {
					scope:htarget = {
						has_trait = archmage
					}
				}
				trigger_event = magic_ev3.38
			}
			else_if = {
				limit = {
					scope:htarget = {
						has_trait = true_witch
					}
				}
				random_list = {
					20 = { trigger_event = magic_ev3.38 }
					20 = { trigger_event = magic_ev3.37 }
					10 = { trigger_event = magic_ev3.39 }
					10 = { trigger_event = magic_ev3.40 }
				}
			}
			else = {
				random_list = {
					2 = { trigger_event = magic_ev3.38 }
					8 = { trigger_event = magic_ev3.37 }
					20 = { trigger_event = magic_ev3.39 }
					20 = { trigger_event = magic_ev3.40 }
				}
			}
		}
		else = {
			trigger_event = magic_ev3.37
		}

	}
}

#witch hunter - found nothing
magic_ev3.37 = {
	title = ev3.341.title
	type = character_event
	desc = ev3.37.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
	}

	option = {
		name = ev3.37.a
		scope:whunter = {
			move_to_pool = yes
		}
		clear_saved_scope = whunter
	}
	option = {
		name = ev3.37.b
		pay_short_term_gold = {
			target = scope:whunter
			gold = 30
		}
		custom_tooltip = ev3.37.b_ct
		trigger_event = {
			id = magic_ev3.36
			months = { 1 3 }
		}
	}
}

#witch hunter - killed
magic_ev3.38 = {
	title = ev3.341.title
	type = character_event
	#desc = ev3.38.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:htarget = {
						has_trait = archmage
					}
				}
				desc = ev3.38.desc
			}
			desc = ev3.38.desc2
		}
	}
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
	}
	immediate = {
		scope:whunter = {
			death = natural
		}
		hidden_effect = {
			scope:htarget = {
				add_secret = {
					type = secret_murder
					target = scope:whunter
				}
			}
		}
	}

	option = {
		name = ev3.38.a
		clear_saved_scope = whunter
	}
}

#witch hunter - kills a witch
magic_ev3.39 = {
	title = ev3.341.title
	type = character_event
	desc = ev3.39.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	lower_right_portrait = scope:htarget
	trigger = {
		is_alive = yes
	}
	immediate = {
		scope:htarget = {
			death = {
				death_reason = death_duel
				killer = scope:whunter
			}
		}
	}
	option = {
		name = ev3.39.a
		scope:whunter = {
			move_to_pool = yes
		}
		clear_saved_scope = whunter
		clear_saved_scope = htarget
	}
	option = {
		name = ev3.39.b
		pay_short_term_gold = {
			target = scope:whunter
			gold = 30
		}
		custom_tooltip = ev3.37.b_ct
		clear_saved_scope = htarget
		trigger_event = {
			id = magic_ev3.36
			months = { 1 3 }
		}
	}
}

#witch hunter - capture a witch
magic_ev3.40 = {
	title = ev3.341.title
	type = character_event
	desc = ev3.40.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	lower_right_portrait = scope:htarget
	trigger = {
		is_alive = yes
	}
	immediate = {
		scope:htarget = {
			if = {
				limit = {
					any_secret = {
						secret_type = secret_witch
					}
				}
				every_secret = {
					limit = {
						secret_type = secret_witch
					}
					reveal_to = root
				}
			}
		}
		
		imprison = {
			target = scope:htarget
			type = dungeon
		}
	}
	option = {
		name = ev3.39.a
		scope:whunter = {
			move_to_pool = yes
		}
		clear_saved_scope = whunter
		clear_saved_scope = htarget
	}
	option = {
		name = ev3.39.b
		pay_short_term_gold = {
			target = scope:whunter
			gold = 30
		}
		custom_tooltip = ev3.37.b_ct
		clear_saved_scope = htarget
		trigger_event = {
			id = magic_ev3.36
			months = { 1 3 }
		}
	}
}

#witch hunter - welcome in the team
magic_ev3.41 = {
	title = ev3.341.title
	type = character_event
	desc = ev3.41.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
	}
	#immediate = {
	#	
	#}
	option = {
		name = ev3.41.a
		trigger_event = {
			id = magic_ev3.42
			days = 7
		}
	}
}
#witch hunter - on the scent
magic_ev3.42 = {
	title = ev3.42.title
	type = character_event
	desc = ev3.42.desc
	theme = intrigue
	override_background = {
		event_background = alley_night
	}
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:whunter = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.42.a
		trigger = {
			NOR = {
				has_trait = patient
				has_trait = impatient
			}
		}
		add_stress = medium_stress_gain
		trigger_event = magic_ev3.43
	}
	option = {
		name = ev3.42.b
		trigger = {
			has_trait = patient
		}
		trait = patient
		trigger_event = magic_ev3.43
	}
	option = {
		name = ev3.42.c
		trigger = {
			has_trait = impatient
		}
		trait = impatient
		add_stress = major_stress_gain
		trigger_event = magic_ev3.43
	}
	option = {
		name = ev3.42.d
		custom_tooltip = ev3.42.d_ct
		trigger_event = {
			id = magic_ev3.36
			months = { 1 2 }
		}
	}
}

#witch hunter - on the scent 2
magic_ev3.43 = {
	title = ev3.42.title
	type = character_event
	desc = ev3.43.desc
	theme = intrigue
	override_background = {
		event_background = alley_night
	}
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:whunter = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.43.a
		custom_tooltip = ev3.43.a_ct
		trigger_event = {
			id = magic_ev3.44
			days = { 10 20 }
		}
	}
	option = {
		name = ev3.43.b
		add_stress = minor_stress_loss
		custom_tooltip = ev3.42.d_ct
		trigger_event = {
			id = magic_ev3.36
			months = { 1 2 }
		}
	}
}

#witch hunter - on the scent 3
magic_ev3.44 = {
	title = ev3.42.title
	type = character_event
	desc = ev3.44.desc
	theme = intrigue
	override_background = {
		event_background = alley_night
	}
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:whunter = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.44.a
		duel = {
			skill = prowess
			value = 14
			5 = {
				desc = ev3.44.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.44.a_1
					custom_tooltip = ev3.44.a_1_ct
				}
				trigger_event = {
					id = magic_ev3.46
					days = 2
				}
			}
			5 = {
				desc = ev3.44.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.44.a_2
					custom_tooltip = ev3.44.a_2_ct
				}
				custom_tooltip = ev3.42.d_ct
				trigger_event = {
					id = magic_ev3.45
					days = 2
				}
			}
		}
	}
	option = {
		name = ev3.44.b
		trigger = {
			diplomacy >19
		}
		skill = diplomacy
		custom_tooltip = ev3.44.a_1_ct
		trigger_event = {
			id = magic_ev3.46
			days = 2
		}
	}
	option = {
		name = ev3.44.c
		trigger = {
			martial >19
		}
		skill = martial
		custom_tooltip = ev3.44.a_1_ct
		trigger_event = {
			id = magic_ev3.46
			days = 2
		}
	}
	option = {
		name = ev3.44.d
		trigger = {
			intrigue >19
		}
		skill = intrigue
		custom_tooltip = ev3.44.a_1_ct
		trigger_event = {
			id = magic_ev3.46
			days = 2
		}
	}
}

#witch hunter - on the scent - failure
magic_ev3.45 = {
	title = ev3.42.title
	type = character_event
	desc = ev3.45.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:whunter = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.45.a
		custom_tooltip = ev3.42.d_ct
		trigger_event = {
			id = magic_ev3.36
			months = { 1 2 }
		}
	}
}

#witch hunter - on the scent - success
magic_ev3.46 = {
	title = ev3.42.title
	type = character_event
	desc = ev3.46.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	lower_center_portrait = scope:wwwitch
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:whunter = {
			is_alive = yes
			is_imprisoned = no
		}
	}
	immediate = {
		hidden_effect = {
			random_courtier_or_guest = {
				limit = {
					is_ai = yes
					is_imprisoned = no
					OR = {
						has_trait = witch
						any_secret = { secret_type = secret_witch }
					}
				}
				save_scope_as = wwwitch
			}
			if = {
				limit = {
					NOT = { exists = scope:wwwitch }
				}
				create_common_witch_effect = yes
				scope:created_witch = { save_scope_as = wwwitch }
			}
		}
		scope:wwwitch = {
			if = {
				limit = {
					any_secret = {
						secret_type = secret_witch
					}
				}
				every_secret = {
					limit = {
						secret_type = secret_witch
					}
					reveal_to = root
				}
			}
		}
		
		imprison = {
			target = scope:wwwitch
			type = dungeon
		}
		add_intrigue_skill = 1
	}

	option = {
		name = ev3.46.a
		custom_tooltip = ev3.37.b_ct
		trigger_event = {
			id = magic_ev3.36
			months = { 1 2 }
		}
	}
	option = {
		name = ev3.46.b
		trigger_event = magic_ev3.47
	}
	after = {
		clear_saved_scope = created_witch
		clear_saved_scope = wwwitch
	}
}

#witch hunter - be a witch hunter?
magic_ev3.47 = {
	title = ev3.42.title
	type = character_event
	desc = ev3.47.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:whunter = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.47.a
		add_character_modifier = novice_witch_hunter_modifier
		trigger_event = {
			id = magic_ev3.48
			months = { 2 3 }
		}
	}
	option = {
		name = ev3.47.b
		custom_tooltip = ev3.37.b_ct
		trigger_event = {
			id = magic_ev3.36
			months = { 1 2 }
		}
	}
}

#witch hunter - be a witch hunter - first lesson
magic_ev3.48 = {
	title = ev3.48.title
	type = character_event
	desc = ev3.48.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:whunter = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.48.a
		
		if = {
			limit = {
				has_perk = protective_runes_perk
			}
			add_learning_skill = 3
			add_prowess_skill = 1
		}
		else = {
			add_learning_skill = 1
			add_perk = protective_runes_perk
		}
		trigger_event = {
			id = magic_ev3.49
			months = { 2 3 }
		}
	}
}

#witch hunter - be a witch hunter - second lesson
magic_ev3.49 = {
	title = ev3.48.title
	type = character_event
	desc = ev3.49.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:whunter = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.49.a
		if = {
			limit = {
				NOR = {
					has_trait = blademaster_1
					has_trait = blademaster_2
					has_trait = blademaster_3
				}
			}
			add_trait = blademaster_1
			add_prowess_skill = 2
		}
		else_if = {
			limit = {
				has_trait = blademaster_3
			}
			add_prowess_skill = 4
		}
		else_if = {
			limit = {
				has_trait = blademaster_1
			}
			hidden_effect = {
				remove_trait = blademaster_1
			}
			add_trait_force_tooltip = blademaster_2
			add_prowess_skill = 2
		}
		else_if = {
			limit = {
				has_trait = blademaster_2
			}
			hidden_effect = {
				remove_trait = blademaster_2
			}
			add_trait_force_tooltip = blademaster_3
			add_prowess_skill = 2
		}
	}
	option = {
		name = ev3.49.b
		add_intrigue_skill = 1
		add_learning_skill = 1
	}
	after = {
		trigger_event = {
			id = magic_ev3.50
			months = { 2 3 }
		}
	}
}

#witch hunter - be a witch hunter - third lesson
magic_ev3.50 = {
	title = ev3.48.title
	type = character_event
	desc = ev3.50.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:whunter = {
			is_alive = yes
			is_imprisoned = no
		}
	}

	option = {
		name = ev3.50.a
		if = {
			limit = {
				has_perk = magical_senses_perk
			}
			add_learning_skill = 2
			add_intrigue_skill = 2
		}
		else = {
			add_learning_skill = 1
			add_intrigue_skill = 1
			add_perk = magical_senses_perk
		}
	}
	after = {
		trigger_event = {
			id = magic_ev3.51
			months = { 2 3 }
		}
	}
}

#witch hunter - intro final
magic_ev3.51 = {
	title = ev3.48.title
	type = character_event
	desc = ev3.38.desc2
	theme = realm
	left_portrait = root
	right_portrait = scope:whunter
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	immediate = {
		scope:whunter = {
			death = {
				death_reason = death_mysterious
			}
		}
	}

	option = {
		name = ev3.51.a
		trigger = {
			NOR = {
				has_trait = true_witch
				has_trait = archmage
			}
		}
		custom_tooltip = ev3.51.a_ct
		trigger_event = {
			id = magic_ev3.52
			months = { 1 2 }
		}
	}
	option = {
		name = ev3.51.b
		remove_character_modifier = novice_witch_hunter_modifier
	}
	after = {
		clear_saved_scope = whunter
	}
}

#witch hunter - exam
magic_ev3.52 = {
	title = ev3.48.title
	type = character_event
	desc = ev3.52.desc
	theme = realm
	left_portrait = root
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}


	option = {
		name = ev3.52.a
		duel = {
			skill = intrigue
			value = 12
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					custom_tooltip = ev3.52.a_1_ct
				}
				trigger_event = {
					id = magic_ev3.53
					days = 2
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					custom_tooltip = ev3.52.a_2_ct
				}
				trigger_event = {
					id = magic_ev3.52
					months = { 6 12 }
				}
			}
		}
	}
	option = {
		name = ev3.52.b
		trigger = {
			has_trait = intellect_good_2
		}
		trait = intellect_good_2
		send_interface_toast = {
			title=ev3.52.a_1
			custom_tooltip = ev3.52.a_1_ct
		}
		trigger_event = {
			id = magic_ev3.53
			days = 2
		}
	}
	option = {
		name = ev3.52.b
		trigger = {
			has_trait = intellect_good_3
		}
		trait = intellect_good_3
		send_interface_toast = {
			title=ev3.52.a_1
			custom_tooltip = ev3.52.a_1_ct
		}
		trigger_event = {
			id = magic_ev3.53
			days = 2
		}
	}
	option = {
		name = ev3.52.c
		trigger = {
			has_trait = torturer
		}
		trait = torturer
		send_interface_toast = {
			title=ev3.52.a_1
			custom_tooltip = ev3.52.a_1_ct
		}
		trigger_event = {
			id = magic_ev3.53
			days = 2
		}
	}
	option = {
		name = ev3.52.d
		if = {
			limit = {
				has_character_modifier = novice_witch_hunter_modifier
			}
			remove_character_modifier = novice_witch_hunter_modifier
		}
	}
}

#witch hunter - outro
magic_ev3.53 = {
	title = ev3.48.title
	type = character_event
	desc = ev3.53.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:wwwitch
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			create_common_witch_effect = yes
			scope:created_witch = { save_scope_as = wwwitch }
		}
		imprison = {
			target = scope:wwwitch
			type = dungeon
		}
		remove_character_modifier = novice_witch_hunter_modifier
	}
	option = {
		name = ev3.53.a
		add_trait = witch_hunter
	}
	after = {
		clear_saved_scope = created_witch
		clear_saved_scope = wwwitch
	}
}

#witch trial 4player
magic_ev3.54 = {
	title = ev2.18.title
	type = character_event
	
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = not_so_brave_flag
					}
				}
				desc = ev3.54.desc2
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = not_so_covard_flag
					}
				}
				desc = ev3.54.desc3
			}
			desc = ev3.54.desc
		}
	}
	theme = prison
	left_portrait = root
	right_portrait = scope:accused
	#trigger = {
	#	is_alive = yes
	#	is_imprisoned = no
	#}
	immediate = {
		save_scope_as = whunter
		if = {
			limit = {
				NOT = {
					exists = scope:accused
				}
			}
			scope:recipient = {
				save_scope_as = accused
			}
			clear_saved_scope = recipient
			clear_saved_scope = actor
		}
		
	}
	option = {
		name = ev3.54.a
		scope:accused = {
			trigger_event = magic_ev3.55
		}
	}
	option = {
		name = ev3.54.b
		trigger = {
			scope:accused = {
				NOR = {
					has_character_flag = not_so_brave_flag
					has_character_flag = not_so_covard_flag
				}
			}
		}
		stress_impact = {
			sadistic = minor_stress_loss
		}
		show_as_tooltip = {
			scope:accused = {
				if = {
					limit = {
						has_trait = craven
					}
					add_stress = medium_stress_gain
				}
				else_if = {
					limit = {
						NOT = { has_trait = brave }
					}
					add_stress = minor_stress_gain
				}
			}
		}
		scope:accused = {
			trigger_event = magic_ev3.59
		}
	}
	option = {
		name = ev3.54.c
		trigger = {
			has_trait = sadistic
		}
		trait = sadistic
		stress_impact = {
			sadistic = minor_stress_loss
			compassionate = minor_stress_gain
		}
		custom_tooltip = ev3.54.c_ct
		trigger_event = magic_ev3.60
	}
	after = {
		if = {
			limit = {
				has_character_flag = not_so_brave_flag
			}
			remove_character_flag = not_so_brave_flag
		}
		else_if = {
			limit = {
				has_character_flag = not_so_covard_flag
			}
			remove_character_flag = not_so_covard_flag
		}
	}
}

#witch trial 4player - are you a witch?
magic_ev3.55 = {
	title = ev2.18.title
	type = character_event
	desc = ev3.55.desc
	theme = prison
	left_portrait = root
	right_portrait = scope:whunter
	
	immediate = {
		if = {
			limit = {
				has_character_flag = trial2_yes1
			}
			remove_character_flag = trial2_yes1
		}
		else_if = {
			limit = {
				has_character_flag = trial2_yes2
			}
			remove_character_flag = trial2_yes2
		}
		else_if = {
			limit = {
				has_character_flag = trial2_no1
			}
			remove_character_flag = trial2_no1
		}
		else_if = {
			limit = {
				has_character_flag = trial2_no2
			}
			remove_character_flag = trial2_no2
		}
		else_if = {
			limit = {
				has_character_flag = trial2_no3
			}
			remove_character_flag = trial2_no3
		}
	}
	option = {
		name = ev3.55.a
		add_character_flag = trial1_no
	}
	option = {
		name = ev3.55.b
		trigger = {
			OR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
		}
		stress_impact = {
			arrogant = minor_stress_loss
		}
		add_character_flag = trial1_maybe
		add_character_flag = confessed_witch_flag
	}
	option = {
		name = ev3.55.c
		trigger = {
			OR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
		}
		if = {
			limit = {
				any_secret = { secret_type = secret_witch }
			}
			random_secret = {
				limit = { secret_type = secret_witch }
				expose_secret = root
			}
			if = {
				limit = { NOT = { has_trait = witch } }
				add_trait_force_tooltip = witch
			}
		}
		stress_impact = {
			arrogant = minor_stress_loss
		}
		add_character_flag = trial1_yes
		add_character_flag = confessed_witch_flag
	}
	after = {
		scope:whunter = {
			trigger_event = magic_ev3.56
		}
	}
}

#witch trial 4player - first stage
magic_ev3.56 = {
	title = ev2.18.title
	type = character_event
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = trial1_no
					}
				}
				desc = ev3.56.desc
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = trial1_maybe
					}
				}
				desc = ev3.56.desc2
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = trial2_no1
					}
				}
				desc = ev3.56.desc4
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = trial2_no2
					}
				}
				desc = ev3.56.desc5
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = trial2_no3
					}
				}
				desc = ev3.56.desc6
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = trial2_yes1
					}
				}
				desc = ev3.56.desc7
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = trial2_yes2
					}
				}
				desc = ev3.56.desc8
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = resp_ev_61_flag1
					}
				}
				desc = ev3.56.desc9
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = resp_ev_61_flag2
					}
				}
				desc = ev3.56.desc10
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = resp_ev_61_flag3
					}
				}
				desc = ev3.56.desc11
			}
			triggered_desc = {
				trigger = {
					scope:accused = {
						has_character_flag = resp_ev_61_flag4
					}
				}
				desc = ev3.56.desc12
			}
			desc = ev3.56.desc3
		}
	}
	theme = prison
	left_portrait = root
	right_portrait = scope:accused
	immediate = {
		if = {
			limit = {
				scope:accused = {
					has_character_flag = resp_ev_61_flag2
				}
			}
			add_hook = {
				type = loyalty_hook
				target = scope:accused
			}
		}
		else_if = {
			limit = {
				exists = scope:secret_to_reveal
				scope:accused = {
					has_character_flag = resp_ev_61_flag4
				}
			}
			scope:secret_to_reveal = {
				reveal_to = root
			}
			clear_saved_scope = secret_to_reveal
		}
		else_if = {
			limit = {
				scope:accused = {
					has_character_flag = resp_ev_61_flag3
				}
			}
			scope:accused = {
				if = {
					limit = {
						any_secret = { secret_type = secret_witch }
					}
					random_secret = {
						limit = { secret_type = secret_witch }
						expose_secret = root
					}
					if = {
						limit = { NOT = { has_trait = witch } }
						add_trait_force_tooltip = witch
					}
				}
			}
		}
	}
	option = {
		name = ev3.56.a
		trigger = {
			scope:accused = {
				has_character_flag = trial1_no
				
			}
		}
		scope:accused = {
			trigger_event = magic_ev3.57
		}
	}
	option = {
		name = ev3.56.b
		trigger = {
			scope:accused = {
				has_character_flag = trial1_no
			}
			diplomacy > 19
		}
		skill = diplomacy
		scope:accused = {
			trigger_event = magic_ev3.57
		}
		
	}
	option = {
		name = ev3.56.c
		trigger = {
			scope:accused = {
				OR = {
					has_character_flag = trial1_no
					has_character_flag = trial2_no1
					has_character_flag = trial2_no2
					has_character_flag = trial2_no3
					has_character_flag = resp_ev_61_flag1
					has_character_flag = resp_ev_61_flag2
					has_character_flag = resp_ev_61_flag4
				}
				
			}
		}
		custom_tooltip = ev3.54.c_ct
		trigger_event = magic_ev3.60
	}
	option = {
		name = ev3.56.d
		trigger = {
			scope:accused = {
				OR = {
					has_character_flag = trial1_no
					has_character_flag = trial2_no1
					has_character_flag = trial2_no2
					has_character_flag = trial2_no3
					has_character_flag = resp_ev_61_flag1
					has_character_flag = resp_ev_61_flag2
					has_character_flag = resp_ev_61_flag4
				}
			}
		}
		custom_tooltip = ev3.56.d_ct
		scope:accused = {
			release_from_prison = yes
		}
	}
	option = {
		name = ev3.56.e
		trigger = {
			scope:accused = {
				OR = {
					has_character_flag = trial1_maybe
					has_character_flag = trial1_yes
					has_character_flag = trial2_yes1
					has_character_flag = trial2_yes2
					has_character_flag = trial2_no1
					has_character_flag = trial2_no2
					has_character_flag = trial2_no3
					has_character_flag = confessed_witch_flag
					has_character_flag = resp_ev_61_flag1
					has_character_flag = resp_ev_61_flag2
					has_character_flag = resp_ev_61_flag3
					has_character_flag = resp_ev_61_flag4
				}
				
			}
		}
		
		scope:accused = {
			add_character_flag = expose_coven_flag
			trigger_event = {
				id = magic_ev3.61
				days = 1
			}
		}
		
	}
	option = {
		name = ev3.56.f
		trigger = {
			scope:accused = {
				OR = {
					has_character_flag = trial1_maybe
					has_character_flag = trial1_yes
					has_character_flag = trial1_no
					has_character_flag = trial2_yes1
					has_character_flag = trial2_yes2
					has_character_flag = trial2_no1
					has_character_flag = trial2_no2
					has_character_flag = trial2_no3
					has_trait = witch
					has_trait = true_witch
					has_character_flag = confessed_witch_flag
					has_character_flag = resp_ev_61_flag1
					has_character_flag = resp_ev_61_flag2
					has_character_flag = resp_ev_61_flag3
					has_character_flag = resp_ev_61_flag4
				}
				
			}
		}
		stress_impact = {
			compassionate = medium_stress_gain
			forgiving = medium_stress_gain
			sadistic = medium_stress_loss
		}
		#burn_witch_effect = { RWITCH = scope:accused }
		custom_tooltip = ev3.56.d_ct
		show_as_tooltip = {
			scope:accused = {
				death = {
					killer = root
					death_reason = death_burned_witch
				}
			}
		}
		trigger_event = magic_ev3.62
	}
	option = {
		name = ev3.56.g
		trigger = {
			scope:accused = {
				OR = {
					has_character_flag = trial2_no1
					has_character_flag = trial2_no2
					has_character_flag = trial2_no3
					has_character_flag = resp_ev_61_flag1
					has_character_flag = resp_ev_61_flag2
					has_character_flag = resp_ev_61_flag4
				}
				NOR = {
					has_character_flag = resp_ev_61_flag3
					has_character_flag = confessed_witch_flag
				}
			}
		}
		scope:accused = {
			trigger_event = magic_ev3.55
		}
		
	}
	option = {
		name = ev3.56.h
		trigger = {
			scope:accused = {
				OR = {
					has_character_flag = trial1_maybe
					has_character_flag = trial1_yes
					has_character_flag = trial1_no
					has_character_flag = trial2_no1
					has_character_flag = trial2_no2
					has_character_flag = trial2_no3
					has_character_flag = trial2_yes1
					has_character_flag = trial2_yes2
					has_character_flag = trial1_maybe
					has_character_flag = confessed_witch_flag
					has_character_flag = resp_ev_61_flag1
					has_character_flag = resp_ev_61_flag2
					has_character_flag = resp_ev_61_flag3
					has_character_flag = resp_ev_61_flag4
				}
			}
		}
		custom_tooltip = ev3.56.d_ct
		show_as_tooltip = {
			scope:accused = {
				if = {
					limit = {
						is_in_prison_type = house_arrest
					}
					change_prison_type = dungeon
				}
			}
		}
		scope:accused = {
			trigger_event = magic_ev3.58
		}
		
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					exists = scope:accused
				}
				scope:accused = {
					if = {
						limit = {
							has_character_flag = resp_ev_61_flag1
						}
						remove_character_flag = resp_ev_61_flag1
					}
					else_if = {
						limit = {
							has_character_flag = resp_ev_61_flag2
						}
						remove_character_flag = resp_ev_61_flag2
					}
					else_if = {
						limit = {
							has_character_flag = resp_ev_61_flag3
						}
						remove_character_flag = resp_ev_61_flag3
					}
					else_if = {
						limit = {
							has_character_flag = resp_ev_61_flag4
						}
						remove_character_flag = resp_ev_61_flag4
					}
				}
			}
			
		}
	}
}

#witch trial 4player - Ive got evidences
magic_ev3.57 = {
	title = ev2.18.title
	type = character_event
	desc = ev3.57.desc
	theme = prison
	left_portrait = root
	right_portrait = scope:whunter
	
	immediate = {
		if = {
			limit = {
				has_character_flag = trial1_maybe
			}
			remove_character_flag = trial1_maybe
		}
		else_if = {
			limit = {
				has_character_flag = trial1_yes
			}
			remove_character_flag = trial1_yes
		}
		else_if = {
			limit = {
				has_character_flag = trial1_no
			}
			remove_character_flag = trial1_no
		}
	}
	option = {
		name = ev3.57.a
		add_character_flag = trial2_no1
	}
	option = {
		name = ev3.57.b
		add_character_flag = trial2_no2
	}
	option = {
		name = ev3.57.c
		add_character_flag = trial2_no3
	}
	option = {
		name = ev3.57.d
		trigger = {
			OR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
		}
		
		add_character_flag = trial2_yes1
		add_character_flag = confessed_witch_flag
	}
	option = {
		name = ev3.57.e
		trigger = {
			OR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
		}
		
		add_character_flag = trial2_yes2
		add_character_flag = confessed_witch_flag
	}
	after = {
		scope:whunter = {
			trigger_event = magic_ev3.56
		}
	}
	
}

#witch trial 4player - you stay in prison
magic_ev3.58 = {
	title = ev2.18.title
	type = character_event
	desc = ev3.58.desc
	theme = prison
	left_portrait = root
	right_portrait = scope:whunter
	
	immediate = {
		if = {
			limit = {
				has_character_flag = trial1_maybe
			}
			remove_character_flag = trial1_maybe
		}
		else_if = {
			limit = {
				has_character_flag = trial1_yes
			}
			remove_character_flag = trial1_yes
		}
		else_if = {
			limit = {
				has_character_flag = trial1_no
			}
			remove_character_flag = trial1_no
		}
		if = {
			limit = {
				is_in_prison_type = house_arrest
			}
			change_prison_type = dungeon
		}
	}
	option = {
		name = ev3.58.a
		trigger = {
			OR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
		}
		add_stress = minor_stress_loss
	}
	option = {
		name = ev3.58.b
		trigger = {
			NOR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
		}
		add_stress = minor_stress_gain
	}
	
	after = {
		clear_saved_scope = accused
		clear_saved_scope = whunter
	}
	
}

#witch trial 4player - show me tools...
magic_ev3.59 = {
	title = ev2.18.title
	type = character_event
	desc = ev3.59.desc
	theme = prison
	left_portrait = root
	right_portrait = scope:whunter
	
	immediate = {
		add_stress = minor_stress_gain
	}
	option = {
		name = ev3.58.b
		trigger = {
			NOT = {
				has_trait = brave
			}
		}
		add_character_flag = not_so_brave_flag
	}
	option = {
		name = ev3.42.c
		trigger = {
			NOT = {
				has_trait = craven
			}
		}
		add_character_flag = not_so_covard_flag
	}
	after = {
		scope:whunter = {
			trigger_event = magic_ev3.54
		}	
	}
}

#witch trial 4player - torture time
magic_ev3.60 = {
	title = ev2.18.title
	type = character_event
	desc = ev3.60.desc
	theme = prison
	left_portrait = root
	right_portrait = scope:accused
	
	#immediate = {
		
	#}
	option = {
		name = ev3.60.a
		stress_impact = {
			sadistic = minor_stress_loss
			compassionate = minor_stress_gain
		}
		show_as_tooltip = {
			scope:accused = {
				if = {
					limit = {
						NOR = {
							has_trait = wounded_1
							has_trait = wounded_2
						}
					}
					add_trait = wounded_1
				}
				else_if = {
					limit = {
						has_trait = wounded_2
					}
					
					add_trait_force_tooltip = wounded_2
				}
				else = {
					hidden_effect = {
						remove_trait = wounded_1
					}
					add_trait_force_tooltip = wounded_2
				}
				if = {
					limit = {
						NOT = { has_character_modifier = recently_tortured }
					}
					add_character_modifier = {
						modifier = recently_tortured
						days = 10
					}
				}
				add_stress = medium_stress_gain
			}
		}
		scope:accused = {
			add_character_flag = torture1_flag
		}
	}
	option = {
		name = ev3.60.b
		stress_impact = {
			sadistic = minor_stress_loss
			compassionate = minor_stress_gain
		}
		show_as_tooltip = {
			scope:accused = {
				random_list = {
					10 = {
						trigger = { NOT = { has_trait = blind } }
						add_trait = blind
					}
					10 = {
						trigger = { NOT = { has_trait = one_eyed } }
						add_trait = one_eyed
					}
					10 = {
						trigger = { NOT = { has_trait = lunatic_1 } }
						add_trait = lunatic_1
					}
					10 = {
						trigger = { NOT = { has_trait = maimed } }
						add_trait = maimed
					}
					10 = {
						trigger = { NOT = { has_trait = one_legged } }
						add_trait = one_legged
					}
					10 = {
						trigger = { NOT = { has_trait = disfigured } }
						add_trait = disfigured
					}
					10 = {
						trigger = { NOT = { has_trait = eunuch } is_male = yes }
						add_trait = eunuch
					}
					10 = {
						trigger = { NOT = { has_trait = infirm } }
						add_trait = infirm
					}
					10 = {
						death = {
							death_reason = death_torture
							killer = root
						}
					}
				}
				if = {
					limit = {
						NOT = { has_character_modifier = recently_tortured }
					}
					add_character_modifier = {
						modifier = recently_tortured
						days = 10
					}
				}
				add_stress = medium_stress_gain
			}
		}
		scope:accused = {
			add_character_flag = torture2_flag
		}
	}
	after = {
		scope:accused = {
			trigger_event = {
				id = magic_ev3.61
				days = 1
			}
		}
	}
}

#witch trial 4player - I am tortured!
magic_ev3.61 = {
	title = ev2.18.title
	type = character_event
	
	desc = {
		first_valid = {
			triggered_desc = { 
				trigger = {
					has_character_flag = expose_coven_flag
				}
				desc = ev3.61.desc2
			}
			desc = ev3.61.desc
		}
	}
	theme = prison
	left_portrait = root
	right_portrait = scope:whunter
	
	immediate = {
		save_scope_as = accused
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = trial1_maybe
				}
				remove_character_flag = trial1_maybe
			}
			else_if = {
				limit = {
					has_character_flag = trial1_yes
				}
				remove_character_flag = trial1_yes
			}
			else_if = {
				limit = {
					has_character_flag = trial1_no
				}
				remove_character_flag = trial1_no
			}
			if = {
				limit = {
					has_character_flag = trial2_yes1
				}
				remove_character_flag = trial2_yes1
			}
			else_if = {
				limit = {
					has_character_flag = trial2_yes2
				}
				remove_character_flag = trial2_yes2
			}
			else_if = {
				limit = {
					has_character_flag = trial2_no1
				}
				remove_character_flag = trial2_no1
			}
			else_if = {
				limit = {
					has_character_flag = trial2_no2
				}
				remove_character_flag = trial2_no2
			}
			else_if = {
				limit = {
					has_character_flag = trial2_no3
				}
				remove_character_flag = trial2_no3
			}
		}
		if = {
			limit = {
				has_character_flag = torture1_flag
			}
			if = {
				limit = {
					NOR = {
						has_trait = wounded_1
						has_trait = wounded_2
					}
				}
				add_trait = wounded_1
			}
			else_if = {
				limit = {
					has_trait = wounded_2
				}
				
				add_trait_force_tooltip = wounded_2
			}
			else = {
				hidden_effect = {
					remove_trait = wounded_1
				}
				add_trait_force_tooltip = wounded_2
			}
			if = {
				limit = {
					NOT = { has_character_modifier = recently_tortured }
				}
				add_character_modifier = {
					modifier = recently_tortured
					days = 10
				}
			}
			add_stress = medium_stress_gain
		}
		else_if = {
			limit = {
				has_character_flag = torture2_flag
			}
			random_list = {
				10 = {
					trigger = { NOT = { has_trait = blind } }
					add_trait = blind
				}
				10 = {
					trigger = { NOT = { has_trait = one_eyed } }
					add_trait = one_eyed
				}
				10 = {
					trigger = { NOT = { has_trait = lunatic_1 } }
					add_trait = lunatic_1
				}
				10 = {
					trigger = { NOT = { has_trait = maimed } }
					add_trait = maimed
				}
				10 = {
					trigger = { NOT = { has_trait = one_legged } }
					add_trait = one_legged
				}
				10 = {
					trigger = { NOT = { has_trait = disfigured } }
					add_trait = disfigured
				}
				10 = {
					trigger = { NOT = { has_trait = eunuch } is_male = yes }
					add_trait = eunuch
				}
				10 = {
					trigger = { NOT = { has_trait = infirm } }
					add_trait = infirm
				}
				10 = {
					death = {
						death_reason = death_torture
						killer = root
					}
				}
			}
			if = {
				limit = {
					NOT = { has_character_modifier = recently_tortured }
				}
				add_character_modifier = {
					modifier = recently_tortured
					days = 10
				}
			}
			add_stress = medium_stress_gain
		}
		hidden_effect = {
			random_known_secret = {
				limit = {
					NOT = { is_known_by = root }
				}
				save_scope_as = secret_to_reveal
			}
		}
	}
	option = {
		name = ev3.61.a
		add_character_flag = resp_ev_61_flag1
		
	}
	option = {
		name = ev3.61.b
		trigger = {
			scope:whunter = {
				NOT = { has_hook = root }
			}
		}
		add_character_flag = resp_ev_61_flag2
		show_as_tooltip = {
			scope:whunter = {
				add_hook = {
						type = loyalty_hook
						target = root
				}
			}
		}
		
	}
	option = {
		name = ev3.61.c
		trigger = {
			#OR = {
			#	has_trait = witch
			#	any_secret = { secret_type = secret_witch }
			#}
			NOT = { has_character_flag = expose_coven_flag }
		}
		add_character_flag = resp_ev_61_flag3
		add_character_flag = confessed_witch_flag
		show_as_tooltip = {
			if = {
				limit = {
					any_secret = { secret_type = secret_witch }
				}
				random_secret = {
					limit = { secret_type = secret_witch }
					expose_secret = root
				}
				if = {
					limit = { NOT = { has_trait = witch } }
					add_trait_force_tooltip = witch
				}
			}
		}
		
	}
	option = {
		name = ev3.61.d
		trigger = {
			exists = scope:secret_to_reveal
		}
		add_character_flag = resp_ev_61_flag4
		show_as_tooltip = {
			scope:secret_to_reveal = {
				reveal_to = scope:whunter
			}
		}
		
	}
	after = {
		if = {
			limit = {
				has_character_flag = torture1_flag
			}
			remove_character_flag = torture1_flag
		}
		else_if = {
			limit = {
				has_character_flag = torture2_flag
			}
			remove_character_flag = torture2_flag
		}
		if = {
			limit = {
				has_character_flag = expose_coven_flag
			}
			remove_character_flag = expose_coven_flag
		}
		
		scope:whunter = {
			trigger_event = {
				id = magic_ev3.56
				days = 1
			}
		}	
	}
}

#witch trial 4player
magic_ev3.62 = {
	title = ev2.18.title
	type = character_event
	desc = ev3.62.desc
	theme = prison
	left_portrait = root
	right_portrait = scope:accused
	
	immediate = {
		burn_witch_effect = { RWITCH = scope:accused }
	}
	option = {
		name = ev3.62.a
		trigger = {
			#has_character_flag = killed_real_witch_flag
			scope:accused = {
				OR = {
					has_character_flag = confessed_witch_flag
					has_trait = witch
					has_trait = true_witch
					has_trait = archmage
					has_trait = demon
				}
				
			}
		}
	}
	option = {
		name = ev3.62.b
		trigger = {
			#NOT = { has_character_flag = killed_real_witch_flag }
			scope:accused = {
				NOR = {
					has_character_flag = confessed_witch_flag
					has_trait = witch
					has_trait = true_witch
					has_trait = archmage
					has_trait = demon
				}
			}
		}
		
	}
	after = {
		#if = {
		#	limit = {
		#		has_character_flag = killed_real_witch_flag
		#	}
		#	remove_character_flag = killed_real_witch_flag
		#}
		clear_saved_scope = accused
		clear_saved_scope = whunter	
	}
}

#witch hunt 4 players - ingrediens
magic_ev3.63 = {
	title = ev3.42.title
	type = character_event
	desc = ev3.63.desc
	theme = realm
	left_portrait = root
	
	option = {
		name = ev3.63.a
		duel = {
			skill = stewardship
			value = 17
			5 = {
				desc = ev3.63.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.63.a_1
					custom_tooltip = ev3.63.a_1_ct
				}
				trigger_event = magic_ev3.64
				
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					custom_tooltip = ev3.63.a_2_ct
				}
			}
		}
	}
	option = {
		name = ev3.63.b
		duel = {
			skill = learning
			value = 17
			5 = {
				desc = ev3.63.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.63.a_1
					custom_tooltip = ev3.63.a_1_ct
				}
				trigger_event = magic_ev3.64
				
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					custom_tooltip = ev3.63.a_2_ct
				}
			}
		}
	}
}

#witch hunt 4 players - hunt down
magic_ev3.64 = {
	title = ev3.42.title
	type = character_event
	desc = ev3.64.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:htarget
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					exists = scope:htarget
				}
				clear_saved_scope = htarget
			}
			if = {
				limit = {
					exists = var:htargets
				}
				clear_variable_list = htargets
			}
			random_vassal_or_below = {
				limit = {
					#is_ai = yes
					is_alive = yes
					is_imprisoned = no
					OR = {
						has_trait = witch
						any_secret = { secret_type = secret_witch }
					}
				}
				add_to_list = htargets
			}
			random_close_or_extended_family_member = {
				limit = {
					#is_ai = yes
					is_alive = yes
					is_imprisoned = no
					OR = {
						has_trait = witch
						any_secret = { secret_type = secret_witch }
					}
				}
				add_to_list = htargets
			}
			random_courtier_or_guest = {
				limit = {
					#is_ai = yes
					is_alive = yes
					is_imprisoned = no
					OR = {
						has_trait = witch
						any_secret = { secret_type = secret_witch }
					}
				}
				add_to_list = htargets
			}
			#random_neighboring_realm_same_rank_owner = {
			#	limit = {
			#		#is_ai = yes
			#		is_alive = yes
			#		is_imprisoned = no
			#		OR = {
			#			has_trait = witch
			#			any_secret = { secret_type = secret_witch }
			#		}
			#	}
			#	add_to_list = htargets
			#}
			if = {
				limit = {
					exists = liege
					liege = {
						any_courtier_or_guest = {
							is_alive = yes
							is_imprisoned = no
							OR = {
								has_trait = witch
								any_secret = { secret_type = secret_witch }
							}
						}
					}
				}
				liege = {
					random_courtier_or_guest = {
						limit = {
							#is_ai = yes
							is_alive = yes
							is_imprisoned = no
							OR = {
								has_trait = witch
								any_secret = { secret_type = secret_witch }
							}
						}
						add_to_list = htargets
					}
				}
			}
			random_in_list = {
				list = htargets
				save_scope_as = htarget
			}
			if = {
				limit = {
					NOT = { exists = scope:htarget }
				}
				create_common_witch_effect = yes
				scope:created_witch = { save_scope_as = htarget }
			}
			random = {
				chance = 25
				random_list = {
					1 = {
						random_courtier_or_guest = {
							limit = { is_imprisoned = no is_alive = yes }
							save_scope_as = htarget
						}
					}
					1 = {
						random_vassal = {
							limit = { is_imprisoned = no is_alive = yes }
							save_scope_as = htarget
						}
					}
				}
				
			}
		}
	}
	
	option = {
		name = ev3.64.a
		scope:htarget = {
			add_character_modifier = {
				modifier = tracked_by_witch_hunter_modifier
				years = 3
			}
		}
		start_scheme = {
			type = abduct
			target = scope:htarget
		}
	}
	option = {
		name = ev3.64.c
		trigger = {
			intrigue > 19
		}
		skill = intrigue
		add_character_modifier = {
			modifier = witchhunter_weapons_modifier
			days = 7
		}
		custom_tooltip = start_duel_ct
		configure_start_single_combat_effect = {
			SC_INITIATOR = root
			SC_ATTACKER = root
			SC_DEFENDER = scope:htarget
			FATALITY = always
			FIXED = no
			LOCALE = alley_night
			OUTPUT_EVENT = fp1_tbc.0011
			INVALIDATION_EVENT = fp1_tbc.0021
		}
	}
	option = {
		name = ev3.64.b
		add_stress = minor_stress_gain
	}
}

#witch hunt 4 players - casual
magic_ev3.65 = {
	title = ev3.42.title
	type = character_event
	desc = ev3.65.desc
	theme = realm
	left_portrait = root
	
	option = {
		name = ev3.44.d
		duel = {
			skill = intrigue
			value = 17
			5 = {
				desc = ev3.63.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.63.a_1
					custom_tooltip = ev3.63.a_1_ct
				}
				trigger_event = magic_ev3.64
				
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					custom_tooltip = ev3.63.a_2_ct
				}
			}
		}
	}
	option = {
		name = ev3.65.b
		trigger = {
			has_trait = administrator
		}
		trait = administrator
		custom_tooltip = ev3.63.a_1_ct
		trigger_event = magic_ev3.64
	}
	option = {
		name = ev3.65.c
		trigger = {
			has_trait = overseer
		}
		trait = overseer
		custom_tooltip = ev3.63.a_1_ct
		trigger_event = magic_ev3.64
	}
	option = {
		name = ev3.65.d
		trigger = {
			has_trait = family_first
		}
		trait = family_first
		custom_tooltip = ev3.63.a_1_ct
		trigger_event = magic_ev3.64
	}
}

#moloch appear
magic_ev3.66 = {
	title = moloch_name
	type = character_event
	desc = ev3.66.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = anger
	}
	
	option = {
		name = ev3.66.a
		trigger_event = magic_ev3.67
	}
}

#moloch first reaction
magic_ev3.67 = {
	title = moloch_name
	type = character_event
	desc = ev3.67.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = anger
	}
	
	option = {
		name = ev3.67.a
		add_stress = minor_stress_gain
		trigger_event = magic_ev3.68
	}
}

#moloch destroy runes
magic_ev3.68 = {
	title = moloch_name
	type = character_event
	desc = ev3.68.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = anger
	}
	
	option = {
		name = ev3.68.a
		trigger_event = magic_ev3.69
	}
}

#moloch - I must do something!
magic_ev3.69 = {
	title = moloch_name
	type = character_event
	desc = ev3.69.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = anger
	}
	
	option = {
		name = ev3.69.a
		custom_tooltip = ev3.69.a_ct
		trigger_event = magic_ev3.70
		if = {
			limit = {
				number_of_personality_traits < 4
				NOR = {
					has_trait = paranoid
					has_trait = trusting
				}
			}
			add_trait = trusting
		}
	}
	option = {
		name = ev3.69.b
		trigger = {
			has_trait = archmage
		}
		trait = archmage
		if = {
			limit = {
				number_of_personality_traits < 4
				NOR = {
					has_trait = shrewd
					has_trait = dull
				}
			}
			add_trait = shrewd
		}
		random_list = {
			1 = {
				desc = ev3.52.a_1
				send_interface_toast = {
					title=ev3.52.a_1
					custom_tooltip = ev3.69.b_ct1
					add_learning_skill = 1
				}
				trigger_event = magic_ev.18
			}
			1 = {
				desc = ev3.52.a_2
				send_interface_toast = {
					title=ev3.52.a_2
					custom_tooltip = ev3.69.a_ct
				}
				trigger_event = magic_ev3.70
			}
		}
	}
	option = {
		name = ev3.69.c
		trigger = {
			has_trait = archmage
			any_character_artifact = {
				has_variable = blackgrimoire
			}
		}
		trait = archmage
		if = {
			limit = {
				number_of_personality_traits < 4
				NOR = {
					has_trait = callous
					has_trait = compassionate
					has_trait = sadistic
				}
			}
			add_trait = callous
		}
		custom_tooltip = ev3.69.b_ct1
		add_learning_skill = 1
		trigger_event = magic_ev.18
	}
	option = {
		name = ev3.69.d
		trigger = {
			NOT = { has_trait = craven }
		}
		if = {
			limit = {
				number_of_personality_traits < 4
				NOR = {
					has_trait = brave
					has_trait = craven
				}
			}
			add_trait = brave
		}
		duel = {
			skill = prowess
			value = 50
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					scope:demon = {
						death = {
							death_reason = death_fight
							killer = root
						}
					}
					add_prestige = major_prestige_gain
					
				}
				add_stress = medium_stress_loss
				add_prowess_skill = 3
				add_dread = 50
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				death = {
					death_reason = death_cloven_in_half
					killer = scope:demon
				}
				hidden_effect = {
					scope:demon = {
						death = natural
					}
				}
			}
		}
	}
}

#moloch is free
magic_ev3.70 = {
	title = moloch_name
	type = character_event
	desc = ev3.70.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = anger
	}
	immediate = {
		add_trait_force_tooltip = wounded_3
	}
	
	option = {
		name = ev3.70.a
		custom_tooltip = ev3.70.a_ct
		hidden_effect = {
			every_courtier_or_guest = {
				if = {
					limit = {
						NOT = {
							has_trait = demon
							has_trait = pure_blooded
						}
					}
					if = {
						limit = {
							is_adult = yes
						}
						random_list = {
							8 = {
								death = {
									death_reason = death_chopped_to_pieces
									killer = scope:demon
								}
							}
							1 = {
								add_trait = wounded_3
							}
							1 = {
								add_trait = wounded_3
								add_trait = infirm
							}
						}
					}
					else = {
						death = {
							death_reason = death_eaten
							killer = scope:demon
						}
					}
				}
				
			}
		}
	}
	after = {
		
		custom_tooltip = ev3.70.a_ct2
		
		scope:demon = {
			trigger_event = magic_ev3.71
		}
		clear_saved_scope = demon
	}
}

magic_ev3.71 = {
	hidden = yes
	type = character_event
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	immediate = {
		random_ruler = {
			limit = {
				is_landed = yes
			}
			save_scope_as = rruler
			recruit_courtier = root
		}
		scope:rruler = {
			send_interface_toast = {
				title=ev3.71.title
				custom_tooltip = ev3.70.a_ct	
			}
			if = {
				limit = {
					NOT = {
						has_trait = demon
						has_trait = pure_blooded
					}
				}
				random_list = {
					1 = {
						death = {
							death_reason = death_chopped_to_pieces
							killer = root
						}
					}
					1 = {
						add_trait = wounded_3
					}
				}
			}
			
			every_courtier_or_guest = {
				if = {
					limit = {
						NOT = {
							has_trait = demon
							has_trait = pure_blooded
						}
					}
					if = {
						limit = {
							is_adult = yes
						}
						random_list = {
							8 = {
								death = {
									death_reason = death_chopped_to_pieces
									killer = root
								}
							}
							1 = {
								add_trait = wounded_3
							}
							1 = {
								add_trait = wounded_3
								add_trait = infirm
							}
						}
					}
					else = {
						death = {
							death_reason = death_eaten
							killer = root
						}
					}
				}
				
			}
		}
		trigger_event = {
			id = magic_ev3.71
			years = { 1 5 }
		}
		clear_saved_scope = rruler
	}
}

#court mage event
magic_ev3.72 = {
	title = ev3.72.title
	type = character_event
	desc = ev3.72.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		has_court_position = mage_court_position
		is_imprisoned = no
	}
	
	option = {
		name = ev3.72.a
		trigger = {
			NOR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
		}
		add_secret = {
			type = secret_witch
			target = root
		}
		set_focus = witch_focus
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev3.72.b
		add_dread = 10
		add_prestige = 100
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev3.72.c
		if = {
			limit = {
				OR = {
					has_focus = witch_focus
					has_focus = arcane_focus
				}
			}
			add_learning_skill = 1
			custom_tooltip = ev2.47.a_ct
			hidden_effect = {
				add_magic_lifestyle_perk_points = 1
			}
		}
		else = {
			add_learning_skill = 2
		}
		ai_chance = {
			base = 10
		}	
	}
	option = {
		name = ev3.72.d
		trigger = {
			has_trait = true_witch
			NOR = {
				any_character_artifact = { has_variable = magic1 }
				has_trait = source
				has_perk = magical_experiments_p1_perk
			}
		}
		trait = true_witch
		add_stress = minor_stress_gain
		custom_tooltip = ev3.72.d_ct
		trigger_event = magic_ev3.73
		ai_chance = {
			base = 100
		}
	}
	after = {
		add_character_flag = court_mage_event
	}
}

#court mage event - part 2 - magic item
magic_ev3.73 = {
	title = ev3.72.title
	type = character_event
	desc = ev3.73.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:mmmowner

	immediate = {
		hidden_effect = {
			random_living_character = {
				limit = {
					NOT = { this = root }
					any_character_artifact = { has_variable = magic1 }
				}
				save_scope_as = mmmowner
			}
			scope:mmmowner = {
				random_character_artifact = {
					limit = {
						has_variable = magic1
					}
					save_scope_as = aaartif
				}
			}
		}
		
	}
	
	option = {
		name = ev2.64.a
	}
	option = {
		name = ev3.73.b
		duel = {
			skill = diplomacy
			value = 20
			5 = {
				desc = ev3.73.b_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.73.b_1
					add_personal_artifact_claim = scope:aaartif
				}
				hidden_effect = {
					set_relation_rival = scope:mmmowner
					#set_random_rivalry_reason = { TARGET = scope:mmmowner }
					#if = {
					#	limit = {
					#		exists = primary_heir
					#		primary_heir = {
					#			is_ai = yes
					#		}
					#	}
					#	primary_heir = {
					#		add_personal_artifact_claim = scope:aaartif
					#	}
					#}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					add_prestige = -100
				}
			}
		}
	}
	after = {
		clear_saved_scope = mmmowner
		clear_saved_scope = aaartif
	}
}

magic_ev3.74 = {
	hidden = yes
	type = character_event
	trigger = {
		is_alive = yes
		has_trait = archmage
	}
	immediate = {
		add_trait = archmage2
	}
}

magic_ev3.75 = {
	hidden = yes
	type = character_event
	trigger = {
		is_alive = yes
	}
	immediate = {
		add_trait = demon
	}
}