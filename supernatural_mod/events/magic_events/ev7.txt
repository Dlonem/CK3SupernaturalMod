namespace = magic_ev7

#sources
magic_ev7.999 = {
	hidden = yes
	trigger = {
		has_trait = source
		has_trait_xp = {
			trait = source
			track = magic_potential
			value < 100
		}
		NOT = {
			has_trait = demon
		}
	}
	immediate = {
		random_list = {
			25 = {
				trigger_event = {
					id = magic_ev7.1
					years = { 5 7 }
				}
			}
			25 = {
				trigger_event = {
					id = magic_ev7.2
					years = { 5 7 }
				}
			}
			20 = {
				if = {
					limit = {
						NOR = {
							has_character_flag = demon_child
							has_trait_xp = {
								trait = source
								track = magic_potential
								value < 40
							}
						}
					}
					trigger_event = {
						id = magic_ev7.3
						years = { 5 7 }
					}
				}
			}
			20 = {
				trigger_event = {
					id = magic_ev8.1
					years = { 5 7 }
				}
			}
			10 = {

			}
		}
	}
}
#source 1.
magic_ev7.1 = {
	title = ev7.1.title
	desc = ev7.1.desc
	theme = healthcare
	override_background = {
		reference = bedchamber
	}
	left_portrait = {
		character = root
		animation = worry
	}

	trigger = {
		is_alive = yes
		has_trait = source
	}

	option = {
		name = ev7.1.0.a
		add_stress = minor_stress_gain
	}
}
#source 2.
magic_ev7.2 = {
	title = ev7.2.title
	desc = ev7.2.desc
	theme = healthcare
	override_background = {
		reference = garden
	}
	left_portrait = root

	trigger = {
		is_alive = yes
		has_trait = source
	}
	immediate = {
		add_2_magic_potential = yes
	}

	option = {
		name = ev7.2.0.a
		add_stress = minor_stress_loss
	}
	option = {
		name = ev7.2.0.b
		trigger = {
			has_trait = curious
		}
		trait = curious
		give_witch_secret_or_trait_effect = yes
	}
	option = {
		name = ev7.2.0.c
		trigger = {
			has_trait = pensive
		}
		trait = pensive
		#random_list = {
		#	1 = {
		#		give_witch_secret_or_trait_effect = yes
		#	}
		#	1 = {
		#		add_learning_skill = 1
		#	}
		#}
		add_character_modifier = {
			modifier = mind_reader_modifier
		}
	}
}

#source 3.
magic_ev7.3 = {
	title = ev7.3.title
	desc = ev7.3.desc
	theme = healthcare
	override_background = {
		reference = bedchamber
	}
	left_portrait = {
		character = root
		animation = worry
	}

	trigger = {
		is_alive = yes
		has_trait = source
	}

	option = {
		name = ev7.3.0.a
		add_stress = medium_stress_gain
		#remove_trait = source
		#add_trait = source4
		make_source_unstable = yes
		hidden_effect = {
			if = {
				limit = {
					is_ruler = no
					exists = liege
					NOT = {
						liege = ROOT
					}
				}
				save_scope_as = schild
				liege = {
					trigger_event = magic_ev7.4
					add_opinion = {
						target = ROOT
						modifier = is_a_threat_opinion
					}
				}
			}
			trigger_event = {
				id = magic_ev7.5
				months = { 2 8 }
			}
		}
	}
}
#instable source - liege reaction
magic_ev7.4 = {
	title = ev7.4.title
	desc = ev7.4.desc
	theme = realm
	left_portrait = root
	right_portrait = {
		character = scope:schild
		animation = worry
	}
	immediate = {
		show_as_tooltip = {
			scope:schild = {
				make_source_unstable = yes
			}
		}
		hidden_effect = {
			random_vassal_or_below = {
				limit = {
					is_clergy = yes
					faith = root.faith
					is_ai = yes
				}
				save_scope_as = spriest
			}
			if = {
				limit = {
					NOT = {
						exists = scope:spriest
					}
				}
				random_courtier = {
					limit = {
						is_clergy = yes
						faith = root.faith
						is_ai = yes
					}
					save_scope_as = spriest
				}
			}
		}
	}

	option = {
		name = ev7.4.0.a
		if = {
			limit = {
				trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = root.faith GENDER_CHARACTER = root }
			}
			stress_impact = {
				zealous = medium_stress_gain
			}
		}
		stress_impact = {
			craven = minor_stress_gain
			lifestyle_mystic = minor_stress_loss
			true_witch = minor_stress_loss
			compassionate = minor_stress_loss
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 5
				has_trait = lifestyle_mystic
			}
			modifier = {
				add = 10
				has_trait = compassionate
			}
			modifier = {
				add = 5
				has_trait = true_witch
			}
			modifier = {
				add = -5
				has_trait = craven
			}
			modifier = {
				add = -20
				trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = root.faith GENDER_CHARACTER = root }
				has_trait = zealous
			}
		}
	}
	option = {
		name = ev7.4.0.b
		trigger = {
			scope:schild = {
				is_ruler = no
			}
		}
		scope:schild = {
			banish = yes
		}
		stress_impact = {
			craven = minor_stress_loss
			compassionate = major_stress_gain
			sadistic = minor_stress_gain
		}
		ai_chance = {
			base = 10
			modifier = {
				add = -20
				has_trait = compassionate
			}
			modifier = {
				add = 5
				has_trait = sadistic
			}
			modifier = {
				add = 5
				has_trait = callous
			}
			modifier = {
				add = 5
				has_trait = craven
			}
		}
	}
	option = {
		name = ev7.4.0.c
		stress_impact = {
			compassionate = minor_stress_gain
			humble = minor_stress_loss
			zealous = medium_stress_loss
			cynical = minor_stress_gain
			arrogant = minor_stress_gain
		}
		random_list = {
			1 = {
				trigger = {
					scope:schild = {
						is_ruler = no
					}
				}
				scope:schild = {
					banish = yes
				}
			}
			1 = {
				trigger = {
					faith = {
						has_doctrine = tenet_human_sacrifice
					}
					exists = scope:spriest
				}
				scope:schild = {
					death = {
						death_reason = death_sacrificed_to_gods
						killer = scope:spriest
					}
				}
			}
			1 = {
				trigger = {
					scope:schild = {
						is_ruler = no
					}
				}
				scope:schild = {
					add_trait = devoted
				}
			}
			1 = {
				trigger = {
					scope:schild = {
						is_ruler = yes
					}
				}
				imprison = {
					target = scope:schild
					type = house_arrest
				}
			}
			1 = {

			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 10
				trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = root.faith GENDER_CHARACTER = root }
				has_trait = zealous
			}
			modifier = {
				add = -5
				has_trait = cynical
			}
			modifier = {
				add = -5
				has_trait = true_witch
			}
			modifier = {
				add = -5
				has_trait = lifestyle_mystic
			}
			modifier = {
				add = 5
				has_trait = theologian
			}
		}
	}
	option = {
		name = ev7.4.0.d
		trigger = {
			has_trait = archmage
			can_spend_standard_ps_trigger = yes
		}
		trait = archmage
		stress_impact = {
			trusting = medium_stress_gain
			scholar = minor_stress_loss
		}
		spend_standard_ps_effect = yes
		scope:schild = {
			random_list = {
				8 = {
					reduce_40_source_instability = yes
				}
				1 = {
					reduce_10_source_instability = yes
				}
				1 = {
					add_trait_xp = {
						trait = source
						track = magic_potential
						value = -5
					}
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
}

#unstable source management
magic_ev7.5 = {
	hidden = yes
	trigger = {
		has_unstable_source_trigger = yes
	}
	immediate = {
		if = {
			limit = {
				can_spend_standard_ps_trigger = yes
			}
			if = {
				limit = {
					age < 16
				}
				random_list = {
					25 = {
						if = {
							limit = {
								NOT = {
									any_relation = {
										type = guardian
										OR = {
											#OR = {
											#	has_trait = witch
											#	any_secret = { secret_type = secret_witch }
											#}
											has_trait = true_witch
											has_trait = archmage
											has_trait = lifestyle_mystic
											has_trait = demon
										}
									}
								}
							}
							trigger_event = magic_ev7.6
						}
						else = {
							send_interface_toast = {
								title = child_personality.0061.t
								reduce_10_source_instability = yes
							}
							if = {
								limit = {
									has_unstable_source_trigger = no
								}
								random_relation = {
									type = guardian
									send_interface_toast = {
										title = child_personality.0061.t
										left_icon = this
										right_icon = ROOT
										custom_tooltip = ev7.11.0.d_title
									}
								}
							}
						}
					}
					25 = {
						trigger_event = magic_ev7.7
					}
					25 = {
						trigger_event = magic_ev7.9
					}
					25 = {
		
					}
					10 = {
						trigger = {
							OR = {
								has_character_modifier = aura_boost1_modifier
								has_character_modifier = aura_boost2_modifier
								has_trait = devoted
							}
						}
						if = {
							limit = {
								has_character_modifier = aura_boost1_modifier
							}
							send_interface_toast = {
								title = aura_boost1_modifier
								reduce_10_source_instability = yes
							}
						}
						else_if = {
							limit = {
								has_character_modifier = aura_boost2_modifier
							}
							send_interface_toast = {
								title = aura_boost2_modifier
								reduce_10_source_instability = yes
							}
						}
						if = {
							limit = {
								has_unstable_source_trigger = no
							}
							random_relation = {
								type = guardian
								send_interface_toast = {
									title = ev7.11.0.d_title
									left_icon = this
									right_icon = ROOT
								}
							}
						}
					}
				}
				
			}
			else = {
				random_list = {
					85 = {
						trigger_event = magic_ev7.11
					}
					15 = {
		
					}
					15 = {
						trigger = {
							OR = {
								has_character_modifier = aura_boost1_modifier
								has_character_modifier = aura_boost2_modifier
								has_trait = devoted
							}
						}
						if = {
							limit = {
								has_character_modifier = aura_boost1_modifier
							}
							send_interface_toast = {
								title = aura_boost1_modifier
								reduce_10_source_instability = yes
							}
						}
						else_if = {
							limit = {
								has_character_modifier = aura_boost2_modifier
							}
							send_interface_toast = {
								title = aura_boost2_modifier
								reduce_10_source_instability = yes
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				age < 16
			}
			trigger_event = {
				id = magic_ev7.5
				months = { 4 24 }
			}
		}
		else = {
			trigger_event = {
				id = magic_ev7.5
				years = { 1 4 }
			}
		}
	}
}

#magic eruption 1.
magic_ev7.6 = {
	title = ev7.6.title
	desc = ev7.6.desc
	theme = healthcare
	override_background = {
		reference = garden
	}
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:vic1
		animation = fear
	}
	lower_right_portrait = scope:vic2

	trigger = {
		is_alive = yes
		has_trait = source4
		can_spend_standard_ps_trigger = yes
	}
	immediate = {
		if = {
			limit = {
				OR = {
					has_trait = sadistic
					has_trait = callous
				}
			}
			stress_impact = {
				sadistic = medium_stress_loss
			}
		}
		else = {
			add_stress = medium_stress_gain
		}
		
		hidden_effect = {
			random_living_character = {
				limit = {
					NOT = { this = root }
					has_any_basic_magic_prot_trigger = no
					location = root.location
				}
				save_scope_as = vic1
			}
			if = {
				limit = {
					NOT = {
						exists = scope:vic1
					}
				}
				create_character = {
					template = bandit_character
					culture = root.culture
					faith = root.faith
					location = root.location
					dynasty = none
					save_scope_as = vic1
				}
			}
			random_living_character = {
				limit = {
					NOT = { this = root }
					NOT = { this = scope:vic1 }
					has_any_basic_magic_prot_trigger = no
					location = root.location
				}
				save_scope_as = vic2
			}
			if = {
				limit = {
					NOT = {
						exists = scope:vic2
					}
				}
				create_character = {
					template = bandit_character
					culture = root.culture
					faith = root.faith
					location = root.location
					dynasty = none
					save_scope_as = vic2
				}
			}
			if = {
				limit = {
					NOT = {
						is_ruler = yes
					}
					exists = liege
					NOT = {
						root = liege
					}
				}
				liege = {
					save_scope_as = info_ruler
				}
			}
		}
	}

	option = {
		name = ev7.6.0.a
		trigger = {
			exists = scope:vic1
		}
		hidden_effect = {
			if = {
				limit = {
					exists = scope:info_ruler
				}
				scope:info_ruler = {
					send_interface_toast = {
						title=ev7.6.title
						show_as_tooltip = {
							scope:vic1 = {
								death = {
									death_reason = death_cloven_in_half
									killer = root
								}
							}
						}
						left_icon = root
						right_icon = scope:vic1
					}
				}
			}
		}
		scope:vic1 = {
			death = {
				death_reason = death_cloven_in_half
				killer = root
			}
		}
	}
	option = {
		name = ev7.6.0.b
		trigger = {
			exists = scope:vic2
		}
		hidden_effect = {
			if = {
				limit = {
					exists = scope:info_ruler
				}
				scope:info_ruler = {
					send_interface_toast = {
						title=ev7.6.title
						show_as_tooltip = {
							scope:vic2 = {
								death = {
									death_reason = death_cloven_in_half
									killer = root
								}
							}
						}
						left_icon = root
						right_icon = scope:vic2
					}
				}
			}
		}
		scope:vic2 = {
			death = {
				death_reason = death_fire
				killer = root
			}
		}
		
	}
	option = {
		name = ev7.6.0.c
		hidden_effect = {
			if = {
				limit = {
					exists = scope:info_ruler
				}
				scope:info_ruler = {
					send_interface_toast = {
						title=ev7.6.title
						location.county = {
							add_county_modifier = {
								modifier = uncontrolled_urban_fires_modifier
								years = 2
							}
						}
						left_icon = root
					}
				}
			}
		}
		location.county = {
			add_county_modifier = {
				modifier = uncontrolled_urban_fires_modifier
				years = 2
			}
		}
		scope:vic1 = {
			add_trait = wounded_3
		}
		scope:vic2 = {
			add_trait = wounded_3
		}
	}
}
#magic eruption 2.
magic_ev7.7 = {
	title = ev7.6.title
	desc = ev7.7.desc
	theme = healthcare
	override_background = {
		reference = garden
	}
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:resper
		animation = fear
	}

	trigger = {
		is_alive = yes
		has_trait = source4
		can_spend_standard_ps_trigger = yes
		is_pool_character = no
	}
	immediate = {
		select_responsible_person_effect = yes
		save_scope_as = mchild
	}

	option = {
		name = ev7.7.0.a
		add_stress = medium_stress_gain
		custom_tooltip = ev7.7.0.a_ct
		hidden_effect = {
			scope:resper = {
				trigger_event = magic_ev7.8
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev7.7.0.b
		trigger = {
			has_trait = stubborn
		}
		trait = stubborn
		add_stress = medium_stress_gain
		custom_tooltip = meruption_avoided
		if = {
			limit = {
				NOT = {
					has_trait = disfigured
				}
			}
			random = {
				chance = 1
				add_trait = disfigured
			}
		}
		ai_chance = {
			base = 100
		}
	}
}
#magic eruption 2. - reaction
magic_ev7.8 = {
	title = ev7.6.title
	desc = ev7.8.desc
	theme = healthcare
	override_background = {
		reference = garden
	}
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:mchild
		animation = fear
	}

	trigger = {
		is_alive = yes
	}
	immediate = {
		if = {
			limit = {
				NOR = {
					has_trait = archmage
					has_trait = demon
				}
			}
			add_stress = medium_stress_gain
		}
		
	}

	option = {
		name = ev7.8.0.a
		stress_impact = {
			craven = medium_stress_gain
		}
		random_list = {
			3 = {
				scope:mchild = {
					send_interface_toast = {
						title=ev7.6.title
						heavy_wounds_effect = yes
					}
					hidden_effect = {
						spend_standard_ps_effect = yes
					}
				}
				
				send_interface_toast = {
					title=ev7.6.title
					heavy_wounds_effect = yes
				}
			}
			1 = {
				hidden_effect = {
					scope:mchild = {
						send_interface_toast = {
							title=meruption_avoided
							add_stress = minor_stress_loss
						}
					}
				}
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 20
				has_trait = compassionate
			}
			modifier = {
				add = -10
				has_trait = craven
			}
		}
	}
	option = {
		name = ev7.8.0.b
		stress_impact = {
			craven = medium_stress_loss
			compassionate = medium_stress_gain
		}
		scope:mchild = {
			send_interface_toast = {
				title=ev7.6.title
				heavy_wounds_effect = yes
			}
			hidden_effect = {
				spend_standard_ps_effect = yes
			}
		}
		ai_chance = {
			base = 15
			modifier = {
				add = -20
				has_trait = compassionate
			}
			modifier = {
				add = 10
				has_trait = craven
			}
		}
	}
	option = {
		name = ev7.8.0.c
		trigger = {
			NOR = {
				has_trait = archmage
				has_trait = true_witch
				has_trait = demon
				has_trait = lifestyle_mystic
			}
			OR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
		}
		trait = witch
		stress_impact = {
			craven = medium_stress_gain
		}
		random_list = {
			1 = {
				scope:mchild = {
					send_interface_toast = {
						title=ev7.6.title
						heavy_wounds_effect = yes
					}
					hidden_effect = {
						spend_standard_ps_effect = yes
					}
				}
				
				send_interface_toast = {
					title=ev7.6.title
					heavy_wounds_effect = yes
				}
			}
			2 = {
				hidden_effect = {
					scope:mchild = {
						send_interface_toast = {
							title=meruption_avoided
							add_stress = minor_stress_loss
						}
					}
				}
			}
		}
		ai_chance = {
			base = 25
		}
	}
	option = {
		name = ev7.8.0.c
		trigger = {
			NOR = {
				has_trait = archmage
				has_trait = true_witch
				has_trait = demon
			}
			has_trait = lifestyle_mystic
		}
		trait = lifestyle_mystic
		stress_impact = {
			craven = medium_stress_gain
			scholar = minor_stress_loss
		}
		random_list = {
			1 = {
				scope:mchild = {
					send_interface_toast = {
						title=ev7.6.title
						heavy_wounds_effect = yes
					}
					hidden_effect = {
						spend_standard_ps_effect = yes
					}
				}
				
				send_interface_toast = {
					title=ev7.6.title
					heavy_wounds_effect = yes
				}
			}
			1 = {
				hidden_effect = {
					scope:mchild = {
						send_interface_toast = {
							title=meruption_avoided
							add_stress = minor_stress_loss
						}
					}
				}
			}
		}
		ai_chance = {
			base = 25
		}
	}
	option = {
		name = ev7.8.0.d
		trigger = {
			has_trait = true_witch
		}
		trait = true_witch
		stress_impact = {
			compassionate = minor_stress_loss
		}
		random_list = {
			1 = {
				scope:mchild = {
					send_interface_toast = {
						title=ev7.6.title
						heavy_wounds_effect = yes
					}
					hidden_effect = {
						spend_standard_ps_effect = yes
					}
				}
				hidden_effect = {
					send_interface_toast = {
						title=ev7.6.title
						show_as_tooltip = {
							scope:mchild = {
								heavy_wounds_effect = yes
							}
						}
					}
				}
			}
			4 = {
				hidden_effect = {
					scope:mchild = {
						send_interface_toast = {
							title=meruption_avoided
							add_stress = minor_stress_loss
							reduce_10_source_instability = yes
						}
					}
					send_interface_toast = {
						title=meruption_avoided
						scope:mchild = {
							show_as_tooltip = {
								add_stress = minor_stress_loss
							}
						}
					}
				}
			}
		}
		ai_chance = {
			base = 250
		}
	}
	option = {
		name = ev7.8.0.e
		trigger = {
			has_trait = archmage
			can_be_power_saturated_trigger = yes
		}
		trait = archmage
		stress_impact = {
			greedy = minor_stress_loss
		}
		random_list = {
			1 = {
				scope:mchild = {
					send_interface_toast = {
						title=ev7.6.title
						heavy_wounds_effect = yes
					}
					hidden_effect = {
						spend_standard_ps_effect = yes
					}
				}
				hidden_effect = {
					send_interface_toast = {
						title=ev7.6.title
						show_as_tooltip = {
							scope:mchild = {
								heavy_wounds_effect = yes
							}
						}
					}
				}
			}
			9 = {
				scope:mchild = {
					spend_standard_ps_effect = yes
					hidden_effect = {
						send_interface_toast = {
							title=meruption_avoided
							add_stress = minor_stress_loss
							reduce_10_source_instability = yes
						}
					}
				}
				gain_standard_ps_effect = yes
			}
		}
		ai_chance = {
			base = 2500
			modifier = {
				add=1000
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev7.8.0.f
		trigger = {
			has_trait = archmage
			can_spend_standard_ps_trigger = yes
		}
		trait = archmage
		stress_impact = {
			compassionate = minor_stress_loss
		}
		spend_standard_ps_effect = yes
		random_list = {
			5 = {
				scope:mchild = {
					send_interface_toast = {
						title=meruption_avoided
						spend_standard_ps_effect = yes
					}
				}
			}
			5 = {
				scope:mchild = {
					send_interface_toast = {
						title=meruption_avoided
						spend_standard_ps_effect = yes
						reduce_40_source_instability = yes
					}
				}
			}
		}
		ai_chance = {
			base = 2500
		}
	}
	option = {
		name = ev7.8.0.g
		trigger = {
			has_trait = demon
			has_trait_xp = {
				trait = demon
				value > 9
			}
		}
		add_trait_xp = {
			trait = demon
			value = -10
		}
		scope:mchild = {
			random_list = {
				6 = {
					send_interface_toast = {
						title=meruption_avoided
						reduce_100_source_instability = yes
					}
					custom_tooltip = ev7.8.0.g_ct
					hidden_effect = {
						add_character_flag = may_be_demon_in_the_future_flag
						trigger_event = {
							id = magic_ev2.38
							years = { 12 18 }
						}
					}
				}
				4 = {
					send_interface_toast = {
						title=meruption_avoided
						spend_standard_ps_effect = yes
						reduce_10_source_instability = yes
					}
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
}
#magic eruption 3.
magic_ev7.9 = {
	title = ev7.6.title
	desc = ev7.9.desc
	theme = healthcare
	override_background = {
		reference = bedchamber
	}
	left_portrait = {
		character = root
		animation = fear
	}

	trigger = {
		is_alive = yes
		has_trait = source4
		can_spend_standard_ps_trigger = yes
	}
	immediate = {
		select_responsible_person_effect = yes
		save_scope_as = mchild
		add_stress = medium_stress_gain
	}

	option = {
		name = bp1_yearly.5001.c	#HELP!
		trigger = {
			exists = scope:resper
		}
		custom_tooltip = ev7.7.0.a_ct
		hidden_effect = {
			scope:resper = {
				trigger_event = magic_ev7.10
			}
		}
		ai_chance = {
			base = 200
		}
	}
	option = {
		name = ev7.9.0.a	#I'll hold out!
		trigger = {
			NOR = {
				has_trait = physique_good_1
				has_trait = physique_good_2
				has_trait = physique_good_3
			}
		}
		random_list = {
			1 = {
				every_living_character = {
					limit = {
						location = root.location
						OR = {
							is_foreign_court_or_pool_guest = yes
							is_courtier = yes
						}
						NOT = { THIS = ROOT }
						has_basic_magic_prot_trigger = no
					}
					death = {
						death_reason = death_fire
					}
				}
				random = {
					chance = 50
					death = {
						death_reason = death_fire
					}
				}
			}
			1 = {

			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev7.9.0.a	#I'll hold out!
		trigger = {
			has_trait = physique_good_1
		}
		trait = physique_good_1
		random_list = {
			1 = {
				every_living_character = {
					limit = {
						location = root.location
						OR = {
							is_foreign_court_or_pool_guest = yes
							is_courtier = yes
						}
						NOT = { THIS = ROOT }
						has_basic_magic_prot_trigger = no
					}
					death = {
						death_reason = death_fire
					}
				}
				random = {
					chance = 50
					death = {
						death_reason = death_fire
					}
				}
			}
			2 = {

			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 50
				scope:resper = {
					NOR = {
						has_trait = true_witch
						has_trait = archmage
						has_trait = demon
					}
				}
			}
		}
	}
	option = {
		name = ev7.9.0.a	#I'll hold out!
		trigger = {
			has_trait = physique_good_2
		}
		trait = physique_good_2
		random_list = {
			1 = {
				every_living_character = {
					limit = {
						location = root.location
						OR = {
							is_foreign_court_or_pool_guest = yes
							is_courtier = yes
						}
						NOT = { THIS = ROOT }
						has_basic_magic_prot_trigger = no
					}
					death = {
						death_reason = death_fire
					}
				}
				random = {
					chance = 50
					death = {
						death_reason = death_fire
					}
				}
			}
			4 = {

			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 200
				scope:resper = {
					NOR = {
						has_trait = true_witch
						has_trait = archmage
						has_trait = demon
					}
				}
			}
		}
	}
	option = {
		name = ev7.9.0.a	#I'll hold out!
		trigger = {
			has_trait = physique_good_3
		}
		trait = physique_good_3
		random_list = {
			1 = {
				every_living_character = {
					limit = {
						location = root.location
						OR = {
							is_foreign_court_or_pool_guest = yes
							is_courtier = yes
						}
						NOT = { THIS = ROOT }
						has_basic_magic_prot_trigger = no
					}
					death = {
						death_reason = death_fire
					}
				}
				random = {
					chance = 50
					death = {
						death_reason = death_fire
					}
				}
			}
			9 = {

			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1000
				scope:resper = {
					NOR = {
						has_trait = true_witch
						has_trait = archmage
						has_trait = demon
					}
				}
			}
		}
	}
}

#magic eruption 3. - reaction
magic_ev7.10 = {
	title = ev7.6.title
	desc = ev7.10.desc
	theme = healthcare
	override_background = {
		reference = bedchamber
	}
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:mchild
		animation = fear
	}

	trigger = {
		is_alive = yes
	}
	immediate = {
		if = {
			limit = {
				NOR = {
					has_trait = archmage
					has_trait = demon
				}
			}
			add_stress = medium_stress_gain
		}
		
	}

	option = {
		name = ev2.66.a
		stress_impact = {
			craven = medium_stress_gain
		}
		random_list = {
			1 = {
				scope:mchild = {
					every_living_character = {
						limit = {
							location = root.location
							OR = {
								is_foreign_court_or_pool_guest = yes
								is_courtier = yes
							}
							NOT = { THIS = scope:mchild }
							has_any_basic_magic_prot_trigger = no
						}
						death = {
							death_reason = death_fire
						}
					}
					random = {
						chance = 50
						death = {
							death_reason = death_fire
						}
					}
				}
			}
			1 = {
				hidden_effect = {
					scope:mchild = {
						send_interface_toast = {
							title=meruption_avoided
							add_stress = minor_stress_loss
						}
					}
				}
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 20
				has_trait = compassionate
			}
			modifier = {
				add = -10
				has_trait = craven
			}
		}
	}
	option = {
		name = ev7.8.0.b
		stress_impact = {
			craven = medium_stress_loss
			compassionate = medium_stress_gain
		}
		scope:mchild = {
			every_living_character = {
				limit = {
					location = root.location
					OR = {
						is_foreign_court_or_pool_guest = yes
						is_courtier = yes
					}
					NOT = { THIS = scope:mchild }
					NOT = { THIS = ROOT }
					has_any_basic_magic_prot_trigger = no
				}
				death = {
					death_reason = death_fire
				}
			}
			death = {
				death_reason = death_fire
			}
		}
		ai_chance = {
			base = 15
			modifier = {
				add = -20
				has_trait = compassionate
			}
			modifier = {
				add = 10
				has_trait = craven
			}
		}
	}
	option = {
		name = ev7.8.0.c
		trigger = {
			NOR = {
				has_trait = archmage
				has_trait = true_witch
				has_trait = demon
				has_trait = lifestyle_mystic
			}
			OR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
		}
		trait = witch
		stress_impact = {
			craven = medium_stress_gain
		}
		random_list = {
			1 = {
				scope:mchild = {
					every_living_character = {
						limit = {
							location = root.location
							OR = {
								is_foreign_court_or_pool_guest = yes
								is_courtier = yes
							}
							NOT = { THIS = scope:mchild }
							has_any_basic_magic_prot_trigger = no
						}
						death = {
							death_reason = death_fire
						}
					}
					random = {
						chance = 50
						death = {
							death_reason = death_fire
						}
					}
				}
			}
			3 = {
				hidden_effect = {
					scope:mchild = {
						send_interface_toast = {
							title=meruption_avoided
							add_stress = minor_stress_loss
						}
					}
				}
			}
		}
		ai_chance = {
			base = 25
		}
	}
	option = {
		name = ev7.8.0.c
		trigger = {
			NOR = {
				has_trait = archmage
				has_trait = true_witch
				has_trait = demon
			}
			has_trait = lifestyle_mystic
		}
		trait = lifestyle_mystic
		stress_impact = {
			craven = medium_stress_gain
			scholar = minor_stress_loss
		}
		random_list = {
			1 = {
				scope:mchild = {
					every_living_character = {
						limit = {
							location = root.location
							OR = {
								is_foreign_court_or_pool_guest = yes
								is_courtier = yes
							}
							NOT = { THIS = scope:mchild }
							has_any_basic_magic_prot_trigger = no
						}
						death = {
							death_reason = death_fire
						}
					}
					random = {
						chance = 50
						death = {
							death_reason = death_fire
						}
					}
				}
			}
			2 = {
				hidden_effect = {
					scope:mchild = {
						send_interface_toast = {
							title=meruption_avoided
							add_stress = minor_stress_loss
							reduce_10_source_instability = yes
						}
					}
				}
			}
		}
		ai_chance = {
			base = 25
		}
	}
	option = {
		name = ev7.8.0.d
		trigger = {
			has_trait = true_witch
		}
		trait = true_witch
		stress_impact = {
			compassionate = minor_stress_loss
		}
		random_list = {
			1 = {
				scope:mchild = {
					every_living_character = {
						limit = {
							location = root.location
							OR = {
								is_foreign_court_or_pool_guest = yes
								is_courtier = yes
							}
							NOT = { THIS = scope:mchild }
							has_any_basic_magic_prot_trigger = no
						}
						death = {
							death_reason = death_fire
						}
					}
					random = {
						chance = 50
						death = {
							death_reason = death_fire
						}
					}
				}
			}
			6 = {
				hidden_effect = {
					scope:mchild = {
						send_interface_toast = {
							title=meruption_avoided
							add_stress = minor_stress_loss
							reduce_10_source_instability = yes
						}
					}
					send_interface_toast = {
						title=meruption_avoided
						scope:mchild = {
							show_as_tooltip = {
								add_stress = minor_stress_loss
							}
						}
					}
				}
			}
		}
		ai_chance = {
			base = 250
		}
	}
	option = {
		name = ev7.8.0.e
		trigger = {
			has_trait = archmage
			can_be_power_saturated_trigger = yes
		}
		trait = archmage
		stress_impact = {
			greedy = minor_stress_loss
		}
		random_list = {
			1 = {
				scope:mchild = {
					every_living_character = {
						limit = {
							location = root.location
							OR = {
								is_foreign_court_or_pool_guest = yes
								is_courtier = yes
							}
							NOT = { THIS = scope:mchild }
							has_any_basic_magic_prot_trigger = no
						}
						death = {
							death_reason = death_fire
						}
					}
					random = {
						chance = 50
						death = {
							death_reason = death_fire
						}
					}
				}
			}
			9 = {
				scope:mchild = {
					spend_standard_ps_effect = yes
					hidden_effect = {
						send_interface_toast = {
							title=meruption_avoided
							add_stress = minor_stress_loss
							reduce_10_source_instability = yes
						}
					}
				}
				gain_standard_ps_effect = yes
			}
		}
		ai_chance = {
			base = 2500
			modifier = {
				add=1000
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev7.8.0.f
		trigger = {
			has_trait = archmage
			can_spend_standard_ps_trigger = yes
		}
		trait = archmage
		stress_impact = {
			compassionate = minor_stress_loss
		}
		spend_standard_ps_effect = yes
		random_list = {
			5 = {
				scope:mchild = {
					send_interface_toast = {
						title=meruption_avoided
						spend_standard_ps_effect = yes
						reduce_100_source_instability = yes
					}
				}
			}
			5 = {
				scope:mchild = {
					send_interface_toast = {
						title=meruption_avoided
						spend_standard_ps_effect = yes
						reduce_10_source_instability = yes
					}
				}
			}
		}
		ai_chance = {
			base = 2500
		}
	}
	option = {
		name = ev7.8.0.g
		trigger = {
			has_trait = demon
			has_trait_xp = {
				trait = demon
				value > 9
			}
		}
		add_trait_xp = {
			trait = demon
			value = -10
		}
		scope:mchild = {
			random_list = {
				6 = {
					send_interface_toast = {
						title=meruption_avoided
						reduce_100_source_instability = yes
					}
					custom_tooltip = ev7.8.0.g_ct
					hidden_effect = {
						add_character_flag = may_be_demon_in_the_future_flag
						trigger_event = {
							id = magic_ev2.38
							years = { 12 18 }
						}
					}
				}
				4 = {
					send_interface_toast = {
						title=meruption_avoided
						spend_standard_ps_effect = yes
						reduce_10_source_instability = yes
					}
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
}

#magic eruption 4. - adult
magic_ev7.11 = {
	title = ev7.6.title
	desc = ev7.11.desc
	theme = healthcare
	override_background = {
		reference = sitting_room
	}
	left_portrait = {
		character = root
		animation = fear
	}

	trigger = {
		is_alive = yes
		has_unstable_source_trigger = yes
		can_spend_standard_ps_trigger = yes
	}
	option = {
		name = ev7.11.0.e
		trigger = {
			has_trait = devoted
		}
		trait = devoted
		remove_trait = source
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.9.0.a	#I'll hold out!
		add_stress = medium_stress_gain
		spend_standard_ps_effect = yes
		random_list = {
			2 = {
				death = {
					death_reason = death_fire
				}
			}
			2 = {
				trigger = {
					NOR = {
						has_trait = wounded_1
						has_trait = wounded_2
						has_trait = wounded_3
					}
				}
				add_trait = wounded_3
			}
			1 = {

			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev7.11.0.c
		trigger = {
			has_trait = lifestyle_herbalist
		}
		trait = lifestyle_herbalist
		reduce_10_source_instability = yes
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev7.11.0.a
		trigger = {
			OR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
		}
		trait = witch
		add_stress = minor_stress_gain
		random_list = {
			3 = {
				reduce_40_source_instability = yes
				#add_5_magic_potential = yes
				add_character_modifier = {
					modifier = magic_resonance
					years = 10
				}
			}
			2 = {
				spend_standard_ps_effect = yes
			}
			1 = {
				heavy_wounds_effect = yes
				spend_standard_ps_effect = yes
			}
		}
		ai_chance = {
			base = 25
		}
	}
	option = {
		name = ev7.11.0.a
		trigger = {
			NOR = {
				has_trait = witch
				any_secret = { secret_type = secret_witch }
			}
			has_trait = lifestyle_mystic
		}
		trait = lifestyle_mystic
		add_stress = minor_stress_gain
		random_list = {
			3 = {
				reduce_40_source_instability = yes
				add_character_modifier = {
					modifier = magic_resonance
					years = 10
				}
			}
			2 = {
				spend_standard_ps_effect = yes
			}
			1 = {
				heavy_wounds_effect = yes
				spend_standard_ps_effect = yes
			}
		}
		ai_chance = {
			base = 25
		}
	}
	option = {
		name = ev7.11.0.b
		trigger = {
			has_trait = true_witch
			NOT = {
				has_trait = archmage
			}
		}
		trait = true_witch
		reduce_100_source_instability = yes
		#add_5_magic_potential = yes
		add_character_modifier = {
			modifier = magic_resonance
			years = 10
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev7.11.0.b
		trigger = {
			has_trait = archmage
		}
		trait = archmage
		reduce_100_source_instability = yes
		#add_5_magic_potential = yes
		gain_sc_xp1_effect = yes
		gain_standard_ps_effect = yes
		add_character_modifier = {
			modifier = magic_resonance
			years = 10
		}
		ai_chance = {
			base = 1000
		}
	}
	option = {
		name = ev7.11.0.d
		trigger = {
			has_trait = archmage
		}
		trait = archmage
		random_list = {
			1 = {
				custom_tooltip = ev7.11.0.d_ct
				hidden_effect = {
					random_list = {
						50 = {
							send_interface_toast = {
								title=ev7.11.0.d_title
								reduce_100_source_instability = yes
								#add_5_magic_potential = yes
								gain_sc_xp10_effect = yes
							}
						}
						40 = {
							send_interface_toast = {
								title=ev7.11.0.d_title
								reduce_100_source_instability = yes
								if = {
									limit = {
										NOT = {
											has_character_modifier = aura_boost1_modifier
										}
									}
									add_character_modifier = {
										modifier = aura_boost1_modifier
									}
								}
							}
							add_5_magic_potential = yes
						}
						3 = {
							trigger = {
								NOT = {
									has_trait = demon
								}
							}
							send_interface_toast = {
								title=ev7.11.0.d_title
								reduce_100_source_instability = yes
								add_trait = demon
							}
							#add_5_magic_potential = yes
						}
						5 = {
							send_interface_toast = {
								title=ev7.11.0.d_title
								reduce_100_source_instability = yes
								add_5_magic_potential = yes
								gain_sc_xp10_effect = yes
								add_trait_xp = {
									trait = archmage
									track = demonology
									value = 20
								}
							}
						}
						2 = {
							send_interface_toast = {
								title=ev7.11.0.d_title
								reduce_100_source_instability = yes
							}
							add_5_magic_potential = yes
						}
					}
				}
			}
			1 = {
				send_interface_toast = {
					title=ev7.11.0.d_title
					reduce_100_source_instability = yes
				}
			}
			1 = {
				death = {
					death_reason = death_fire
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
}

#raw magic - outcome 1. - curse
magic_ev7.12 = {
	title = ev7.12.title
	desc = ev7.12.desc
	theme = realm
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	#right_portrait = {
	#	character = scope:recipient
	#	animation = fear
	#}
	right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		has_trait = source
	}	
	immediate = {
		spend_standard_ps_effect = yes
	}

	option = {
		name = ev7.12.0.a
		scope:recipient = {
			add_character_modifier = {
				modifier = cursed_modifier
				years = 2
			}
		}
	}
	option = {
		name = ev7.12.0.b
		trigger = {
			NOT = {
				is_the_choosen_one_trigger = yes
			}
		}
		random_list = {
			8 = {
				scope:recipient = {
					add_character_modifier = {
						modifier = cursed_modifier
						years = 3
					}
					add_stress = major_stress_gain
				}
			}
			2 = {
				add_character_modifier = {
					modifier = cursed_modifier
					years = 3
				}
				add_stress = major_stress_gain
			}
		}
	}
	option = {
		name = ev7.12.0.b
		trigger = {
			is_the_choosen_one_trigger = yes
		}
		scope:recipient = {
			death = natural
		}
	}
	option = {
		name = ev7.12.0.c
		scope:recipient = {
			if = {
				limit = {
					NOR = {
						has_character_modifier = aura_boost1_modifier
						has_character_modifier = aura_boost2_modifier
					}
				}
				add_character_modifier = {
					modifier = aura_boost2_modifier
					years = 3
				}
			}
		}
	}
}
#raw magic - outcome 2. - failure
magic_ev7.13 = {
	title = ev7.12.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = rm_o1_falg
				}
				desc = ev7.13.desc1
			}
			triggered_desc = {
				trigger = {
					has_character_flag = rm_o2_falg
				}
				desc = ev7.13.desc2
			}
			desc = ev7.13.desc3
		}
	}
	theme = realm
	left_portrait = {
		character = root
		animation = fear
	}

	trigger = {
		is_alive = yes
		has_trait = source
	}
	immediate = {
		hidden_effect = {
			random_list = {
				1 = {
					add_character_flag = rm_o1_falg
				}
				1 = {
					add_character_flag = rm_o2_falg
				}
				1 = {
					add_character_flag = rm_o3_falg
				}
			}
		}
	}

	option = {
		name = tour_grounds_events.3017.a	#A pity.
		
		if = {
			limit = {
				has_character_flag = rm_o1_falg
			}
			add_dread = minor_dread_gain
			spend_standard_ps_effect = yes
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = rm_o1_falg
				}
				remove_character_flag = rm_o1_falg
			}
			if = {
				limit = {
					has_character_flag = rm_o2_falg
				}
				remove_character_flag = rm_o2_falg
			}
			if = {
				limit = {
					has_character_flag = rm_o3_falg
				}
				remove_character_flag = rm_o3_falg
			}
		}
	}
}

#raw magic - outcome 3. - cancer // epidemic
magic_ev7.14 = {
	title = ev7.12.title
	desc = ev7.14.desc
	theme = realm
	left_portrait = root
	#right_portrait = {
	#	character = scope:recipient
	#	animation = fear
	#}
	right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		#has_unstable_source_trigger = yes
		has_trait = source
	}
	immediate = {
		spend_standard_ps_effect = yes
		hidden_effect = {
			random_list = {
				1 = {
					add_character_flag = rm_o1_falg
				}
				1 = {
					add_character_flag = rm_o2_falg
				}
			}
		}
	}

	option = {
		name = bp2_hostage_system.0300.a.killer	#Oh well...
		if = {
			limit = {
				has_character_flag = rm_o1_falg
			}
			scope:recipient = {
				if = {
					limit = {
						NOT = {
							has_trait = cancer
						}
					}
					add_trait = cancer
				}
				else = {
					remove_trait = cancer
				}
			}
		}
		else = {
			scope:recipient.location = {
				create_epidemic_outbreak = {
					type = measles
					intensity = major
				}
			}
		}
	}
	after = {
		if = {
			limit = {
				has_character_flag = rm_o1_falg
			}
			remove_character_flag = rm_o1_falg
		}
		if = {
			limit = {
				has_character_flag = rm_o2_falg
			}
			remove_character_flag = rm_o2_falg
		}
	}
}
#raw magic - outcome 4. - traits
magic_ev7.15 = {
	title = ev7.12.title
	desc = ev7.15.desc
	theme = realm
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	#right_portrait = {
	#	character = scope:recipient
	#	animation = fear
	#}
	right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		has_trait = source
	}

	option = {
		name = ev7.15.0.b
		trigger = {
			has_trait = bossy
		}
		trait = bossy
		spend_standard_ps_effect = yes
		hidden_effect = {
			if = {
				limit = {
					has_hook = scope:recipient
				}
				remove_hook = {
					target = scope:recipient
				}
			}
			scope:recipient = {
				if = {
					limit = {
						has_hook = scope:actor
					}
					remove_hook = {
						target = scope:actor
					}
				}
			}
		}
		add_hook = {
				type = magic_domination_hook
				target = scope:recipient
		}
		scope:recipient = {
			hidden_effect = {
				scope:recipient = {
					every_relation = {
						type = mmaster
						remove_relation_mminion = scope:recipient
					}
				}
			}
			set_relation_mminion = scope:recipient
		}
	}
	option = {
		name = ev7.15.0.c
		trigger = {
			has_trait = charming
		}
		trait = charming
		spend_standard_ps_effect = yes
		scope:recipient = {
			add_opinion = {
				target = ROOT
				modifier = bewitched_opinion
			}
		}
	}
	option = {
		name = ev7.15.0.d
		trigger = {
			has_trait = curious
		}
		trait = curious
		spend_standard_ps_effect = yes
		if = {
			limit = {
				scope:recipient = {
					any_secret = {
						NOT = { is_known_by = root }
					}
				}
			}
			scope:recipient = {
				random_secret = {
					limit = {
						NOT = { is_known_by = root }
					}
					reveal_to = root
				}
			}
		}
		else = {
			scope:recipient = {
				add_stress = major_stress_gain
				add_character_modifier = {
					modifier = confused_modifier
					years = 1
				}
			}
			random = {
				chance = 25
				add_intrigue_skill = 1
			}
		}
	}
	option = {
		name = ev7.15.0.e
		trigger = {
			has_trait = pensive
		}
		trait = pensive
		spend_standard_ps_effect = yes
		scope:recipient = {
			add_stress = major_stress_gain
			random = {
				chance = 10
				add_trait = incapable
			}
		}
	}
	option = {
		name = ev7.15.0.f
		trigger = {
			has_trait = rowdy
		}
		trait = rowdy
		spend_standard_ps_effect = yes
		scope:recipient = {
			add_character_modifier = {
				modifier = terrible_stench
				years = 2
			}
		}
	}
	option = {
		name = ev7.15.0.g
		trigger = {
			age > 15
			NOT = {
				is_the_choosen_one_trigger = yes
			}
		}
		spend_standard_ps_effect = yes
		scope:recipient = {
			if = {
				limit = {
					NOR = {
						has_trait = wounded_1
						has_trait = wounded_2
						has_trait = wounded_3
					}
				}
				add_trait = wounded_2
			}
			else_if = {
				limit = {
					NOR = {
						has_trait = giant
						has_trait = dwarf
					}
				}
				add_trait = dwarf
			}
			else_if = {
				limit = {
					NOT = {
						has_trait = albino
					}
				}
				add_trait = albino
			}
			else = {
				add_diplomacy_skill = -1
				add_martial_skill = -1
				add_stewardship_skill = -1
				add_intrigue_skill = -1
				add_learning_skill = -1
			}
		}
	}
	option = {
		name = ev7.15.0.g
		trigger = {
			is_the_choosen_one_trigger = yes
		}
		spend_standard_ps_effect = yes
		scope:recipient = {
			if = {
				limit = {
					NOR = {
						has_trait = wounded_1
						has_trait = wounded_2
						has_trait = wounded_3
					}
				}
				add_trait = wounded_3
			}
			else_if = {
				limit = {
					NOR = {
						has_trait = giant
						has_trait = dwarf
					}
				}
				add_trait = dwarf
			}
			else_if = {
				limit = {
					NOT = {
						has_trait = albino
					}
				}
				add_trait = albino
			}
			else = {
				add_diplomacy_skill = -3
			}
		}
	}
	option = {
		name = ev7.15.0.a
	}
}

#raw magic - outcome 5. - dangerous
magic_ev7.16 = {
	title = ev7.12.title
	desc = ev7.16.desc
	theme = realm
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:recipient
		animation = fear
	}
	lower_left_portrait = scope:resper

	trigger = {
		is_alive = yes
		has_unstable_source_trigger = yes
	}
	immediate = {
		#spend_standard_ps_effect = yes
		select_responsible_person_effect = yes
	}

	option = {
		name = ev7.16.0.a
		random_list = {
			1 = {
				spend_standard_ps_effect = yes
			}
			1 = {
				death = natural
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev7.16.0.b
		random_list = {
			1 = {
				spend_standard_ps_effect = yes
				scope:recipient = {
					death = natural
				}
				add_diplomacy_skill = 1
				add_martial_skill = 1
				add_stewardship_skill = 1
				add_intrigue_skill = 1
				add_learning_skill = 1
			}
			2 = {
				death = natural
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev7.7.0.a
		add_stress = medium_stress_gain
		custom_tooltip = ev7.7.0.a_ct
		hidden_effect = {
			save_scope_as = mchild
			scope:resper = {
				trigger_event = magic_ev7.8
			}
		}
		ai_chance = {
			base = 100
		}
	}
}

#corruption - succeeded - liege
magic_ev7.17 = {
	title = corruption
	desc = ev7.17.desc
	theme = secret
	#theme = witchcraft
	override_background = {
		reference = study
	}
	left_portrait = {
		character = scope:owner
		animation = spymaster
	}
	right_portrait = scope:target
	trigger = {
		is_alive = yes
	}
	immediate = {
		scope:target = {
			add_corrupt_trait = yes
		}
	}
	option = {
		name = ev7.17.0.a
		trigger = {
			custom_description = {
				text = magic_protection_custom
				scope:target = {
					has_full_magic_prot_trigger = no
					OR = {
						has_basic_magic_prot_trigger2 = no
						AND = {
							has_basic_magic_prot_trigger2 = yes
							root = {	can_penetrate_basic_magic_prot_trigger = yes	}
						}
					}
				}
			}
		}
		show_as_unavailable = {
			always = yes
		}
		scope:target = {
			add_trait = incapable
			if = {
				limit = {
					exists = diarch
					diarch = scope:owner
				}
				scope:owner = {
					update_diarchy_swing_with_perspective_effect = {
						SWING = major_sop_swing_diarch_gain
						LIEGE = scope:target
					}
				}
			}
			else = {
				set_diarch = scope:owner
				scope:owner = {
					update_diarchy_swing_with_perspective_effect = {
						SWING = major_sop_swing_diarch_gain
						LIEGE = scope:target
					}
				}
			}
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev7.17.0.b
		trigger = {
			OR = {
				has_perk = mind_control_p6_perk
				has_trait = demon
			}
			custom_description = {
				text = magic_protection_custom
				scope:target = {
					has_full_magic_prot_trigger = no
					OR = {
						has_basic_magic_prot_trigger2 = no
						AND = {
							has_basic_magic_prot_trigger2 = yes
							root = {	can_penetrate_basic_magic_prot_trigger = yes	}
						}
					}
				}
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
		}
		show_as_unavailable = {
			OR = {
				has_perk = mind_control_p6_perk
				has_trait = demon
			}
		}
		spend_standard_ps_effect = yes
		hidden_effect = {
			scope:owner = {
				if = {
					limit = {
						has_hook = scope:target
					}
					remove_hook = {
						target = scope:target
					}
				}
			}
			scope:target = {
				every_relation = {
					type = mmaster
					remove_relation_mminion = scope:target
				}
			}
		}
		set_relation_mminion = scope:target
		scope:target = {
			add_corrupt_trait = yes
			custom_tooltip = ev7.17.0.b_ct
		}
		add_hook = {
			type = magic_domination_hook
			target = scope:target
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.17.0.c
		scope:target = {
			every_vassal = {
				limit = {
					NOT = {
						this = scope:owner
					}
				}
				add_opinion = {
					modifier = disrespect_opinion
					target = scope:target
					opinion = -200
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.17.0.d
		scope:target = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 50
			}
		}
		if = {
			limit = {
				NOT = {
					has_hook = scope:target
				}
			}
			add_hook = {
				target = scope:target
				type = manipulation_hook
			}
		}
		ai_chance = {
			base = 10
		}
	}
	after = {
		scope:scheme = {
			end_scheme = yes
		}
	}
}

#corruption - succeeded - submision
magic_ev7.18 = {
	title = corruption
	desc = ev7.17.desc
	#theme = secret
	theme = witchcraft
	override_background = {
		reference = study
	}
	left_portrait = {
		character = scope:owner
		animation = spymaster
	}
	right_portrait = scope:target
	trigger = {
		is_alive = yes
	}

	option = {
		name = ev7.18.0.a
		trigger = {
			scope:target = {
				is_independent_ruler = yes
			}
		}
		show_as_unavailable = {
			always = yes
		}
		create_title_and_vassal_change = {
			type = granted
			save_scope_as = change
			add_claim_on_loss = yes
		}

		scope:target = {
			add_corrupt_trait = yes
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 50
			}
			change_liege = {
				liege = scope:owner
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change
		ai_chance = {
			base = 1000
		}
	}
	option = {
		name = ev7.17.0.b
		trigger = {
			OR = {
				has_perk = mind_control_p6_perk
				has_trait = demon
			}
			custom_description = {
				text = magic_protection_custom
				scope:target = {
					has_full_magic_prot_trigger = no
					OR = {
						has_basic_magic_prot_trigger2 = no
						AND = {
							has_basic_magic_prot_trigger2 = yes
							root = {	can_penetrate_basic_magic_prot_trigger = yes	}
						}
					}
				}
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
		}
		show_as_unavailable = {
			OR = {
				has_perk = mind_control_p6_perk
				has_trait = demon
			}
		}
		spend_standard_ps_effect = yes
		hidden_effect = {
			scope:owner = {
				if = {
					limit = {
						has_hook = scope:target
					}
					remove_hook = {
						target = scope:target
					}
				}
			}
			scope:target = {
				every_relation = {
					type = mmaster
					remove_relation_mminion = scope:target
				}
			}
		}
		scope:target = {
			add_corrupt_trait = yes
		}
		set_relation_mminion = scope:target
		scope:target = {
			custom_tooltip = ev7.17.0.b_ct
		}
		add_hook = {
			type = magic_domination_hook
			target = scope:target
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.18.0.b
		scope:target = {
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 50
			}
		}
		add_prestige = medium_prestige_gain
		ai_chance = {
			base = 10
		}
	}
	after = {
		scope:scheme = {
			end_scheme = yes
		}
	}
}

#corruption - succeeded - others
magic_ev7.19 = {
	title = corruption
	desc = ev7.17.desc
	#theme = secret
	theme = witchcraft
	override_background = {
		reference = study
	}
	left_portrait = {
		character = scope:owner
		animation = spymaster
	}
	right_portrait = scope:target
	trigger = {
		is_alive = yes
	}

	option = {
		name = ev7.19.0.a
		trigger = {
			scope:target = {
				is_ruler = no
			}
		}
		scope:target = {
			add_corrupt_trait = yes
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 50
			}
			add_intrigue_skill = 1
			add_prowess_skill = 1
		}
		if = {
			limit = {
				NOT = {
					any_courtier = {
						THIS = scope:target
					}
				}
			}
			hidden_effect = {
				scope:target = {
					move_to_pool = yes
				}
			}
			add_courtier = scope:target
		}
		if = {
			limit = {
				NOT = {
					has_hook = scope:target
				}
				
			}
			add_hook = {
				type = loyalty_hook
				target = scope:target
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.17.0.b
		trigger = {
			OR = {
				has_perk = mind_control_p6_perk
				has_trait = demon
			}
			custom_description = {
				text = magic_protection_custom
				scope:target = {
					has_full_magic_prot_trigger = no
					OR = {
						has_basic_magic_prot_trigger2 = no
						AND = {
							has_basic_magic_prot_trigger2 = yes
							root = {	can_penetrate_basic_magic_prot_trigger = yes	}
						}
					}
				}
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
		}
		show_as_unavailable = {
			OR = {
				has_perk = mind_control_p6_perk
				has_trait = demon
			}
		}
		spend_standard_ps_effect = yes
		hidden_effect = {
			scope:owner = {
				if = {
					limit = {
						has_hook = scope:target
					}
					remove_hook = {
						target = scope:target
					}
				}
			}
			scope:target = {
				every_relation = {
					type = mmaster
					remove_relation_mminion = scope:target
				}
			}
		}
		set_relation_mminion = scope:target
		scope:target = {
			add_corrupt_trait = yes
			custom_tooltip = ev7.17.0.b_ct
		}
		add_hook = {
			type = magic_domination_hook
			target = scope:target
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.19.0.b
		scope:target = {
			add_corrupt_trait = yes
			add_learning_skill = 1
			add_intrigue_skill = 1
			if = {
				limit = {
					NOR = {
						has_trait = witch
						any_secret = { secret_type = secret_witch }
					}
				}
				#if = {
				#	limit = {
				#		has_trait = supernatural_hunter
				#	}
				#	remove_trait = supernatural_hunter
				#}
					
				if = {
					limit = {
						trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = scope:target.faith GENDER_CHARACTER = scope:target }
					}
					add_secret = {
						type = secret_witch
					}
					random_secret = {
						limit = { secret_type = secret_witch }
						reveal_to = root
					}
				}
				else = {
					add_trait = witch
				}
			}
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 100
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.19.0.c
		add_prestige = medium_prestige_gain
		scope:target = {
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 100
			}
		}
		if = {
			limit = {
				NOT = {
					has_hook = scope:target
				}
			}
			add_hook = {
				target = scope:target
				type = manipulation_hook
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.19.0.d
		trigger = {
			has_trait = lustful
		}
		trait = lustful
		add_stress = major_stress_loss
		had_sex_with_effect = {
			CHARACTER = scope:target
			PREGNANCY_CHANCE = seduce_pregnancy_chance
		}
		scope:target = {
			add_corrupt_trait = yes
			if = {
				limit = {
					OR = {
						has_trait = lustful
						has_trait = rakish
					}
				}
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 80
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.19.0.e
		trigger = {
			scope:target = {
				exists = liege
				NOT = {	liege = ROOT	}
				NOT = {	liege = scope:target	}
				can_start_scheme = {
					type = murder
					target_character = liege
				}
			}
		}
		scope:target = {
			add_corrupt_trait = yes
			start_scheme = {
				type = murder
				target_character = liege
			}
		}
		ai_chance = {
			base = 10
		}
	}
	after = {
		scope:scheme = {
			end_scheme = yes
		}
	}
}
#corruption - failed
magic_ev7.20 = {
	title = corruption
	desc = ev7.20.desc
	#theme = secret
	theme = witchcraft
	override_background = {
		reference = study
	}
	left_portrait = {
		character = scope:owner
		animation = disapproval
	}
	right_portrait = scope:target
	trigger = {
		is_alive = yes
	}

	option = {
		name = tour_grounds_events.3017.a	#A pity.
		add_stress = minor_stress_gain
	}
	after = {
		scope:scheme = {
			end_scheme = yes
		}
	}
}

magic_ev7.21 = {
	type = character_event
	title = corruption
	desc = ev7.21.desc
	theme = intrigue
	left_portrait = {
		character = scope:owner
		animation = scheme
	}
	right_portrait = scope:target

	option = {
		name = ev7.21.0.a
		trigger_event = {
			id = magic_ev7.22
			days = { 20 30 }
		}
	}
}
magic_ev7.22 = {
	type = character_event
	title = corruption
	desc = ev7.22.desc
	theme = intrigue
	left_portrait = {
		character = scope:owner
		animation = spymaster
	}
	right_portrait = scope:target

	option = {
		name = ev7.22.0.a	#power
		hidden_effect = {
			if = {
				limit = {
					scope:target = {
						OR = {
							has_trait = ambitious
							has_trait = greedy
							has_trait = overseer
							has_trait = deceitful
							has_trait = arrogant
							has_trait = paranoid
							has_trait = august
							has_trait = schemer
							has_trait = peasant_leader
							has_focus = witch_focus
							has_focus = arcane_focus
						}
					}
				}
				random_list = {
					9 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_good_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
					1 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_bad_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
				}
			}
			else = {
				random_list = {
					1 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_good_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
					9 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_bad_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
				}
			}
		}
	}
	option = {
		name = ev7.22.0.b	#lust
		hidden_effect = {
			if = {
				limit = {
					scope:target = {
						OR = {
							has_trait = lustful
							has_trait = lunatic_genetic
							has_trait = lunatic_1
							has_trait = rakish
							has_trait = sadistic
							has_trait = drunkard
							has_trait = hashishiyah
							has_trait = wrathful
							has_trait = irritable
							has_trait = flagellant
							has_trait = cannibal
							has_trait = deviant
							has_trait = incestuous
							has_trait = gluttonous
							has_trait = vengeful
							any_secret = {
								secret_type = secret_cannibal
							}
							any_secret = {
								secret_type = secret_deviant
							}
							any_secret = {
								secret_type = secret_incest
							}
						}
					}
				}
				random_list = {
					9 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_good_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
					1 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_bad_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
				}
			}
			else = {
				random_list = {
					1 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_good_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
					9 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_bad_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
				}
			}
		}
	}
	option = {
		name = ev7.22.0.c	#gold
		hidden_effect = {
			if = {
				limit = {
					scope:target = {
						OR = {
							has_trait = greedy
							has_trait = profligate
							has_trait = avaricious
							has_trait = improvident
							any_secret = {
								secret_type = secret_embezzler
							}
							stewardship > 20
						}
					}
				}
				random_list = {
					99 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_good_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
					1 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_bad_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:target = {
						OR = {
							has_trait = generous
						}
					}
				}
				send_interface_toast = {
					title=corruption
					scope:scheme = {
						add_scheme_modifier = {
							type = corruption_scheme_bad_bait_modifier
						}
					}
					left_icon = root
					right_icon = scope:target
				}
			}
			else = {
				random_list = {
					2 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_good_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
					8 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_bad_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
				}
			}
		}
	}
	option = {
		name = ev7.22.0.d	#proud and noble
		hidden_effect = {
			if = {
				limit = {
					scope:target = {
						OR = {
							has_trait = compassionate
							has_trait = just
							has_trait = forgiving
							has_trait = arrogant
							has_trait = chaste
							has_trait = generous
							has_trait = gregarious
							has_trait = forgiving
							has_trait = humble
							has_trait = zealous
							has_trait = temperate
							has_trait = pilgrim
							has_trait = gallant
							has_trait = crusader_king
							has_trait = brave
						}
					}
				}
				random_list = {
					9 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_good_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
					1 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_bad_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
				}
			}
			else = {
				random_list = {
					1 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_good_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
					9 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_bad_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
				}
			}
		}
	}
	option = {
		name = ev7.22.0.e	#magic
		hidden_effect = {
			if = {
				limit = {
					scope:target = {
						OR = {
							has_trait = lifestyle_mystic
							has_trait = lifestyle_mystic
							has_trait = lifestyle_physician
							has_trait = grandmaster_coven
							has_trait = scholar
							has_trait = witch
							has_trait = true_witch
							has_focus = witch_focus
							has_focus = arcane_focus
							any_secret = {
								secret_type = secret_witch
							}
							has_trait = ambitious
							has_trait = greedy
							any_character_artifact = {
								has_variable = magic1
							}
						}
					}
				}
				random_list = {
					9 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_good_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
					1 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_bad_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
				}
			}
			else = {
				random_list = {
					1 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_good_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
					9 = {
						send_interface_toast = {
							title=corruption
							scope:scheme = {
								add_scheme_modifier = {
									type = corruption_scheme_bad_bait_modifier
								}
							}
							left_icon = root
							right_icon = scope:target
						}
					}
				}
			}
		}
	}
	after = {
		scope:target = {
			trigger_event = magic_ev7.23
		}
	}
}
magic_ev7.23 = {
	type = character_event
	title = ev7.23.title
	desc = ev7.23.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ev7.23.0.a
	}
}

#Corruption ongoing 1.
magic_ev7.24 = {
	type = character_event
	title = corruption
	desc = ev7.24.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = scope:owner
		animation = personality_greedy
	}
	right_portrait = scope:target

	trigger = {
		exists = scope:scheme
		scope:scheme = {
			NOT = {
				is_scheme_exposed = yes
			}
		}
	}
	immediate = {
		random_known_secret = {
			limit = {
				NOT = { secret_owner = root }
			}
			save_scope_as = secret0
		}
	}

	option = {
		name = ev7.24.0.a
		trigger = {
			exists = scope:secret0
		}
		show_as_tooltip = {
			scope:secret0 = {
				reveal_to = scope:target
			}
		}
		scope:scheme = {
			add_scheme_progress = 2
		}
		scope:target = {
			trigger_event = magic_ev7.25
		}
	}
	option = {
		name = ev7.24.0.b
		duel = {
			skill = intrigue
			value = scope:target.intrigue
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					scope:scheme = {
						add_scheme_progress = 2
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					scope:scheme = {
						add_scheme_progress = -1
					}
				}
			}
		}
	}
	option = {
		name = ev7.24.0.c
		show_as_tooltip = {
			pay_short_term_gold = {
				target = scope:target
				gold = medium_gold_min_value
			}
		}
		hidden_effect = {
			remove_short_term_gold = {
				add = medium_gold_min_value
			}
		}
		scope:scheme = {
			add_scheme_progress = 2
		}
		scope:target = {
			trigger_event = magic_ev7.26
		}
	}
	option = {
		name = ev7.24.0.d
	}
}
#reaction
magic_ev7.25 = {
	type = character_event
	title = ev7.23.title
	desc = ev7.25.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ev2.64.a	#Interesting.
		scope:secret0 = {
			reveal_to = scope:target
		}
	}
}
#reaction
magic_ev7.26 = {
	type = character_event
	title = ev7.23.title
	desc = ev7.26.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ev2.64.a	#Interesting.
		add_gold = scope:owner.medium_gold_min_value
	}
}
#Corruption ongoing 2.
magic_ev7.27 = {
	type = character_event
	title = corruption
	desc = ev7.27.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = scope:owner
		animation = spymaster
	}
	right_portrait = scope:target

	trigger = {
		exists = scope:scheme
		scope:scheme = {
			NOR = {
				is_scheme_exposed = yes
				has_scheme_modifier = lifestyle_studied_habits_modifier
			}
		}
	}

	option = {
		name = ev7.27.0.a
		duel = {
			skill = intrigue
			value = 15
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					scope:scheme = {
						add_scheme_modifier = {
							type = lifestyle_studied_habits_modifier
						}
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					
				}
			}
		}
	}
	option = {
		name = ev7.27.0.b
		duel = {
			skill = diplomacy
			value = 20
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					scope:scheme = {
						add_scheme_modifier = {
							type = lifestyle_studied_habits_modifier
						}
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					
				}
			}
		}
	}
	option = {
		name = ev7.27.0.c
		trigger = {
			has_usable_hook = scope:target
		}
		scope:scheme = {
			add_scheme_modifier = {
				type = lifestyle_studied_habits_modifier
			}
		}
		use_hook = scope:target
	}
	option = {
		name = ev7.27.0.d
		trigger = {
			has_trait = grandmaster_coven
		}
		trait = grandmaster_coven
		scope:scheme = {
			add_scheme_modifier = {
				type = lifestyle_studied_habits_modifier
			}
		}
	}
	option = {
		name = ev7.27.0.e
		
	}
}
#Corruption ongoing 3.
magic_ev7.28 = {
	type = character_event
	title = corruption
	desc = ev7.28.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = scope:owner
		animation = spymaster
	}
	right_portrait = scope:target

	trigger = {
		exists = scope:scheme
		scope:scheme = {
			NOR = {
				is_scheme_exposed = yes
				has_scheme_modifier = magical_suggestion_modifier
				has_scheme_modifier = murder_trusted_advice_modifier
				has_scheme_modifier = limited_risk_modifier
			}
		}
	}

	option = {
		name = ev7.28.0.a
		trigger = {
			can_spend_standard_ps_trigger = yes
		}
		spend_standard_ps_effect = yes
		scope:scheme = {
			add_scheme_modifier = {
				type = magical_suggestion_modifier
			}
		}
	}
	option = {
		name = ev7.28.0.b
		trigger = {
			NOT = {
				has_trait = demon
			}
		}
		if = {
			limit = {
				OR = {
					has_trait = paranoid
					has_trait = trusting
					has_trait = shy
					has_trait = gregarious
				}
			}
			stress_impact = {
				paranoid = major_stress_gain
				trusting = minor_stress_loss
				shy = medium_stress_gain
				gregarious = medium_stress_loss
			}
		}
		else = {
			add_stress = minor_stress_gain
		}
		
		scope:scheme = {
			add_scheme_modifier = {
				#type = murder_trusted_by_target_modifier
				type = murder_trusted_advice_modifier
			}
		}
		scope:target = {
			send_interface_toast = {
				title=ev7.23.title
				add_intrigue_skill = 2
				left_icon = scope:target
			}
		}
	}
	option = {
		name = ev7.28.0.d
		trigger = {
			has_trait = demon
		}
		trait = demon
		scope:scheme = {
			add_scheme_modifier = {
				type = magical_suggestion_modifier
			}
		}
		scope:target = {
			send_interface_toast = {
				title=ev7.23.title
				add_character_modifier = {
					modifier = gift_from_hell_modifier
				}
				left_icon = scope:target
			}
		}
	}
	option = {
		name = ev7.28.0.c
		scope:scheme = {
			add_scheme_modifier = {
				type = limited_risk_modifier
			}
		}
	}
}
#Corruption ongoing 4.
magic_ev7.29 = {
	type = character_event
	title = corruption
	desc = ev7.29.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = scope:owner
		animation = spymaster
	}
	right_portrait = scope:target

	trigger = {
		exists = scope:scheme
		scope:scheme = {
			NOT = {
				is_scheme_exposed = yes
			}
		}
		scope:target = {
			NOT = {
				has_character_flag = change_personality_corruption_flag
			}
		}
	}

	option = {
		name = epidemic_events.1110.a	#Very well.
		custom_tooltip = ev7.29.0.a_ct
		scope:target = {
			trigger_event = magic_ev7.30
		}
	}
}

#Corruption ongoing 4. - reaction
magic_ev7.30 = {
	type = character_event
	title = ev7.30.title
	desc = ev7.30.desc
	theme = intrigue
	left_portrait = root

	trigger = {
		exists = scope:scheme
		scope:scheme = {
			NOT = {
				is_scheme_exposed = yes
			}
		}
	}

	option = {
		name = ev7.30.0.a
		add_stress = major_stress_gain
	}
	option = {
		name = ev7.30.0.b
		trigger = {
			OR = {
				has_trait = just
				has_trait = generous
				has_trait = brave
				has_trait = trusting
				has_trait = compassionate
				has_trait = temperate
				has_trait = chaste
				has_trait = honest
				has_trait = forgiving
			}
		}
		if = {
			limit = {
				has_trait = trusting
			}
			remove_trait = trusting
			add_trait = paranoid
		}
		else_if = {
			limit = {
				has_trait = generous
			}
			remove_trait = generous
			add_trait = greedy
		}
		else_if = {
			limit = {
				has_trait = compassionate
			}
			remove_trait = compassionate
			add_trait = sadistic
		}
		else_if = {
			limit = {
				has_trait = just
			}
			remove_trait = just
			add_trait = arbitrary
		}
		else_if = {
			limit = {
				has_trait = temperate
			}
			remove_trait = temperate
			add_trait = gluttonous
		}
		else_if = {
			limit = {
				has_trait = chaste
			}
			remove_trait = chaste
			add_trait = lustful
		}
		else_if = {
			limit = {
				has_trait = honest
			}
			remove_trait = honest
			add_trait = deceitful
		}
		else_if = {
			limit = {
				has_trait = forgiving
			}
			remove_trait = forgiving
			add_trait = vengeful
		}
		else_if = {
			limit = {
				has_trait = brave
			}
			remove_trait = brave
			add_trait = craven
		}
	}
	option = {
		name = ev7.30.0.c
		trigger = {
			has_trait = callous
		}
		trait = callous
	}
	after = {
		hidden_effect = {
			add_character_flag = {
				flag = change_personality_corruption_flag
				years = 10
			}
		}
	}
}

#Dark Champion Operation (DCO) - begins - dark champion perspective
magic_ev7.31 = {
	type = character_event
	title = special_champion_mission
	desc = {
		desc = ev7.31.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = special_champion_mission1
				}
				desc = ev7.31.desc1
			}
			triggered_desc = {
				trigger = {
					has_character_flag = special_champion_mission2
				}
				desc = ev7.31.desc2
			}
			triggered_desc = {
				trigger = {
					has_character_flag = special_champion_mission3
				}
				desc = ev7.31.desc3
			}
			desc = ev7.31.desc4
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					OR = {
						has_character_flag = special_champion_mission1
						has_character_flag = special_champion_mission3
						has_character_flag = special_champion_mission4
					}
					
				}
				desc = ev7.31.descX
			}
			desc = hunt_attendants_roco_tt_NO_ROCO_DLC	# ""
		}
	}
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	right_portrait = scope:actor
	lower_right_portrait = scope:recipient
	trigger = {
		is_alive = yes
	}

	option = {
		#name = ev4.37.0.a	# "I will try to make a duel."
		name = ev7.31.0.a
		trigger_event = {
			id = magic_ev7.32
			days = { 5 10 }
		}
	}
}

#DCO2. - the plan - dark champion perspective
magic_ev7.32 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.32.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	#right_portrait = scope:dchampion
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_character_flag = ready_for_special_mission
		exists = liege
		liege = scope:actor 
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:recipient = {
			is_alive = yes
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			scope:actor = {
				trigger_event = magic_ev7.34
			}
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			scope:actor = {
				trigger_event = magic_ev7.35
			}
		}
		else = {
			clear_dc_mission_flags = yes
			scope:actor = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = special_mission_dco_ends_ct
					left_icon = scope:dchampion
					right_icon = scope:recipient
				}
			}
		}
	}

	option = {
		name = ev7.32.0.a	#duel
		trigger = {
			has_character_flag = special_champion_mission1
			NOT = {
				has_character_flag = dc_duel_refused_flag
			}
		}
		custom_tooltip = ev7.32.0.a_ct
		scope:recipient = {
			trigger_event = magic_ev7.40
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 10
				prowess > scope:recipient.prowess
			}
			modifier = {
				add = -10
				has_trait = craven
			}
			modifier = {
				add = 5
				has_trait = brave
			}
			modifier = {
				add = 5
				has_trait = lifestyle_blademaster
			}
			modifier = {
				add = -9
				prowess < scope:recipient.prowess
			}
		}
	}
	option = {
		name = ev7.32.0.b	#scheme
		trigger = {
			has_character_flag = special_champion_mission1
			can_start_scheme = {
				type = murder
				target_character = scope:recipient
			}
			NOT = {
				any_scheme = {
					hostile_scheme_trigger = yes
				}
			}
		}
		start_scheme = {
			type = murder
			target_character = scope:recipient
		}
		trigger_event = {
			id = magic_ev7.44
			months = { 5 6 }
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 10
				intrigue > scope:recipient.intrigue
			}
			modifier = {
				add = 10
				has_trait = schemer
			}
			modifier = {
				add = -9
				intrigue < scope:recipient.intrigue
			}
		}
	}
	option = {
		name = ev7.32.0.c	#direct attack
		trigger = {
			has_character_flag = special_champion_mission1
		}
		custom_tooltip = ev7.32.0.c_ct
		trigger_event = {
			id = magic_ev7.46
			months = { 1 2 }
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 5
				has_trait = strategist
			}
			modifier = {
				add = 5
				OR = {
					has_trait = education_martial_1
					has_trait = education_martial_2
					has_trait = education_martial_4
					has_trait = education_martial_3
					has_trait = education_martial_5
				}
			}
			modifier = {
				add = 10
				martial > scope:recipient.martial
			}
			modifier = {
				add = -9
				martial < scope:recipient.martial
			}
		}
	}
	option = {
		name = ev7.32.0.d	#lets ride
		trigger = {
			has_character_flag = special_champion_mission2
		}
		custom_tooltip = ev7.32.0.d_ct
		trigger_event = {
			id = magic_ev7.53
			months = { 1 2 }
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.32.0.e	#time to hunt
		trigger = {
			has_character_flag = special_champion_mission3
		}
		custom_tooltip = ev7.32.0.e_ct
		trigger_event = {
			id = magic_ev7.60
			months = { 2 5 }
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.32.0.f	#I need to prepare myself
		trigger = {
			has_character_flag = special_champion_mission4
		}
		custom_tooltip = ev7.32.0.f_ct
		trigger_event = {
			id = magic_ev7.60
			months = { 2 5 }
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.32.0.h	#I need gold
		trigger = {
			OR = {
				has_character_flag = special_champion_mission1
				has_character_flag = special_champion_mission2
				has_character_flag = special_champion_mission3
				has_character_flag = special_champion_mission4
			}
			NOT = {
				has_character_flag = asked_for_gold_dco
			}
		}
		custom_tooltip = ev7.32.0.h_ct
		stress_impact = {
			greedy = medium_stress_loss
			arrogant = minor_stress_gain
		}
		scope:actor = {
			trigger_event = magic_ev7.69
		}
		hidden_effect = {
			add_character_flag = asked_for_gold_dco
		}
		ai_chance = {
			base = 5
			modifier = {
				add = 5
				has_trait = craven
			}
			modifier = {
				add = 10
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev7.32.0.g	#I give up
		trigger = {
			OR = {
				has_character_flag = special_champion_mission1
				has_character_flag = special_champion_mission2
				has_character_flag = special_champion_mission3
				has_character_flag = special_champion_mission4
			}
			
		}
		custom_tooltip = special_mission_dco_ends_ct
		scope:actor = {
			trigger_event = magic_ev7.65
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 5
				has_trait = craven
			}
			modifier = {
				add = 2
				has_trait = content
			}
			modifier = {
				add = 5
				has_trait = lazy
			}
			modifier = {
				add = -5
				has_trait = ambitious
			}
			modifier = {
				add = -5
				has_trait = arrogant
			}
			modifier = {
				add = -5
				has_trait = diligent
			}
		}
	}
}

#DCO - ends, invalidate (DC died) - actor perspective
magic_ev7.33 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.33.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	right_portrait = scope:dchampion
	lower_right_portrait = {
		trigger = {
			exists = scope:recipient
		}
		character = scope:recipient
	}

	trigger = {
		is_alive = yes
	}

	option = {
		name = ev7.33.0.a
		custom_tooltip = special_mission_dco_ends_ct
		hidden_effect = {
			if = {
				limit = {
					exists = scope:recipient 
				}
				scope:recipient = {
					if = {
						limit = {
							has_character_flag = marked_for_assasination_dc_flag
						}
						remove_character_flag = marked_for_assasination_dc_flag
					}
				}
			}
		}
	}
}
#DCO - ends, invalidate (target died) - actor perspective
magic_ev7.34 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.34.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	right_portrait = scope:dchampion
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
	}

	option = {
		name = ev7.34.0.a
		custom_tooltip = special_mission_dco_ends_ct
		hidden_effect = {
			scope:dchampion = {
				clear_dc_mission_flags = yes
			}
		}
	}
}
#DCO - ends, invalidate (DC imprisoned) - actor perspective
magic_ev7.35 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.35.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	right_portrait = scope:dchampion
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
	}

	option = {
		name = ev7.35.0.a
		custom_tooltip = special_mission_dco_ends_ct
		hidden_effect = {
			scope:recipient = {
				if = {
					limit = {
						has_character_flag = marked_for_assasination_dc_flag
					}
					remove_character_flag = marked_for_assasination_dc_flag
				}
			}
			scope:dchampion = {
				clear_dc_mission_flags = yes
			}
		}
	}
}
#DCO - ends, target died
magic_ev7.36 = {
	hidden = yes
	trigger = {
		has_character_flag = marked_for_assasination_dc_flag
		exists = scope:killer
		scope:killer = {
			has_court_position = dark_champion_court_position
			has_character_flag = special_champion_mission1
			exists = liege
		}
	}
	immediate = {
		save_scope_as = recipient
		scope:killer = {
			save_scope_as = dchampion
			liege = {
				trigger_event = magic_ev7.37
			}
		}
	}
}
#DCO - ends, killed by DC - actor perspective
magic_ev7.37 = {
	type = character_event
	title = special_champion_mission_success
	desc = ev7.37.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	right_portrait = scope:dchampion
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
	}

	option = {
		name = EXCELLENT
		custom_tooltip = special_mission_dco_ends_ct2
		hidden_effect = {
			scope:dchampion = {
				trigger_event = magic_ev7.38
				clear_dc_mission_flags = yes
			}
		}
	}
}
#DCO - ends, congratulations to DC - DC perspective
magic_ev7.38 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.38.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	right_portrait = scope:liege0
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
	}
	immediate = {
		liege = {
			save_scope_as = liege0
		}
	}

	option = {
		name = ev7.38.0.a
		custom_tooltip = special_mission_dco_ends_ct
		hidden_effect = {
			scope:dchampion = {
				clear_dc_mission_flags = yes
			}
		}
	}
}
#DCO - ends, DC died - from on_action
magic_ev7.39 = {
	hidden = yes
	trigger = {
		has_court_position = dark_champion_court_position
		OR = {
			has_character_flag = special_champion_mission1
			has_character_flag = special_champion_mission2
			has_character_flag = special_champion_mission3
			has_character_flag = special_champion_mission4
		}
		exists = liege
	}
	immediate = {
		save_scope_as = dchampion
		liege = {
			trigger_event = magic_ev7.33
		}
	}
}

#DCO - duel consideration - target perspective
magic_ev7.40 = {
	type = character_event
	title = character_duel
	desc = ev7.40.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:dchampion

	trigger = {
		is_alive = yes
	}

	option = {
		name = ev7.40.0.a
		custom_tooltip = start_duel_ct
		hidden_effect = {
			configure_start_single_combat_effect = {
				SC_INITIATOR = scope:dchampion
				SC_ATTACKER = scope:dchampion
				SC_DEFENDER = root
				FATALITY = always
				FIXED = no
				LOCALE = throne_room
				OUTPUT_EVENT = fp1_tbc.0011
				INVALIDATION_EVENT = fp1_tbc.0021
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 20
				prowess > scope:dchampion.prowess
			}
			modifier = {
				add = 5
				has_trait = brave
			}
			modifier = {
				add = 5
				has_trait = arrogant
			}
		}
	}
	option = {
		name = ev7.40.0.b
		custom_tooltip = ev7.40.0.b_ct
		scope:dchampion = {
			trigger_event = {
				id = magic_ev7.41
				days = 3
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 20
				prowess < scope:dchampion.prowess
			}
			modifier = {
				add = 5
				has_trait = craven
			}
			modifier = {
				add = 5
				has_trait = paranoid
			}
			modifier = {
				add = 5
				has_trait = calm
			}
			modifier = {
				add = 5
				has_trait = compassionate
			}
		}
	}
}
#DCO - duel rejected - DC perspective
magic_ev7.41 = {
	type = character_event
	title = character_duel
	desc = ev7.41.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	lower_right_portrait = scope:recipient
	lower_left_portrait = scope:actor

	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_character_flag = ready_for_special_mission
		exists = liege
		liege = scope:actor 
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:recipient = {
			is_alive = yes
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			scope:actor = {
				trigger_event = magic_ev7.34
			}
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			scope:actor = {
				trigger_event = magic_ev7.35
			}
		}
		else = {
			clear_dc_mission_flags = yes
			scope:actor = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = special_mission_dco_ends_ct
					left_icon = scope:dchampion
					right_icon = scope:recipient
				}
			}
		}
	}
	immediate = {
		hidden_effect = {
			add_character_flag = dc_duel_refused_flag
		}
	}

	option = {
		name = ev7.41.0.a
		trigger_event = {
			id = magic_ev7.42
			days = 2
		}
	}
	option = {
		name = ev7.41.0.b
		add_stress = minor_stress_gain
		trigger_event = {
			id = magic_ev7.32
			days = 10
		}
	}
}
#DCO - duel rejected - actor perspective
magic_ev7.42 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.42.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	right_portrait = scope:dchampion
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
	}
	immediate = {
		stress_impact = {
			impatient = minor_stress_gain
		}
	}

	option = {
		name = ev7.42.0.a
		scope:dchampion = {
			trigger_event = {
				id = magic_ev7.32
				days = 5
			}
		}
	}
	option = {
		name = ev7.42.0.b
		scope:dchampion = {
			trigger_event = {
				id = magic_ev7.32
				days = 5
			}
		}
	}
	option = {
		name = ev7.42.0.c
		scope:dchampion = {
			trigger_event = {
				id = magic_ev7.32
				days = 5
			}
		}
	}
	option = {
		name = ev7.42.0.d
		custom_tooltip = special_mission_dco_ends_ct
		scope:dchampion = {
			trigger_event = {
				id = magic_ev7.43
				days = 1
			}
		}
	}
}
#DCO - mission aborted - DC perspective
magic_ev7.43 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.43.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	right_portrait = scope:actor
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
	}

	option = {
		name = ev7.31.0.a
		custom_tooltip = special_mission_dco_ends_ct
	}
	after = {
		hidden_effect = {
			scope:recipient = {
				if = {
					limit = {
						has_character_flag = marked_for_assasination_dc_flag
					}
					remove_character_flag = marked_for_assasination_dc_flag
				}
			}
			clear_dc_mission_flags = yes
		}
	}
}

#DCO - scheme murder validation
magic_ev7.44 = {
	hidden = yes
	trigger = {
		is_alive = yes
		has_character_flag = ready_for_special_mission
		has_court_position = dark_champion_court_position
		OR = {
			has_character_flag = special_champion_mission1
			has_character_flag = special_champion_mission2
			has_character_flag = special_champion_mission3
			has_character_flag = special_champion_mission4
		}
		exists = liege
		liege = scope:actor
	}
	immediate = {
		if = {
			limit = {
				any_scheme = {
					scheme_type = murder
					scheme_target_character = scope:recipient
				}
			}
			trigger_event = {
				id = magic_ev7.44
				months = 1
			}
		}
		else = {
			scope:actor = {
				trigger_event = magic_ev7.45
			}
		}
	}
}
#DCO - assasination failed - actor perspective
magic_ev7.45 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.45.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	right_portrait = scope:dchampion
	lower_right_portrait = {
		trigger = {
			exists = scope:recipient
			scope:recipient = {
				is_alive = yes
			}
		}
		character = scope:recipient
	}

	trigger = {
		is_alive = yes
	}
	immediate = {
		stress_impact = {
			impatient = medium_stress_gain
		}
	}

	option = {
		name = ev7.45.0.a
		scope:dchampion = {
			trigger_event = {
				id = magic_ev7.32
				days = 5
			}
		}
	}
	option = {
		name = ev7.45.0.b
		scope:dchampion = {
			trigger_event = {
				id = magic_ev7.32
				days = 5
			}
		}
	}
	option = {
		name = ev7.45.0.c
		stress_impact = {
			ambitious = minor_stress_gain
		}
		custom_tooltip = special_mission_dco_ends_ct
		scope:dchampion = {
			trigger_event = {
				id = magic_ev7.43
				days = 1
			}
		}
	}
	option = {
		name = ev7.45.0.d
		trigger = {
			has_trait = archmage
			can_spend_standard_ps_trigger = yes
			scope:dchampion = {
				has_full_magic_prot_trigger = no
			}
		}
		trait = archmage
		stress_impact = {
			vengeful = medium_stress_loss
			sadistic = medium_stress_loss
		}
		custom_tooltip = special_mission_dco_ends_ct
		custom_tooltip = ev7.45.0.d_ct
		spend_standard_ps_effect = yes
		scope:dchampion = {
			death = {
				death_reason = death_murder
				killer = root
			}
		}
		hidden_effect = {
			scope:recipient = {
				if = {
					limit = {
						has_character_flag = marked_for_assasination_dc_flag
					}
					remove_character_flag = marked_for_assasination_dc_flag
				}
			}
		}
	}
}
#DCO - night attack preparation - DC perspective
magic_ev7.46 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.46.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_character_flag = ready_for_special_mission
		exists = liege
		liege = scope:actor 
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:recipient = {
			is_alive = yes
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			scope:actor = {
				trigger_event = magic_ev7.34
			}
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			scope:actor = {
				trigger_event = magic_ev7.35
			}
		}
		else = {
			clear_dc_mission_flags = yes
			scope:actor = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = special_mission_dco_ends_ct
					left_icon = scope:dchampion
					right_icon = scope:recipient
				}
			}
		}
	}
	immediate = {
		hidden_effect = {
			set_variable = {
				name = night_attack_q
				value = 0
			}
			
		}
	}

	option = {
		name = ev7.46.0.a
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev7.46.0.b
		custom_tooltip = ev7.46.0.b_ct
		remove_short_term_gold = minor_gold_max_value_static
		hidden_effect = {
			change_variable = {
				name = night_attack_q
				add = 1
			}
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev7.46.0.d
		trigger = {
			has_trait = corrupted
		}
		trait = corrupted
		custom_tooltip = ev7.46.0.b_ct
		hidden_effect = {
			change_variable = {
				name = night_attack_q
				add = 1
			}
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev7.46.0.c
		custom_tooltip = ev7.46.0.c_ct
		remove_short_term_gold = major_gold_max_value_static
		hidden_effect = {
			change_variable = {
				name = night_attack_q
				add = 2
			}
		}
		ai_chance = {
			base = 1
		}
	}
	after = {
		trigger_event = {
			id = magic_ev7.47
			days = { 10 15 }
		}
	}
}
#DCO - night attack preparation 2. - DC perspective
magic_ev7.47 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.47.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_character_flag = ready_for_special_mission
		exists = liege
		liege = scope:actor 
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:recipient = {
			is_alive = yes
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			scope:actor = {
				trigger_event = magic_ev7.34
			}
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			scope:actor = {
				trigger_event = magic_ev7.35
			}
		}
		else = {
			clear_dc_mission_flags = yes
			scope:actor = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = special_mission_dco_ends_ct
					left_icon = scope:dchampion
					right_icon = scope:recipient
				}
			}
		}
	}

	option = {
		name = ev7.47.0.a
		duel = {
			skill = intrigue
			value = scope:recipient.intrigue
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					custom_tooltip = ev7.46.0.b_ct
				}
				hidden_effect = {
					change_variable = {
						name = night_attack_q
						add = 1
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev7.47.0.b
		trigger = {
			has_trait = schemer
		}
		trait = schemer
		custom_tooltip = ev7.46.0.b_ct
		hidden_effect = {
			change_variable = {
				name = night_attack_q
				add = 1
			}
		}
		ai_chance = {
			base = 1000
		}
	}
	option = {
		name = ev7.47.0.c
		remove_short_term_gold = medium_gold_max_value_static
		random_list = {
			9 = {
				send_interface_toast = {
					title=ev3.52.a_1
					custom_tooltip = ev7.46.0.b_ct
				}
				hidden_effect = {
					change_variable = {
						name = night_attack_q
						add = 1
					}
				}
			}
			1 = {
				send_interface_toast = {
					title=ev3.52.a_2
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = -1
				has_trait = greedy
			}
			modifier = {
				add = -1
				gold < medium_gold_max_value_static
			}
		}
	}
	option = {
		name = ev7.47.0.d
		ai_chance = {
			base = 1
		}
	}
	after = {
		trigger_event = {
			id = magic_ev7.48
			days = { 10 15 }
		}
	}
}
#DCO - night attack preparation 3. - DC perspective
magic_ev7.48 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.48.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_character_flag = ready_for_special_mission
		exists = liege
		liege = scope:actor 
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:recipient = {
			is_alive = yes
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			scope:actor = {
				trigger_event = magic_ev7.34
			}
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			scope:actor = {
				trigger_event = magic_ev7.35
			}
		}
		else = {
			clear_dc_mission_flags = yes
			scope:actor = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = special_mission_dco_ends_ct
					left_icon = scope:dchampion
					right_icon = scope:recipient
				}
			}
		}
	}

	
	option = {
		name = ev7.48.0.a
		duel = {
			skill = martial
			value = scope:recipient.martial
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					custom_tooltip = ev7.46.0.c_ct
				}
				hidden_effect = {
					change_variable = {
						name = night_attack_q
						add = 2
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.48.0.b
		trigger = {
			has_trait = strategist
		}
		trait = strategist
		custom_tooltip = ev7.46.0.b_ct
		hidden_effect = {
			change_variable = {
				name = night_attack_q
				add = 2
			}
		}
		ai_chance = {
			base = 1000
		}
	}
	option = {
		name = ev7.48.0.c
		trigger = {
			intrigue > 25
			var:night_attack_q > 0
		}
		skill = intrigue
		custom_tooltip = ev7.46.0.b_ct
		hidden_effect = {
			change_variable = {
				name = night_attack_q
				add = 1
			}
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev7.48.0.d
		duel = {
			skill = prowess
			value = 40
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					custom_tooltip = ev7.46.0.b_ct
				}
				hidden_effect = {
					change_variable = {
						name = night_attack_q
						add = 1
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					OR = {
						has_trait = lifestyle_blademaster
						has_trait = berserker
						has_trait = viking
						has_trait = gallant
						has_trait = shieldmaiden
						has_trait = varangian
						has_trait = warlike_court_1
						has_trait = warlike_court_2
					}
				}
				change_variable = {
					name = night_attack_q
					add = 1
				}
			}
			scope:recipient = {
				trigger_event = magic_ev7.49
			}
		}
	}
}

#DCO - night attack - target perspective
magic_ev7.49 = {
	type = character_event
	title = ev7.49.title
	desc = ev7.49.desc
	theme = realm
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:dchampion
		animation = aggressive_sword
	}

	trigger = {
		is_alive = yes
	}
	
	option = {
		name = ev7.49.0.a
		if = {
			limit = {
				scope:dchampion = {
					var:night_attack_q > 4
				}
			}
			duel = {
				skill = prowess
				value = scope:dchampion.prowess
				1 = {
					desc = ev3.52.a_1
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
						min = 0
					}
					send_interface_toast = {
						title=ev3.52.a_1
						custom_tooltip = ev2.48.a_ct1
					}
					hidden_effect = {
						scope:dchampion = {
							trigger_event = magic_ev7.50
						}
						trigger_event = magic_ev7.51
					}
				}
				9 = {
					desc = ev3.52.a_2
					compare_modifier = {
						value = scope:duel_value
						multiplier = -1
						min = 0
					}
					send_interface_toast = {
						title=ev3.52.a_2
						show_as_tooltip = {
							death = {
								death_reason = death_head_ripped_off
								killer = scope:dchampion
							}
						}
					}
					hidden_effect = {
						scope:dchampion = {
							trigger_event = magic_ev7.52
							remove_variable = night_attack_q
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:dchampion = {
					var:night_attack_q > 2
				}
			}
			duel = {
				skill = prowess
				value = scope:recipient.martial
				5 = {
					desc = ev3.52.a_1
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
						min = 0
					}
					send_interface_toast = {
						title=ev3.52.a_1
						custom_tooltip = ev2.48.a_ct1
					}
					hidden_effect = {
						scope:dchampion = {
							trigger_event = magic_ev7.50
						}
						trigger_event = magic_ev7.51
					}
				}
				5 = {
					desc = ev3.52.a_2
					compare_modifier = {
						value = scope:duel_value
						multiplier = -1
						min = 0
					}
					send_interface_toast = {
						title=ev3.52.a_2
						show_as_tooltip = {
							death = {
								death_reason = death_head_ripped_off
								killer = scope:dchampion
							}
						}
					}
					hidden_effect = {
						scope:dchampion = {
							trigger_event = magic_ev7.52
							remove_variable = night_attack_q
						}
					}
				}
			}
		}
		else = {
			duel = {
				skill = prowess
				value = scope:recipient.martial
				8 = {
					desc = ev3.52.a_1
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
						min = 0
					}
					send_interface_toast = {
						title=ev3.52.a_1
						custom_tooltip = ev2.48.a_ct1
					}
					hidden_effect = {
						scope:dchampion = {
							trigger_event = magic_ev7.50
						}
						trigger_event = magic_ev7.51
					}
				}
				2 = {
					desc = ev3.52.a_2
					compare_modifier = {
						value = scope:duel_value
						multiplier = -1
						min = 0
					}
					send_interface_toast = {
						title=ev3.52.a_2
						show_as_tooltip = {
							death = {
								death_reason = death_head_ripped_off
								killer = scope:dchampion
							}
						}
					}
					hidden_effect = {
						scope:dchampion = {
							trigger_event = magic_ev7.52
							remove_variable = night_attack_q
						}
					}
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.49.0.b
		trigger = {
			has_trait = demon
		}
		trait = demon
		if = {
			limit = {
				scope:dchampion = {
					OR = {
						has_trait = demon
						has_trait = archmage
					}
				}
			}
			custom_tooltip = start_duel_ct
			configure_start_mage_duel_effect = {
				MD_ATTACKER = root
				MD_DEFENDER = scope:dchampion
			}
			hidden_effect = {
				scope:dchampion = {
					remove_variable = night_attack_q
				}
			}
		}
		else = {
			custom_tooltip = ev2.48.a_ct1
			hidden_effect = {
				scope:dchampion = {
					trigger_event = magic_ev7.50
				}
				trigger_event = magic_ev7.51
			}
		}
		ai_chance = {
			base = 1000
		}
	}
	option = {
		name = ev7.49.0.c
		trigger = {
			has_trait = archmage
			can_spend_standard_ps_trigger = yes
		}
		trait = archmage
		if = {
			limit = {
				scope:dchampion = {
					OR = {
						has_trait = demon
						has_trait = archmage
					}
				}
			}
			custom_tooltip = start_duel_ct
			configure_start_mage_duel_effect = {
				MD_ATTACKER = root
				MD_DEFENDER = scope:dchampion
			}
			hidden_effect = {
				scope:dchampion = {
					remove_variable = night_attack_q
				}
			}
		}
		else = {
			spend_standard_ps_effect = yes
			custom_tooltip = ev2.48.a_ct1
			hidden_effect = {
				scope:dchampion = {
					trigger_event = magic_ev7.50
				}
				trigger_event = magic_ev7.51
			}
		}
		ai_chance = {
			base = 1000
		}
	}
}

#DCO - night attack failed - DC perspective
magic_ev7.50 = {
	type = character_event
	title = special_champion_mission_failure
	desc = ev7.50.desc
	theme = realm
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:recipient
		animation = aggressive_sword
	}

	trigger = {
		is_alive = yes
	}
	
	option = {
		name = ev7.50.0.a
		if = {
			limit = {
				var:night_attack_q >3
			}
			random = {
				chance = 10
				death = {
					death_reason = death_battle
					killer = scope:recipient
				}
			}
		}
		else = {
			random = {
				chance = 60
				death = {
					death_reason = death_battle
					killer = scope:recipient
				}
			}
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					is_alive = yes
				}
				scope:actor = {
					trigger_event = magic_ev7.45
				}
			}
			remove_variable = night_attack_q
		}
	}
}

#DCO - night attack failed - recipient perspective
magic_ev7.51 = {
	type = character_event
	title = ev7.49.title
	desc = ev7.51.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:recipient

	trigger = {
		is_alive = yes
	}
	
	option = {
		name = ev7.51.1.a
		hidden_effect = {
			add_opinion = {
				target = scope:dchampion
				modifier = angry_opinion
				opinion = -100
			}
		}
	}
}
#DCO - night attack success - DC perspective
magic_ev7.52 = {
	type = character_event
	title = special_champion_mission_success
	desc = ev7.52.desc
	theme = realm
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	right_portrait = {
		character = scope:recipient
		animation = worry
	}

	trigger = {
		is_alive = yes
	}
	
	option = {
		name = ev7.52.0.a
		scope:recipient = {
			death = {
				death_reason = death_head_ripped_off
				killer = scope:dchampion
			}
		}
		hidden_effect = {
			remove_variable = night_attack_q
		}
	}
}

#DCO - plunder 1. - DC perspective
magic_ev7.53 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.53.desc
	theme = war
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_character_flag = ready_for_special_mission
		exists = liege
		liege = scope:actor 
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:recipient = {
			is_alive = yes
			is_landed_or_landless_administrative = yes
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			scope:actor = {
				trigger_event = magic_ev7.34
			}
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			scope:actor = {
				trigger_event = magic_ev7.35
			}
		}
		else = {
			clear_dc_mission_flags = yes
			scope:actor = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = special_mission_dco_ends_ct
					left_icon = scope:dchampion
					right_icon = scope:recipient
				}
			}
		}
	}
	immediate = {
		hidden_effect = {
			scope:recipient = {
				random_held_title = {
					limit = {
						tier = tier_county
						title_province = {
							NOT = {
								has_province_modifier = recently_looted_modifier
							}
						}
					}
					title_province = {
						save_scope_as = tprovince
					}
				}
			}
		}
	}
	
	option = {
		name = ev7.53.0.a
		add_gold = minor_gold_min_value
		show_as_tooltip = {
			scope:tprovince = {
				add_province_modifier = {
					modifier = recently_looted_modifier
					years = 1
				}
			}
			scope:recipient = {
				if = {
					limit = { is_valid_for_legitimacy_change = yes }
					add_legitimacy = minor_legitimacy_loss
				}
			}
		}
		hidden_effect = {
			scope:actor = {
				trigger_event = magic_ev7.54
			}
			scope:recipient = {
				trigger_event = {
					id = magic_ev7.55
					months = 1
				}
			}
		}
	}
}
#DCO - plunder 1. - actor perspective (notification)
magic_ev7.54 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.54.desc
	theme = realm
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	lower_left_portrait = scope:dchampion
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
	}
	
	
	option = {
		name = ev7.53.0.a
		show_as_tooltip = {
			scope:tprovince = {
				add_province_modifier = {
					modifier = recently_looted_modifier
					years = 1
				}
			}
			scope:recipient = {
				if = {
					limit = { is_valid_for_legitimacy_change = yes }
					add_legitimacy = minor_legitimacy_loss
				}
			}
		}
		custom_tooltip = ev7.54.0.a_ct
	}
}
#DCO - plunder 1. - recipient perspective
magic_ev7.55 = {
	type = character_event
	title = travel_danger_type_default
	desc = ev7.55.desc
	theme = realm
	left_portrait = root
	#lower_right_portrait = scope:dchampion
	immediate = {
		hidden_effect = {
			random_knight = {
				limit = {
					is_landed_or_landless_administrative = no
					NOR = {
						has_trait = demon
						has_trait = archmage
						has_trait = yaga
					}
				}
				save_scope_as = rknight
			}
		}
		scope:tprovince = {
			add_province_modifier = {
				modifier = recently_looted_modifier
				years = 1
			}
		}
		if = {
			limit = { is_valid_for_legitimacy_change = yes }
			add_legitimacy = minor_legitimacy_loss
		}
	}
	
	option = {
		name = tournament_events.9004.d #"I don't have time for this."
		hidden_effect = {
			scope:dchampion = {
				trigger_event = {
					id = magic_ev7.57
					months = 2
				}
			}
		}
	}
	option = {
		name = ev7.55.0.a	#"I will delegate the guards for this."
		trigger = {
			NOT = {
				has_character_modifier = busy_guards_modifier
			}
		}
		add_character_modifier = {
			modifier = busy_guards_modifier
			years = 2
		}
		hidden_effect = {
			if = {
				limit = {
					scope:dchampion = {
						aptitude = {
							court_position = dark_champion_court_position
							value < 3
						}
					}
				}
				duel = {
					skill = martial
					value = scope:dchampion.martial
					8 = {
						desc = ev3.52.a_1
						compare_modifier = {
							value = scope:duel_value
							multiplier = 1
							min = 0
						}
						
						scope:dchampion = {
							death = {
								death_reason = death_battle
								killer = scope:rknight
							}
						}
					}
					2 = {
						desc = ev3.52.a_2
						compare_modifier = {
							value = scope:duel_value
							multiplier = -1
							min = 0
						}
						scope:actor = {
							trigger_event = magic_ev7.56
						}
					}
				}
			}
			else = {
				duel = {
					skill = martial
					value = scope:dchampion.martial
					2 = {
						desc = ev3.52.a_1
						compare_modifier = {
							value = scope:duel_value
							multiplier = 1
							min = 0
						}
						
						scope:dchampion = {
							death = {
								death_reason = death_battle
								killer = scope:rknight
							}
						}
					}
					8 = {
						desc = ev3.52.a_2
						compare_modifier = {
							value = scope:duel_value
							multiplier = -1
							min = 0
						}
						scope:actor = {
							trigger_event = magic_ev7.56
						}
					}
				}
			}
			
		}
	}
	option = {
		name = ev7.55.0.b	#"My knights will deal with it."
		trigger = {
			exists = scope:rknight
		}
		custom_tooltip = ev7.55.0.b_ct
		hidden_effect = {
			if = {
				limit = {
					scope:dchampion = {
						OR = {
							has_trait = demon
							has_trait = archmage
						}
					}
				}
				scope:dchampion = {
					trigger_event = {
						id = magic_ev7.57
						months = 2
					}
				}
			}
			else = {
				scope:rknight = {
					duel = {
						skill = martial
						value = scope:dchampion.martial
						3 = {
							desc = ev3.52.a_1
							compare_modifier = {
								value = scope:duel_value
								multiplier = 2
								min = 0
							}
							
							scope:dchampion = {
								death = {
									death_reason = death_battle
									killer = scope:rknight
								}
							}
						}
						7 = {
							desc = ev3.52.a_2
							compare_modifier = {
								value = scope:duel_value
								multiplier = -2
								min = 0
							}
							scope:dchampion = {
								trigger_event = {
									id = magic_ev7.57
									months = 2
								}
							}
							root = {
								send_interface_toast = {
									title=travel_danger_type_default
									scope:rknight = {
										death = {
											death_reason = death_battle
											killer = scope:dchampion
										}
									}
									left_icon = scope:rknight
								}
							}
							
						}
					}
				}
			}
		}
	}
	option = {
		name = ev7.55.0.c	#"I will put a bounty on their heads."
		remove_short_term_gold = medium_gold_max_value_static
		hidden_effect = {
			if = {
				limit = {
					NOR = {
						has_trait = demon
						has_trait = yaga
						has_trait = archmage
					}
				}
				random = {
					chance = 20
					scope:dchampion = {
						death = {
							death_reason = death_battle
							killer = scope:rknight
						}
					}
				}
			}
			scope:dchampion = {
				trigger_event = {
					id = magic_ev7.57
					months = 2
				}
			}
		}
	}
}
#DCO - plunder 1.5. (guards) - actor perspective
magic_ev7.56 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.56.desc
	theme = realm
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = root
	lower_left_portrait = scope:dchampion
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		is_imprisoned = no

		scope:dchampion = {
			is_alive = yes
			is_imprisoned = no
			has_character_flag = ready_for_special_mission
			exists = liege
			liege = scope:actor 
		}
		scope:recipient = {
			is_alive = yes
			is_landed_or_landless_administrative = yes
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			trigger_event = magic_ev7.34
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			trigger_event = magic_ev7.35
		}
		else = {
			scope:dchampion = {
				clear_dc_mission_flags = yes
			}
			send_interface_toast = {
				title = special_champion_mission
				custom_tooltip = special_mission_dco_ends_ct
				left_icon = scope:dchampion
				right_icon = scope:recipient
			}
		}
	}
	immediate = {
		show_as_tooltip = {
			scope:recipient = {
				add_character_modifier = {
					modifier = busy_guards_modifier
					years = 2
				}
			}
		}
	}
	
	option = {
		name = ev7.56.0.a
		custom_tooltip = special_mission_dco_ends_ct2
		hidden_effect = {
			scope:dchampion = {
				trigger_event = magic_ev7.38
				clear_dc_mission_flags = yes
			}
		}
	}
	option = {
		name = ev7.56.0.b
		custom_tooltip = ev7.54.0.a_ct
		hidden_effect = {
			scope:dchampion = {
				trigger_event = {
					id = magic_ev7.57
					months = 2
				}
			}
		}
	}
}
#DCO - plunder 2. - DC perspective
magic_ev7.57 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.57.desc
	theme = war
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	lower_left_portrait = scope:actor
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_character_flag = ready_for_special_mission
		exists = liege
		liege = scope:actor 
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:recipient = {
			is_alive = yes
			is_landed_or_landless_administrative = yes
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			scope:actor = {
				trigger_event = magic_ev7.34
			}
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			scope:actor = {
				trigger_event = magic_ev7.35
			}
		}
		else = {
			clear_dc_mission_flags = yes
			scope:actor = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = special_mission_dco_ends_ct
					left_icon = scope:dchampion
					right_icon = scope:recipient
				}
			}
		}
	}
	immediate = {
		scope:recipient = {
			show_as_tooltip = {
				add_opinion = {
					target = ROOT
					modifier = humiliated_opinion
					opinion = -100
				}
				every_vassal = {
					limit = {
						is_powerful_vassal = yes
					}
					add_opinion = {
						target = scope:recipient
						modifier = contempt_opinion 
						opinion = -20
					}
				}
				if = {
					limit = { is_valid_for_legitimacy_change = yes }
					add_legitimacy = major_legitimacy_loss
				}
				remove_short_term_gold = major_gold_max_value_static
			}
		}
	}
	option = {
		name = ev7.57.0.a
		hidden_effect = {
			scope:actor = {
				trigger_event = magic_ev7.58
			}
			scope:recipient = {
				trigger_event = magic_ev7.59
			}
		}
	}
}
#DCO - plunder 2. - actor perspective
magic_ev7.58 = {
	type = character_event
	title = special_champion_mission_success
	desc = ev7.58.desc
	theme = realm
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	right_portrait = {
		character = scope:dchampion
		animation = aggressive_sword
	}
	lower_right_portrait = scope:recipient

	
	immediate = {
		scope:recipient = {
			show_as_tooltip = {
				add_opinion = {
					target = scope:dchampion
					modifier = humiliated_opinion
					opinion = -100
				}
				every_vassal = {
					limit = {
						is_powerful_vassal = yes
					}
					add_opinion = {
						target = scope:recipient
						modifier = contempt_opinion 
						opinion = -20
					}
				}
				if = {
					limit = { is_valid_for_legitimacy_change = yes }
					add_legitimacy = major_legitimacy_loss
				}
				remove_short_term_gold = major_gold_max_value_static
			}
		}
	}
	option = {
		name = ev7.56.0.a
		custom_tooltip = special_mission_dco_ends_ct2
		hidden_effect = {
			scope:dchampion = {
				trigger_event = magic_ev7.38
				clear_dc_mission_flags = yes
			}
		}
	}
}
#DCO - plunder 2. - recipient perspective
magic_ev7.59 = {
	type = character_event
	title = travel_danger_type_default
	desc = ev7.59.desc
	theme = realm
	left_portrait = {
		character = root
		animation = anger
	}
	right_portrait = {
		character = scope:dchampion
		animation = aggressive_sword
	}

	
	immediate = {
		hidden_effect = {
			add_opinion = {
				target = scope:dchampion
				modifier = humiliated_opinion
				opinion = -100
			}
		}
		every_vassal = {
			limit = {
				is_powerful_vassal = yes
			}
			add_opinion = {
				target = scope:recipient
				modifier = contempt_opinion 
				opinion = -20
			}
		}
		if = {
			limit = { is_valid_for_legitimacy_change = yes }
			add_legitimacy = major_legitimacy_loss
		}
		remove_short_term_gold = major_gold_max_value_static
	}
	option = {
		name = ev7.59.0.a
		start_scheme = {
			type = murder
			target_character = scope:dchampion
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 1000
				has_trait = vengeful
			}
		}
	}
	option = {
		name = ev7.59.0.b
		ai_chance = {
			base = 10
		}
	}
}

#DCO - abduct/release 1. - DC perspective
magic_ev7.60 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.60.desc
	theme = abduct_scheme
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = scheme
	}
	lower_left_portrait = scope:actor
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_character_flag = ready_for_special_mission
		exists = liege
		liege = scope:actor 
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:recipient = {
			is_alive = yes
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			scope:actor = {
				trigger_event = magic_ev7.34
			}
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			scope:actor = {
				trigger_event = magic_ev7.35
			}
		}
		else = {
			clear_dc_mission_flags = yes
			scope:actor = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = special_mission_dco_ends_ct
					left_icon = scope:dchampion
					right_icon = scope:recipient
				}
			}
		}
	}
	
	option = {
		name = ev7.60.0.a
		duel = {
			skill = intrigue
			value = 21
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					custom_tooltip = ev7.60.0.a_ct
				}
				hidden_effect = {
					add_character_flag = good_abduct_plan_dco
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					custom_tooltip = ev7.60.1.a_ct
				}
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 40
				intrigue > martial
			}
		}
	}
	option = {
		name = ev7.60.0.b
		duel = {
			skill = martial
			value = 21
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					custom_tooltip = ev7.60.0.a_ct
				}
				hidden_effect = {
					add_character_flag = good_abduct_plan_dco
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					custom_tooltip = ev7.60.1.a_ct
				}
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 40
				intrigue < martial
			}
		}
	}
	option = {
		name = ev3.32.c
		trigger = {
			has_trait = intellect_good_3
		}
		trait = intellect_good_3
		custom_tooltip = ev7.60.0.a_ct
		hidden_effect = {
			add_character_flag = good_abduct_plan_dco
		}
		ai_chance = {
			base = 1000
		}
	}
	after = {
		trigger_event = {
			id = magic_ev7.61
			months = 1
		}
	}
}
#DCO - abduct/release 2. - DC perspective
magic_ev7.61 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.61.desc
	theme = abduct_scheme
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = scheme
	}
	lower_left_portrait = scope:actor
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_character_flag = ready_for_special_mission
		exists = liege
		liege = scope:actor 
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:recipient = {
			is_alive = yes
		}
		
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			scope:actor = {
				trigger_event = magic_ev7.34
			}
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			scope:actor = {
				trigger_event = magic_ev7.35
			}
		}
		else = {
			clear_dc_mission_flags = yes
			scope:actor = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = special_mission_dco_ends_ct
					left_icon = scope:dchampion
					right_icon = scope:recipient
				}
			}
		}
	}
	option = {
		name = ev7.61.0.a		
	}
	after = {
		if = {
			limit = {
				has_character_flag = special_champion_mission3
			}
			scope:recipient = {
				trigger_event = magic_ev7.62
			}
		}
		else = {
			trigger_event = {
				id = magic_ev7.67
				months = 1
			}
		}
	}
}

#DCO - abduct 2. - target perspective
magic_ev7.62 = {
	type = character_event
	title = ev7.49.title
	desc = ev7.62.desc
	theme = realm
	left_portrait = {
		character = root
		animation = shock
	}
	right_portrait = {
		character = scope:dchampion
		animation = aggressive_sword
	}

	option = {
		name = ev7.62.0.a
		if = {
			limit = {
				is_landed_or_landless_administrative = yes
			}
			if = {
				limit = {
					scope:dchampion = {
						has_character_flag = good_abduct_plan_dco
					}
				}
				random_list = {
					2 = {
						custom_tooltip = ev2.48.a_ct1
						hidden_effect = {
							scope:dchampion = {
								random_list = {
									9 = {
										trigger_event = magic_ev7.63
									}
									1 = {
										death = {
											death_reason = death_duel
											killer = scope:recipient
										}
									}
								}
							}
							trigger_event = magic_ev7.51
						}
					}
					3 = {
						custom_tooltip = abduct_outcome.5001.t
						hidden_effect = {
							scope:dchampion = {
								trigger_event = magic_ev7.64
							}
						}
					}
				}
			}
			else = {
				random_list = {
					3 = {
						custom_tooltip = ev2.48.a_ct1
						hidden_effect = {
							scope:dchampion = {
								random_list = {
									5 = {
										trigger_event = magic_ev7.63
									}
									5 = {
										death = {
											death_reason = death_duel
											killer = scope:recipient
										}
									}
								}
							}
							trigger_event = magic_ev7.51
						}
					}
					2 = {
						custom_tooltip = abduct_outcome.5001.t
						hidden_effect = {
							scope:dchampion = {
								trigger_event = magic_ev7.64
							}
						}
					}
				}
			}
		}
		else = {
			if = {
				limit = {
					scope:dchampion = {
						has_character_flag = good_abduct_plan_dco
					}
				}
				random_list = {
					1 = {
						custom_tooltip = ev2.48.a_ct1
						hidden_effect = {
							scope:dchampion = {
								random_list = {
									9 = {
										trigger_event = magic_ev7.63
									}
									1 = {
										death = {
											death_reason = death_duel
											killer = scope:recipient
										}
									}
								}
							}
							trigger_event = magic_ev7.51
						}
					}
					4 = {
						custom_tooltip = abduct_outcome.5001.t
						hidden_effect = {
							scope:dchampion = {
								trigger_event = magic_ev7.64
							}
						}
					}
				}
			}
			else = {
				random_list = {
					2 = {
						custom_tooltip = ev2.48.a_ct1
						hidden_effect = {
							scope:dchampion = {
								random_list = {
									7 = {
										trigger_event = magic_ev7.63
									}
									3 = {
										death = {
											death_reason = death_duel
											killer = scope:recipient
										}
									}
								}
							}
							trigger_event = magic_ev7.51
						}
					}
					2 = {
						custom_tooltip = abduct_outcome.5001.t
						hidden_effect = {
							scope:dchampion = {
								trigger_event = magic_ev7.64
							}
						}
					}
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.62.0.b
		if = {
			limit = {
				is_landed_or_landless_administrative = yes
			}
			if = {
				limit = {
					scope:dchampion = {
						has_character_flag = good_abduct_plan_dco
					}
				}
				duel = {
					skill = prowess
					value = scope:dchampion.prowess
					55 = {
						desc = ev3.52.a_1
						compare_modifier = {
							value = scope:duel_value
							multiplier = 2
							min = 0
						}
						custom_tooltip = ev2.48.a_ct1
						hidden_effect = {
							scope:dchampion = {
								random_list = {
									8 = {
										trigger_event = magic_ev7.63
									}
									2 = {
										death = {
											death_reason = death_duel
											killer = scope:recipient
										}
									}
								}
							}
							trigger_event = magic_ev7.51
						}
					}
					45 = {
						desc = ev3.52.a_2
						compare_modifier = {
							value = scope:duel_value
							multiplier = -2
							min = 0
						}
						custom_tooltip = abduct_outcome.5001.t
						hidden_effect = {
							scope:dchampion = {
								trigger_event = magic_ev7.64
							}
						}
					}
				}
			}
			else = {
				duel = {
					skill = prowess
					value = scope:dchampion.prowess
					65 = {
						desc = ev3.52.a_1
						compare_modifier = {
							value = scope:duel_value
							multiplier = 2
							min = 0
						}
						custom_tooltip = ev2.48.a_ct1
						hidden_effect = {
							scope:dchampion = {
								random_list = {
									6 = {
										trigger_event = magic_ev7.63
									}
									4 = {
										death = {
											death_reason = death_duel
											killer = scope:recipient
										}
									}
								}
							}
							trigger_event = magic_ev7.51
						}
					}
					35 = {
						desc = ev3.52.a_2
						compare_modifier = {
							value = scope:duel_value
							multiplier = -2
							min = 0
						}
						custom_tooltip = abduct_outcome.5001.t
						hidden_effect = {
							scope:dchampion = {
								trigger_event = magic_ev7.64
							}
						}
					}
				}
			}
		}
		else = {
			if = {
				limit = {
					scope:dchampion = {
						has_character_flag = good_abduct_plan_dco
					}
				}
				duel = {
					skill = prowess
					value = scope:dchampion.prowess
					35 = {
						desc = ev3.52.a_1
						compare_modifier = {
							value = scope:duel_value
							multiplier = 2
							min = 0
						}
						custom_tooltip = ev2.48.a_ct1
						hidden_effect = {
							scope:dchampion = {
								trigger_event = magic_ev7.63
							}
							trigger_event = magic_ev7.51
						}
					}
					65 = {
						desc = ev3.52.a_2
						compare_modifier = {
							value = scope:duel_value
							multiplier = -2
							min = 0
						}
						custom_tooltip = abduct_outcome.5001.t
						hidden_effect = {
							scope:dchampion = {
								trigger_event = magic_ev7.64
							}
						}
					}
				}
			}
			else = {
				duel = {
					skill = prowess
					value = scope:dchampion.prowess
					50 = {
						desc = ev3.52.a_1
						compare_modifier = {
							value = scope:duel_value
							multiplier = 2
							min = 0
						}
						custom_tooltip = ev2.48.a_ct1
						hidden_effect = {
							scope:dchampion = {
								random_list = {
									6 = {
										trigger_event = magic_ev7.63
									}
									4 = {
										death = {
											death_reason = death_duel
											killer = scope:recipient
										}
									}
								}
							}
							trigger_event = magic_ev7.51
						}
					}
					50 = {
						desc = ev3.52.a_2
						compare_modifier = {
							value = scope:duel_value
							multiplier = -2
							min = 0
						}
						custom_tooltip = abduct_outcome.5001.t
						hidden_effect = {
							scope:dchampion = {
								trigger_event = magic_ev7.64
							}
						}
					}
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.49.0.c
		trigger = {
			has_trait = archmage
		}
		trait = archmage
		if = {
			limit = {
				scope:dchampion = {
					OR = {
						has_trait = demon
						has_trait = archmage
					}
				}
			}
			custom_tooltip = start_duel_ct
			configure_start_mage_duel_effect = {
				MD_ATTACKER = root
				MD_DEFENDER = scope:dchampion
			}
		}
		else = {
			spend_standard_ps_effect = yes
			custom_tooltip = ev2.48.a_ct1
			hidden_effect = {
				scope:dchampion = {
					random_list = {
						3 = {
							trigger_event = magic_ev7.63
						}
						7 = {
							death = {
								death_reason = death_chopped_to_pieces
								killer = scope:recipient
							}
						}
					}
				}
				trigger_event = magic_ev7.51
			}
		}
		ai_chance = {
			base = 1000
		}
	}
}

#DCO - abduct 3, failure - DC perspective
magic_ev7.63 = {
	type = character_event
	title = special_champion_mission_failure
	desc = ev7.63.desc
	theme = abduct_scheme
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = stress
	}
	lower_left_portrait = scope:actor
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
	}
	
	
	option = {
		name = diplomacy_family.2301.a	#I did what I could.
		custom_tooltip = special_mission_dco_ends_ct
	}
	after = {
		scope:actor = {
			trigger_event = magic_ev7.65
		}
	}
}

#DCO - abduct 3, success - DC perspective
magic_ev7.64 = {
	type = character_event
	title = special_champion_mission_success
	desc = ev7.64.desc
	theme = abduct_scheme
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = happiness
	}
	lower_left_portrait = scope:actor
	right_portrait = {
		character = scope:recipient
		animation = paranoia
	}

	trigger = {
		is_alive = yes
	}
	immediate = {
		show_as_tooltip = {
			scope:actor = {
				imprison = {
					target = scope:recipient
					type = dungeon
				}
			}
		}
	}
	
	option = {
		name = ev7.64.0.a
		custom_tooltip = special_mission_dco_ends_ct2
	}
	after = {
		scope:actor = {
			trigger_event = magic_ev7.66
		}
	}
}

#DCO - general failure - actor perspective
magic_ev7.65 = {
	type = character_event
	title = special_champion_mission_failure
	desc = ev7.65.desc
	theme = realm
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		#animation = anger
	}
	lower_right_portrait = scope:recipient
	right_portrait = scope:dchampion

	trigger = {
		is_alive = yes
	}
	immediate = {
		stress_impact = {
			ambitious = minor_stress_gain
		}
	}
	
	option = {
		name = tour_grounds_events.3017.a	#A pity.
		custom_tooltip = special_mission_dco_ends_ct
		hidden_effect = {
			scope:dchampion = {
				clear_dc_mission_flags = yes
			}
		}
	}
	option = {
		name = ev7.65.0.a
		stress_impact = {
			wrathful = minor_stress_loss
			irritable = medium_stress_loss
		}
		custom_tooltip = special_mission_dco_ends_ct
		scope:dchampion = {
			add_stress = medium_stress_gain
		}
		hidden_effect = {
			scope:dchampion = {
				clear_dc_mission_flags = yes
			}
		}
	}
	option = {
		name = ev7.65.0.b
		stress_impact = {
			arbitrary = minor_stress_loss
			sadistic = minor_stress_loss
			callous = minor_stress_loss
			vengeful = minor_stress_loss
		}
		custom_tooltip = special_mission_dco_ends_ct
		if = {
			limit = {
				scope:dchampion = {
					OR = {
						has_trait = yaga
						has_trait = archmage
						has_trait = demon
					}
				}
			}
			random_list = {
				3 = {
					imprison = {
						target = scope:dchampion
						type = dungeon
					}
				}
				7 = {
					set_relation_rival = scope:dchampion
				}
			}
		}
		else = {
			imprison = {
				target = scope:dchampion
				type = dungeon
			}
		}
		
		hidden_effect = {
			scope:dchampion = {
				clear_dc_mission_flags = yes
			}
		}
	}
	option = {
		name = ev7.45.0.d
		trigger = {
			has_trait = archmage
			can_spend_standard_ps_trigger = yes
			scope:dchampion = {
				has_full_magic_prot_trigger = no
			}
		}
		trait = archmage
		stress_impact = {
			sadistic = medium_stress_loss
			compassionate = minor_stress_gain
			forgiving = medium_stress_gain
			vengeful = minor_stress_loss
		}
		custom_tooltip = ev7.45.0.d_ct
		spend_standard_ps_effect = yes
		scope:dchampion = {
			death = {
				death_reason = death_murder
				killer = root
			}
		}
		custom_tooltip = special_mission_dco_ends_ct
	}
}

#DCO - general success - actor perspective
magic_ev7.66 = {
	type = character_event
	title = special_champion_mission_success
	desc = ev7.66.desc
	theme = realm
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = happiness
	}
	lower_right_portrait = scope:recipient
	right_portrait = scope:dchampion

	trigger = {
		is_alive = yes
	}
	immediate = {
		if = {
			limit = {
				scope:dchampion = {
					has_character_flag = special_champion_mission3
				}
			}
			imprison = {
				target = scope:recipient
				type = dungeon
			}
		}
	}
	
	option = {
		name = ev7.66.0.a
		stress_impact = {
			ambitious = minor_stress_loss
		}
		if = {
			limit = {
				scope:dchampion = {
					has_character_flag = special_champion_mission4
				}
			}
			scope:recipient = {
				release_from_prison = yes
				add_opinion = {
					target = root
					modifier = grateful_opinion
					opinion = 100
				}
			}
			if = {
				limit = {
					scope:recipient = {
						is_landed_or_landless_administrative = no
						is_ruler = no
					}
				}
				hidden_effect = {
					scope:recipient = {
						move_to_pool = yes
					}
				}
				add_courtier = scope:recipient
			}
		}
		custom_tooltip = special_mission_dco_ends_ct2
	}
	option = {
		name = ev7.66.0.b
		trigger = {
			scope:dchampion = {
				has_character_flag = special_champion_mission4
			}
		}
		stress_impact = {
			sadistic = medium_stress_loss
		}
		hidden_effect = {
			scope:recipient = {
				release_from_prison = yes
			}
		}
		scope:recipient = {
			add_opinion = {
				target = root
				modifier = hate_opinion
				opinion = -50
			}
		}
		imprison = {
			target = scope:recipient
			type = dungeon
		}
		custom_tooltip = special_mission_dco_ends_ct2
	}
	after = {
		hidden_effect = {
			scope:dchampion = {
				clear_dc_mission_flags = yes
			}
		}
	}
}

#DCO - release 3. - DC perspective
magic_ev7.67 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.67.desc
	theme = intrigue
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = scheme
	}
	lower_left_portrait = scope:actor
	right_portrait = scope:recipient

	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_character_flag = ready_for_special_mission
		exists = liege
		liege = scope:actor 
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:recipient = {
			is_alive = yes
			is_imprisoned = yes
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				scope:recipient = {
					is_alive = no
				}
			}
			scope:actor = {
				trigger_event = magic_ev7.34
			}
		}
		else_if = {
			limit = {
				is_imprisoned = yes
			}
			scope:actor = {
				trigger_event = magic_ev7.35
			}
		}
		else = {
			clear_dc_mission_flags = yes
			scope:actor = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = special_mission_dco_ends_ct
					left_icon = scope:dchampion
					right_icon = scope:recipient
				}
			}
		}
	}
	
	option = {
		name = ev7.67.0.a
		if = {
			limit = {
				has_character_flag = good_abduct_plan_dco
			}
			duel = {
				skill = prowess
				value = 20
				50 = {
					desc = ev3.52.a_1
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2
						min = 0
					}
					show_as_tooltip = {
						scope:recipient = {
							release_from_prison = yes
						}
					}
					hidden_effect = {
						trigger_event = magic_ev7.64
					}
				}
				50 = {
					desc = ev3.52.a_2
					compare_modifier = {
						value = scope:duel_value
						multiplier = -2
						min = 0
					}
					custom_tooltip = ev7.67.0.a_ct
					hidden_effect = {
						scope:dchampion = {
							trigger_event = magic_ev7.63
						}
					}
				}
			}
		}
		else = {
			duel = {
				skill = prowess
				value = 30
				50 = {
					desc = ev3.52.a_1
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2
						min = 0
					}
					show_as_tooltip = {
						scope:recipient = {
							release_from_prison = yes
						}
					}
					hidden_effect = {
						trigger_event = magic_ev7.64
					}
				}
				50 = {
					desc = ev3.52.a_2
					compare_modifier = {
						value = scope:duel_value
						multiplier = -2
						min = 0
					}
					custom_tooltip = ev7.67.0.a_ct
					hidden_effect = {
						scope:dchampion = {
							trigger_event = magic_ev7.63
						}
					}
				}
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 40
				prowess > intrigue
			}
		}
	}
	option = {
		name = ev7.67.0.b
		if = {
			limit = {
				has_character_flag = good_abduct_plan_dco
			}
			duel = {
				skill = intrigue
				value = 20
				50 = {
					desc = ev3.52.a_1
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2
						min = 0
					}
					show_as_tooltip = {
						scope:recipient = {
							release_from_prison = yes
						}
					}
					hidden_effect = {
						trigger_event = magic_ev7.64
						scope:recipient = {
							trigger_event = magic_ev7.68
						}
					}
				}
				50 = {
					desc = ev3.52.a_2
					compare_modifier = {
						value = scope:duel_value
						multiplier = -2
						min = 0
					}
					custom_tooltip = ev7.67.0.a_ct
					hidden_effect = {
						scope:dchampion = {
							trigger_event = magic_ev7.63
						}
					}
				}
			}
		}
		else = {
			duel = {
				skill = intrigue
				value = 30
				50 = {
					desc = ev3.52.a_1
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2
						min = 0
					}
					show_as_tooltip = {
						scope:recipient = {
							release_from_prison = yes
						}
					}
					hidden_effect = {
						trigger_event = magic_ev7.64
						scope:recipient = {
							trigger_event = magic_ev7.68
						}
					}
				}
				50 = {
					desc = ev3.52.a_2
					compare_modifier = {
						value = scope:duel_value
						multiplier = -2
						min = 0
					}
					custom_tooltip = ev7.67.0.a_ct
					hidden_effect = {
						scope:dchampion = {
							trigger_event = magic_ev7.63
						}
					}
				}
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 40
				prowess < intrigue
			}
		}
	}
}
#DCO - releasing success - target perspective
magic_ev7.68 = {
	type = character_event
	title = released_from_prison
	desc = ev7.68.desc
	theme = realm
	left_portrait = {
		character = root
		animation = happiness
	}
	right_portrait = scope:dchampion

	trigger = {
		is_alive = yes
	}
	immediate = {
		show_as_tooltip = {
			release_from_prison = yes
		}
	}
	
	option = {
		name = ev7.68.0.a
		add_stress = medium_stress_loss
	}
}

#DCO - gold requested - actor perspective
magic_ev7.69 = {
	type = character_event
	title = special_champion_mission
	desc = ev7.69.desc
	theme = realm
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = disapproval
	}
	right_portrait = {
		character = scope:dchampion
		animation = beg
	}

	trigger = {
		is_alive = yes
	}
	option = {
		name = ev54.0.a
		pay_short_term_gold = {
			target = scope:dchampion
			gold = medium_gold_max_value_static
		}
		hidden_effect = {
			scope:dchampion = {
				send_interface_toast = {
					title = special_champion_mission
					show_as_tooltip = {
						root = {
							pay_short_term_gold = {
								target = scope:dchampion
								gold = medium_gold_max_value_static
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = ev7.69.0.a
		hidden_effect = {
			scope:dchampion = {
				send_interface_toast = {
					title = special_champion_mission
					custom_tooltip = ev7.69.0.a_ct
				}
			}
		}
	}
	after = {
		scope:dchampion = {
			trigger_event = {
				id = magic_ev7.32
				days = 10
			}
		}
	}
}

#Corruption ongoing 5.
magic_ev7.70 = {
	type = character_event
	title = corruption
	desc = ev7.70.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = scope:owner
		animation = spymaster
	}
	right_portrait = scope:target

	trigger = {
		exists = scope:scheme
		scope:scheme = {
			NOT = {
				is_scheme_exposed = yes
			}
		}
		scope:target = {
			NOR = {
				has_character_flag = corruption_5_ongoing_flag
				has_basic_magic_prot_trigger2 = yes
				has_full_magic_prot_trigger = yes
			}
		}
	}

	option = {
		name = ev7.70.0.a
		trigger = {
			scope:target = {
				NOT = {
					has_trait = disfigured
				}
			}
		}
		random = {
			chance = 50
			scope:target = {
				add_trait = disfigured
			}
		}
	}
	option = {
		name = ev7.70.0.b
		scope:target = {
			send_interface_toast = {
				title=ev7.70.0.b_ct
				add_stress = major_stress_gain
			}
		}
	}
	option = {
		name = ev7.70.0.c
		trigger = {
			has_trait = demon
			scope:target = {
				NOT = {
					has_character_modifier = horned_god_blessing_modifier
				}
			}
		}
		trait = demon
		scope:target = {
			add_character_modifier = {
				modifier = horned_god_blessing_modifier
			}
			if = {
				limit = {
					NOT = {
						has_character_modifier = demonic_charm_modifier
					}
				}
				add_character_modifier = {
					modifier = demonic_charm_modifier
				}
			}
		}
	}
	option = {
		name = ev7.70.0.d
		trigger = {
			scope:target = {
				NOT = {
					has_trait = source
				}
			}
			is_the_choosen_one_trigger = yes
		}
		scope:target = {
			add_min_source_trait = yes
			if = {
				limit = {
					NOT = {
						has_character_modifier = magic_resonance
					}
				}
				add_character_modifier = {
					modifier = magic_resonance
					years = 5
				}
			}
		}
	}
	option = {
		name = ev7.70.0.e
		trigger = {
			scope:target = {
				NOR = {
					has_trait = intellect_bad_1
					has_trait = intellect_bad_2
					has_trait = intellect_bad_3
					has_trait = intellect_good_1
					has_trait = intellect_good_2
					has_trait = intellect_good_3
					has_basic_magic_prot_trigger2 = yes
					has_full_magic_prot_trigger = yes
				}
			}
		}
		scope:target = {
			random_list = {
				1 = {
					add_trait = intellect_good_1
				}
				1 = {
					add_trait = intellect_bad_1
				}
				1 = {
					
				}
			}
		}
	}
	option = {
		name = ev7.70.0.f
		scope:target = {
			send_interface_toast = {
				title = ev7.23.title
				random_list = {
					1 = {
						add_diplomacy_skill = 1
					}
					1 = {
						add_martial_skill = 1
					}
					1 = {
						add_stewardship_skill = 1
					}
					1 = {
						add_intrigue_skill = 1
					}
					1 = {
						add_learning_skill = 1
					}
					1 = {
						add_prowess_skill = 1
					}
				}
			}
		}
	}
	after = {
		hidden_effect = {
			scope:target = {
				add_character_flag = corruption_5_ongoing_flag
			}
		}
	}
}

#Corruption - extra for demons
magic_ev7.71 = {
	type = character_event
	title = corruption
	desc = ev7.71.desc
	theme = intrigue
	left_portrait = {
		character = scope:owner
		animation = spymaster
	}

	trigger = {
		has_trait = demon
		NOT = {
			has_trait = cyrographer
		}
	}

	option = {
		name = ev7.71.0.a
		trait = demon
		add_trait = cyrographer
	}
}
#Dark Champion training
magic_ev7.72 = {
	hidden = yes
	type = character_event
	trigger = {
		is_alive = yes
		exists = scope:dchampion
		scope:dchampion = {
			has_character_flag = dc_during_training_flag
			has_court_position = dark_champion_court_position
			liege = root
		}
	}
	immediate = {
		random_list = {
			10 = {
				send_interface_toast = {
					title = ev7.72.0.a_ct
					show_as_tooltip = {
						scope:dchampion = {
							add_martial_skill = 1
							add_intrigue_skill = 1
						}
					}
					left_icon = scope:dchampion
				}
				scope:dchampion = {
					send_interface_toast = {
						title = ev7.72.title
						add_martial_skill = 1
						add_intrigue_skill = 1
					}
				}
			}
			10 = {
				send_interface_toast = {
					title = ev7.72.0.a_ct
					show_as_tooltip = {
						scope:dchampion = {
							add_prowess_skill = 1
							add_martial_skill = 1
						}
					}
					left_icon = scope:dchampion
				}
				scope:dchampion = {
					send_interface_toast = {
						title = ev7.72.title
						add_prowess_skill = 1
						add_martial_skill = 1
					}
				}
			}
			10 = {
				trigger = {
					scope:dchampion = {
						NOR = {
							has_trait = schemer
							has_trait = strategist
						}
					}
				}
				trigger_event = magic_ev7.73
			}
			10 = {
				trigger = {
					scope:dchampion = {
						NOR = {
							has_trait = lifestyle_blademaster
							has_trait = lifestyle_mystic
							has_trait = aggressive_attacker
						}
					}
				}
				trigger_event = magic_ev7.74
			}
			10 = {
				trigger = {
					scope:dchampion = {
						has_trait = lifestyle_mystic
						has_trait_xp = {
							trait = lifestyle_mystic
							value < 100
						}
					}
				}
				send_interface_toast = {
					title = ev7.72.0.a_ct
					show_as_tooltip = {
						scope:dchampion = {
							add_trait_xp = {
								trait = lifestyle_mystic
								value = 25
							}
						}
					}
					left_icon = scope:dchampion
				}
				scope:dchampion = {
					send_interface_toast = {
						title = ev7.72.title
						add_trait_xp = {
							trait = lifestyle_mystic
							value = 25
						}
					}
				}
			}
			10 = {
				trigger = {
					scope:dchampion = {
						has_trait = lifestyle_blademaster
						has_trait_xp = {
							trait = lifestyle_blademaster
							value < 100
						}
					}
				}
				send_interface_toast = {
					title = ev7.72.0.a_ct
					show_as_tooltip = {
						scope:dchampion = {
							add_trait_xp = {
								trait = lifestyle_blademaster
								value = 25
							}
						}
					}
					left_icon = scope:dchampion
				}
				scope:dchampion = {
					send_interface_toast = {
						title = ev7.72.title
						add_trait_xp = {
							trait = lifestyle_blademaster
							value = 25
						}
					}
				}
			}
			10 = {
				trigger = {
					scope:dchampion = {
						NOT = {
							has_trait = adventurer
						}
					}
				}
				send_interface_toast = {
					title = ev7.72.0.a_ct
					show_as_tooltip = {
						scope:dchampion = {
							add_trait = adventurer
						}
					}
					left_icon = scope:dchampion
				}
				scope:dchampion = {
					send_interface_toast = {
						title = ev7.72.title
						add_trait = adventurer
					}
				}
			}
		}
	}
}
#Dark Champion training 1.
magic_ev7.73 = {
	type = character_event
	title = ev7.72.title
	desc = ev7.73.desc
	theme = dread
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = spymaster
	}
	right_portrait = {
		character = scope:dchampion
		animation = marshal
	}

	option = {
		name = ev7.73.0.a
		show_as_tooltip = {
			scope:dchampion = {
				add_trait = strategist
			}
		}
		hidden_effect = {
			scope:dchampion = {
				if = {
					limit = {
						NOT = {
							has_perk = bellum_justum_perk
						}
					}
					add_perk = bellum_justum_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = parthian_tactics_perk
						}
					}
					add_perk = parthian_tactics_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = envelopment_perk
						}
					}
					add_perk = envelopment_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = organized_retreat_perk
						}
					}
					add_perk = organized_retreat_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = hit_and_run_perk
						}
					}
					add_perk = hit_and_run_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = engineered_for_destruction_perk
						}
					}
					add_perk = engineered_for_destruction_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = living_off_the_land_perk
						}
					}
					add_perk = living_off_the_land_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = sappers_perk
						}
					}
					add_perk = sappers_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = strategist_perk
						}
					}
					add_perk = strategist_perk
				}
			}
		}
	}
	option = {
		name = ev7.73.0.b
		show_as_tooltip = {
			scope:dchampion = {
				add_trait = schemer
			}
		}
		hidden_effect = {
			scope:dchampion = {
				if = {
					limit = {
						NOT = {
							has_perk = truth_is_relative_perk
						}
					}
					add_perk = truth_is_relative_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = digging_for_dirt_perk
						}
					}
					add_perk = digging_for_dirt_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = kidnapper_perk
						}
					}
					add_perk = kidnapper_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = court_of_shadows_perk
						}
					}
					add_perk = court_of_shadows_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = prepared_for_anything_perk
						}
					}
					add_perk = prepared_for_anything_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = swift_execution_perk
						}
					}
					add_perk = swift_execution_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = a_job_done_right_perk
						}
					}
					add_perk = a_job_done_right_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = twice_schemed_perk
						}
					}
					add_perk = twice_schemed_perk
				}
				if = {
					limit = {
						NOT = {
							has_perk = schemer_perk
						}
					}
					add_perk = schemer_perk
				}
			}
		}
	}
}

#Dark Champion training 2.
magic_ev7.74 = {
	type = character_event
	title = ev7.72.title
	desc = ev7.73.desc
	theme = dread
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_dco.dds" 
	}
	left_portrait = {
		character = root
		animation = spymaster
	}
	right_portrait = {
		character = scope:dchampion
		animation = celebrate_mace
	}

	option = {
		name = ev7.74.0.a
		scope:dchampion = {
			add_trait = lifestyle_blademaster
			add_prowess_skill = 3
		}
	}
	option = {
		name = ev7.74.0.b
		scope:dchampion = {
			add_trait = lifestyle_mystic
			add_trait = shrewd
		}
	}
	option = {
		name = ev7.74.0.c
		scope:dchampion = {
			if = {
				limit = {
					has_trait = logistician
					has_trait = aggressive_attacker
					has_trait = organizer
					has_trait = flexible_leader
				}
				add_martial_skill = 5
			}
			else = {
				random_list = {
					1 = {
						trigger = {
							NOT = {
								has_trait = logistician
							}
						}
						add_trait = logistician
					}
					1 = {
						trigger = {
							NOT = {
								has_trait = aggressive_attacker
							}
						}
						add_trait = aggressive_attacker
					}
					1 = {
						trigger = {
							NOT = {
								has_trait = organizer
							}
						}
						add_trait = organizer
					}
					1 = {
						trigger = {
							NOT = {
								has_trait = flexible_leader
							}
						}
						add_trait = flexible_leader
					}
				}
				add_martial_skill = 3
			}
		}
	}
	option = {
		name = ev7.74.0.d
		trigger = {
			has_trait = demon
			scope:dchampion = {
				NOT = {
					has_character_modifier = gift_from_hell_modifier
				}
			}
		}
		trait = demon
		scope:dchampion = {
			add_character_modifier = gift_from_hell_modifier
			if = {
				limit = {
					NOT = {
						has_trait = berserker
					}
				}
				add_trait = berserker
			}
			else = {
				add_prowess_skill = 5
				add_martial_skill = 5
			}
		}
	}
}

#Magic and Morality
magic_ev7.75 = {
	type = character_event
	title = ev7.75.title
	desc = ev7.75.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = spymaster
	}

	option = {
		name = ev7.75.0.a
		trigger = {
			NOT = {
				has_trait = theologian
			}
		}
		stress_impact = {
			compassionate = medium_stress_gain
			forgiving = minor_stress_gain
		}
		if = {
			limit = {
				trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = root.faith GENDER_CHARACTER = root }
			}
			stress_impact = {
				zealous = medium_stress_gain
			}
		}
	}
	option = {
		name = ev7.75.0.b
		trigger = {
			has_trait = theologian
		}
		trait = theologian
		add_stress = medium_stress_loss
	}
	option = {
		name = ev7.75.0.c
		trigger = {
			has_trait = ambitious
		}
		trait = ambitious
		add_prestige = minor_prestige_gain
	}
	option = {
		name = ev7.75.0.d
		trigger = {
			has_trait = callous
		}
		trait = callous
		add_dread = minor_dread_gain
		stress_impact = {
			arrogant = minor_stress_loss
		}
	}
	option = {
		name = ev7.75.0.e
		trigger = {
			has_trait = cynical
		}
		trait = cynical
		add_stress = medium_stress_loss
	}
	option = {
		name = ev7.75.0.f
		trigger = {
			has_trait = lifestyle_mystic
			has_trait = forgiving
			NOT = {
				has_trait = compassionate
			}
		}
		trait = lifestyle_mystic
		trait = forgiving
		custom_tooltip = ev7.75.0.f_ct
		custom_tooltip = ev7.75.0.f_ct2
		hidden_effect = {
			add_character_flag = good_one_magic_flag
		}
		add_stress = minor_stress_loss
	}
	option = {
		name = ev7.75.0.f
		trigger = {
			has_trait = lifestyle_mystic
			has_trait = compassionate
		}
		trait = lifestyle_mystic
		trait = compassionate
		custom_tooltip = ev7.75.0.f_ct
		custom_tooltip = ev7.75.0.f_ct2
		hidden_effect = {
			add_character_flag = good_one_magic_flag
		}
		add_stress = minor_stress_loss
	}
	option = {
		name = ev7.75.0.g
		trigger = {
			has_trait = corrupted
			NOR = {
				has_trait = demon
				has_trait = necromancer
			}
		}
		trait = corrupted
		add_dread = medium_dread_gain
		stress_impact = {
			sadistic = medium_stress_loss
			zealous = minor_stress_loss
		}
	}
	option = {
		name = ev7.75.0.g
		trigger = {
			has_trait = necromancer
			NOT = {
				has_trait = demon
			}
		}
		trait = necromancer
		add_dread = medium_dread_gain
		stress_impact = {
			sadistic = medium_stress_loss
			zealous = minor_stress_loss
		}
	}
	option = {
		name = ev7.75.0.g
		trigger = {
			has_trait = demon
		}
		trait = demon
		add_dread = medium_dread_gain
		stress_impact = {
			sadistic = medium_stress_loss
			zealous = minor_stress_loss
		}
	}
	option = {
		name = ev7.75.0.h
		trigger = {
			has_trait = heresiarch
		}
		trait = heresiarch
		add_diplomacy_skill = 1
		add_prestige = minor_prestige_gain
	}
}

#Mage Summit - begining (4Host)
magic_ev7.76 = {
	type = activity_event
	title = prelude_phase
	desc = ev7.76.desc
	theme = feast_activity
	#override_background = {
	#	reference = bp1_bonfire
	#}
	left_portrait = root

	trigger = {
		is_alive = yes
	}
	immediate = {
		hidden_effect = {
			save_scope_as = aowner
		}
	}

	option = {
		name = ev7.76.a
		stress_impact = {
			shy = medium_stress_gain
			gregarious = minor_stress_loss
			paranoid = medium_stress_gain
			trusting = minor_stress_loss
			lifestyle_reveler = medium_stress_loss
			drunkard = minor_stress_loss
		}
		if = {
			limit = {
				NOT = {
					has_character_modifier = generous_host_fp1_modifier
				}
			}
			add_character_modifier = {
				modifier = generous_host_fp1_modifier
				years = 1
			}
		}
	}
	option = {
		name = ev7.76.b
		stress_impact = {
			deceitful = minor_stress_loss
			paranoid = minor_stress_loss
			schemer = minor_stress_loss
			honest = minor_stress_gain
		}
		if = {
			limit = {
				NOT = {
					has_character_modifier = feast_practiced_secrecy_modifier
				}
			}
			add_character_modifier = {
				modifier = feast_practiced_secrecy_modifier
				years = 1
			}
		}
	}
	option = {
		name = ev7.76.c
		stress_impact = {
			fickle = minor_stress_loss
			lifestyle_reveler = medium_stress_gain
			paranoid = minor_stress_loss
		}
		custom_tooltip = ev7.76.c_ct
		hidden_effect = {
			random_list = {
				1 = {
					trigger_event = magic_ev7.77
				}
				1 = {
					trigger_event = magic_ev7.78
				}
				1 = {

				}
			}
		}
	}
}
#Mage Summit - guest reaction - alchemist (4Host)
magic_ev7.77 = {
	type = activity_event
	title = prelude_phase
	desc = ev7.77.desc
	theme = feast_activity
	#override_background = {
	#	reference = bp1_bonfire
	#}
	left_portrait = root
	right_portrait = scope:mystic0

	trigger = {
		is_alive = yes
	}
	immediate = {
		hidden_effect = {
			create_character = {
				location = root.location
				gender = male
				template = default_mystic_character
				save_scope_as = mystic0
			}

		}
	}

	option = {
		name = ev7.77.a
		stress_impact = {
			shy = minor_stress_gain
		}
		scope:mystic0 = {
			add_to_activity = scope:activity
			add_opinion = {
				target = ROOT
				modifier = grateful_opinion
				opinion = 50
			}
		}
	}
	option = {
		name = ev7.77.b
		stress_impact = {
			arrogant = medium_stress_loss
			generous = minor_stress_gain
		}
		scope:mystic0 = {
			add_opinion = {
				target = ROOT
				modifier = disrespect_opinion
				opinion = -20
			}
		}
	}
	option = {
		name = ev7.77.c
		stress_impact = {
			arrogant = medium_stress_loss
			generous = minor_stress_gain
			wrathful = minor_stress_loss
			irritable = minor_stress_loss
		}
		imprison = {
			target = scope:mystic0
			type = dungeon
		}
		scope:mystic0 = {
			add_opinion = {
				target = ROOT
				modifier = imprisoned_me
				opinion = -50
			}
		}
	}
	option = {
		name = ev7.77.d
		trigger = {
			has_trait = torturer
		}
		trait = torturer
		stress_impact = {
			sadistic = medium_stress_loss
			generous = minor_stress_gain
			wrathful = minor_stress_loss
			irritable = minor_stress_loss
		}
		add_dread = minor_dread_gain
		scope:mystic0 = {
			add_trait = wounded_2
			add_trait = blind
			add_character_modifier = {
				modifier = recently_tortured
			}
			add_opinion = {
				target = ROOT
				modifier = tortured_me
				opinion = -100
			}
		}
		imprison = {
			target = scope:mystic0
			type = dungeon
		}
	}
}
#Mage Summit - guest reaction - witch hunter (4Host)
magic_ev7.78 = {
	type = activity_event
	title = witch_hunter
	desc = ev7.78.desc
	theme = feast_activity
	#override_background = {
	#	reference = bp1_bonfire
	#}
	left_portrait = root
	right_portrait = scope:whunter0

	trigger = {
		is_alive = yes
	}
	immediate = {
		hidden_effect = {
			create_character = {
				location = root.location
				culture = root.culture
				faith = root.faith
				gender = male
				template = witch_hunter_character
				save_scope_as = whunter0
			}
			
		}
		add_prestige = -100
	}

	option = {
		name = ev7.78.a
		imprison = {
			target = scope:whunter0
			type = dungeon
		}
	}
	option = {
		name = ev7.78.b
		trigger = {
			has_trait = archmage
			can_spend_standard_ps_trigger = yes
		}
		trait = archmage
		add_dread = medium_dread_gain
		stress_impact = {
			vengeful = medium_stress_loss
			sadistic = medium_stress_loss
		}
		custom_tooltip = ev7.45.0.d_ct
		spend_standard_ps_effect = yes
		scope:whunter0 = {
			death = {
				death_reason = death_fire
				killer = root
			}
		}
		involved_activity = {
			every_attending_character = {
				limit = {
					NOT = {
						THIS = ROOT
					}
				}
				trigger_event = magic_ev7.79
			}
		}
	}
}

#Mage Summit - guest reaction - witch hunter (4guests)
magic_ev7.79 = {
	type = activity_event
	title = witch_hunter
	desc = ev7.79.desc
	theme = feast_activity
	left_portrait = scope:aowner
	right_portrait = scope:whunter0

	trigger = {
		is_alive = yes
	}
	immediate = {
		show_as_tooltip = {
			scope:whunter0 = {
				death = {
					death_reason = death_fire
					killer = scope:aowner
				}
			}
		}
	}
	
	option = {
		name = ev7.79.a
		stress_impact = {
			sadistic = medium_stress_loss
			compassionate = major_stress_gain
			forgiving = medium_stress_gain
		}
		hidden_effect = {
			add_opinion = {
				target = scope:aowner
				modifier = impressed_opinion
				opinion = 30
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 20
				has_trait = sadistic
			}
			modifier = {
				add = -10
				OR = {
					has_trait = compassionate
					has_trait = forgiving
				}
			}
		}
	}
	option = {
		name = ev7.79.b
		stress_impact = {
			callous = medium_stress_loss
			compassionate = major_stress_gain
			cynical = minor_stress_loss
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 10
				OR = {
					has_trait = callous
					has_trait = cynical
				}
			}
			modifier = {
				add = 5
				OR = {
					has_trait = archmage
					has_trait = demon
					has_trait = corrupted
				}
			}
			modifier = {
				add = -10
				OR = {
					has_trait = compassionate
					has_trait = forgiving
				}
			}
		}
	}
	option = {
		name = ev7.79.c
		stress_impact = {
			sadistic = minor_stress_gain
		}
		hidden_effect = {
			add_opinion = {
				target = scope:aowner
				modifier = disgusted_opinion
				opinion = -20
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 10
				OR = {
					has_trait = compassionate
					has_trait = forgiving
				}
			}
			modifier = {
				add = -10
				OR = {
					has_trait = callous
					has_trait = sadistic
				}
			}
		}
	}
}

#Mage Summit - begining - 4guests
magic_ev7.80 = {
	type = activity_event
	title = prelude_phase
	desc = ev7.76.desc
	theme = feast_activity
	left_portrait = root
	right_portrait = scope:host

	trigger = {
		is_alive = yes
	}
	
	option = {
		name = ev7.80.a
		stress_impact = {
			gregarious = minor_stress_loss
			lifestyle_reveler = minor_stress_loss
			gluttonous = medium_stress_loss
			impatient = minor_stress_loss
			drunkard = minor_stress_loss
			shy = minor_stress_gain
		}
	}
	option = {
		name = ev7.80.b
		stress_impact = {
			arrogant = medium_stress_loss
			humble = minor_stress_gain
		}
	}
	option = {
		name = ev7.80.c
		stress_impact = {
			temperate = minor_stress_loss
			patient = minor_stress_loss
			eccentric = minor_stress_loss
		}
	}
}

#Mage Summit - invitations for mages
magic_ev7.81 = {
	title = mages_summit
	desc = ev7.81.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:host

	trigger = {
		is_alive = yes
		NOT = {
			has_character_modifier = excluded_from_magic_community
		}
	}
	
	option = {
		name = ev7.81.a
	}
}

#Mage Summit - grand rite (4host)
magic_ev7.82 = {
	type = activity_event
	title = ev7.82.title
	desc = ev7.82.desc
	theme = witchcraft
	override_background = {
		reference = bp1_bonfire
	}
	left_portrait = root
	right_portrait = scope:rwitch

	trigger = {
		is_alive = yes
		involved_activity = {
			any_attending_character = {
				is_ai = yes
				NOR = {
					THIS=ROOT
					has_trait = yaga
					has_trait = archmage
				}
				OR = {
					has_trait = true_witch
					has_trait = witch
				}
			}
		}
	}
	immediate = {
		hidden_effect = {
			involved_activity = {
				random_attending_character = {
					limit = {
						is_ai = yes
						NOR = {
							THIS=ROOT
							has_trait = yaga
							has_trait = archmage
						}
						OR = {
							has_trait = true_witch
							has_trait = witch
						}
					}
					save_scope_as = rwitch
				}
			}
		}
	}
	
	option = {
		name = ev7.82.a
		trigger = {
			has_trait = heresiarch
		}
		trait = heresiarch
		stress_impact = {
			zealous = minor_stress_loss
		}
		add_prestige = medium_prestige_gain
		involved_activity = {
			every_attending_character = {
				limit = {
					NOT = {
						THIS=ROOT
					}
					OR = {
						has_trait = true_witch
						has_trait = witch
					}
				}
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 20
				}
			}
		}
	}
	option = {
		name = ev7.82.b
		stress_impact = {
			shy = minor_stress_gain
		}
		involved_activity = {
			every_attending_character = {
				limit = {
					NOT = {
						THIS=ROOT
					}
					OR = {
						has_trait = true_witch
						has_trait = witch
					}
				}
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 5
				}
			}
		}
	}
	option = {
		name = ev7.82.c
		stress_impact = {
			arrogant = medium_stress_loss
			cynical = minor_stress_loss
		}
	}
	option = {
		name = ev7.82.d
		stress_impact = {
			craven = medium_stress_loss
			paranoid = minor_stress_loss
		}
		imprison = {
			target = scope:rwitch
			type = dungeon
		}
		scope:rwitch = {
			add_opinion = {
				target = ROOT
				modifier = imprisoned_me
				opinion = -50
			}
		}
	}
}
#Mage Summit - yaga's story
magic_ev7.83 = {
	type = activity_event
	title = yaga_name
	desc = {
		desc = ev7.83.desc
		desc = ev7.83.desc2
	}
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	center_portrait = scope:guest2
	right_portrait = scope:yaga0

	trigger = {
		is_alive = yes
		exists = scope:activity
		scope:activity = {
			any_attending_character = {
				has_character_flag = yaga_flag
			}
		}
		NOR = {
			has_character_flag = heard_yaga_story
			has_character_flag = yaga_flag
		}
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						has_character_flag = yaga_flag
					}
					save_scope_as = yaga0
				}
				random_attending_character = {
					limit = {
						NOR = {
							has_character_flag = yaga_flag
							THIS=ROOT
						}
					}
					save_scope_as = guest1
				}
				random_attending_character = {
					limit = {
						NOR = {
							has_character_flag = yaga_flag
							THIS=ROOT
							THIS=scope:guest1
						}
					}
					save_scope_as = guest2
				}
			}
		}
	}
	
	option = {
		name = ev7.83.a
		trigger_event = magic_ev7.84
	}
	after = {
		add_character_flag = heard_yaga_story
	}
}

#Mage Summit - yaga's story - part2.
magic_ev7.84 = {
	type = activity_event
	title = yaga_name
	desc = ev7.84.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	center_portrait = scope:guest2
	right_portrait = scope:yaga0

	trigger = {
		is_alive = yes
	}
	immediate = {
		gain_sc_xp1_effect = yes
	}
	option = {
		name = ev7.84.a
		#reason = faith
		stress_impact = {
			lifestyle_mystic = minor_stress_loss
			scholar = minor_stress_loss
		}
	}
	option = {
		name = ev7.84.b
		trigger = {
			has_ms_show_superiority_intent_trigger = yes
		}
		reason = activity_intent
		stress_impact = {
			arrogant = medium_stress_loss
			humble = minor_stress_gain
		}
		duel = {
			skill = diplomacy
			value = 20
			5 = {
				desc = ev7.84.b_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev7.84.b_1
					add_prestige = medium_prestige_gain
				}
			}
			5 = {
				desc = ev7.84.b_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev7.84.b_2
					add_prestige = -100
				}
			}
		}
		#custom_tooltip = available_because_intent_tt
	}
}

#Mage Summit - demon hunter
magic_ev7.85 = {
	type = activity_event
	title = ev7.85.title
	desc = ev7.85.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	right_portrait = scope:demon_hunter
	cooldown = {
		years = 2
	}
	trigger = {
		is_alive = yes
		NOT = {
			has_character_flag = fund_demon_fighting_flag
		}
		scope:activity = {
			any_attending_character = {
				is_ai = yes
				NOR = {
					THIS = ROOT
					has_trait = demon
					has_relation_nemesis = ROOT
					has_relation_rival = ROOT
				}
				OR = {
					any_relation = {
						type = rival
						has_trait = demon
					}
					any_relation = {
						type = nemesis
						has_trait = demon
					}
				}
			}
		}
	}
	immediate = {
		scope:activity = {
			random_attending_character = {
				limit = {
					is_ai = yes
					NOR = {
						THIS = ROOT
						has_trait = demon
						has_relation_nemesis = ROOT
						has_relation_rival = ROOT
					}
					OR = {
						any_relation = {
							type = rival
							has_trait = demon
						}
						any_relation = {
							type = nemesis
							has_trait = demon
						}
					}
				}
				save_scope_as = demon_hunter
			}
		}
	}
	option = {
		name = ev7.85.a
		pay_short_term_gold = {
			target = scope:demon_hunter
			gold = 200
		}
		custom_tooltip = ev7.85.a_ct
		hidden_effect = {
			add_character_flag = fund_demon_fighting_flag
		}
	}
	option = {
		name = ev7.85.d
		trigger = {
			has_ms_show_superiority_intent_trigger = yes
			NOR = {
				has_nickname = archmage_nickname
				has_character_flag = ms_is_archmage_flag
			}
		}
		reason = activity_intent
		pay_short_term_gold = {
			target = scope:demon_hunter
			gold = 300
		}
		add_prestige = medium_prestige_gain
		custom_tooltip = ev7.85.a_ct
		hidden_effect = {
			add_character_flag = fund_demon_fighting_flag
		}
	}
	option = {
		name = ev7.85.d2
		trigger = {
			has_ms_show_superiority_intent_trigger = yes
			OR = {
				has_character_flag = ms_is_archmage_flag
				has_nickname = archmage_nickname
			}
		}
		reason = activity_intent
		pay_short_term_gold = {
			target = scope:demon_hunter
			gold = 300
		}
		add_prestige = medium_prestige_gain
		custom_tooltip = ev7.85.a_ct
		hidden_effect = {
			add_character_flag = fund_demon_fighting_flag
		}
	}
	option = {
		name = ev7.85.e
		trigger = {
			has_ms_political_matters_intent_trigger = yes
		}
		reason = activity_intent
		pay_short_term_gold = {
			target = scope:demon_hunter
			gold = 200
		}
		
		custom_tooltip = ev7.85.a_ct
		hidden_effect = {
			add_character_flag = fund_demon_fighting_flag
		}
		if = {
			limit = {
				NOT = {
					has_hook = scope:demon_hunter
				}
			}
			add_hook = {
				type = favor_hook
				target = scope:demon_hunter
			}
		}
		else_if = {
			limit = {
				scope:demon_hunter = {
					any_secret = {
						NOT = { is_known_by = root }
					}
				}
			}
			scope:demon_hunter = {
				random_secret = {
					limit = {
						NOT = { is_known_by = root }
					}
					reveal_to = root
				}
			}
		}
		else = {
			add_diplomacy_skill = 1
		}
	}
	option = {
		name = ev7.85.b
		trigger = {
			has_trait = scholar
			has_ms_knowledge_sharing_intent_trigger = no
		}
		trait = scholar
		add_stress = minor_stress_loss
		if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = demonology
					value < 100
				}
			}
			gain_demonology_standard_effect = yes
		}
		else_if = {
			limit = {
				has_trait = lifestyle_mystic
				has_trait_xp = {
					trait = lifestyle_mystic
					value < 100
				}
			}
			add_trait_xp = {
				trait = lifestyle_mystic
				value = 20
			}
		}
		else_if = {
			limit = {
				OR = {
					has_focus = witch_focus
					has_focus = arcane_focus
				}
			}
			custom_tooltip = ev2.47.a_ct
			add_magic_lifestyle_perk_points = 1
		}
		else = {
			add_learning_skill = 1
		}
	}
	option = {
		name = ev7.85.b
		trigger = {
			has_ms_knowledge_sharing_intent_trigger = yes
		}
		reason = activity_intent
		stress_impact = {
			scholar = minor_stress_loss
		}
		if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = demonology
					value < 100
				}
			}
			gain_demonology_standard_effect = yes
		}
		else_if = {
			limit = {
				has_trait = lifestyle_mystic
				has_trait_xp = {
					trait = lifestyle_mystic
					value < 100
				}
			}
			add_trait_xp = {
				trait = lifestyle_mystic
				value = 20
			}
		}
		else_if = {
			limit = {
				OR = {
					has_focus = witch_focus
					has_focus = arcane_focus
				}
			}
			custom_tooltip = ev2.47.a_ct
			hidden_effect = {
				add_magic_lifestyle_perk_points = 1
			}
		}
		else = {
			add_learning_skill = 1
		}
	}
	option = {
		name = ev7.85.c
		scope:demon_hunter = {
			add_opinion = {
				target = ROOT
				modifier = refusal_opinion
				opinion = -10
			}
		}
	}
	option = {
		name = ev7.85.f
		trigger = {
			has_trait = demon
		}
		trait = demon
		stress_impact = {
			sadistic = medium_stress_loss
		}
		custom_tooltip = ev7.85.f_ct
		scope:demon_hunter = {
			add_trait = wounded_2
			add_opinion = {
				target = ROOT
				modifier = disrespect_opinion
				opinion = -200
			}
		}
		add_dread = medium_dread_gain
	}
}

#Merlin resurection
magic_ev7.86 = {
	hidden = yes
	immediate = {
		create_merlin_effect = yes
		random_living_character = {
			limit = {
				has_character_flag = merlin_dude
			}
			set_age = scope:merlin_age
			copy_inheritable_appearance_from = scope:old_merlin
		}
		clear_saved_scope = merlin_age
		clear_saved_scope = old_merlin
	}
}

#Mage Summit - potions
magic_ev7.87 = {
	type = activity_event
	title = ev7.87.title
	desc = ev7.87.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	right_portrait = scope:trader0
	cooldown = {
		years = 1
	}
	trigger = {
		is_alive = yes
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						NOR = {
							ROOT = THIS
							has_trait = yaga
							has_relation_rival = root
							has_relation_nemesis = root
							has_trait = archmage
						}
						is_ai = yes
						has_trait = true_witch
						has_trait = lifestyle_herbalist
					}
					save_scope_as = trader0
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:trader0
					}
				}
				save_scope_as = recipient
				create_character = {
					location = root.location
					template = witchy_template2
					save_scope_as = trader0
					after_creation = {
						if = {
							limit = {
								NOT = {
									has_trait = lifestyle_herbalist
								}
							}
							add_trait = lifestyle_herbalist
						}
						add_trait = true_witch
					}
				}
				scope:trader0 = {
					add_to_activity = scope:activity
				}
			}
			random_list = {
				1 = {
					add_character_flag = ms_potions_o1_flag
				}
				1 = {
					add_character_flag = ms_potions_o2_flag
				}
				1 = {
					add_character_flag = ms_potions_o3_flag
				}
			}
		}
	}
	option = {
		name = pot1	#regeneration
		trigger = {
			OR = {
				has_character_flag = ms_potions_o1_flag
				has_character_flag = ms_potions_o2_flag
			}
		}
		pay_short_term_gold = {
			target = scope:trader0
			gold = 500
		}
		hidden_effect = {
			create_artifact = {	
				name = pot1
				description = pot1_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot1
			}
		}
		custom_tooltip = gain_pot1_ct
	}
	option = {
		name = pot3	#mutagen
		trigger = {
			OR = {
				has_character_flag = ms_potions_o2_flag
				has_character_flag = ms_potions_o3_flag
			}
		}
		pay_short_term_gold = {
			target = scope:trader0
			gold = 200
		}
		hidden_effect = {
			create_artifact = {	
				name = pot3
				description = pot3_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot3
			}
		}
		custom_tooltip = gain_pot3_ct
	}
	option = {
		name = pot2	#magic
		trigger = {
			OR = {
				has_character_flag = ms_potions_o1_flag
				has_character_flag = ms_potions_o2_flag
				has_character_flag = ms_potions_o3_flag
			}
		}
		pay_short_term_gold = {
			target = scope:trader0
			gold = 250
		}
		hidden_effect = {
			create_artifact = {	
				name = pot2
				description = pot2_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot2
			}
		}
		custom_tooltip = gain_pot2_ct
	}
	option = {
		name = pot7	#mind reading
		trigger = {
			OR = {
				has_character_flag = ms_potions_o1_flag
				has_character_flag = ms_potions_o3_flag
			}
		}
		pay_short_term_gold = {
			target = scope:trader0
			gold = 250
		}
		hidden_effect = {
			create_artifact = {	
				name = pot7
				description = pot7_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot7
			}
		}
		custom_tooltip = gain_pot7_ct
	}
	option = {
		name = ev7.87.a	#scrolls 1
		trigger = {
			has_character_flag = ms_potions_o1_flag
		}
		pay_short_term_gold = {
			target = scope:trader0
			gold = 200
		}
		if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = demonology
					value < 100
				}
			}
			gain_demonology_standard_effect = yes
		}
		else_if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = combat_magic
					value < 100
				}
			}
			gain_cm_xp5_effect = yes
		}
		else_if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
			}
			gain_sc_xp1_effect = yes
		}
		else_if = {
			limit = {
				OR = {
					has_focus = witch_focus
					has_focus = arcane_focus
				}
			}
			custom_tooltip = ev2.47.a_ct
			hidden_effect = {
				add_magic_lifestyle_perk_points = 1
			}
		}
		else_if = {
			limit = {
				has_trait = lifestyle_mystic
				has_trait_xp = {
					trait = lifestyle_mystic
					value < 100
				}
			}
			add_trait_xp = {
				trait = lifestyle_mystic
				value = 25
			}
		}
		else = {
			add_learning_skill = 1
		}
		stress_impact = {
			scholar = minor_stress_loss
			lifestyle_mystic = minor_stress_loss
		}
	}
	option = {
		name = ev7.87.a	#scrolls 2
		trigger = {
			has_character_flag = ms_potions_o2_flag
		}
		pay_short_term_gold = {
			target = scope:trader0
			gold = 200
		}
		
		if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = combat_magic
					value < 100
				}
			}
			gain_cm_xp5_effect = yes
		}
		else_if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = demonology
					value < 100
				}
			}
			gain_demonology_standard_effect = yes
		}
		else_if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
			}
			gain_sc_xp1_effect = yes
		}
		else_if = {
			limit = {
				OR = {
					has_focus = witch_focus
					has_focus = arcane_focus
				}
			}
			custom_tooltip = ev2.47.a_ct
			hidden_effect = {
				add_magic_lifestyle_perk_points = 1
			}
		}
		else_if = {
			limit = {
				has_trait = lifestyle_mystic
				has_trait_xp = {
					trait = lifestyle_mystic
					value < 100
				}
			}
			add_trait_xp = {
				trait = lifestyle_mystic
				value = 25
			}
		}
		else = {
			add_learning_skill = 1
		}
		stress_impact = {
			scholar = minor_stress_loss
			lifestyle_mystic = minor_stress_loss
		}
	}
	option = {
		name = ev7.87.a	#scrolls 3
		trigger = {
			has_character_flag = ms_potions_o3_flag
		}
		pay_short_term_gold = {
			target = scope:trader0
			gold = 200
		}
		if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
			}
			gain_sc_xp1_effect = yes
		}
		else_if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = combat_magic
					value < 100
				}
			}
			gain_cm_xp5_effect = yes
		}
		else_if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = demonology
					value < 100
				}
			}
			gain_demonology_standard_effect = yes
		}
		else_if = {
			limit = {
				OR = {
					has_focus = witch_focus
					has_focus = arcane_focus
				}
			}
			custom_tooltip = ev2.47.a_ct
			hidden_effect = {
				add_magic_lifestyle_perk_points = 1
			}
		}
		else_if = {
			limit = {
				has_trait = lifestyle_mystic
				has_trait_xp = {
					trait = lifestyle_mystic
					value < 100
				}
			}
			add_trait_xp = {
				trait = lifestyle_mystic
				value = 25
			}
		}
		else = {
			add_learning_skill = 1
		}
		stress_impact = {
			scholar = minor_stress_loss
			lifestyle_mystic = minor_stress_loss
		}
	}
	option = {
		name = ev7.87.b	#no thanks
		stress_impact = {
			greedy = minor_stress_loss
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = ms_potions_o1_flag
				}
				remove_character_flag = ms_potions_o1_flag
			}
			if = {
				limit = {
					has_character_flag = ms_potions_o2_flag
				}
				remove_character_flag = ms_potions_o2_flag
			}
			if = {
				limit = {
					has_character_flag = ms_potions_o3_flag
				}
				remove_character_flag = ms_potions_o3_flag
			}
		}
	}
}


#Mage Summit - sexy
magic_ev7.88 = {
	type = activity_event
	title = ev7.88.title
	desc = ev7.88.desc
	theme = witchcraft
	override_background = {
		reference = corridor_night
	}
	left_portrait = {
		character = scope:witch1
		animation = flirtation_left
	}
	center_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:witch2
		animation = flirtation
	}
	cooldown = {
		years = 1
	}
	trigger = {
		is_alive = yes
		has_trait = archmage
		is_male = yes
		is_attracted_to_women = yes
	}
	immediate = {
		hidden_effect = {
			save_scope_as = recipient	#just for the witchy template, it took culture/faith from "recipient"
			scope:activity = {
				random_attending_character = {
					limit = {
						NOR = {
							ROOT = THIS
							has_trait = yaga
							has_relation_rival = root
							has_relation_nemesis = root
							has_trait = archmage
							has_trait = true_witch
						}
						is_ai = yes
						OR = {
							has_trait = witch
							any_secret = { secret_type = secret_witch }
						}
						age < 25
						OR = {
							NOT = { exists = house }
							ROOT = {
								NOT = { exists = house }
							}
							NOT = {
								house = root.house
							}
						}
					}
					save_scope_as = witch1
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:witch1
					}
				}
				create_character = {
					location = root.location
					gender = female
					template = witchy_template2
					save_scope_as = witch1
				}
				scope:witch1 = {
					if = {
						limit = {
							NOR = {
								has_trait = witch
								any_secret = { secret_type = secret_witch }
							}
						}
						add_trait = witch
					}
					add_to_activity = scope:activity
				}
			}
			create_character = {
				location = root.location
				gender = female
				template = witchy_template2
				save_scope_as = witch2
			}
			scope:witch2 = {
				if = {
					limit = {
						NOR = {
							has_trait = witch
							any_secret = { secret_type = secret_witch }
						}
					}
					add_trait = witch
				}
				add_to_activity = scope:activity
			}
		}
	}
	option = {
		name = ev7.88.a
		trigger = {
			is_landed_or_landless_administrative = yes
		}
		add_courtier = scope:witch2
		scope:witch2 = {
			add_opinion = {
				target = root
				modifier = admiration_opinion
				opinion = 200
			}
		}
		progress_towards_lover_effect = {
			CHARACTER = scope:witch2
			REASON = lover_feast_crush
			OPINION = 0
		}
	}
	option = {
		name = ev7.88.b
		if = {
			limit = {
				OR = {
					has_trait = lustful
					has_trait = rakish
					has_trait = chaste
				}
			}
			stress_impact = {
				lustful = major_stress_loss
				rakish = medium_stress_loss
				chaste = major_stress_gain
			}
		}
		else = {
			add_stress = minor_stress_loss
		}
		had_sex_with_effect = {
			CHARACTER = scope:witch1
			PREGNANCY_CHANCE = seduce_pregnancy_chance
		}
		had_sex_with_effect = {
			CHARACTER = scope:witch2
			PREGNANCY_CHANCE = seduce_pregnancy_chance
		}
		hidden_effect = {
			scope:witch1 = {
				add_opinion = {
					target = root
					modifier = admiration_opinion
					opinion = 100
				}
			}
			scope:witch2 = {
				add_opinion = {
					target = root
					modifier = admiration_opinion
					opinion = 100
				}
			}
		}
	}
	option = {
		name = ev7.88.c
		if = {
			limit = {
				NOT = {
					has_hook = scope:witch1
				}
			}
			add_hook = {
				type = favor_hook
				target = scope:witch1
			}
		}
		if = {
			limit = {
				NOT = {
					has_hook = scope:witch2
				}
			}
			add_hook = {
				type = favor_hook
				target = scope:witch2
			}
		}
	}
	option = {
		name = ev7.88.d
		add_prestige = minor_prestige_gain
		stress_impact = {
			arrogant = minor_stress_loss
		}
		scope:witch1 = {
			add_opinion = {
				target = root
				modifier = disrespect_opinion
				opinion = -50
			}
		}
		scope:witch2 = {
			add_opinion = {
				target = root
				modifier = disrespect_opinion
				opinion = -50
			}
		}
	}
}

#Mage Summit - perk
magic_ev7.89 = {
	type = activity_event
	title = ev7.89.title
	desc = ev7.89.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}

	left_portrait = {
		character = root
		animation = scheme
	}
	cooldown = {
		years = 1
	}
	trigger = {
		is_alive = yes
		has_ms_knowledge_sharing_intent_trigger = yes
		OR = {
			has_focus = witch_focus
			has_focus = arcane_focus
		}
	}
	
	option = {
		name = ev7.89.a
		custom_tooltip = ev2.47.a_ct
		hidden_effect = {
			add_magic_lifestyle_perk_points = 1
		}
	}
}

#Mage Summit - teacher
#(I unnecessarily used actor/recipient scopes, but I don't want to correct...)
magic_ev7.90 = {
	type = activity_event
	title = intrigue_scheming.2001.t	#The Teacher
	desc = ev7.90.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}

	left_portrait = root
	lower_right_portrait = scope:actor

	cooldown = {
		years = 3
	}
	trigger = {
		is_alive = yes
		OR = {
			has_trait = witch
			any_secret = { secret_type = secret_witch }
		}
		has_ms_knowledge_sharing_intent_trigger = yes
		NOR = {
			has_trait = archmage
			has_trait = demon
		}
		can_unlock_arcane_focus_trigger = no
		scope:activity = {
			any_attending_character = {
				NOR = {
					ROOT = THIS
					has_character_flag = has_event_sorcery_training_flag
					has_relation_rival = root
					has_relation_nemesis = root
				}
				has_trait = archmage
			}
		}
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						NOR = {
							ROOT = THIS
							has_character_flag = has_event_sorcery_training_flag
							has_relation_rival = root
							has_relation_nemesis = root
						}
						has_trait = archmage
					}
					save_scope_as = actor
				}
			}
			save_scope_as = recipient
		}
	}
	
	option = {
		name = ev7.90.a
		stress_impact = {
			greedy = medium_stress_gain
		}
		show_as_tooltip = {
			pay_short_term_gold = {
				target = scope:actor
				gold = 200
			}
		}
		hidden_effect = {
			add_character_flag = ms_offer_small_payment
		}
		custom_tooltip = ev7.90.a_ct
		hidden_effect = {
			scope:actor = {
				trigger_event = {
					id = magic_ev7.91
					days = 1
				}
			}
		}
	}
	option = {
		name = ev7.90.b
		trigger = {
			gold > 400
		}
		stress_impact = {
			greedy = major_stress_gain
			generous = minor_stress_loss
		}
		show_as_tooltip = {
			pay_short_term_gold = {
				target = scope:actor
				gold = 400
			}
		}
		hidden_effect = {
			add_character_flag = ms_offer_medium_payment
		}
		custom_tooltip = ev7.90.a_ct
		hidden_effect = {
			scope:actor = {
				trigger_event = {
					id = magic_ev7.91
					days = 1
				}
			}
		}
	}
	option = {
		trigger = {
			gold > 700
		}
		name = ev7.90.c
		stress_impact = {
			greedy = massive_stress_gain
			generous = medium_stress_loss
		}
		show_as_tooltip = {
			pay_short_term_gold = {
				target = scope:actor
				gold = 700
			}
		}
		hidden_effect = {
			add_character_flag = ms_offer_huge_payment
		}
		custom_tooltip = ev7.90.a_ct
		hidden_effect = {
			scope:actor = {
				trigger_event = {
					id = magic_ev7.91
					days = 1
				}
			}
		}
	}

	option = {
		name = tour_general.1001.f	#bad idea
	}
}

#Mage Summit - teacher - response
magic_ev7.91 = {
	type = activity_event
	title = intrigue_scheming.2001.t	#The Teacher
	desc = ev7.91.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}

	left_portrait = root
	right_portrait = {
		character = scope:recipient
		animation = beg
	}
	trigger = {
		NOT = {
			has_character_flag = has_event_sorcery_training_flag
		}
	}
	
	
	option = {
		name = ev7.91.a
		custom_tooltip = ev7.91.a_ct
		save_scope_as = mteacher
		scope:recipient = {
			add_opinion = {
				target = root
				modifier = grateful_opinion
				opinion = 50
			}
			save_scope_as = disciple
			if = {
				limit = {
					has_character_flag = ms_offer_small_payment
				}
				pay_short_term_gold = {
					target = root
					gold = 200
				}
				hidden_effect = {
					send_interface_toast = {
						title = ev7.91.a_ct2
						left_icon = scope:recipient
						right_icon = scope:actor
						show_as_tooltip = {
							pay_short_term_gold = {
								target = root
								gold = 200
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					has_character_flag = ms_offer_medium_payment
				}
				pay_short_term_gold = {
					target = root
					gold = 400
				}
				hidden_effect = {
					send_interface_toast = {
						title = ev7.91.a_ct2
						left_icon = scope:recipient
						right_icon = scope:actor
						show_as_tooltip = {
							pay_short_term_gold = {
								target = root
								gold = 400
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					has_character_flag = ms_offer_huge_payment
				}
				pay_short_term_gold = {
					target = root
					gold = 700
				}
				hidden_effect = {
					send_interface_toast = {
						title = ev7.91.a_ct2
						left_icon = scope:recipient
						right_icon = scope:actor
						show_as_tooltip = {
							pay_short_term_gold = {
								target = root
								gold = 700
							}
						}
					}
				}
			}
		}
		hidden_effect = {
			trigger_event = {
				id = magic_ev3.13
				days = { 31 62 }
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 40
				scope:recipient = {
					has_character_flag = ms_offer_medium_payment
				}
			}
			modifier = {
				add = 150
				scope:recipient = {
					has_character_flag = ms_offer_huge_payment
				}
			}
			modifier = {
				add = 40
				has_trait = greedy
			}
			modifier = {
				add = -100
				has_trait = paranoid
			}
		}
	}
	option = {
		name = ev7.91.b
		scope:recipient = {
			add_opinion = {
				target = root
				modifier = refusal_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev7.91.a_ct3
					left_icon = scope:recipient
					right_icon = scope:actor
				}
			}
		}
		ai_chance = {
			base = 50
		}
	}
	option = {
		name = ev7.91.c
		scope:recipient = {
			add_opinion = {
				target = root
				modifier = angry_opinion
				opinion = -50
			}
			add_prestige = -100
			hidden_effect = {
				send_interface_toast = {
					title = ev7.91.a_ct3
					left_icon = scope:recipient
					right_icon = scope:actor
					add_stress = minor_stress_gain
				}
			}
		}
		ai_chance = {
			base = 50
		}
	}

	after = {
		hidden_effect = {
			add_character_flag = {
				flag = has_event_sorcery_training_flag
				years = 2
			}
			scope:recipient = {
				if = {
					limit = {
						has_character_flag = ms_offer_small_payment
					}
					remove_character_flag = ms_offer_small_payment
				}
				if = {
					limit = {
						has_character_flag = ms_offer_medium_payment
					}
					remove_character_flag = ms_offer_medium_payment
				}
				if = {
					limit = {
						has_character_flag = ms_offer_huge_payment
					}
					remove_character_flag = ms_offer_huge_payment
				}
			}
		}
	}
}

#Mage Summit - debate
magic_ev7.92 = {
	type = activity_event
	title = sharing_knowledge_intent
	desc = ev7.92.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}

	left_portrait = root
	center_portrait = scope:mage1
	right_portrait = {
		character = scope:mage2
		animation = toast
	}
	trigger = {
		is_alive = yes
		has_ms_knowledge_sharing_intent_trigger = yes
		scope:activity = {
			any_attending_character = {
				OR = {
					has_trait = archmage
					has_trait = true_witch
				}
				NOT = {
					THIS = ROOT
				}
				count > 1
			}
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						OR = {
							has_trait = archmage
							has_trait = true_witch
						}
						NOT = {
							THIS = ROOT
						}
					}
					save_scope_as = mage1
				}
				random_attending_character = {
					limit = {
						OR = {
							has_trait = archmage
							has_trait = true_witch
						}
						NOR = {
							THIS = ROOT
							THIS = scope:mage1
						}
					}
					save_scope_as = mage2
				}
			}
		}
	}
	
	option = {
		name = ev7.92.a
		if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
			}
			gain_sc_xp2_effect = yes
		}
		else_if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = demonology
					value < 100
				}
			}
			gain_demonology_standard_effect = yes
		}
		else_if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = combat_magic
					value < 100
				}
			}
			gain_cm_xp5_effect = yes
		}
		else_if = {
			limit = {
				OR = {
					has_focus = witch_focus
					has_focus = arcane_focus
				}
			}
			custom_tooltip = ev2.47.a_ct
			hidden_effect = {
				add_magic_lifestyle_perk_points = 1
			}
		}
		else_if = {
			limit = {
				has_trait = lifestyle_mystic
				has_trait_xp = {
					trait = lifestyle_mystic
					value < 100
				}
			}
			add_trait_xp = {
				trait = lifestyle_mystic
				value = 25
			}
		}
		else = {
			add_learning_skill = 1
		}
		if = {
			limit = {
				has_trait = archmage
				OR = {
					has_trait_xp = {
						trait = archmage
						track = secret_knowledge
						value > 24
					}
					has_trait = scholar
				}
				me_may_unlocks_special_project = yes
			}
			random = {
				chance = 10
				custom_tooltip = ev3.22.a3_ct
				hidden_effect = {
					me_unlock_new_special_project_effect2 = yes
				}
			}
		}
	}
	option = {
		name = ev7.92.b
		if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
				me_may_unlocks_special_project = no
			}
			gain_sc_xp1_effect = yes
		}
		
		random_list = {
			1 = {
				add_stewardship_skill = 2
			}
			1 = {
				add_intrigue_skill = 2
			}
		}
	}
}
#Mage Summit - small talk/chat
magic_ev7.93 = {
	type = activity_event
	title = ev7.93.title
	desc = ev7.93.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}

	left_portrait = root
	right_portrait = {
		character = scope:guest0
		animation = toast
	}
	trigger = {
		is_alive = yes
		has_ms_political_matters_intent_trigger = yes
		scope:activity = {
			any_attending_character = {
				is_ai = yes
				OR = {
					has_trait = archmage
					has_trait = true_witch
				}
				NOR = {
					THIS = ROOT
					has_relation_nemesis = ROOT
					has_relation_rival = ROOT
					has_relation_friend = ROOT
					has_relation_mminion = ROOT
					has_relation_mmaster = ROOT
				}
				is_landed_or_landless_administrative = yes
			}
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						is_ai = yes
						OR = {
							has_trait = archmage
							has_trait = true_witch
						}
						NOR = {
							THIS = ROOT
							has_relation_nemesis = ROOT
							has_relation_rival = ROOT
							has_relation_friend = ROOT
							has_relation_mminion = ROOT
							has_relation_mmaster = ROOT
						}
						is_landed_or_landless_administrative = yes
					}
					save_scope_as = guest0
				}
			}
		}
	}
	
	option = {
		name = ev7.93.a
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 50
			}
		}
		progress_towards_friend_effect = {
			REASON = friend_had_a_great_feast_together
			CHARACTER = scope:guest0
			OPINION = 0
		}
	}
	option = {
		name = ev7.93.b
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 50
			}
			if = {
				limit = {
					NOT = {
						has_hook = root
					}
				}
				add_hook = {
					type = obligation_hook
					target = ROOT
				}
			}
			else = {
				add_diplomacy_skill = 1
			}
		}
		if = {
			limit = {
				NOT = {
					has_hook = scope:guest0
				}
			}
			add_hook = {
				type = obligation_hook
				target = scope:guest0
			}
		}
		else = {
			add_diplomacy_skill = 1
		}
	}
	option = {
		name = ev7.93.c
		trigger = {
			NOT = {
				has_hook = scope:guest0
			}
		}
		duel = {
			skill = diplomacy
			value = scope:guest0.diplomacy
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					add_hook = {
						type = obligation_hook
						target = scope:guest0
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					scope:guest0 = {
						add_opinion = {
							target = ROOT
							modifier = disgusted_opinion
							opinion = -30
						}
					}
				}
			}
		}
	}
}

#Mage Summit - intro to mage council/prelude
magic_ev7.94 = {
	type = activity_event
	title = ev7.94.title
	desc = ev7.94.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	lower_right_portrait = {
		trigger = {
			exists = scope:guest0
		}
		character = scope:guest0
	}
	trigger = {
		is_alive = yes
		has_ms_political_matters_intent_trigger = yes
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						OR = {
							has_trait = archmage
							has_trait = true_witch
						}
						NOR = {
							THIS = ROOT
							has_relation_nemesis = ROOT
							has_relation_rival = ROOT
							has_relation_friend = ROOT
							has_relation_mminion = ROOT
							has_relation_mmaster = ROOT
						}
						is_landed_or_landless_administrative = yes
					}
					save_scope_as = guest0
				}
			}
		}
	}
	
	option = {
		name = ev7.94.a
		add_prestige = minor_prestige_gain
		scope:activity = {
			every_attending_character = {
				limit = {
					has_trait = true_witch
					NOR = {
						THIS = ROOT
						has_trait = archmage
					}
				}
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 5
				}
			}
		}
	}
	option = {
		name = ev7.94.b
		trigger = {
			NOT = {
				has_character_modifier = gathered_supporters
			}
		}
		add_character_modifier = {
			modifier = gathered_supporters
			years = 1
		}
	}
	option = {
		name = ev7.94.c
		trigger = {
			has_trait = deceitful
		}
		trait = deceitful
		add_stress = medium_stress_loss
	}
	option = {
		name = ev7.94.d
		trigger = {
			exists = scope:guest0
		}
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 20
			}
		}
	}
}

#Mage Summit - political debate
magic_ev7.95 = {
	type = activity_event
	title = ev7.95.title
	desc = ev7.95.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	center_portrait = scope:mage1
	right_portrait = {
		character = scope:mage2
		animation = scheme
	}
	trigger = {
		is_alive = yes
		OR = {
			has_ms_political_matters_intent_trigger = yes
			has_ms_show_superiority_intent_trigger = yes
		}
		
		scope:activity = {
			any_attending_character = {
				has_trait = archmage
				NOT = {
					THIS = ROOT
				}
				count > 1
			}
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						has_trait = archmage
						NOT = {
							THIS = ROOT
						}
					}
					save_scope_as = mage1
				}
				random_attending_character = {
					limit = {
						OR = {
							has_trait = archmage
							has_trait = true_witch
						}
						NOR = {
							THIS = ROOT
							THIS = scope:mage1
						}
					}
					save_scope_as = mage2
				}
			}
		}
	}
	
	option = {
		name = ev7.95.a
		scope:mage1 = {
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 30
			}
		}
		scope:mage2 = {
			add_opinion = {
				target = ROOT
				modifier = disrespect_opinion
				opinion = -30
			}
		}
	}
	option = {
		name = ev7.95.c
		trigger = {
			has_ms_show_superiority_intent_trigger = yes
		}
		reason = activity_intent
		duel = {
			skill = diplomacy
			value = 20
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				add_prestige = medium_prestige_gain
				send_interface_toast = {
					title=ev3.52.a_1
					scope:mage1 = {
						add_opinion = {
							target = ROOT
							modifier = respect_opinion
							opinion = 20
						}
					}
					scope:mage2 = {
						add_opinion = {
							target = ROOT
							modifier = respect_opinion
							opinion = 20
						}
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					scope:mage1 = {
						add_opinion = {
							target = ROOT
							modifier = disrespect_opinion
							opinion = -20
						}
					}
					scope:mage2 = {
						add_opinion = {
							target = ROOT
							modifier = disrespect_opinion
							opinion = -20
						}
					}
				}
			}
		}
	}
	option = {
		name = ev7.95.d
		trigger = {
			has_ms_political_matters_intent_trigger = yes
			OR = {
				scope:mage1 = {
					is_ai = yes
				}
				scope:mage2 = {
					is_ai = yes
				}
			}
		}
		reason = activity_intent
		random = {
			chance = 50
			if = {
				limit = {
					scope:mage2 = {
						is_ai = yes
					}
				}
				if = {
					limit = {
						NOT = {
							has_hook = scope:mage2
						}
					}
					add_hook = {
						type = manipulation_hook
						target = scope:mage2
					}
				}
				else = {
					send_interface_toast = {
						title=ev3.52.a_1
						scope:mage2 = {
							add_opinion = {
								target = ROOT
								modifier = respect_opinion
								opinion = 30
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:mage1 = {
						is_ai = yes
					}
				}
				if = {
					limit = {
						NOT = {
							has_hook = scope:mage1
						}
					}
					add_hook = {
						type = manipulation_hook
						target = scope:mage1
					}
				}
				else = {
					send_interface_toast = {
						title=ev3.52.a_1
						scope:mage1 = {
							add_opinion = {
								target = ROOT
								modifier = respect_opinion
								opinion = 30
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = ev7.95.e
		trigger = {
			has_trait = diplomat
		}
		trait = diplomat
		scope:mage1 = {
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 15
			}
		}
		scope:mage2 = {
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 15
			}
		}
	}
	option = {
		name = ev7.95.b
		
	}
}

#Mage Summit - skill demonstration
magic_ev7.96 = {
	type = activity_event
	title = ev7.96.title
	desc = ev7.96.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root

	trigger = {
		is_alive = yes
		has_ms_show_superiority_intent_trigger = yes
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						is_ai = yes
						NOR = {
							has_trait = archmage
							has_trait = true_witch
							THIS = ROOT
						}
					}
					save_scope_as = vict0
				}
			}
			random_character_artifact = {
				limit = {
					has_variable = magic1
				}
				save_scope_as = mart0
			}
		}
		
	}
	
	option = {
		name = ev7.96.a
		trigger = {
			can_spend_standard_ps_trigger = yes
			has_trait = archmage
		}
		trait = archmage
		spend_standard_ps_effect = yes
		add_prestige = major_prestige_gain
		add_dread = minor_dread_gain
		if = {
			limit = {
				exists = scope:vict0
			}
			random = {
				chance = 1
				scope:vict0 = {
					death = {
						death_reason = death_fire
						killer = root
					}
				}
			}
		}
	}
	option = {
		name = ev7.96.b
		trigger = {
			any_character_artifact = {
				has_variable = magic1
			}
		}
		add_prestige = medium_prestige_gain
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						NOR = {
							THIS = ROOT
							has_personal_artifact_claim = scope:mart0
						}
					}
					add_personal_artifact_claim = scope:mart0
				}
			}
		}
	}
	option = {
		name = ev7.96.c
		random = {
			chance = 50
			add_prestige = minor_prestige_gain
		}
	}
	option = {
		name = ev7.96.d
		trigger = {
			has_trait = necromancer
		}
		trait = necromancer
		add_prestige = medium_prestige_gain
		add_dread = medium_dread_gain
		
	}
	option = {
		name = ev7.96.f
		trigger = {
			has_trait = demon
		}
		trait = demon
		add_prestige = major_prestige_gain
		add_dread = medium_dread_gain
		
	}
	option = {
		name = ev7.96.e
	}
}

#Mage Summit - mage duel?
magic_ev7.97 = {
	type = activity_event
	title = mage_duel
	desc = ev7.97.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_right_portrait = scope:mage0

	trigger = {
		is_alive = yes
		has_ms_show_superiority_intent_trigger = yes
		scope:activity = {
			any_attending_character = {
				NOT = {
					THIS = ROOT
				}
				OR = {
					has_perk = healer_p9_perk
					has_trait = archmage
				}
			}
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			save_scope_as = challenger
			scope:activity = {
				random_attending_character = {
					limit = {
						OR = {
							has_perk = healer_p9_perk
							has_trait = archmage
						}
						OR = {
							has_relation_rival = ROOT
							has_relation_nemesis = ROOT
						}
						NOT = {
							ROOT = THIS
						}
					}
					save_scope_as = mage0
				}
				if = {
					limit = {
						NOT = {
							exists = scope:mage0
						}
					}
					random_attending_character = {
						limit = {
							OR = {
								has_perk = healer_p9_perk
								has_trait = archmage
							}
							NOR = {
								ROOT = THIS
							}
						}
						save_scope_as = mage0
					}
				}
			}
		}
	}
	
	option = {
		name = ev7.97.a
		custom_tooltip = ev7.97.a_ct
		stress_impact = {
			craven = major_stress_gain
			brave = medium_stress_loss
		}
		hidden_effect = {
			scope:mage0 = {
				trigger_event = {
					id = magic_ev7.98
					days = 1
				}
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 50
				OR = {
					has_relation_nemesis = scope:mage0
					has_relation_rival = scope:mage0
					has_trait = sadistic
				}
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = power_saturation
					value > 50
				}
			}
			modifier = {
				add = 10
				has_trait = brave
			}
		}
	}
	option = {
		name = ev7.97.b
		stress_impact = {
			brave = minor_stress_gain
			arrogant = minor_stress_loss
		}
		scope:mage0 = {
			send_interface_toast = {
				title = insult_opinion	#insulted
				add_stress = minor_stress_gain
				left_icon = scope:mage0
				right_icon = root
			}
			
			add_opinion = {
				target = ROOT
				modifier = disrespect_opinion
				opinion = -50
			}
		}
		hidden_effect = {
			random = {
				chance = 50
				if = {
					limit = {
						NOR = {
							has_relation_nemesis = scope:mage0
							has_relation_rival = scope:mage0
						}
					}
					set_relation_rival = scope:mage0
				}
			}
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 50
				OR = {
					has_relation_nemesis = scope:mage0
					has_relation_rival = scope:mage0
				}
			}
			modifier = {
				add = 30
				has_trait = arrogant
			}
		}
	}
	option = {
		name = tournament_events.6000.e	#It's too risky
		if = {
			limit = {
				NOR = {
					has_trait = brave
					has_trait = craven
				}
			}
			add_stress = minor_stress_loss
		}
		else = {
			stress_impact = {
				craven = medium_stress_loss
				brave = medium_stress_gain
			}
		}
		ai_chance = {
			base = 50
			modifier = {
				add = 50
				has_trait = craven
			}
			modifier = {
				add = 50
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = power_saturation
					value < 50
				}
			}
		}
	}
}

#Mage Summit - mage duel - response
magic_ev7.98 = {
	type = activity_event
	title = mage_duel
	desc = ev7.98.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:challenger
		animation = personality_bold
	}

	
	option = {
		name = ev4.36.0.a
		custom_tooltip = start_duel_ct
		configure_start_mage_duel_effect = {
			MD_ATTACKER = scope:challenger
			MD_DEFENDER = root
		}
		ai_chance = {
			base = 50
			modifier = {
				add = 20
				has_trait = brave
			}
			modifier = {
				add = 50
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = power_saturation
					value > 50
				}
				scope:challenger = {
					has_trait = archmage
					has_trait_xp = {
						trait = archmage
						track = power_saturation
						value < 50
					}
				}
			}
			modifier = {
				add = 50
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = power_saturation
					value > 99
				}
				scope:challenger = {
					has_trait = archmage
					has_trait_xp = {
						trait = archmage
						track = power_saturation
						value < 100
					}
				}
			}
		}
	}
	option = {
		name = ev7.98.a
		custom_tooltip = ev7.40.0.b_ct
		add_prestige_level = -1
		hidden_effect = {
			scope:challenger = {
				send_interface_toast = {
					title = ev7.91.a_ct3
					add_prestige = minor_prestige_gain
					show_as_tooltip = {
						root = {
							add_prestige_level = -1
						}
					}
				}
			}
		}
		ai_chance = {
			base = 50
			modifier = {
				add = 100
				has_trait = craven
			}
			modifier = {
				add = 50
				has_trait = forgiving
			}
			modifier = {
				add = 50
				has_trait = compassionate
			}
		}
	}
}

#Mage Summit - summon demon
magic_ev7.99 = {
	type = activity_event
	title = summoner_p8_perk
	desc = ev7.99.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:guestX
		animation = personality_rational
	}

	trigger = {
		is_alive = yes
		has_ms_show_superiority_intent_trigger = yes
		NOT = {
			has_trait = demon
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						NOR = {
							ROOT = THIS
							has_trait = demon
						}
					}
					save_scope_as = guestX
				}
			}
		}
	}
	
	option = {
		name = ev7.99.a
		trigger = {
			has_perk = summoner_p8_perk
			can_spend_standard_ps_trigger = yes
		}
		spend_standard_ps_effect = yes
		duel = {
			skill = learning
			value = 20
			5 = {
				desc = ev7.99.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				add_prestige = major_prestige_gain
				scope:guestX = {
					add_opinion = {
						target = ROOT
						modifier = respect_opinion
						opinion = 50
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				custom_tooltip = ev7.99.a_ct
				hidden_effect = {
					create_character = {
						location = root.location
						culture = root.culture
						faith = root.faith
						gender_female_chance = 30
						template = generic_demon_character
						save_scope_as = demon
						after_creation = {
							set_sexuality = bisexual
							give_witch_secret_or_trait_effect = yes
							add_trait_xp = {
								trait = demon
								value = { 20 40 }
							}
						}
					}
					scope:demon = {
						add_to_activity = scope:activity
					}
					configure_start_mage_duel_effect = {
						MD_ATTACKER = root
						MD_DEFENDER = scope:demon
					}
				}
			}
		}
	}
	option = {
		name = ev7.99.b
		add_stress = minor_stress_loss
		scope:guestX = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 10
			}
		}
	}
}

#Mage Summit - Mammon (only 4 host)
magic_ev7.100 = {
	type = activity_event
	title = mammon_name
	desc = ev7.100.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:demon
		animation = personality_bold
	}

	trigger = {
		is_alive = yes
		has_character_flag = ms_met_mammon
		any_living_character = {
			has_character_flag = mammon
			count = 0
		}
	}
	cooldown = {
		years = 100
	}
	immediate = {
		hidden_effect = {
			create_character = {
				name = mammon_name
				gender = male
				location = root.location
				faith =root.faith
				culture = root.culture
				template = mammon_demon_character
				save_scope_as = demon
				after_creation = {
					set_sexuality = bisexual
					add_character_flag = mammon
					give_witch_secret_or_trait_effect = yes
					add_trait_xp = {
						trait = demon
						value = 65
					}
				}
			}
		}
	}
	
	option = {
		name = ev7.100.a
		scope:demon = {
			add_to_activity = scope:activity
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev7.100.b
		custom_tooltip = start_duel_ct
		configure_start_mage_duel_effect = {
			MD_ATTACKER = root
			MD_DEFENDER = scope:demon
		}
		hidden_effect = {
			scope:demon = {
				add_to_activity = scope:activity
			}
		}
		ai_chance = {
			base = 1
		}
	}
}

#Mage Summit - do you want to be a speaker?
magic_ev7.101 = {
	type = activity_event
	title = meeting_phase
	desc = ev7.101.desc
	theme = witchcraft
	override_background = {
		reference = throne_room_east
	}
	
	left_portrait = {
		character = root
		animation = personality_rational
	}

	trigger = {
		is_alive = yes
	}
	
	
	option = {
		name = ev7.101.a
		trigger = {
			has_variable = speaker1
		}
		stress_impact = {
			humble = minor_stress_gain
			ambitious = medium_stress_loss
		}
		duel = {
			skill = diplomacy
			value = 18
			3 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				custom_tooltip = ev7.101.a_ct1
				hidden_effect = {
					random_list = {
						1 = {
							change_variable = {
								name = speaker1
								add = 5
							}
						}
						1 = {
							change_variable = {
								name = speaker1
								add = 4
							}
						}
					}
				}
			}
			3 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				custom_tooltip = ev7.101.a_ct2
				hidden_effect = {
					random_list = {
						1 = {
							change_variable = {
								name = speaker1
								add = 3
							}
						}
						1 = {
							change_variable = {
								name = speaker1
								add = 2
							}
						}
					}
				}
			}
			4 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				custom_tooltip = ev7.101.a_ct3
				hidden_effect = {
					random = {
						chance = 50
						change_variable = {
							name = speaker1
							add = 1
						}
					}
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 50
				has_trait = ambitious
			}
			modifier = {
				add = 25
				is_landed_or_landless_administrative = yes
				highest_held_title_tier > 2
			}
			modifier = {
				add = 25
				prestige_level > 3
			}
			modifier = {
				add = 10
				has_trait = contrite
			}
			modifier = {
				add = 49
				OR = {
					has_trait = archmage
					has_trait = yaga
				}
			}
		}
	}
	option = {
		name = ev7.101.b
		trigger = {
			has_variable = speaker1
		}
		custom_tooltip = ev7.101.b_ct
		stress_impact = {
			humble = minor_stress_loss
			ambitious = medium_stress_gain
			patient = minor_stress_loss
			content = minor_stress_loss
		}
		hidden_effect = {
			change_variable = {
				name = speaker1
				add = -100
			}
		}
		ai_chance = {
			base = 100
			modifier = {
				add = 50
				OR = {
					has_trait = humble
					has_trait = reclusive
				}
			}
			modifier = {
				add = 25
				has_trait = content
			}
			modifier = {
				add = 100
				has_trait = shy
			}
		}
	}
	option = {
		name = ev7.101.c
		trigger = {
			NOT = {
				has_variable = speaker1
			}
		}
		custom_tooltip = ev7.101.b_ct
		stress_impact = {
			humble = minor_stress_loss
			ambitious = medium_stress_gain
			arrogant = minor_stress_gain
		}
		ai_chance = {
			base = 100
		}
	}
}

#Mage Summit - you are the one
magic_ev7.102 = {
	type = activity_event
	title = ev7.102.title
	desc = ev7.102.desc
	theme = witchcraft
	override_background = {
		reference = throne_room_east
	}
	
	left_portrait = {
		character = root
		animation = toast_goblet
	}


	trigger = {
		is_alive = yes
	}
	immediate = {
		stress_impact = {
			ambitious = massive_stress_loss
			humble = minor_stress_gain
			shy = minor_stress_gain
			gregarious = minor_stress_loss
		}
	}
	
	option = {
		name = ev7.102.b
		trigger = {
			has_trait = august
		}
		trait = august
		add_prestige = massive_prestige_gain
	}
	option = {
		name = ev7.102.a
		add_prestige = major_prestige_gain
	}
	after = {
		trigger_event = {
			id = magic_ev7.104
			days = 2
		}
	}
}
#Mage Summit - you are noone
magic_ev7.103 = {
	type = activity_event
	title = ev7.102.title
	desc = ev7.103.desc
	theme = witchcraft
	override_background = {
		reference = throne_room_east
	}
	
	left_portrait = {
		character = root
		animation = disapproval
	}
	lower_left_portrait = scope:speaker0
	trigger = {
		is_alive = yes
	}
	immediate = {
		stress_impact = {
			ambitious = minor_stress_gain
		}
	}
	
	option = {
		name = ev7.103.a
		trigger = {
			NOR = {
				has_relation_rival = scope:speaker0
				has_relation_nemesis = scope:speaker0
			}
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev4.72.0.b
		if = {
			limit = {
				OR = {
					has_relation_rival = scope:speaker0
					has_relation_nemesis = scope:speaker0
				}
			}
			add_stress = medium_stress_gain
		}
		else = {
			progress_towards_rival_effect = {
				CHARACTER = scope:speaker0
				OPINION = 0
				REASON = rival_random_m1
			}
		}
		ai_chance = {
			base = 0
		}
	}
}

#Mage Summit - speech
magic_ev7.104 = {
	type = activity_event
	title = ev7.104.title
	desc = ev7.104.desc
	theme = witchcraft
	override_background = {
		reference = throne_room_east
	}
	
	left_portrait = root
	lower_left_portrait = scope:mage0
	lower_center_portrait = scope:mage1
	lower_right_portrait = scope:mage2


	trigger = {
		is_alive = yes
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						OR = {
							has_trait = yaga
							has_trait = archmage
						}
						NOT = {
							ROOT = THIS
						}
					}
					save_scope_as = mage0
				}
				random_attending_character = {
					limit = {
						OR = {
							has_trait = true_witch
							has_trait = archmage
						}
						NOR = {
							ROOT = THIS
							THIS = scope:mage0
						}
					}
					save_scope_as = mage1
				}
				random_attending_character = {
					limit = {
						OR = {
							has_trait = true_witch
							has_trait = archmage
							has_trait = witch
							has_trait = lifestyle_mystic
						}
						NOR = {
							ROOT = THIS
							THIS = scope:mage0
							THIS = scope:mage1
						}
					}
					save_scope_as = mage2
				}
			}
		}
	}
	
	option = {
		name = ev7.104.a
		trigger = {
			has_trait = scholar
		}
		trait = scholar
		add_stress = minor_stress_loss
		scope:activity = {
			every_attending_character = {
				limit = {
					NOT = {
						THIS = ROOT
					}
					OR = {
						has_trait = lifestyle_mystic
						has_trait = scholar
					}
				}
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 10
				}
			}
		}
	}
	option = {
		name = ev7.104.b
		trigger = {
			has_ms_knowledge_sharing_intent_trigger = yes
		}
		reason = activity_intent
		scope:activity = {
			every_attending_character = {
				limit = {
					NOT = {
						THIS = ROOT
					}
					has_ms_knowledge_sharing_intent_trigger = yes
				}
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 5
				}
			}
		}
	}
	option = {
		name = ev7.104.c
		trigger = {
			has_ms_political_matters_intent_trigger = yes
		}
		reason = activity_intent
		scope:activity = {
			every_attending_character = {
				limit = {
					NOT = {
						THIS = ROOT
					}
					has_ms_political_matters_intent_trigger = yes
				}
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 5
				}
			}
		}
	}
	option = {
		name = ev7.104.d
		trigger = {
			has_ms_show_superiority_intent_trigger = yes
		}
		reason = activity_intent
		add_prestige = medium_prestige_gain
		add_stress = medium_stress_loss
		scope:activity = {
			every_attending_character = {
				limit = {
					NOT = {
						THIS = ROOT
					}
					OR = {
						has_ms_show_superiority_intent_trigger = yes
						has_trait = arrogant
					}
				}
				add_opinion = {
					target = ROOT
					modifier = disrespect_opinion
					opinion = -5
				}
			}
		}
	}
	option = {
		name = ev7.104.f
		trigger = {
			OR = {
				has_trait = lunatic_1
				has_trait = lunatic_genetic
			}
		}
		add_stress = major_stress_loss
		scope:activity = {
			every_attending_character = {
				limit = {
					NOR = {
						THIS = ROOT
					}
					OR = {
						has_trait = lunatic_1
						has_trait = lunatic_genetic
						has_trait = dull
						has_trait = intellect_bad_1
						has_trait = intellect_bad_2
						has_trait = intellect_bad_3
					}
				}
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 5
				}
			}
		}
	}
	option = {
		name = ev7.104.e
		stress_impact = {
			gregarious = medium_stress_loss
			trusting = minor_stress_loss
			compassionate = minor_stress_loss
		}
		scope:activity = {
			every_attending_character = {
				limit = {
					NOT = {
						THIS = ROOT
					}
				}
				if = {
					limit = {
						OR = {
							has_trait = trusting
							has_trait = gregarious
							has_trait = compassionate
						}
					}
					add_opinion = {
						target = ROOT
						modifier = respect_opinion
						opinion = 5
					}
				}
				else_if = {
					limit = {
						OR = {
							has_trait = paranoid
							has_trait = shy
							has_trait = arrogant
						}
					}
					add_opinion = {
						target = ROOT
						modifier = irritated_opinion
						opinion = -5
					}
				}
			}
		}
	}
	option = {
		name = ev7.104.g
		trigger = {
			OR = {
				has_trait = wrathful
				has_trait = irritable
			}
		}
		stress_impact = {
			eccentric = medium_stress_loss
			arrogant = major_stress_loss
			compassionate = minor_stress_gain
			irritable = massive_stress_loss
			contrite = medium_stress_loss
			wrathful = medium_stress_loss
			gregarious = minor_stress_gain
		}
		scope:activity = {
			every_attending_character = {
				limit = {
					NOR = {
						THIS = ROOT
						has_trait = eccentric
					}
				}
				add_opinion = {
					target = ROOT
					modifier = irritated_opinion
					opinion = -20
				}
				hidden_effect = {
					if = {
						limit = {
							NOR = {
								has_trait = calm
								has_trait = patient
							}
						}
						send_interface_toast = {
							title = insult_opinion	#insulted
							add_stress = medium_stress_gain
							left_icon = this
							right_icon = root
						}
					}
				}
			}
		}
	}
	
	after = {
		trigger_event = magic_ev7.105
	}
}

#Mage Summit - topic
magic_ev7.105 = {
	type = activity_event
	title = meeting_phase
	desc = ev7.105.desc
	theme = witchcraft
	override_background = {
		reference = throne_room_east
	}
	left_portrait = root
	lower_left_portrait = scope:mage0
	lower_center_portrait = scope:mage1
	lower_right_portrait = scope:mage2


	trigger = {
		is_alive = yes
	}
	
	immediate = {
		hidden_effect = {
			every_living_character = {
				limit = {
					has_character_flag = ms_target1_flag
				}
				remove_character_flag = ms_target1_flag
			}
			every_living_character = {
				limit = {
					has_character_flag = ms_target2_flag
				}
				remove_character_flag = ms_target2_flag
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target1
					}
				}
				random_relation = {
					type = nemesis
					limit = {
						has_character_flag = abdul_dude
					}
					save_scope_as = target1
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target1
					}
				}
				random_relation = {
					type = rival
					limit = {
						has_character_flag = abdul_dude
					}
					save_scope_as = target1
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target1
					}
				}
				random_relation = {
					type = nemesis
					limit = {
						has_character_flag = bael_flag
					}
					save_scope_as = target1
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target1
					}
				}
				random_relation = {
					type = rival
					limit = {
						has_character_flag = bael_flag
					}
					save_scope_as = target1
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target1
					}
				}
				random_relation = {
					type = nemesis
					limit = {
						has_trait = demon
					}
					save_scope_as = target1
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target1
					}
				}
				random_relation = {
					type = rival
					limit = {
						has_trait = demon
					}
					save_scope_as = target1
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target1
					}
				}
				random_ruler = {
					limit = {
						has_character_modifier = inq_modifier
						is_incapable = no
						is_imprisoned = no
					}
					save_scope_as = target1
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target1
					}
				}
				random_ruler = {
					limit = {
						faith.religious_head = THIS
						trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = this.faith GENDER_CHARACTER = this }
					}
					save_scope_as = target1
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target1
					}
				}
				random_ruler = {
					limit = {
						trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = this.faith GENDER_CHARACTER = this }
						is_independent_ruler = yes
						OR = {
							highest_held_title_tier = kingdom
							highest_held_title_tier = empire
						}
					}
					save_scope_as = target1
				}
			}
			random_relation = {
				type = nemesis
				limit = {
					has_trait = archmage
					NOR = {
						THIS = scope:target1
						has_character_modifier = excluded_from_magic_community
					}
				}
				save_scope_as = target2
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target2
					}
				}
				random_relation = {
					type = rival
					limit = {
						has_trait = archmage
						NOR = {
							THIS = scope:target1
							has_character_modifier = excluded_from_magic_community
						}
					}
					save_scope_as = target2
				}
			}
			scope:target1 = {
				add_character_flag = {
					flag = ms_target1_flag
				}
			}
			if = {
				limit = {
					exists = scope:target2
				}
				scope:target2 = {
					add_character_flag = {
						flag = ms_target2_flag
					}
				}
			}
		}
	}
	option = {
		name = ev7.105.a	#We will develop a joint program of magical research.
		trigger = {
			has_ms_knowledge_sharing_intent_trigger = yes
		}
		reason = activity_intent
		custom_description_no_bullet = {
			text = ms_if_succeded
		}
		show_as_tooltip = {
			scope:activity = {
				every_attending_character = {
					add_character_modifier = {
						modifier = research_cooperation
						years = 10
					}
					gain_sc_xp2_effect = yes
				}
			}
		}
		hidden_effect = {
			add_character_flag = ms_research_cooperation_flag
		}
		ai_chance = {
			base = 50
			modifier = {
				add = 150
				has_trait = scholar
			}
		}
	}
	option = {
		name = ev7.105.b	#We'll all sign a joint mutual defense pact.
		trigger = {
			has_ms_political_matters_intent_trigger = yes
		}
		reason = activity_intent
		custom_description_no_bullet = {
			text = ms_if_succeded
		}
		custom_tooltip = ev7.105.b_ct2
		custom_tooltip = ev7.105.b_ct3
		show_as_tooltip = {
			scope:activity = {
				every_attending_character = {
					limit = {
						is_landed_or_landless_administrative = yes
						NOT = {
							THIS = ROOT
						}
					}
					custom_tooltip = ev7.105.b_ct
					custom_description_no_bullet = {
						text = empty_description1
					}
				}
			}
		}
		hidden_effect = {
			add_character_flag = ms_magic_pact_flag
		}
		ai_chance = {
			base = 10
			modifier = {
				add = -1000
				has_character_flag = ms_defence_pact_flag
			}
			modifier = {
				add = 90
				OR = {
					has_trait = diplomat
					has_trait = craven
				}
			}
			modifier = {
				add = -50
				has_trait = paranoid
			}
		}
	}
	option = {
		name = ev7.105.c	#We need an archmage - I nominate myself for this responsible role!
		trigger = {
			has_ms_show_superiority_intent_trigger = yes
			NOT = {
				any_living_character = {
					OR = {
						has_nickname = archmage_nickname
						has_character_flag = ms_is_archmage_flag
					}
				}
			}
		}
		reason = activity_intent
		stress_impact = {
			ambitious = medium_stress_loss
			arrogant = medium_stress_loss
			humble = minor_stress_gain
		}
		custom_description_no_bullet = {
			text = ms_if_succeded
		}
		show_as_tooltip = {
			give_nickname = archmage_nickname
			custom_tooltip = ev7.105.c_ct
			custom_tooltip = ev7.105.c_ct2
			add_prestige = massive_prestige_gain
			if = {
				limit = {
					is_valid_for_legitimacy_change = yes
					culture = {
						has_cultural_tradition = mage_rulership_tradition
					}
				}
				add_legitimacy = major_legitimacy_gain
			}
		}
		
		
		hidden_effect = {
			add_character_flag = ms_want_be_archmage_flag
		}
		ai_chance = {
			base = 50
			modifier = {
				add = 200
				has_trait = ambitious
			}
			modifier = {
				add = 100
				has_trait = arrogant
			}
			modifier = {
				add = 100
				has_character_flag = abdul_dude
			}
		}
	}
	option = {
		name = ev7.105.d	#As the archmage, I need to raise funds to ensure your safety.
		trigger = {
			OR = {
				has_nickname = archmage_nickname
				has_character_flag = ms_is_archmage_flag
			}
		}
		add_internal_flag = special
		stress_impact = {
			greedy = major_stress_loss
			arrogant = medium_stress_loss
		}
		custom_description_no_bullet = {
			text = ms_if_succeded
		}
		show_as_tooltip = {
			scope:activity = {
				every_attending_character = {
					limit = {
						NOT = {
							THIS = ROOT
						}
					}
					pay_short_term_gold = {
						target = scope:speaker0
						gold = archmage_tax_value
					}
				}
			}
		}
		
		
		hidden_effect = {
			add_character_flag = ms_archmage_tax_flag
		}
		ai_chance = {
			base = 200
			modifier = {
				add = 100
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev7.105.e	#We must ban the use of black magic.
		trigger = {
			NOT = {
				scope:activity = {
					any_attending_character = {
						has_character_flag = forbidden_black_magic_flag
					}
				}
			}
		}
		stress_impact = {
			compassionate = major_stress_loss
		}
		custom_description_no_bullet = {
			text = ms_if_succeded
		}
		show_as_tooltip = {
			custom_tooltip = ev7.105.e_ct
			custom_tooltip = ev7.105.e_ct2
		}
		
		
		hidden_effect = {
			add_character_flag = ms_black_magic_prohibited
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 100
				has_trait = compassionate
			}
		}
	}
	option = {
		name = ev7.105.f	#Ordinary rulers will become our puppets. Let's develop a plan...
		trigger = {
			has_trait = schemer
		}
		trait = schemer
		custom_description_no_bullet = {
			text = ms_if_succeded
		}
		show_as_tooltip = {
			add_intrigue_skill = 1
			scope:activity = {
				every_attending_character = {
					add_character_modifier = {
						modifier = joint_intrigues
						years = 10
					}
				}
			}
		}
		
		
		hidden_effect = {
			add_character_flag = ms_schemer_flag
		}
		ai_chance = {
			base = 300
		}
	}
	option = {
		name = ev7.105.i	#You will give me your power so that I can cast a powerful spell. For the greater good, of course...
		trigger = {
			has_trait = archmage
			OR = {
				has_nickname = archmage_nickname
				has_character_flag = ms_is_archmage_flag
			}
		}
		trait = archmage
		add_internal_flag = special
		custom_description_no_bullet = {
			text = ms_if_succeded
		}
		show_as_tooltip = {
			custom_tooltip = ev7.105.i_ct
			custom_tooltip = ev7.105.i_ct2
			add_trait_xp = {
				trait = archmage
				track = power_saturation
				value = 100
			}
			
		}
		
		hidden_effect = {
			add_character_flag = ms_grand_spell_flag
		}
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev7.105.g	#against demon, witch hunter or pope
		trigger = {
			exists = scope:target1
		}
		custom_description_no_bullet = {
			text = ms_if_succeded
		}
		show_as_tooltip = {
			scope:target1 = {
				add_character_modifier = {
					modifier = death_sentence
					years = 10
				}
			}
			custom_tooltip = ev7.105.g_ct
		}
		
		
		
		hidden_effect = {
			add_character_flag = ms_against_target1_flag
		}
		ai_chance = {
			base = 200
		}
	}
	option = {
		name = ev7.105.h	#against mage rival
		trigger = {
			exists = scope:target2
		}
		custom_description_no_bullet = {
			text = ms_if_succeded
		}
		show_as_tooltip = {
			scope:target2 = {
				add_character_modifier = {
					modifier = excluded_from_magic_community
					years = 50
				}
			}
		}
		
		
		
		hidden_effect = {
			add_character_flag = ms_against_target2_flag
		}
		ai_chance = {
			base = 100
		}
	}
	after = {
		trigger_event = magic_ev7.106
	}
}

#Mage Summit - voting (speaker)
magic_ev7.106 = {
	type = activity_event
	title = meeting_phase
	desc = ev7.106.desc
	theme = witchcraft
	override_background = {
		reference = throne_room_east
	}
	left_portrait = root
	lower_left_portrait = scope:mage0
	lower_center_portrait = scope:mage1
	lower_right_portrait = scope:mage2


	trigger = {
		is_alive = yes
	}
	
	
	option = {
		name = ev7.106.a
	}
	option = {
		name = ev7.106.b
		trigger = {
			#has_usable_hook
			any_hooked_character = {
				involved_activity = root.involved_activity
			}
		}
		custom_tooltip = ev7.106.b_ct
		hidden_effect = {
			add_character_flag = ms_may_lost_hooks_flag
		}
	}
	after = {
		hidden_effect = {
			set_variable = {
				name = ms_vote_yes
				value = 1
			}
			set_variable = {
				name = ms_vote_no
				value = 0
			}
			scope:activity = {
				every_attending_character = {
					limit = {
						NOT = {
							THIS = ROOT
						}
					}
					trigger_event = magic_ev7.107
				}
			}
		}
	}
}
#Mage Summit - voting (participants)
magic_ev7.107 = {
	type = activity_event
	title = meeting_phase
	desc = ev7.107.desc
	#desc = {
	#	first_valid = {
	#		triggered_desc = {
	#			trigger = {
	#				scope:speaker0 = {
	#					has_character_flag = ms_may_lost_hooks_flag
	#				}
	#			}
	#			desc = ev7.107.desc
	#		}
	#		desc = ev7.107.descX
	#	}
	#}
	theme = witchcraft
	override_background = {
		reference = throne_room_east
	}
	left_portrait = root
	right_portrait = scope:speaker0


	trigger = {
		is_alive = yes
	}
	
	immediate = {
		if = {
			limit = {
				scope:speaker0 = {
					has_character_flag = ms_research_cooperation_flag
				}
			}
			custom_description_no_bullet = {
				text = ms_if_succeded
			}
			show_as_tooltip = {
				scope:activity = {
					every_attending_character = {
						add_character_modifier = {
							modifier = research_cooperation
							years = 10
						}
						gain_sc_xp2_effect = yes
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:speaker0 = {
					has_character_flag = ms_magic_pact_flag
				}
			}
			custom_description_no_bullet = {
				text = ms_if_succeded
			}
			show_as_tooltip = {
				custom_tooltip = ev7.105.b_ct2
				custom_tooltip = ev7.105.b_ct3
				scope:activity = {
					every_attending_character = {
						limit = {
							is_landed_or_landless_administrative = yes
							NOT = {
								THIS = ROOT
							}
						}
						custom_tooltip = ev7.105.b_ct
						custom_description_no_bullet = {
							text = empty_description1
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:speaker0 = {
					has_character_flag = ms_want_be_archmage_flag
				}
			}
			custom_description_no_bullet = {
				text = ms_if_succeded
			}
			show_as_tooltip = {
				scope:speaker0 = {
					show_as_tooltip = {
						give_nickname = archmage_nickname
						add_prestige = massive_prestige_gain
						if = {
							limit = {
								is_valid_for_legitimacy_change = yes
								culture = {
									has_cultural_tradition = mage_rulership_tradition
								}
							}
							add_legitimacy = major_legitimacy_gain
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:speaker0 = {
					has_character_flag = ms_archmage_tax_flag
				}
			}
			custom_description_no_bullet = {
				text = ms_if_succeded
			}
			show_as_tooltip = {
				scope:activity = {
					every_attending_character = {
						limit = {
							NOT = {
								THIS = scope:speaker0
							}
						}
						pay_short_term_gold = {
							target = scope:speaker0
							gold = archmage_tax_value
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:speaker0 = {
					has_character_flag = ms_black_magic_prohibited
				}
			}
			custom_description_no_bullet = {
				text = ms_if_succeded
			}
			show_as_tooltip = {
				custom_tooltip = ev7.105.e_ct
				custom_tooltip = ev7.105.e_ct2
			}
		}
		else_if = {
			limit = {
				scope:speaker0 = {
					has_character_flag = ms_schemer_flag
				}
			}
			custom_description_no_bullet = {
				text = ms_if_succeded
			}
			show_as_tooltip = {
				scope:speaker0 = {
					add_intrigue_skill = 1
				}
				scope:activity = {
					every_attending_character = {
						add_character_modifier = {
							modifier = joint_intrigues
							years = 10
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:speaker0 = {
					has_character_flag = ms_against_target1_flag
				}
			}
			custom_description_no_bullet = {
				text = ms_if_succeded
			}
			show_as_tooltip = {
				scope:target1 = {
					add_character_modifier = {
						modifier = death_sentence
						years = 10
					}
				}
				custom_tooltip = ev7.105.g_ct
			}
		}
		else_if = {
			limit = {
				scope:speaker0 = {
					has_character_flag = ms_against_target2_flag
				}
			}
			custom_description_no_bullet = {
				text = ms_if_succeded
			}
			show_as_tooltip = {
				scope:target2 = {
					add_character_modifier = {
						modifier = excluded_from_magic_community
						years = 50
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:speaker0 = {
					has_character_flag = ms_grand_spell_flag
				}
			}
			custom_description_no_bullet = {
				text = ms_if_succeded
			}
			show_as_tooltip = {
				custom_tooltip = ev7.105.i_ct
				custom_tooltip = ev7.105.i_ct2
				scope:speaker0 = {
					add_trait_xp = {
						trait = archmage
						track = power_saturation
						value = 100
					}
				}
			}
		}
	}
	
	option = {
		name = ev7.85.a
		trigger = {
			OR = {
				has_trait = archmage
				has_trait = true_witch
				has_focus = arcane_focus
			}
		}
		if = {
			limit = {
				scope:speaker0 = {
					has_character_flag = ms_may_lost_hooks_flag
					has_usable_hook = ROOT
				}
			}
			scope:speaker0 = {
				use_hook = ROOT
			}
		}
		custom_tooltip = ms_vote_yes_ct
		hidden_effect = {
			scope:speaker0 = {
				change_variable = {
					name = ms_vote_yes
					add = 1
				}
			}
		}
		ai_chance = {
			base = 40
			modifier = {
				add = 300
				has_character_flag = ms_additional_support_flag
			}
			modifier = {
				add = 50
				opinion = {
					target = scope:speaker0
					value > 50
				}
			}
			modifier = {
				add = 200
				OR = {
					has_relation_best_friend = scope:speaker0
					has_relation_friend = scope:speaker0
					has_relation_lover = scope:speaker0
					has_relation_soulmate = scope:speaker0
					has_relation_mmaster = scope:speaker0
					has_relation_mminion = scope:speaker0
				}
			}
			modifier = {
				add = 50
				has_trait = trusting
			}
			modifier = {
				add = 200
				has_trait = fickle
			}
			modifier = {
				add = 100
				scope:speaker0 = {
					has_character_flag = ms_research_cooperation_flag
				}
				has_trait = scholar
			}
			modifier = {
				add = -10
				scope:speaker0 = {
					has_character_flag = ms_research_cooperation_flag
				}
				NOT = {
					has_trait = scholar
				}
			}
			modifier = {
				add = -30
				scope:speaker0 = {
					has_character_flag = ms_research_cooperation_flag
				}
				has_trait = paranoid
			}
			modifier = {
				add = 10
				scope:speaker0 = {
					is_legendary_mage_trigger = yes
				}
			}
			modifier = {
				add = -10
				scope:speaker0 = {
					has_character_flag = ms_research_cooperation_flag
				}
				has_trait = arrogant
			}
			modifier = {
				add = 50
				scope:speaker0 = {
					has_character_flag = ms_magic_pact_flag
				}
				OR = {
					has_trait = craven
					has_trait = diplomat
				}
			}
			modifier = {
				add = 20
				scope:speaker0 = {
					has_character_flag = ms_want_be_archmage_flag
				}
				has_trait = humble
			}
			modifier = {
				add = -10
				scope:speaker0 = {
					has_character_flag = ms_want_be_archmage_flag
				}
				NOT = {
					has_trait = humble
				}
			}
			modifier = {
				add = -10
				scope:speaker0 = {
					has_character_flag = ms_grand_spell_flag
				}
			}
			modifier = {
				add = 50
				scope:speaker0 = {
					has_character_flag = ms_black_magic_prohibited
				}
				has_trait = compassionate
			}
			modifier = {
				add = -10
				scope:speaker0 = {
					has_character_flag = ms_black_magic_prohibited
				}
				NOT = {
					has_trait = compassionate
				}
			}
			modifier = {
				add = 50
				scope:speaker0 = {
					has_character_flag = ms_archmage_tax_flag
				}
				has_trait = generous
			}
			modifier = {
				add = -50
				scope:speaker0 = {
					has_character_flag = ms_archmage_tax_flag
				}
				has_trait = greedy
			}
			modifier = {
				add = 100
				scope:speaker0 = {
					has_character_flag = ms_schemer_flag
				}
				OR = {
					has_trait = deceitful
					has_trait = schemer
				}
			}
			modifier = {
				add = -20
				scope:speaker0 = {
					has_character_flag = ms_schemer_flag
				}
				OR = {
					has_trait = just
					has_trait = honest
				}
			}
			modifier = {
				add = 1000
				exists = scope:target1
				scope:speaker0 = {
					has_character_flag = ms_against_target1_flag
				}
				OR = {
					has_relation_nemesis = scope:target1
					has_relation_rival = scope:target1
				}
			}
			modifier = {
				add = 30
				exists = scope:target1
				scope:speaker0 = {
					has_character_flag = ms_against_target1_flag
				}
				scope:target1 = {
					OR = {
						has_trait = demon
						has_trait = witch_hunter
					}
				}
			}
			modifier = {
				add = 1000
				exists = scope:target2
				scope:speaker0 = {
					has_character_flag = ms_against_target2_flag
				}
				OR = {
					has_relation_nemesis = scope:target2
					has_relation_rival = scope:target2
				}
			}
			modifier = {
				add = 70
				scope:speaker0 = {
					has_character_flag = ms_may_lost_hooks_flag
					has_usable_hook = ROOT
				}
			}
		}
	}
	option = {
		name = ev7.107.b
		trigger = {
			OR = {
				has_trait = archmage
				has_trait = true_witch
				has_focus = arcane_focus
			}
		}
		custom_tooltip = ms_vote_no_ct
		hidden_effect = {
			scope:speaker0 = {
				change_variable = {
					name = ms_vote_no
					add = 1
				}
			}
		}
		ai_chance = {
			base = 50
			modifier = {
				add = -50
				has_character_flag = ms_additional_support_flag
			}
			modifier = {
				add = 50
				scope:speaker0 = {
					is_ai = no
				}
				has_character_flag = abdul_dude
			}
			modifier = {
				add = 50
				opinion = {
					target = scope:speaker0
					value < 0
				}
			}
			modifier = {
				add = 50
				opinion = {
					target = scope:speaker0
					value < -50
				}
			}
			modifier = {
				add = 1000
				OR = {
					has_relation_nemesis = scope:speaker0
					has_relation_rival = scope:speaker0
				}
			}
			modifier = {
				add = 50
				has_trait = paranoid
			}
			modifier = {
				add = 30
				scope:speaker0 = {
					has_character_flag = ms_grand_spell_flag
				}
			}
			modifier = {
				add = 200
				has_trait = fickle
			}
			modifier = {
				add = 50
				scope:speaker0 = {
					has_character_flag = ms_research_cooperation_flag
				}
				has_trait = arrogant
			}
			modifier = {
				add = 10
				scope:speaker0 = {
					has_character_flag = ms_research_cooperation_flag
				}
				has_trait = shy
			}
			modifier = {
				add = 50
				scope:speaker0 = {
					has_character_flag = ms_magic_pact_flag
				}
				is_landed_or_landless_administrative = yes
				highest_held_title_tier > duchy
			}
			modifier = {
				add = 80
				scope:speaker0 = {
					OR = {
						has_character_flag = ms_grand_spell_flag
						has_character_flag = ms_want_be_archmage_flag
					}
				}
				OR = {
					has_trait = ambitious
					has_trait = arrogant
				}
			}
			modifier = {
				add = 25
				scope:speaker0 = {
					has_character_flag = ms_want_be_archmage_flag
				}
			}
			modifier = {
				add = 50
				scope:speaker0 = {
					has_character_flag = ms_black_magic_prohibited
				}
				NOT = {
					has_trait = compassionate
				}
			}
			modifier = {
				add = -30
				scope:speaker0 = {
					has_character_flag = ms_black_magic_prohibited
				}
				has_trait = compassionate
			}
			modifier = {
				add = 10
				scope:speaker0 = {
					has_character_flag = ms_archmage_tax_flag
				}
				NOT = {
					has_trait = generous
				}
			}
			modifier = {
				add = 50
				scope:speaker0 = {
					has_character_flag = ms_archmage_tax_flag
				}
				has_trait = greedy
			}
			modifier = {
				add = 100
				scope:speaker0 = {
					has_character_flag = ms_schemer_flag
				}
				OR = {
					has_trait = honest
					has_trait = just
				}
			}
			modifier = {
				add = 1000
				exists = scope:target1
				scope:speaker0 = {
					has_character_flag = ms_against_target1_flag
				}
				OR = {
					has_relation_best_friend = scope:target1
					has_relation_friend = scope:target1
					has_relation_lover = scope:target1
					has_relation_soulmate = scope:target1
					has_relation_mmaster = scope:target1
					has_relation_mminion = scope:target1
					THIS = scope:target1
				}
			}
			modifier = {
				add = 25
				exists = scope:target1
				scope:speaker0 = {
					has_character_flag = ms_against_target1_flag
				}
				opinion = {
					target = scope:target1
					value > 0
				}
			}
			modifier = {
				add = 50
				exists = scope:target1
				scope:speaker0 = {
					has_character_flag = ms_against_target1_flag
				}
				scope:target1 = {
					NOR = {
						has_trait = demon
						has_trait = witch_hunter
					}
				}
			}
			modifier = {
				add = 1000
				exists = scope:target2
				scope:speaker0 = {
					has_character_flag = ms_against_target2_flag
				}
				OR = {
					has_relation_best_friend = scope:target2
					has_relation_friend = scope:target2
					has_relation_lover = scope:target2
					has_relation_soulmate = scope:target2
					has_relation_mmaster = scope:target2
					has_relation_mminion = scope:target2
					THIS = scope:target2
				}
			}
			modifier = {
				add = 25
				exists = scope:target2
				scope:speaker0 = {
					has_character_flag = ms_against_target2_flag
				}
				opinion = {
					target = scope:target2
					value > 0
				}
			}
			modifier = {
				add = -60
				scope:speaker0 = {
					has_character_flag = ms_may_lost_hooks_flag
					has_usable_hook = ROOT
				}
			}
		}
	}
	option = {
		name = ev7.107.c
		trigger = {
			NOR = {
				has_trait = archmage
				has_trait = true_witch
				has_focus = arcane_focus
			}
		}

		ai_chance = {
			base = 50
		}
	}
}

#defence pact management
magic_ev7.108 = {
	hidden = yes
		
	immediate = {
		every_ruler = {
			limit = {
				#is_at_war = no
				has_character_flag = ms_defence_pact_flag
				NOR = {
					THIS = scope:defender
					THIS = scope:attacker
					scope:attacker = {
						has_character_flag = ms_defence_pact_flag
					}
				}
			}
			trigger_event = {
				id = magic_ev7.109
				days = 7
			}
		}
	}
}
#defence pact - for rulers
magic_ev7.109 = {
	type = character_event
	title = ev7.109.title
	desc = ev7.109.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_right_portrait = scope:defender
	trigger = {
		exists = scope:war
		is_imprisoned = no
		#is_at_war = no
		NOR = {
			is_attacker_in_war = scope:war
			is_defender_in_war = scope:war
			is_participant_in_war = scope:war
		}
	}

	option = {
		name = ev7.109.a
		scope:defender = {
			send_interface_toast = {
				title = ev7.109.title
				scope:war = {
					add_defender = root
				}
				left_icon = scope:defender
				right_icon = root
			}
			add_opinion = {
				target = ROOT
				modifier = grateful_opinion
				opinion = 30
			}
		}
		stress_impact = {
			just = medium_stress_loss
		}
		ai_chance = {
			base = 100
			modifier = {
				add = 700
				OR = {
					has_relation_friend = scope:defender
					has_relation_best_friend = scope:defender
					has_relation_mmaster = scope:defender
					has_relation_lover = scope:defender
					has_relation_soulmate = scope:defender
				}
			}
			modifier = {
				add = 200
				has_trait = just
			}
			modifier = {
				add = 50
				has_trait = brave
			}
		}
	}
	option = {
		name = ev7.109.b
		trigger = {
			intrigue > 20
		}
		skill = intrigue
		scope:defender = {
			send_interface_toast = {
				title = ev7.109.title
				root = {
					pay_short_term_gold = {
						target = scope:defender
						gold = 100
					}
				}
				left_icon = scope:defender
				right_icon = root
			}
		}
		stress_impact = {
			deceitful = minor_stress_loss
			greedy = medium_stress_gain
		}
		ai_chance = {
			base = 200
			modifier = {
				add = 200
				has_trait = deceitful
			}
		}
	}
	option = {
		name = ev7.109.c
		add_prestige_level = -1
		scope:defender = {
			add_opinion = {
				target = ROOT
				modifier = rejected_call_to_defensive_war
			}
		}
		stress_impact = {
			just = medium_stress_gain
		}
		custom_tooltip = ev7.109.c_ct
		hidden_effect = {
			remove_character_flag = ms_defence_pact_flag
			scope:defender = {
				send_interface_toast = {
					title = ev7.109.title
					left_icon = root
					root = {
						custom_tooltip = ev7.109.c_ct2
						show_as_tooltip = {
							add_prestige_level = -1
						}
					}
				}
			}
		}
		ai_chance = {
			base = 30
			modifier = {
				add = 9000
				OR = {
					has_relation_rival = scope:defender
					has_relation_nemesis = scope:defender
				}
			}
			modifier = {
				add = 100
				has_trait = arbitrary
			}
			modifier = {
				add = 1000
				has_trait = craven
			}
			modifier = {
				add = 70
				has_trait = deceitful
			}
		}
	}
}

#death sentence - from mage summit
magic_ev7.110 = {
	type = character_event
	title = death_sentence
	desc = ev7.110.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_right_portrait = scope:target1
	trigger = {
		is_imprisoned = no
		OR = {
			has_trait = witch
			any_secret = { secret_type = secret_witch }
		}
		scope:target1 = {
			is_alive = yes
		}
		NOT = {
			ROOT = scope:target1
		}
	}
	immediate = {
		hidden_effect = {
			save_scope_as = actor
		}
	}
	option = {
		name = ev7.110.c
		trigger = {
			has_trait = archmage
			scope:target1 = {
				OR = {
					has_focus = arcane_focus
					has_trait = demon
					has_trait = archmage
				}
				NOT = {
					has_variable = pclash
				}
				is_imprisoned = no
			}
		}
		trait = archmage
		stress_impact = {
			brave = medium_stress_loss
			craven = major_stress_gain
			sadistic = minor_stress_loss
		}
		custom_tooltip = start_duel_ct
		configure_start_mage_duel_effect = {
			MD_ATTACKER = root
			MD_DEFENDER = scope:target1
		}
		#hidden_effect = {
		#	scope:speaker0 = {
		#		send_interface_toast = {
		#			title = mage_duel
		#			left_icon = root
		#			right_icon = scope:target1
		#		}
		#	}
		#}

		ai_chance = {
			base = 1
			modifier = {
				add = -9
				has_trait = compassionate
			}
			modifier = {
				add = 9
				OR = {
					is_legendary_mage_trigger = yes
					has_trait = sadistic
					has_trait = wrathful
					has_trait = brave
				}
			}
			modifier = {
				add = -20
				has_trait = craven
			}
			modifier = {
				add = 5
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = power_saturation
					value > 49
				}
				scope:target1 = {
					NOR = {
						has_trait = demon
						AND = {
							has_trait = archmage
							has_trait_xp = {
								trait = archmage
								track = power_saturation
								value > 99
							}
						}
					}
				}
			}
			modifier = {
				add = 10
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = power_saturation
					value > 99
				}
				OR = {
					scope:target1 = {
						has_full_magic_prot_trigger = no
					}
					AND = {
						scope:target1 = {
							has_full_magic_prot_trigger = yes
						}
						has_full_magic_prot_trigger = yes
					}
				}
			}
			modifier = {
				add = 5
				scope:target1 = {
					any_character_artifact = {
						has_variable = magic1
					}
				}
			}
			modifier = {
				add = 5
				has_trait = greedy
				scope:target1 = {
					any_character_artifact = {
						has_variable = magic1
					}
				}
			}
		}
	}
	option = {
		name = ev7.110.a
		trigger = {
			has_trait = archmage
			exists = scope:target1
			scope:target1 = {
				OR = {
					has_basic_magic_prot_trigger = no
					AND = {
						has_basic_magic_prot_trigger = yes
						root = {	can_penetrate_basic_magic_prot_trigger = yes	}
					}
				}
				has_full_magic_prot_trigger = no
			}
			can_spend_standard_ps_trigger = yes
		}
		trait = archmage
		stress_impact = {
			sadistic = minor_stress_loss
			compassionate = minor_stress_gain
		}
		scope:target1 = {
			save_scope_as = reci
		}
		trigger_event = magic_ev.10
		custom_tooltip = ev2.61.d_ct
		show_as_tooltip = {
			spend_standard_ps_effect = yes
		}
		ai_chance = {
			base = 20
			modifier = {
				add = -19
				OR = {
					has_trait = compassionate
					has_trait = lazy
				}
				
			}
			modifier = {
				add = 10
				has_trait = impatient
			}
		}
	}
	option = {
		name = ev7.110.b
		trigger = {
			can_start_scheme = {
				type = murder
				target_character = scope:target1
			}
		}
		start_scheme = {
			type = murder
			target_character = scope:target1
		}
		stress_impact = {
			sadistic = minor_stress_loss
			compassionate = minor_stress_gain
			deceitful = minor_stress_loss
		}
		ai_chance = {
			base = 10
			modifier = {
				add = -9
				OR = {
					has_trait = compassionate
					has_trait = honest
				}
				
			}
			modifier = {
				add = -20
				any_scheme = {
					is_hostile = yes
				}
			}
			modifier = {
				add = 10
				OR = {
					has_trait = patient
					has_trait = deceitful
				}
			}
			modifier = {
				add = 10
				has_trait = schemer
			}
		}
	}
	option = {
		name = ev4.38.0.b
		add_prestige = -200
		stress_impact = {
			lazy = minor_stress_loss
			compassionate = minor_stress_loss
		}
		ai_chance = {
			base = 9
			modifier = {
				add = 11
				has_trait = compassionate
			}
			modifier = {
				add = 20
				has_trait = lazy
			}
			modifier = {
				add = -8
				has_trait = sadistic
			}
			modifier = {
				add = -8
				has_trait = callous
			}
			modifier = {
				add = 1000
				OR = {
					has_relation_friend = scope:target1
					has_relation_best_friend = scope:target1
					has_relation_mmaster = scope:target1
					has_relation_lover = scope:target1
					has_relation_soulmate = scope:target1
				}
			}
			modifier = {
				add = -1000
				OR = {
					has_relation_rival = scope:target1
					has_relation_nemesis = scope:target1
				}
			}
		}
	}
}

#Mage Summit - another event... - searching for support
magic_ev7.111 = {
	type = activity_event
	title = ev7.111.title
	desc = ev7.111.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	right_portrait = {
		character = scope:mage0
		animation = personality_rational
	}

	trigger = {
		is_alive = yes
		is_ai = no
		OR = {
			has_focus = arcane_focus
			has_trait = archmage
			has_trait = true_witch
		}
		scope:activity = {
			any_attending_character = {
				NOR = {
					THIS = ROOT
					has_relation_rival = ROOT
					has_relation_nemesis = ROOT
					has_relation_mminion = ROOT
					has_hook = ROOT
				}
				OR = {
					has_focus = arcane_focus
					has_trait = archmage
					has_trait = true_witch
				}
			}
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						NOR = {
							THIS = ROOT
							has_relation_rival = ROOT
							has_relation_nemesis = ROOT
							has_relation_mminion = ROOT
							has_hook = ROOT
						}
						OR = {
							has_focus = arcane_focus
							has_trait = archmage
							has_trait = true_witch
						}
					}
					save_scope_as = mage0
				}
			}
		}
	}
	
	option = {
		name = ev7.111.a
		trigger = {
			has_usable_hook = scope:mage0
		}
		use_hook = scope:mage0
		custom_tooltip = ev7.111.a_ct
		hidden_effect = {
			scope:mage0 = {
				add_character_flag = ms_additional_support_flag
			}
		}
	}
	option = {
		name = ev7.111.b
		scope:mage0 = {
			add_hook = {
				type = favor_hook
				target = ROOT
			}
		}
		custom_tooltip = ev7.111.a_ct
		hidden_effect = {
			scope:mage0 = {
				add_character_flag = ms_additional_support_flag
			}
		}
	}
	option = {
		name = ev7.111.c
		pay_short_term_gold = {
			target = scope:mage0
			gold = medium_gold_value_check
		}
		custom_tooltip = ev7.111.a_ct
		hidden_effect = {
			scope:mage0 = {
				add_character_flag = ms_additional_support_flag
			}
		}
	}
	option = {
		name = ev7.111.d
		trigger = {
			OR = {
				has_trait = diplomat
				has_trait = schemer
			}
		}
		custom_tooltip = ev7.111.a_ct
		hidden_effect = {
			scope:mage0 = {
				add_character_flag = ms_additional_support_flag
			}
		}
	}
	option = {
		name = ev7.111.f
		trigger = {
			has_trait = archmage
			has_trait_xp = {
				trait = archmage
				track = secret_knowledge
				value < 100
			}
			has_ms_knowledge_sharing_intent_trigger = yes
		}
		reason = activity_intent
		gain_sc_xp1_effect = yes
		if = {
			limit = {
				scope:mage0 = {
					has_trait = archmage
					has_trait_xp = {
						trait = archmage
						track = secret_knowledge
						value < 100
					}
				}
			}
			scope:mage0 = {
				gain_sc_xp1_effect = yes
			}
		}
	}
	option = {
		name = ev7.111.e
	}
}

#magic epic - special projects
magic_ev7.112 = {
	type = character_event
	title = ev3.22.title
	desc = ev7.112.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	trigger = {
		is_imprisoned = no
	}
	option = {
		name = ev3.22.c	#magic ring
		trigger = {
			any_character_artifact = {
				has_variable = magic_ring0
				has_artifact_modifier = artifact_ring_of_life_modifier0
			}
		}
		trigger_event = {
			id = magic_ev6.26
			days = { 10 20 }
		}
		custom_tooltip = ev3.22.c_ct
		custom_tooltip = ev3.22.b2_ct
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = me_golem_option
		trigger = {
			has_character_flag = me_golem_project
			NOT = {
				has_character_flag = me_golem_project_done
			}
		}
		hidden_effect = {
			add_character_flag = me_golem_project_progress
			trigger_event = {
				id = magic_ev7.114
				days = { 10 20 }
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = me_time_travel_option
		trigger = {
			has_character_flag = me_time_travel_project
			NOT = {
				has_character_flag = me_time_travel_project_done
			}
		}
		hidden_effect = {
			add_character_flag = me_time_travel_project_progress
			trigger_event = {
				id = magic_ev7.114
				days = { 10 20 }
			}
		}
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = me_immortality_option
		trigger = {
			OR = {
				has_character_flag = me_immortality_project
				is_legendary_mage_trigger = yes
			}
			NOT = {
				has_character_flag = me_immortality_project_done
			}
		}
		hidden_effect = {
			add_character_flag = me_immortality_project_progress
			trigger_event = {
				id = magic_ev7.114
				days = { 10 20 }
			}
		}
		ai_chance = {
			base = 20
		}
	}
	option = {
		name = me_death_option
		trigger = {
			has_character_flag = me_death_project
			OR = {
				has_trait = necromancer
				is_cannibal_trigger = yes
			}
			NOT = {
				has_character_flag = me_death_project_done
			}
		}
		hidden_effect = {
			add_character_flag = me_death_project_progress
			trigger_event = {
				id = magic_ev7.114
				days = { 10 20 }
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = me_ascendency_option
		trigger = {
			has_character_flag = me_ascendency_project
			NOT = {
				has_trait = demon
			}
			NOT = {
				has_character_flag = me_ascendency_project_done
			}
		}
		hidden_effect = {
			add_character_flag = me_ascendency_project_progress
			trigger_event = {
				id = magic_ev7.114
				days = { 10 20 }
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = flying_castle_modifier
		trigger = {
			has_character_flag = me_castle_project
			NOT = {
				has_character_flag = me_castle_project_done
			}
		}
		hidden_effect = {
			add_character_flag = me_castle_project_progress
			trigger_event = {
				id = magic_ev7.114
				days = { 10 20 }
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = me_sing_option
		trigger = {
			has_character_flag = me_sing_project
			any_character_artifact = {
				has_variable = singularity
				NOR = {
					has_variable = singularity_sleeping
					has_variable = singularity2
				}
			}
			NOT = {
				has_character_flag = me_sing_project_done
			}
		}
		hidden_effect = {
			add_character_flag = me_sing_project_progress
			trigger_event = {
				id = magic_ev7.114
				days = { 10 20 }
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = me_soul_option
		trigger = {
			has_character_flag = me_soul_project
			NOT = {
				has_character_flag = me_soul_project_done
			}
		}
		hidden_effect = {
			add_character_flag = me_soul_project_progress
			trigger_event = {
				id = magic_ev7.114
				days = { 10 20 }
			}
		}
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev5.1.0.j
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = magic_epic_project
				}
				remove_character_flag = magic_epic_project
			}
		}
		remove_decision_cooldown = magic_epic_decision
		add_gold = medium_gold_value
		ai_chance = {
			base = 0
		}
	}
}

#magic epic - unlock new special projects
magic_ev7.113 = {
	type = character_event
	title = ev3.22.title
	desc = ev7.113.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	trigger = {
		is_imprisoned = no
		me_may_unlocks_special_project = yes
	}
	immediate = {
		me_unlock_new_special_project_effect = yes
	}
	option = {
		name = ev7.113.a
		if = {
			limit = {
				has_character_flag = me_golem_project_proposal
			}
			hidden_effect = {
				add_character_flag = me_golem_project
			}
			custom_tooltip = me_golem_project_ct
		}
		else_if = {
			limit = {
				has_character_flag = me_time_travel_project_proposal
			}
			hidden_effect = {
				add_character_flag = me_time_travel_project
			}
			custom_tooltip = me_time_travel_project_ct
		}
		else_if = {
			limit = {
				has_character_flag = me_immortality_project_proposal
			}
			hidden_effect = {
				add_character_flag = me_immortality_project
			}
			custom_tooltip = me_immortality_project_ct
		}
		else_if = {
			limit = {
				has_character_flag = me_death_project_proposal
			}
			hidden_effect = {
				add_character_flag = me_death_project
			}
			custom_tooltip = me_death_project_ct
		}
		else_if = {
			limit = {
				has_character_flag = me_ascendency_project_proposal
			}
			hidden_effect = {
				add_character_flag = me_ascendency_project
			}
			custom_tooltip = me_ascendency_project_ct
		}
		else_if = {
			limit = {
				has_character_flag = me_castle_project_proposal
			}
			hidden_effect = {
				add_character_flag = me_castle_project
			}
			custom_tooltip = me_castle_project_ct
		}
		else_if = {
			limit = {
				has_character_flag = me_sing_project_proposal
			}
			hidden_effect = {
				add_character_flag = me_sing_project
			}
			custom_tooltip = me_sing_project_ct
		}
		else_if = {
			limit = {
				has_character_flag = me_soul_project_proposal
			}
			hidden_effect = {
				add_character_flag = me_soul_project
			}
			custom_tooltip = me_soul_project_ct
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.113.b
		add_learning_skill = 1
		ai_chance = {
			base = 0
		}
	}
	after = {
		hidden_effect = {
			me_clear_proposal_flags_effect = yes
		}
	}
}

#magic epic - special project 1.
magic_ev7.114 = {
	type = character_event
	title = ev3.22.title
	desc = ev7.114.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	trigger = {
		is_imprisoned = no
	}
	option = {
		name = ev7.114.a	#I will be meticulous.
		stress_impact = {
			impatient = minor_stress_gain
			patient = minor_stress_loss
		}
		add_prestige = -100
		trigger_event = {
			id = magic_ev3.25
			months = { 2 4 }
		}
	}
	option = {
		name = ev7.114.b	#I won't fall asleep until I do it.
		if = {
			limit = {
				NOR = {
					has_trait = diligent
					has_trait = lazy
					has_trait = patient
					has_trait = impatient
				}
			}
			add_stress = medium_stress_gain
		}
		else = {
			stress_impact = {
				diligent = medium_stress_loss
				lazy = medium_stress_gain
				impatient = minor_stress_loss
				patient = minor_stress_gain
			}
		}
		trigger_event = {
			id = magic_ev3.25
			months = 1
		}
	}
	after = {
		custom_tooltip = ev3.25.a_ct
	}
}

#magic epic - special project 3.
magic_ev7.115 = {
	type = character_event
	title = ev3.22.title
	desc = ev7.115.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
	}
	immediate = {
		custom_tooltip = ev3.25.a_ct
	}
	option = {
		name = ev7.115.c
		trigger = {
			has_trait = scholar
		}
		trait = scholar
		custom_tooltip = ev3.25.b_ct
		hidden_effect = {
			change_variable = {
				name = magic_epic_q
				add = 1
			}
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev7.115.a
		stress_impact = {
			calm = minor_stress_loss
		}
		duel = {
			skill = learning
			value = 25
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				
				send_interface_toast = {
					title=ev3.52.a_1
					custom_tooltip = ev3.25.b_ct
				}
				hidden_effect = {
					change_variable = {
						name = magic_epic_q
						add = 1
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					custom_tooltip = ev7.115.a_ct
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev7.115.b
		stress_impact = {
			diligent = minor_stress_gain
		}
		custom_tooltip = ev7.115.a_ct
		ai_chance = {
			base = 1
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					var:magic_epic_q < 2
				}
				trigger_event = {
					id = magic_ev7.116	#failure
					months = 1
				}
			}
			else_if = {
				limit = {
					has_character_flag = me_golem_project_progress
				}
				trigger_event = {
					id = magic_ev7.118	#succeded - golem
					months = 1
				}
			}
			else_if = {
				limit = {
					has_character_flag = me_time_travel_project_progress
				}
				trigger_event = {
					id = magic_ev8.5	#succeded - time travel
					months = 1
				}
			}
			else = {
				trigger_event = {
					id = magic_ev7.117	#succeded - the rest
					months = 1
				}
			}
		}
	}
}

#magic epic - failure
magic_ev7.116 = {
	type = character_event
	title = ev3.52.a_2
	desc = ev7.116.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
	}
	immediate = {
		custom_tooltip = ev7.116.a_ct
		add_learning_skill = 1
	}
	option = {
		name = ev5.21.0.a	#damn!
		if = {
			limit = {
				NOT = {
					has_trait = ambitious
				}
			}
			add_stress = medium_stress_gain
		}
		else = {
			stress_impact = {
				ambitious = major_stress_gain
			}
		}
	}
	option = {
		name = ev7.116.a
		trigger = {
			has_trait = humble
		}
		add_stress = medium_stress_loss
	}
	option = {
		name = playdate.5003.b
		trigger = {
			has_trait = scholar
		}
		add_stress = massive_stress_gain
		remove_decision_cooldown = magic_epic_decision
	}
	option = {
		name = playdate.5003.b
		trigger = {
			OR = {
				has_trait = stubborn
				has_trait = impatient
			}
			NOT = {
				has_trait = scholar
			}
		}
		add_stress = massive_stress_gain
		remove_decision_cooldown = magic_epic_decision
	}
	after = {
		hidden_effect = {
			me_clear_progress_flags_effect = yes
		}
	}
}
#magic epic - succeded
magic_ev7.117 = {
	type = character_event
	title = game_concept_magic_special_project
	#desc = ev7.117.desc
	desc = {
		desc = ev7.117.desc
		triggered_desc = {
			trigger = {
				has_character_flag = me_immortality_project_progress
			}
			#desc = me_golem_optiom
			desc = me_immortality_option
		}
		triggered_desc = {
			trigger = {
				has_character_flag = me_death_project_progress
			}
			desc = me_death_option
		}
		triggered_desc = {
			trigger = {
				has_character_flag = me_time_travel_project_progress
			}
			desc = me_time_travel_option
		}
		triggered_desc = {
			trigger = {
				has_character_flag = me_ascendency_project_progress
			}
			desc = me_ascendency_option
		}
		triggered_desc = {
			trigger = {
				has_character_flag = me_castle_project_progress
			}
			desc = flying_castle_modifier
		}
		triggered_desc = {
			trigger = {
				has_character_flag = me_sing_project_progress
			}
			desc = me_sing_option
		}
		triggered_desc = {
			trigger = {
				has_character_flag = me_soul_project_progress
			}
			desc = me_soul_option
		}
		desc = ev7.117.desc2
	}
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
	}
	immediate = {
		custom_tooltip = ev3.28.a_ct
		add_stress = medium_stress_loss
		add_learning_skill = 1
		gain_sc_xp10_effect = yes
	}
	option = {
		name = ev7.117.a
		trigger = {
			has_character_flag = me_immortality_project_progress
		}
		add_trait = supernatural_vampire #lol, change this to the event or it bugs)
		hidden_effect = {
			add_character_flag = me_immortality_project_done
		}
	}
	option = {
		name = ev7.117.b
		trigger = {
			has_character_flag = me_death_project_progress
			has_trait = necromancer
		}
		trait = necromancer
		hidden_effect = {
			remove_trait = necromancer
			if = {
				limit = {
					has_trait = incapable
				}
				remove_trait = incapable
			}
			if = {
				limit = {
					has_trait = cancer
				}
				remove_trait = cancer
			}
			if = {
				limit = {
					has_trait = ill
				}
				remove_trait = ill
			}
			if = {
				limit = {
					has_trait = measles
				}
				remove_trait = measles
			}
			if = {
				limit = {
					has_trait = maimed
				}
				remove_trait = maimed
			}
			if = {
				limit = {
					has_trait = infertile
				}
				remove_trait = infertile
			}
			if = {
				limit = {
					has_trait = lovers_pox
				}
				remove_trait = lovers_pox
			}
			if = {
				limit = {
					has_trait = gout_ridden
				}
				remove_trait = gout_ridden
			}
			if = {
				limit = {
					has_trait = consumption
				}
				remove_trait = consumption
			}
			if = {
				limit = {
					has_trait = typhus
				}
				remove_trait = typhus
			}
			if = {
				limit = {
					has_trait = bubonic_plague
				}
				remove_trait = bubonic_plague
			}
			if = {
				limit = {
					has_trait = smallpox
				}
				remove_trait = smallpox
			}
			if = {
				limit = {
					has_trait = dysentery
				}
				remove_trait = dysentery
			}
			if = {
				limit = {
					has_trait = ergotism
				}
				remove_trait = ergotism
			}
			if = {
				limit = {
					has_trait = disfigured
				}
				remove_trait = disfigured
			}
			if = {
				limit = {
					has_trait = measles
				}
				remove_trait = measles
			}
		}
		add_trait = necromancer

		hidden_effect = {
			add_character_flag = me_death_project_done
		}
	}
	option = {
		name = ev7.117.c
		trigger = {
			has_character_flag = me_death_project_progress
			is_cannibal_trigger = yes
		}
		trait = cannibal
		custom_tooltip = ev7.117.c_ct
		hidden_effect = {
			add_character_flag = me_death_project_done
			add_character_flag = me_death_project_done2
		}
	}
	option = {
		name = ev7.117.a
		trigger = {
			has_character_flag = me_ascendency_project_progress
		}
		if = {
			limit = {
				NOT = {
					has_trait = source
				}
			}
			add_min_source_trait = yes
		}
		add_trait = demon
		#add_trait_xp = {
		#	trait = demon
		#	value = 25
		#}
		hidden_effect = {
			add_character_flag = me_ascendency_project_done
		}
	}
	option = {
		name = ev7.117.d
		trigger = {
			has_character_flag = me_castle_project_progress
			is_landed_or_landless_administrative = yes
			exists = capital_province
		}
		capital_province = {
			hidden_effect = {
				if = {
					limit = {
						has_province_modifier = flying_castle_modifier
					}
					remove_province_modifier = flying_castle_modifier
				}
			}
			add_province_modifier = {
				modifier = flying_castle_modifier
				#years = 100
			}
		}
		#primary_title = {
		#	province = {
		#		
		#	}
		#}
		if = {
			limit = {
				trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = root.faith GENDER_CHARACTER = root }
			}
			add_character_modifier = {
				modifier = devils_servant_modifier
				years = 5
			}
			add_piety_level = -1
		}
		add_prestige = massive_prestige_gain
		hidden_effect = {
			add_character_flag = me_castle_project_done
			set_variable = {
				name = province_with_flying_castle
				value = capital_province
			}
		}
	}
	option = {
		name = ev7.117.e
		trigger = {
			has_character_flag = me_sing_project_progress
			any_character_artifact = {
				has_variable = singularity
				NOR = {
					has_variable = singularity_sleeping
					has_variable = singularity2
				}
			}
		}
		random_character_artifact = {
			limit = {
				has_variable = singularity
				NOR = {
					has_variable = singularity_sleeping
					has_variable = singularity2
				}
			}
			destroy_artifact = THIS
		}
		create_ancient_singularity_v3_effect = { OWNER = root }
		hidden_effect = {
			#scope:newly_created_artifact={
			#	set_variable=magic1
			#}
			add_character_flag = me_sing_project_done
		}
	}
	option = {
		name = ev7.117.f
		trigger = {
			has_character_flag = me_soul_project_progress
		}
		custom_tooltip = ev7.117.f_ct
		hidden_effect = {
			add_character_flag = me_soul_project_done
		}
	}
	option = {
		name = ev7.117.z
	}
	after = {
		hidden_effect = {
			me_clear_progress_flags_effect = yes
		}
	}
}

#magic epic - special project - golem1
magic_ev7.118 = {
	type = character_event
	title = me_golem_option
	desc = ev7.118.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
	}
	option = {
		name = ev7.118.a
		hidden_effect = {
			add_character_flag = me_golem_male
		}
	}
	option = {
		name = ev7.118.b
		hidden_effect = {
			add_character_flag = me_golem_female
		}
	}
	after = {
		trigger_event = {
			id = magic_ev7.119
			days = 7
		}
	}
}
#magic epic - special project - golem2
magic_ev7.119 = {
	type = character_event
	title = me_golem_option
	desc = ev7.119.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:golem
		outfit_tags = { no_clothes }
	}
	widgets = {
		widget = {
			gui = "event_window_widget_name_child"
			container = "dynamic_birth_name"
			controller = name_character
			setup_scope = { scope:golem = { save_scope_as = name_character_target } }
		}
	}
	trigger = {
		is_imprisoned = no
	}
	immediate = {
		custom_tooltip = ev3.28.a_ct
		add_stress = medium_stress_loss
		add_learning_skill = 1
		gain_sc_xp10_effect = yes
		if = {
			limit = {
				has_character_flag = me_golem_male
			}
			create_character = {
				name = golem_name
				employer = root
				culture = root.culture
				faith = root.faith
				dynasty_house = root.house
				gender = male
				template = golem_character
				save_scope_as = golem
				after_creation = {
					add_trait = beauty_good_3
					add_character_flag = no_soul
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = me_golem_female
			}
			create_character = {
				name = golem_name2
				employer = root
				culture = root.culture
				faith = root.faith
				dynasty_house = root.house
				gender = female
				template = golem_character
				save_scope_as = golem
				after_creation = {
					add_trait = beauty_good_3
					add_character_flag = no_soul
				}
			}
		}
	}
	option = {
		name = ev7.119.a
		hidden_effect = {
			add_character_flag = me_golem_project_done
			set_relation_mminion = scope:golem
			add_hook = {
				type = magic_domination_hook
				target = scope:golem
			}
		}
	}
	after = {
		hidden_effect = {
			me_clear_progress_flags_effect = yes
			trigger_event = {
				id = magic_ev7.120
				months = 1
			}
		}
	}
}

#magic epic - special project - golem3
magic_ev7.120 = {
	type = character_event
	title = ev7.120.title
	desc = ev7.120.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:golem
	trigger = {
		is_imprisoned = no
		scope:golem = {
			is_alive = yes
		}
	}
	
	option = {
		name = ev7.120.a
		scope:golem = {
			if = {
				limit = {
					has_trait = intellect_bad_3
				}
				remove_trait = intellect_bad_3
			}
			random_list = {
				1 = {
					add_trait = education_diplomacy_2
				}
				1 = {
					add_trait = education_martial_2
				}
				1 = {
					add_trait = education_stewardship_2
				}
				1 = {
					add_trait = education_intrigue_2
				}
				1 = {
					add_trait = education_learning_2
				}
			}
		}
	}
	option = {
		name = ev7.120.b
		scope:golem = {
			add_trait = giant
			add_trait = lifestyle_blademaster
			add_trait_xp = {
				trait = lifestyle_blademaster
				value = 60
			}
		}
		
	}
	option = {
		name = ev7.120.c
		scope:golem = {
			add_min_source_trait = yes
		}
		
	}
	option = {
		name = ev7.120.d
		trigger = {
			has_trait = intellect_good_3
		}
		trait = intellect_good_3
		scope:golem = {
			if = {
				limit = {
					has_trait = intellect_bad_3
				}
				remove_trait = intellect_bad_3
			}
			random_list = {
				1 = {
					add_trait = education_diplomacy_2
				}
				1 = {
					add_trait = education_martial_2
				}
				1 = {
					add_trait = education_stewardship_2
				}
				1 = {
					add_trait = education_intrigue_2
				}
				1 = {
					add_trait = education_learning_2
				}
			}
			add_trait = giant
			add_trait = lifestyle_blademaster
			add_min_source_trait = yes
		}
	}
	after = {
		hidden_effect = {
			random = {
				chance = 90
				trigger_event = {
					id = magic_ev7.113
					days = 7
				}
			}
			trigger_event = {
				id = magic_ev7.133
				months = 3
			}
		}
	}
}

#new Astaroth
magic_ev7.121 = {
	type = character_event
	title = ev7.70.0.b_ct
	desc = ev7.121.desc
	theme = dread
	override_background = {
		reference = bedchamber
	}
	left_portrait = root
	trigger = {
		has_character_flag = no_soul
		is_alive = yes
		NOT = {
			has_game_rule = low_whunters
		}
	}
	
	option = {
		name = ev7.121.a
		add_stress = minor_stress_gain
	}
	after = {
		hidden_effect = {
			save_scope_as = tttarget
			trigger_event = magic_ev2.79
		}
	}
}
#advanced magic triangulation 1
magic_ev7.122 = {
	type = character_event
	title = ev9.0.title
	desc = ev7.122.desc
	theme = witchcraft
	left_portrait = root
	
	option = {
		name = singularity_name
		trigger = {
			NOT = {
				any_character_artifact = {
					has_variable = singularity
				}
			}
			any_artifact = {
				has_variable = singularity
			}
		}
		hidden_effect = {
			random_artifact = {
				limit = {
					has_variable = singularity
				}
				save_scope_as = artif
			}
		}
	}
	option = {
		name = immortality_ring
		trigger = {
			NOT = {
				any_character_artifact = {
					has_variable = magic_ring
					has_variable = magic1
				}
			}
			any_artifact = {
				has_variable = magic_ring
				has_variable = magic1
			}
		}
		hidden_effect = {
			random_artifact = {
				limit = {
					has_variable = magic_ring
					has_variable = magic1
				}
				save_scope_as = artif
			}
		}
	}
	option = {
		name = blackgrimoire
		trigger = {
			NOT = {
				any_character_artifact = {
					has_variable = blackgrimoire
				}
			}
			any_artifact = {
				has_variable = blackgrimoire
			}
		}
		hidden_effect = {
			random_artifact = {
				limit = {
					has_variable = blackgrimoire
				}
				save_scope_as = artif
			}
		}
	}
	option = {
		name = dark_blade
		trigger = {
			NOT = {
				any_character_artifact = {
					has_variable = dark_blade
				}
			}
			any_artifact = {
				has_variable = dark_blade
			}
		}
		hidden_effect = {
			random_artifact = {
				limit = {
					has_variable = dark_blade
				}
				save_scope_as = artif
			}
		}
	}
	option = {
		name = crown_shadows
		trigger = {
			NOT = {
				any_character_artifact = {
					has_variable = magic_crown
				}
			}
			any_artifact = {
				has_variable = magic_crown
			}
		}
		hidden_effect = {
			random_artifact = {
				limit = {
					has_variable = magic_crown
				}
				save_scope_as = artif
			}
		}
	}
	option = {
		name = magic_catalyst
		trigger = {
			NOT = {
				any_character_artifact = {
					has_variable = catalyst
				}
			}
			any_artifact = {
				has_variable = catalyst
			}
		}
		hidden_effect = {
			random_artifact = {
				limit = {
					has_variable = catalyst
				}
				save_scope_as = artif
			}
		}
	}
	option = {
		name = dragon_scales
		trigger = {
			NOT = {
				any_character_artifact = {
					has_variable = dragon_scales
				}
			}
			any_artifact = {
				has_variable = dragon_scales
			}
		}
		hidden_effect = {
			random_artifact = {
				limit = {
					has_variable = dragon_scales
				}
				save_scope_as = artif
			}
		}
	}
	option = {
		name = hells_scepter
		trigger = {
			NOT = {
				any_character_artifact = {
					has_variable = magic_scepter
				}
			}
			any_artifact = {
				has_variable = magic_scepter
			}
		}
		hidden_effect = {
			random_artifact = {
				limit = {
					has_variable = magic_scepter
				}
				save_scope_as = artif
			}
		}
	}
	after = {
		trigger_event = magic_ev.9
	}
}
#advanced magic triangulation 2
magic_ev7.123 = {
	type = character_event
	title = ev9.0.title
	desc = ev7.122.desc
	theme = witchcraft
	left_portrait = root
	
	option = {
		name = building_witch_house
		trigger = {
			has_witch_house_trigger = no
		}
		hidden_effect = {
			random_ruler = {
				limit = {
					NOT = {	THIS = ROOT	}
					has_witch_house_trigger = yes
				}
				save_scope_as = owner_p
			}
			scope:owner_p = {
				random_held_county = {
					limit = {
						any_county_province = {
							has_building_or_higher = witch_house
						}
					}
					save_scope_as = magic_t
					title_province = {
						save_scope_as = magic_p
					}
				}
			}
		}
	}
	option = {
		name = building_horned_god_house
		trigger = {
			has_dark_temple_trigger = no
		}
		hidden_effect = {
			random_ruler = {
				limit = {
					NOT = {	THIS = ROOT	}
					has_dark_temple_trigger = yes
				}
				save_scope_as = owner_p
			}
			scope:owner_p = {
				random_held_county = {
					limit = {
						any_county_province = {
							has_building_or_higher = horned_god_house
						}
					}
					save_scope_as = magic_t
					title_province = {
						save_scope_as = magic_p
					}
				}
			}
		}
	}
	option = {
		name = building_mage_house
		trigger = {
			has_mage_academy_trigger = no
		}
		hidden_effect = {
			random_ruler = {
				limit = {
					NOT = {	THIS = ROOT	}
					has_mage_academy_trigger = yes
				}
				save_scope_as = owner_p
			}
			scope:owner_p = {
				random_held_county = {
					limit = {
						any_county_province = {
							has_building_or_higher = mage_house
						}
					}
					save_scope_as = magic_t
					title_province = {
						save_scope_as = magic_p
					}
				}
			}
		}
	}
	after = {
		trigger_event = magic_ev4.83
	}
}

#new blackgrimoire
magic_ev7.124 = {
	type = character_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = necro_chapter5_flag
				}
				desc = necro_chapter5
			}
			triggered_desc = {
				trigger = {
					has_character_flag = necro_chapter4_flag
				}
				desc = necro_chapter4
			}
			triggered_desc = {
				trigger = {
					has_character_flag = necro_chapter3_flag
				}
				desc = necro_chapter3
			}
			triggered_desc = {
				trigger = {
					has_character_flag = necro_chapter2_flag
				}
				desc = necro_chapter2
			}
			desc = necro_chapter1
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = necro_chapter5_flag
				}
				desc = necro_chapter_desc5
			}
			triggered_desc = {
				trigger = {
					has_character_flag = necro_chapter4_flag
				}
				desc = necro_chapter_desc4
			}
			triggered_desc = {
				trigger = {
					has_character_flag = necro_chapter3_flag
				}
				desc = necro_chapter_desc3
			}
			triggered_desc = {
				trigger = {
					has_character_flag = necro_chapter2_flag
				}
				desc = necro_chapter_desc2
			}
			desc = necro_chapter_desc1
		}
	}
	theme = witchcraft
	left_portrait = root
	immediate = {
		hidden_effect = {
			choose_blackgrimoire_reward_effect = yes
		}
	}
	option = {
		name = ev7.124.a
		
	}
	after = {
		hidden_effect = {
			choose_blackgrimoire_chapter_effect = yes
		}
		#hidden_effect = {
		#	if = {
		#		limit = {
		#			NOT = {
		#				has_character_flag = necro_chapter1_flag
		#			}
		#		}
		#		add_character_flag = necro_chapter1_flag
		#	}
		#	else_if = {
		#		limit = {
		#			NOT = {
		#				has_character_flag = necro_chapter2_flag
		#			}
		#		}
		#		add_character_flag = necro_chapter2_flag
		#	}
		#	else_if = {
		#		limit = {
		#			NOT = {
		#				has_character_flag = necro_chapter3_flag
		#			}
		#		}
		#		add_character_flag = necro_chapter3_flag
		#	}
		#	else_if = {
		#		limit = {
		#			NOT = {
		#				has_character_flag = necro_chapter4_flag
		#			}
		#		}
		#		add_character_flag = necro_chapter4_flag
		#	}
		#	else_if = {
		#		limit = {
		#			NOT = {
		#				has_character_flag = necro_chapter5_flag
		#			}
		#		}
		#		add_character_flag = necro_chapter5_flag
		#	}
		#}
	}
}

#Nyx - stage 2.1
magic_ev7.125 = {
	type = character_event
	title = nyx_name
	desc = ev7.125.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = pain
	}
	immediate = {
		hidden_effect = {
			scope:demon = {
				add_trait = wounded_3
			}
		}
	}
	option = {
		name = ev7.125.a
		trigger_event = magic_ev7.126
	}
}
#Nyx - stage 2.2
magic_ev7.126 = {
	type = character_event
	title = nyx_name
	desc = ev7.126.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	option = {
		name = ev7.126.a
		trigger_event = magic_ev7.127
	}
}
#Nyx - stage 2.3
magic_ev7.127 = {
	type = character_event
	title = nyx_name
	desc = ev7.127.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = grief
	}
	option = {
		name = ev7.127.a
		trigger_event = magic_ev7.128
		if = {
			limit = {
				NOT = {
					has_trait = arrogant
				}
			}
			add_stress = minor_stress_gain
		}
		else = {
			stress_impact = {
				arrogant = major_stress_gain
			}
		}
	}
	
	option = {
		name = ev7.127.b
		custom_tooltip = start_duel_ct
		hidden_effect = {
			add_character_flag = nyx_no_more_flag
			scope:demon = {
				remove_trait = wounded_3
				add_trait = wounded_1
			}
		}
		configure_start_mage_duel_effect = {
			MD_ATTACKER = root
			MD_DEFENDER = scope:demon
		}
	}
	option = {
		name = ev7.127.c
		trigger = {
			diplomacy > 20
		}
		skill = diplomacy
		hidden_effect = {
			scope:demon = {
				move_to_pool = yes
			}
		}
		add_courtier = scope:demon
		set_relation_friend = scope:demon
	}
}
#Nyx - stage 2.4
magic_ev7.128 = {
	type = character_event
	title = nyx_name
	desc = ev7.128.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = grief
	}
	option = {
		name = ev7.128.a
		trigger_event = magic_ev6.9
	}
}

#the ultimate spell
magic_ev7.129 = {
	type = character_event
	title = ultimate_spell_modifier
	desc = ev7.129.desc
	theme = realm
	left_portrait = root
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_medicine.dds"
	}
	option = {
		name = ev7.129.f
		trigger = {
			is_legendary_mage_trigger = yes
			NOT = {
				exists = global_var:us_magic_barrier_var
			}
		}
		stress_impact = {
			craven = major_stress_loss
		}
		custom_tooltip = ev7.129.f_ct
		custom_tooltip = ev7.129.f_ct2
		custom_tooltip = ev7.129.f_ct3
		hidden_effect = {
			add_character_flag = us_magic_barrier_flag
			set_global_variable = us_magic_barrier_var
		}
		
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev7.129.f2
		trigger = {
			is_legendary_mage_trigger = yes
			exists = global_var:us_magic_barrier_var
		}
		custom_tooltip = ev7.129.f2_ct
		custom_tooltip = ev7.129.f2_ct2
		hidden_effect = {
			every_living_character = {
				limit = {
					has_character_flag = us_magic_barrier_flag
				}
				remove_character_flag = us_magic_barrier_flag
			}
			remove_global_variable = us_magic_barrier_var
		}
		
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev7.129.a
		save_scope_as = mass_healer_ultimate_spell
		stress_impact = {
			compassionate = massive_stress_loss
			sadistic = massive_stress_gain
		}
		custom_tooltip = ev7.129.a_ct
		every_living_character = {
			limit = {
				requires_magic_healing_trigger = yes
			}
			full_healing_effect = yes
		}
		every_ruler = {
			limit = {
				is_ai = no
			}
			trigger_event = {
				id = magic_ev8.46
				days = 1
			}
		}
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev7.129.b
		trigger = {
			NOT = {
				exists = global_var:us_magic_barrier_var
			}
		}
		stress_impact = {
			ambitious = massive_stress_loss
			education_martial_1 = massive_stress_loss
			education_martial_2 = massive_stress_loss
			education_martial_3 = massive_stress_loss
			education_martial_4 = massive_stress_loss
			education_martial_5 = massive_stress_loss
		}
		spawn_army = {
			name = demonic_knights
			men_at_arms = {
				type = demonic_knights
				stacks = 10
			}
			inheritable = no
			uses_supply = no
			location = root.location
		}
		gain_demonology_standard_effect = yes
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev7.129.c
		stress_impact = {
			arrogant = massive_stress_loss
			greedy = massive_stress_loss
		}
		add_trait_xp = {
			trait = archmage
			track = power_saturation
			value = 100
		}
		if = {
			limit = {
				has_trait = demon
				has_trait_xp = {
					trait = demon
					value < 100
				}
			}
			add_trait_xp = {
				trait = demon
				value = 25
			}
		}
		if = {
			limit = {
				NOT = {
					has_character_modifier = mind_reader_modifier
				}
			}
			add_character_modifier = {
				modifier = mind_reader_modifier
			}
		}
		if = {
			limit = {
				NOT = {
					has_trait = source
				}
			}
			add_min_source_trait = yes
		}
		else_if = {
			limit = {
				NOT = {
					is_the_choosen_one_trigger = yes
				}
			}
			add_diplomacy_skill = 1
			add_martial_skill = 1
			add_stewardship_skill = 1
			add_intrigue_skill = 1
			add_learning_skill = 1
			random = {
				chance = 50
				add_5_magic_potential = yes
			}
		}
		else = {
			add_diplomacy_skill = 1
			add_martial_skill = 1
			add_stewardship_skill = 1
			add_intrigue_skill = 1
			add_learning_skill = 1
		}
		ai_chance = {
			base = 50
		}
	}
	option = {
		name = ev7.129.d
		stress_impact = {
			vengeful = massive_stress_loss
			deceitful = massive_stress_loss
		}
		add_trait_xp = {
			trait = archmage
			track = power_saturation
			value = 100
		}
		add_character_modifier = {
			modifier = ultimate_spell_modifier
		}
		gain_cm_xp5_effect = yes
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev7.129.e
		trigger = {
			is_the_choosen_one_trigger = yes
			is_decision_on_cooldown = magic_epic_decision
		}
		stress_impact = {
			ambitious = medium_stress_loss
			scholar = medium_stress_loss
			lazy = medium_stress_gain
			impatient = minor_stress_loss
			patient = minor_stress_gain
		}
		
		remove_decision_cooldown = magic_epic_decision
		ai_chance = {
			base = 0
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = ready_for_grand_spell_flag
				}
				remove_character_flag = ready_for_grand_spell_flag
			}
		}
	}
}

#for ai, teach sorcery
magic_ev7.130 = {
	hidden = yes
	trigger = {
		is_ai = yes
		NOR = {
			has_trait = incapable
			has_trait = archmage
		}
	}
	immediate = {
		turn_into_mage_effect = yes
	}
}

#for ai, teach sorcery progress
magic_ev7.131 = {
	hidden = yes
	trigger = {
		is_ai = yes
		NOR = {
			has_trait = incapable
			has_trait = archmage
		}
	}
	immediate = {
		turn_into_mage_progress_effect = yes
		trigger_event = {
			id = magic_ev7.131
			years = 1
		}
	}
}

#Magic Ending Story Event
magic_ev7.132 = {
	type = character_event
	window = fullscreen_event
	title = story_event_legends.0001.t
	desc = {
		desc = story_event_legends.0001.desc.intro
		desc = ev7.132.desc
		desc = story_event_legends.0001.desc.outro
	}
	theme = legend
	override_background = { reference = ce1_fullscreen_legitimizing_legend }
	override_sound = { reference = "event:/DLC/FP4/SFX/UI/Unique/sfx_ui_spread_legend" }

	immediate = {
		play_music_cue = mx_cue_legend
		set_variable = {
			name = finished_legend_var
			value = scope:promoted_legend
		}
		scope:promoted_legend = { set_variable = my_legend_var }
	}
	option = {
		name = story_event_legends.0001.a
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}
}

#magic epic - special project - golem3
magic_ev7.133 = {
	type = character_event
	title = ev7.133.title
	desc = ev7.133.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:golem
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:golem = {
			is_alive = yes
		}
	}
	
	option = {
		name = ev7.133.a
		scope:golem = {
			add_diplomacy_skill = 20
		}
		add_diplomacy_lifestyle_perk_points = 1
	}
	option = {
		name = ev7.133.b
		scope:golem = {
			add_martial_skill = 20
		}
		add_martial_lifestyle_perk_points = 1
	}
	option = {
		name = ev7.133.c
		scope:golem = {
			add_stewardship_skill = 20
		}
		add_stewardship_lifestyle_perk_points = 1
	}
	option = {
		name = ev7.133.d
		scope:golem = {
			add_learning_skill = 20
		}
		add_learning_lifestyle_perk_points = 1
	}
	option = {
		name = ev7.133.e
		scope:golem = {
			add_intrigue_skill = 20
		}
		add_intrigue_lifestyle_perk_points = 1
	}
}

#ritual of greater protection
magic_ev7.134 = {
	type = character_event
	title = magic_defence_decision
	desc = ev7.134.desc
	theme = witchcraft
	left_portrait = root
	lower_left_portrait = {
		trigger = {
			exists = root.player_heir
		}
		character = root.player_heir
	}
	lower_center_portrait = {
		trigger = {
			exists = root.primary_partner
		}
		character = root.primary_partner
	}
	lower_right_portrait = {
		trigger = {
			exists = scope:target0
		}
		character = scope:target0
	}
	
	trigger = {
		is_alive = yes
		has_trait = archmage
		is_imprisoned = no
		can_spend_standard_ps_trigger = yes
		OR = {
			exists = primary_partner
			exists = player_heir
		}
	}
	immediate = {
		hidden_effect = {
			random_relation = {
				limit = {
					NOR = {
						THIS = ROOT.primary_partner
						THIS = ROOT.player_heir
					}
				}
				type = soulmate
				save_scope_as = target0
			}
			if = {
				limit = {
					NOT = {
						exists = scope:target0
					}
				}
				random_relation = {
					limit = {
						NOR = {
							THIS = ROOT.primary_partner
							THIS = ROOT.player_heir
						}
					}
					type = best_friend
					save_scope_as = target0
				}
			}
		}
	}
	
	option = {
		name = ev7.134.a
		trigger = {
			exists = player_heir
			player_heir = {
				NOR = {
					has_character_modifier = amp_modifier
					has_character_modifier = master_defence_modifier
				}
			}
		}
		spend_standard_ps_effect = yes
		if = {
			limit = {
				any_character_artifact = {
					has_variable = catalyst
				}
			}
			player_heir = {
				add_character_modifier = {
					modifier = amp_modifier
					years = 20
				}
				add_character_modifier = {
					modifier = master_defence_modifier
					years = 20
				}
			}
		}
		else = {
			player_heir = {
				add_character_modifier = {
					modifier = amp_modifier
					years = 20
				}
				add_character_modifier = {
					modifier = master_defence_modifier
					years = 20
				}
			}
		}
		
		gain_cm_xp1_effect = yes
		gain_sc_xp1_effect = yes
		hidden_effect = {
			metamagic_effect = yes
		}
	}
	option = {
		name = ev7.134.b
		trigger = {
			exists = primary_partner
			primary_partner = {
				NOR = {
					has_character_modifier = amp_modifier
					has_character_modifier = master_defence_modifier
				}
			}
		}
		spend_standard_ps_effect = yes
		if = {
			limit = {
				any_character_artifact = {
					has_variable = catalyst
				}
			}
			primary_partner = {
				add_character_modifier = {
					modifier = amp_modifier
					years = 20
				}
				add_character_modifier = {
					modifier = master_defence_modifier
					years = 20
				}
			}
		}
		else = {
			primary_partner = {
				add_character_modifier = {
					modifier = amp_modifier
					years = 20
				}
				add_character_modifier = {
					modifier = master_defence_modifier
					years = 20
				}
			}
		}
		gain_cm_xp1_effect = yes
		gain_sc_xp1_effect = yes
		hidden_effect = {
			metamagic_effect = yes
		}
	}
	option = {
		name = ev7.134.c
		trigger = {
			exists = scope:target0
			scope:target0 = {
				NOR = {
					has_character_modifier = amp_modifier
					has_character_modifier = master_defence_modifier
				}
			}
		}
		spend_standard_ps_effect = yes
		scope:target0 = {
			add_character_modifier = {
				modifier = amp_modifier
				years = 10
			}
			add_character_modifier = {
				modifier = master_defence_modifier
				years = 10
			}
		}
		gain_cm_xp1_effect = yes
		gain_sc_xp1_effect = yes
		hidden_effect = {
			metamagic_effect = yes
		}
	}
	option = {
		name = ev7.134.d
	}
}

#Additional secret knowledge
magic_ev7.135 = {
	type = character_event
	title = ev7.135.title
	desc = ev7.135.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:wmage0
	
	trigger = {
		is_alive = yes
		has_trait = archmage
		has_trait_xp = {
			trait = archmage
			track = secret_knowledge
			value > 24
		}
		has_trait_xp = {
			trait = archmage
			track = secret_knowledge
			value < 100
		}
		is_imprisoned = no
		NOT = {
			has_character_flag = uses_additional_knowledge_flag
		}
	}
	on_trigger_fail = {
		trigger_event = {
			id = magic_ev7.135
			years = { 2 4 }
		}
		if = {
			limit = {
				is_ai = yes
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
				NOT = {
					has_character_flag = uses_additional_knowledge_flag
				}
			}
			gain_sc_xp2_effect = yes
		}
	}
	immediate = {
		hidden_effect = {
			create_pure_wandering_mage_effect = yes
			scope:wmage0 = {
				add_trait = drunkard
			}
		}
	}
	option = {
		name = ev2.2.a	#I'll take it!
		stress_impact = {
			greedy = medium_stress_gain
			scholar = medium_stress_loss
			lifestyle_mystic = minor_stress_loss
		}
		#remove_short_term_gold = demon_gold_value
		pay_short_term_gold = {
			target = scope:wmage0
			gold = demon_gold_value
		}
		gain_sc_xp2_effect = yes
		gain_cm_xp5_effect = yes
		if = {
			limit = {
				me_may_unlocks_special_project = yes
			}
			random = {
				chance = 10
				custom_tooltip = ev3.22.a3_ct
				hidden_effect = {
					me_unlock_new_special_project_effect2 = yes
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 100
				gold > demon_gold_value
			}
		}
	}
	option = {
		name = ev7.135.a
		ai_chance = {
			base = 10
		}
	}
	after = {
		hidden_effect = {
			add_character_flag = uses_additional_knowledge_flag
			if = {
				limit = {
					is_ai = yes
				}
				scope:wmage0 = {
					death = natural
				}
			}
		}
		
	}
}

#selling magic items
magic_ev7.136 = {
	type = letter_event
	#opening = ev6.53.opening
	opening = ev7.136.opening
	desc = ev7.136.desc
	sender = scope:new_mage

	trigger = {
		is_imprisoned = no
		is_adult = yes
		any_character_artifact = {
			has_variable = magic1
		}
	}
	cooldown = { years = 10 }
	immediate = {
		hidden_effect = {
			random_character_artifact = {
				limit = {
					has_variable = magic1
				}
				save_scope_as = martX
			}
			scope:new_mage = {
				add_gold = 1000
			}
		}
	}

	option = {
		name = ev7.136.a
		scope:new_mage = {
			pay_short_term_gold = {
				target = ROOT
				gold = 1000
			}
		}
		scope:martX = {
			set_owner = {
				target = scope:new_mage
				history = {
					type = purchased
					actor = root
					recipient = scope:new_mage
					location = root.location
				}
			}
		}
		ai_chance = {
			base = 20
		}
	}
	option = {
		name = ev7.136.b
		scope:new_mage = {
			add_opinion = {
				target = ROOT
				modifier = refusal_opinion
				opinion = -10
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9999
				OR = {
					has_trait = true_witch
					has_trait = archmage
					has_focus = arcane_focus
					has_focus = witch_focus
				}
			}
		}
	}
	after = {
		hidden_effect = {
			add_character_flag = {
				flag = magic_item_offer_already_flag
				years = 30
			}
		}
	}
}
#crisis delay
magic_ev7.1379 = {
	scope = none
	hidden = yes
	immediate = {
		trigger_event = {
			id = magic_ev7.1378
			years = magic_ciris_delay_value
		}
	}
}
#crisis may begin
magic_ev7.1378 = {
	scope = none
	hidden = yes
	
	immediate = {
		#if = {
		#	limit = {
		#		any_ruler = {
		#			is_ai = no
		#			can_unlock_arcane_focus_trigger = yes
		#		}
		#	}
		#	random_living_character = {
		#		limit = {
		#			exists = house
		#			house = {
		#				NOT = {
		#					any_house_member = {
		#						is_ai = no
		#					}
		#				}
		#			}
		#			age < 2
		#		}
		#		if = {
		#			limit = {
		#				has_trait = source
		#			}
		#			add_trait_xp = {
		#				trait = source
		#				track = magic_potential
		#				value = 100
		#			}
		#		}
		#		give_witch_secret_or_trait_effect = yes
		#		trigger_event = {
		#			id = magic_ev7.138
		#			years = 20
		#		}
		#	}
		#}
		#else = {
		#	trigger_event = {
		#		id = magic_ev7.137
		#		years = 20
		#	}
		#}
		trigger_event = {
			id = magic_ev7.137
			years = { 60 90 }
		}
		set_global_variable = ready_4_crisis_var
	}
}
#the chosen one - one time per game
magic_ev7.137 = {
	scope = none
	hidden = yes
	
	immediate = {
		random_living_character = {
			limit = {
				exists = house
				house = {
					NOT = {
						any_house_member = {
							is_ai = no
						}
					}
				}
				age < 2
			}
			if = {
				limit = {
					NOT = {
						has_trait = source
					}
				}
				add_trait = source
			}
			add_trait_xp = {
				trait = source
				track = magic_potential
				value = 100
			}
			add_trait = infertile
			give_witch_secret_or_trait_effect = yes
			trigger_event = {
				id = magic_ev7.138
				years = 19
			}
		}
		set_global_variable = ready_4_crisis_var
	}
}

#the chosen management
magic_ev7.138 = {
	hidden = yes
	trigger = {
		is_ai = yes
	}
	immediate = {
		add_character_modifier = {
			modifier = amp_modifier
			years = 25
		}
		add_character_flag = protection_ritual
		if = {
			limit = {
				is_landed_or_landless_administrative = no
				is_ai = yes
			}
			if = {
				limit = {
					is_imprisoned = yes
				}
				release_from_prison = ROOT
			}
			random_ruler = {
				limit = {
					is_ai = no
				}
				save_scope_as = player1
			}
			random_ruler = {
				limit = {
					is_ai = yes
					is_landed_or_landless_administrative = yes
					primary_title = { is_mercenary_company = no }	
					highest_held_title_tier = 2
					in_diplomatic_range = scope:player1
				}
				save_scope_as = unlucky_one
			}
			set_culture_same_as = scope:unlucky_one
			set_character_faith = scope:unlucky_one.faith
			scope:unlucky_one = {
				create_title_and_vassal_change = {
					type = conquest
					save_scope_as = change
					add_claim_on_loss = no
				}
				random_held_title = {
					limit = {
						tier = tier_county
						title_province = scope:unlucky_one.capital_province
					}
					change_title_holder_include_vassals = {
						holder = ROOT
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
				death = natural
			}
			if = {
				limit = {
					exists = liege
					NOT = { liege = ROOT }
				}
				set_relation_mminion = liege
				add_hook = {
					type = magic_domination_hook
					target = liege
				}
			}
			turn_into_mage_effect = yes
		}
	}
}

#raw magic - outcome X. - hurt
magic_ev7.139 = {
	title = ev7.12.title
	desc = ev7.139.desc
	theme = realm
	left_portrait = {
		character = root
	}
	right_portrait = {
		character = scope:recipient
		animation = fear
	}

	trigger = {
		is_alive = yes
		has_trait = source
	}
	immediate = {
		spend_standard_ps_effect = yes
	}

	option = {
		name = ev7.139.a
		scope:recipient = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 30
			}
			if = {
				limit = {
					NOR = {
						has_trait = loyal
						has_trait = disloyal
					}
				}
				random = {
					chance = 25
					add_trait = loyal
				}
			}
		}
	}
	option = {
		name = ev7.139.b
		scope:recipient = {
			add_stress = massive_stress_gain
			random = {
				chance = 25
				add_trait = lunatic_1
			}
		}
	}
	option = {
		name = ev7.139.c
		scope:recipient = {
			if = {
				limit = {
					NOR = {
						has_trait = wounded_1
						has_trait = wounded_2
						has_trait = wounded_3
					}
				}
				add_trait = wounded_2
				add_opinion = {
					target = ROOT
					modifier = use_magic_on_me_opinion
				}
				ROOT = {
					random_secret = {
						limit = { secret_type = secret_witch }
						reveal_to = scope:recipient
					}
				}
			}
			else = {
				death = {
					death_reason = death_murder
					killer = ROOT
				}
			}
		}
	}
}
