namespace = magic_ev8

#childhood source option (from magic_ev7.999 )
magic_ev8.1 = {
	title = ev2.75.title	#Source Of The True Power
	desc = ev8.1.desc
	theme = healthcare
	override_background = {
		reference = bedchamber
	}
	left_portrait = {
		character = root
		#animation = worry
	}

	trigger = {
		is_alive = yes
		has_trait = source
		has_trait_xp = {
			trait = source
			track = magic_potential
			value > 19
		}
	}

	option = {
		name = ev8.1.0.a
		add_stress = minor_stress_loss
		add_5_magic_potential = yes
		random = {
			chance =  50
			add_trait_xp = {
				trait = source
				track = instability
				value = 60
			}
			custom_tooltip = make_source_unstable_ct
			hidden_effect = {
				trigger_event = {
					id = magic_ev7.5
					months = { 2 8 }
				}
			}
		}
	}
	option = {
		name = ev8.1.0.b
		add_stress = minor_stress_gain
		random_list = {
			6 = {
				send_interface_message = {
					title = magic_potential
					add_trait_xp = {
						trait = source
						track = magic_potential
						value = 5
					}
				}
			}
			4 = {
				send_interface_message = {
					title = magic_potential
					add_trait_xp = {
						trait = source
						track = magic_potential
						value = -5
					}
				}
			}
		}
	}
	option = {
		name = ev8.1.0.c
		#add_stress = minor_stress_loss
		random_list = {
			1 = { add_diplomacy_skill = 1 }
			1 = { add_martial_skill = 1 }
			1 = { add_stewardship_skill = 1 }
			1 = { add_intrigue_skill = 1 }
			1 = { add_learning_skill = 1 }
		}
	}
}
#feudal_levies_exempt_short:0 "None"
#feudal_levies_low_short:0 "Low"
#feudal_levies_high_short:0 "High"
#feudal_levies_extortionate_short:0 "Massive"
#FERTILITY_LEVEL_2:0 "Medium"
#CURRENT_SPEED_TEXT_0:0 "Unknown"
#line_break:0 "\n"

#ev8.2.desc00:0 "Magical emanations: "
#ev8.2.desc01:0 "Magic protection: "
#ev8.2.desc02:0 "Mortality: "
magic_ev8.2 = {
	title = aura_reading
	#desc = ev8.2.desc
	desc = {
		desc = ev8.2.desc00
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:recipient = {
						OR = {
							has_character_flag = blob_flag
							AND = {
								has_trait = source
								has_trait_xp = {
									trait = source
									track = magic_potential
									value > 79
								}
							}
							AND = {
								has_trait = demon
								has_trait_xp = {
									trait = demon
									value > 99
								}
							}
							any_character_artifact = {
								has_variable = magic1
							}
							#AND = {
							#	has_trait = archmage
							#	has_trait_xp = {
							#		trait = archmage
							#		track = secret_knowledge
							#		value > 49
							#	}
							#}
							is_legendary_mage_trigger = yes
							has_trait = yaga
							#has_trait = necromancer2
							has_trait = golem
							#has_trait = immortal1
							#has_trait = immortal2
							has_character_modifier = master_alteration_modifier
							has_character_modifier = master_magic_modifier
							has_character_modifier = master_defence_modifier
							has_character_modifier = master_metamagic_modifier
							has_character_modifier = master_necromancer_modifier
							has_character_modifier = master_psionic_modifier
							has_character_modifier = amp_modifier
							has_character_modifier = touched_divinity_modifier
						}
					}
				}
				#desc = feudal_levies_extortionate_short
				desc = extreme_emanations
			}
			triggered_desc = {
				trigger = {
					scope:recipient = {
						OR = {
							AND = {
								has_trait = source
								has_trait_xp = {
									trait = source
									track = magic_potential
									value > 59
								}
							}
							AND = {
								has_trait = source
								has_trait_xp = {
									trait = source
									track = instability
									value > 29
								}
							}
							AND = {
								has_trait = demon
								has_trait_xp = {
									trait = demon
									value > 24
								}
							}
							AND = {
								has_trait = archmage
								has_trait_xp = {
									trait = archmage
									track = power_saturation
									value > 99
								}
							}
						}
					}
				}
				desc = feudal_levies_high_short
			}
			triggered_desc = {
				trigger = {
					scope:recipient = {
						OR = {
							AND = {
								has_trait = source
								has_trait_xp = {
									trait = source
									track = magic_potential
									value > 39
								}
							}
							has_trait = demon
							AND = {
								has_trait = archmage
								has_trait_xp = {
									trait = archmage
									track = power_saturation
									value > 49
								}
							}
							
							has_character_modifier = cursed_modifier
							has_character_modifier = aura_boost1_modifier
							has_character_modifier = aura_boost2_modifier
							has_character_flag = demon_child
							has_character_modifier = infertile_modifier
							
						}
					}
				}
				desc = FERTILITY_LEVEL_2
			}
			triggered_desc = {
				trigger = {
					scope:recipient = {
						OR = {
							has_trait = source
							has_character_modifier = lifestolen_modifier
							has_character_modifier = lifestealer_modifier
							has_character_modifier = magic_flu_modifier
							has_character_modifier = alchemical_enhancement
							has_character_modifier = power_saturated1
							AND = {
								has_trait = archmage
								has_trait_xp = {
									trait = archmage
									track = power_saturation
									value > 9
								}
							}
							has_focus = arcane_focus
							has_trait = corrupted
							exists = var:spell_id
							any_relation = {
								type = mmaster
							}
						}
					}
				}
				desc = feudal_levies_low_short
			}
			desc = feudal_levies_exempt_short
		}

		desc = line_break
		desc = ev8.2.desc01
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:recipient = {
						has_full_magic_prot_trigger = yes
					}
				}
				desc = magic_pro_terrain_cancel_negative_supply
			}
			triggered_desc = {
				trigger = {
					scope:recipient = {
						has_any_basic_magic_prot_trigger = yes
					}
				}
				desc = magic_pro_less_terrain_cancel_negative_supply
			}
			desc = feudal_levies_exempt_short
		}

		

		desc = line_break
		#desc = ev8.2.desc03
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:recipient = {
						exists = var:spell_id
						var:spell_id = 98
					}
				}
				desc = ev8.2.desc03N
			}
			desc = ev8.2.desc03
		}
		desc = line_break
		#desc = ev8.2.desc04
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:recipient = {
						exists = var:spell_id
						var:spell_id = 98
					}
				}
				desc = ev8.2.desc04N
			}
			desc = ev8.2.desc04
		}

		desc = line_break
		desc = ev8.2.desc06
		
		desc = line_break
		desc = ev8.2.desc07

		desc = line_break
		desc = ev8.2.desc02
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:recipient = {
						OR = {
							has_trait = demon
							#has_trait = immortal1
							#has_trait = immortal2
							#has_trait = necromancer2
							has_trait = yaga
							is_immortal = yes
						}
					}
				}
				#desc = trait_immortal1
			}
			triggered_desc = {
				trigger = {
					scope:recipient = {
						OR = {
							has_character_flag = demon_child
							has_character_flag = may_be_demon_in_the_future_flag
						}
					}
				}
				desc = ev7.8.0.g_ct
			}
			desc = ev8.2.desc02a	#Mortal
		}

		desc = line_break
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:recipient = {
						exists = scope:rfather
					}
				}
				desc = ev8.2.desc05
			}
			desc = ev8.2.desc05a
		}
	}
	theme = healthcare
	override_background = {
		reference = bedchamber
	}
	right_portrait = {
		character = scope:recipient
	}
	immediate = {
		hidden_effect = {
			scope:recipient = {
				if = {
					limit = {
						exists = real_father
					}
					real_father = {
						save_scope_as = rfather
					}
				}
				set_variable = {
					name = pc_bonus
					value = md_small_pc_progress_value
				}
				change_variable = {
					name = pc_bonus
					add = -1
				}
				set_variable = {
					name = ds_bonus
					value = 0
				}
				if = {
					limit = {
						has_trait = archmage
						has_trait_xp = {
							trait = archmage
							track = secret_knowledge
							value > 74
						}
					}
					change_variable = {
						name = ds_bonus
						add = 2
					}
				}
				else_if = {
					limit = {
						has_trait = archmage
						has_trait_xp = {
							trait = archmage
							track = secret_knowledge
							value > 24
						}
					}
					change_variable = {
						name = ds_bonus
						add = 1
					}
				}
				if = {
					limit = {
						has_trait = archmage
						has_trait_xp = {
							trait = archmage
							track = combat_magic
							value > 64
						}
					}
					change_variable = {
						name = ds_bonus
						add = 2
					}
				}
				else_if = {
					limit = {
						has_trait = archmage
						has_trait_xp = {
							trait = archmage
							track = combat_magic
							value > 34
						}
					}
					change_variable = {
						name = ds_bonus
						add = 1
					}
				}
				if = {
					limit = {
						any_equipped_character_artifact = {
							has_variable = singularity
							has_artifact_modifier = singularity_modifier5
						}
					}
					change_variable = {
						name = ds_bonus
						add = 1
					}
				}
				else_if = {
					limit = {
						any_equipped_character_artifact = {
							has_variable = singularity2
						}
					}
					change_variable = {
						name = ds_bonus
						add = 1
					}
				}
				if = {
					limit = {
						any_equipped_character_artifact = {
							has_variable = catalyst
						}
					}
					change_variable = {
						name = ds_bonus
						add = 1
					}
				}
				if = {
					limit = {
						has_mage_academy_trigger = yes
					}
					change_variable = {
						name = ds_bonus
						add = 1
					}
				}
				if = {
					limit = {
						has_character_modifier = magic_duelist_modifier
					}
					change_variable = {
						name = ds_bonus
						add = 1
					}
				}
				if = {
					limit = {
						has_character_modifier = alchemical_enhancement
					}
					change_variable = {
						name = ds_bonus
						add = 1
					}
				}
				if = {
					limit = {
						has_trait = necromancer
					}
					change_variable = {
						name = ds_bonus
						add = 1
					}
				}
				if = {
					limit = {
						has_character_modifier = ultimate_spell_modifier
					}
					change_variable = {
						name = ds_bonus
						add = 3
					}
				}
			}
			
		}
	}
	option = {
		#name = ev2.53.a		#Good to know.
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							scope:recipient = {
								has_character_flag = blob_flag
							}
						}
						desc = ev1.1.a	#Strange
					}
					desc = ev2.53.a		#Good to know.
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev8.2.0.c	#He/she was casting a forbidden spell!
		trigger = {
			scope:recipient = {
				exists = var:spell_id
				OR = {
					var:spell_id = 2
					var:spell_id = 5
					var:spell_id = 3
				}
			}
			has_character_flag = forbidden_black_magic_flag
		}
		scope:recipient = {
			if = {
				limit = {
					is_landed_or_landless_administrative = yes
					is_ruler = yes
				}
				primary_title = {
					save_scope_as = ptitle
				}
			}
		}
		if = {
			limit = {
				exists = scope:ptitle
				NOT = {
					has_claim_on = scope:ptitle
				}
			}
			add_unpressed_claim = scope:ptitle
		}
		every_living_character = {
			limit = {
				has_character_flag = forbidden_black_magic_flag
				NOR = {
					has_opinion_modifier = {
						modifier = use_black_magic_opinion
						target = scope:recipient
					}
					THIS = scope:recipient
				}
			}
			add_opinion = {
				target = scope:recipient
				modifier = use_black_magic_opinion
				opinion = -50
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 10
				has_trait = just
			}
			modifier = {
				add = -10
				has_trait = arbitrary
			}
			modifier = {
				add = 10
				scope:recipient = {
					is_landed_or_landless_administrative = yes
				}
				OR = {
					has_trait = greedy
					has_trait = ambitious
				}
			}
		}
	}
	option = {
		name = ev8.2.0.b		#This could be a subject for gossip.
		trigger = {
			scope:recipient = {
				exists = real_father
				exists = father
				exists = mother
				root = father
				NOT = {
					real_father = father
				}
				NOT = {
					trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = root.faith GENDER_CHARACTER = root }
				}
			}
		}
		scope:recipient = {
			add_trait = bastard
			set_father = real_father
			mother = {
				if = {
					limit = {
						NOT = {
							has_trait = adulterer
						}
					}
					add_trait = adulterer
				}
			}
		}
		if = {
			limit = {
				scope:recipient.mother = {
					is_spouse_of = root
				}
			}
			add_opinion = {
				target = scope:recipient.mother
				modifier = unfaithful_spouse_exposed_opinion
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev8.2.0.a		#This could be a subject for gossip.
		trigger = {
			scope:recipient = {
				exists = real_father
				exists = father
				NOT = {
					real_father = father
				}
				NOT = {
					has_trait = disputed_heritage
				}
			}
		}
		scope:recipient = {
			add_trait = disputed_heritage
		}
		ai_chance = {
			base = 5
		}
	}
	after = {
		hidden_effect = {
			scope:recipient = {
				remove_variable = pc_bonus
				remove_variable = ds_bonus
			}
		}
	}
}

#witch hunt 4 players - path to fallen witch hunter
magic_ev8.3 = {
	title = ev8.3.title	#Source Of The True Power
	desc = ev8.3.desc
	type = character_event
	theme = realm
	left_portrait = root
	trigger = {
		is_imprisoned = no
		is_alive = yes
	}
	cooldown = { years = 10 }
	option = {
		name = ev8.3.0.a
		add_stress = medium_stress_loss
	}
	option = {
		name = ev8.3.0.b
		trigger_event = {
			id = magic_ev8.4
			days = 25
		}
	}
}
#witch hunt 4 players - path to fallen witch hunter #2
magic_ev8.4 = {
	title = ev8.3.title	#Source Of The True Power
	desc = ev8.4.desc
	type = character_event
	theme = realm
	left_portrait = root
	trigger = {
		is_imprisoned = no
		is_alive = yes
	}
	option = {
		name = ev8.4.0.a
		add_learning_skill = 1
		add_trait_xp = {
			trait = supernatural_hunter
			track = witch_hunting
			value = 10
		}
	}
	#option = {
	#	name = ev8.4.0.b
	#	remove_trait = witch_hunter
	#	add_trait_force_tooltip = witch_hunter2
	#}
}

#time travel
magic_ev8.5 = {
	title = me_time_travel_option
	desc = ev8.5.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			culture = {
				set_variable = has_time_traveler
			}
		}
	}
	option = {
		name = ev8.5.0.a
		custom_tooltip = ev8.5.0.a_ct
		spend_standard_ps_effect = yes
		trigger_event = magic_ev8.6
	}
}

#time travel 2
magic_ev8.6 = {
	title = ev8.6.title
	desc = ev8.6.desc
	theme = realm
	right_portrait = {
		character = root
		#animation = paranoia
		animation = fear
	}
	
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	override_background = {
		reference = airport
	}
	override_effect_2d = {
		reference = rain	
	}
	#override_sound = { reference = mx_magic_plane_mood_call_01 }
	#override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_animate" }

	#override_sound = { reference = "event:/SFX/Events/Themes/sfx_event_theme_type_intrigue" }
	#override_sound = { reference = "event:/SFX/Events/Themes/sfx_event_theme_type_medicine" }
	#override_sound = { reference = "event:/SFX/Events/Themes/sfx_event_theme_type_duty" }
	#override_sound = { reference = "event:/DLC/FP4/SFX/UI/Unique/sfx_ui_spread_legend" }
	#override_background = { reference = fp2_fullscreen_compromise }
	#override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_end_animate" }
	#override_effect_2d = {
	#	reference = smoke	
	#}
	#override_background = { reference = ep2_wedding_ceremony }
	immediate = {
		play_music_cue = "mx_magic_plane_mood_call_01"
		add_stress = major_stress_gain
	}
	option = {
		name = ev8.6.0.a
		trigger_event = magic_ev8.7
		set_spell_id = { ID = 29 }
	}
	#{046cd4a9-fb65-4900-bffe-93ea434e3b34} bus:/SFX/Events/Themes
	#{0845553b-6d99-4acc-972d-a4e6cfb49104} event:/sfx_event_theme_type_diplomacy
}

#time travel 3
magic_ev8.7 = {
	title = me_time_travel_option
	desc = ev8.7.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
	}
	immediate = {
		custom_tooltip = ev3.28.a_ct
		gain_sc_xp10_effect = yes
		add_learning_skill = 1
		add_prestige = massive_prestige_gain
		hidden_effect = {
			add_character_flag = me_time_travel_project_done
		}
	}
	option = {
		name = ev8.7.0.a
		custom_tooltip = ev8.7.0.a_ct
		trigger_event = {
			id = magic_ev8.8
			months = { 6 7 }
		}
	}
	option = {
		name = ev8.7.0.b
		add_stress = medium_stress_loss
	}
}
#time travel 4
magic_ev8.8 = {
	title = ev8.8.title
	desc = ev8.8.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
		#NOT = {
		#	has_character_flag = no_soul
		#}
	}
	on_trigger_fail = {
		if = {
			limit = {
				is_alive = yes
			}
			trigger_event = {
				id = magic_ev8.8
				months = 2
			}
		}
	}
	option = {
		name = ev4b.0.a 	#I have to be careful
		custom_tooltip = ev8.8.0.a_ct
		hidden_effect = {
			add_character_flag = fighting_planes_flag
			if = {
				limit = {
					NOT = {
						has_character_flag = ms_met_hecate
					}
				}
				add_character_flag = ms_met_hecate
			}
		}
	}
}

#time travel 5
magic_ev8.9 = {
	title = ev8.8.title
	desc = ev8.9.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	
	option = {
		name = ev8.9.0.a
		hidden_effect = {
			trigger_event = magic_ev8.10
		}
	}
}
#time travel 6
magic_ev8.10 = {
	title = ev8.8.title
	desc = ev8.10.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	
	option = {
		name = ev8.10.0.a
		hidden_effect = {
			trigger_event = magic_ev8.11
		}
	}
}
#time travel 7
magic_ev8.11 = {
	title = ev8.8.title
	desc = ev8.11.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	
	option = {
		name = ev8.11.0.a
		hidden_effect = {
			trigger_event = magic_ev8.12
		}
	}
}

#time travel 8
magic_ev8.12 = {
	title = ev8.8.title
	desc = ev8.12.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	
	option = {
		name = ev8.12.0.a
		custom_tooltip = ev8.12.0.a_ct
		custom_tooltip = ev8.12.0.a_ct2
		hidden_effect = {
			trigger_event = magic_ev.18
			add_character_flag = fighting_planes_flag2
		}
	}
}

#time travel 9 - from decision
magic_ev8.13 = {
	title = change_the_future_title
	desc = ev8.13.desc
	theme = witchcraft
	left_portrait = root
	immediate = {
		custom_tooltip = ev8.13.0.a_ct
	}
	option = {
		name = ev8.13.0.a
		add_stress = major_stress_loss
		hidden_effect = {
			trigger_event = {
				id = magic_ev8.14
				days = 1
			}
		}
	}
}

#time travel 10 - outro
magic_ev8.14 = {
	title = ev8.14.title
	desc = ev8.14.desc
	theme = witchcraft
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_travel_sea.dds" 
	}
	override_background = {
		reference = triangle
	}
	option = {
		name = ev8.14.0.a
		send_interface_toast = {
			title = change_the_future_title
			add_character_modifier = {
				modifier = master_magic_modifier
			}
		}
		custom_tooltip = ev8.14.0.a_ct
		add_internal_flag = special
	}
}

#cyro 1
magic_ev8.15 = {
	title = ev8.15.title
	desc = ev8.15.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = spymaster
	}
	right_portrait = {
		character = scope:actor
		animation = schadenfreude
	}
	option = {
		name = ev8.15.0.c	#better offer
		trigger = {
			diplomacy > 25
		}
		skill = diplomacy
		show_as_tooltip = {
			cyro_better_offer_effect = yes
		}		
		custom_tooltip = no_soul_custom_tooltip
		scope:actor = {
			trigger_event = magic_ev8.17
		}
		hidden_effect = {
			add_character_flag = select_better_offer_cyro_flag
			if = {
				limit = {
					is_ruler = no
					is_landed_or_landless_administrative = no
					is_ai = yes
				}
				trigger_event = {
					id = magic_ev7.130
					years = { 10 15 }
				}
			}
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev8.15.0.b	#regular offer
		show_as_tooltip = {
			cyro_common_offer_effect = yes
		}
		scope:actor = {
			trigger_event = magic_ev8.17
		}
		custom_tooltip = no_soul_custom_tooltip
		hidden_effect = {
			if = {
				limit = {
					is_ruler = no
					is_landed_or_landless_administrative = no
					is_ai = yes
				}
				trigger_event = {
					id = magic_ev7.130
					years = { 10 15 }
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}

	option = {
		name = ev8.15.0.a	#refuse
		scope:actor = {
			trigger_event = magic_ev8.16
		}
		ai_chance = {
			base = 0
		}
	}
	
}

#cyro 2 - noppe
magic_ev8.16 = {
	title = ev8.15.title
	desc = ev8.16.desc
	theme = witchcraft
	left_portrait = {
		character = scope:actor
		animation = spymaster
	}
	right_portrait = {
		character = scope:recipient
	}
	option = {
		name = tour_grounds_events.3017.a	#A pity.
		custom_tooltip = cyro_proposal_cooldown_reset
		add_prestige = -250
		hidden_effect = {
			remove_interaction_cooldown = cyro_proposal_interaction
		}
		
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = magic_cyroo_o3_flag
				}
				remove_character_flag = magic_cyroo_o3_flag
			}
			if = {
				limit = {
					has_character_flag = magic_cyroo_o2_flag
				}
				remove_character_flag = magic_cyroo_o2_flag
			}
			if = {
				limit = {
					has_character_flag = magic_cyroo_o1_flag
				}
				remove_character_flag = magic_cyroo_o1_flag
			}
		}
	}
}

#cyro 3 - ok
magic_ev8.17 = {
	title = ev8.15.title
	desc = ev8.17.desc
	theme = witchcraft
	left_portrait = {
		character = scope:actor
		animation = spymaster
	}
	right_portrait = {
		character = scope:recipient
	}
	immediate = {
		spend_standard_ps_effect = yes
		if = {
			limit = {
				scope:recipient = {
					has_character_flag = select_better_offer_cyro_flag
				}
			}
			cyro_better_offer_effect = yes
		}
		else = {
			cyro_common_offer_effect = yes
		}
		
	}
	option = {
		name = EXCELLENT
	}
	after = {
		hidden_effect = {
			start_magic_cyro_effect = yes
			scope:recipient = {
				if = {
					limit = {
						scope:recipient = {
							has_character_flag = select_better_offer_cyro_flag
						}
					}
					remove_character_flag = select_better_offer_cyro_flag
				}
			}
			if = {
				limit = {
					has_character_flag = magic_cyroo_o3_flag
				}
				remove_character_flag = magic_cyroo_o3_flag
			}
			if = {
				limit = {
					has_character_flag = magic_cyroo_o2_flag
				}
				remove_character_flag = magic_cyroo_o2_flag
			}
			if = {
				limit = {
					has_character_flag = magic_cyroo_o1_flag
				}
				remove_character_flag = magic_cyroo_o1_flag
			}
		}
	}
}

#cyro 4 - cyro completed
magic_ev8.18 = {
	title = ev8.15.title
	desc = ev8.18.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = stress
	}
	right_portrait = {
		character = scope:actor
		animation = schadenfreude
	}
	trigger = {
		is_alive = yes
		exists = scope:actor
		scope:actor = {
			is_alive = yes
			is_imprisoned = no
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				is_alive = yes
				exists = scope:actor
				scope:actor = {
					is_alive = yes
					is_imprisoned = yes
				}
			}
			trigger_event = {
				id = magic_ev8.18
				years = 1
			}
		}
		else_if = {
			limit = {
				OR = {
					NOT = {
						exists = scope:actor
					}
					scope:actor = {
						is_alive = no
					}
				}
			}
			remove_variable = my_soul_owner
			trigger_event = {
				id = magic_ev2.11
				months = 1
			}
		}
	}
	option = {
		name = ev8.18.0.a
		custom_tooltip = ev8.18.0.a_ct
		scope:actor = {
			trigger_event = magic_ev8.20
		}
		ai_chance = {
			base = 50
			modifier = {
				has_trait = archmage
				add = 20
			}
			modifier = {
				has_trait = ambitious
				add = 20
			}
			modifier = {
				has_trait = gluttonous
				add = 20
			}
			modifier = {
				has_trait = stubborn
				add = 20
			}
			modifier = {
				can_use_banish_spell = yes
				add = 50
			}
			modifier = {
				has_trait = fickle
				add = 50
			}
			modifier = {
				has_trait = arbitrary
				add = 50
			}
		}
	}
	option = {
		name = ev8.18.0.b
		show_as_tooltip = {
			death = natural
		}
		scope:actor = {
			trigger_event = magic_ev8.19
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 500
				OR = {
					has_relation_mmaster = scope:actor
					has_relation_mminion = scope:actor
				}
			}
			modifier = {
				has_trait = fickle
				add = 50
			}
			modifier = {
				has_trait = just
				add = 100
			}
			modifier = {
				add = 20
				scope:actor = {
					dread > 90
				}
			}
			modifier = {
				OR = {
					has_trait = depressed
					has_trait = depressed_1
					has_trait = depressed_genetic
					has_trait = cancer
				}
				add = 50
			}
		}
	}
}

#cyro 5 - cyro completed
magic_ev8.19 = {
	title = ev8.15.title
	desc = ev8.19.desc
	theme = witchcraft
	left_portrait = {
		character = scope:actor
		animation = ecstasy
	}
	right_portrait = {
		character = scope:recipient
		animation = fear
	}
	option = {
		name = host_dinner_events.1061.a	#Delicious!
		scope:recipient = {
			hidden_effect = {
				if = {
					limit = {
						has_variable = my_soul_owner
					}
					remove_variable = my_soul_owner
				}
			}
			death = natural
		}
		add_trait_xp = {
			trait = demon
			value = 20
		}
		if = {
			limit = {
				NOT = {
					has_trait = cyrographer
				}
			}
			add_trait = cyrographer
		}
	}
}

#cyro 5 - cyro completed... almost
magic_ev8.20 = {
	title = ev8.15.title
	desc = ev8.20.desc
	theme = witchcraft
	left_portrait = {
		character = scope:actor
		animation = disapproval
	}
	right_portrait = {
		character = scope:recipient
		animation = spymaster
	}
	option = {
		name = ev8.20.0.a
		start_scheme = {
			type = murder
			target_character = scope:recipient
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 100
				has_trait_xp = {
					trait = demon
					value > 80
				}
				intrigue > scope:recipient.intrigue
			}
		}
	}
	option = {
		name = ev8.20.0.b
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev8.20.0.c
		custom_tooltip = ev8.20.0.c_ct
		add_trait_xp = {
			trait = demon
			value = 1
		}
		hidden_effect = {
			scope:recipient = {
				remove_variable = my_soul_owner
				trigger_event = {
					id = magic_ev2.11
					months = 1
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
}
#artifacts searching 12. - rival
magic_ev8.21 = {
	type = activity_event
	title = game_concept_rival
	desc = ev8.21.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}
	trigger = {
		any_living_character = {
			OR = {
				has_relation_rival = root
				has_relation_nemesis = root
			}
		}
	}
	cooldown = { years = 9 }
	
	option = {
		name = ev8.21.0.a
		add_character_modifier = {
			modifier = confused_modifier
			months = 3
		}
		custom_tooltip = artifacts_searching_tt_negative_medium
		scope:activity = { 
			change_variable = {
				name = activity_special_type_progression
				add = -10
			}
		}
	}
}
#Blob - first meeting
magic_ev8.22 = {
	title = ev8.22.title
	desc = ev8.22.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	immediate = {
		save_scope_as = this0
	}

	option = {
		name = ev8.22.0.a
		trigger_event = magic_ev8.23
	}
}
#Blob - first meeting - 2
magic_ev8.23 = {
	title = blob_name
	desc = ev8.23.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon

	option = {
		name = ev8.23.0.a
		trigger_event =  magic_ev8.24
	}
}
#Blob - first meeting - 3
magic_ev8.24 = {
	title = blob_name
	desc = ev8.24.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = beg
	}

	option = {
		name = ev8.24.0.a
		hidden_effect = {
			scope:demon = {
				move_to_pool = yes
			}
		}
		add_courtier = scope:demon
		scope:demon = {
			add_trait = loyal
		}
		blob_joins_you_effect = yes
	}
	option = {
		name = ev8.24.0.b
		trigger_event = magic_ev.18
	}
}
#Blob - another meeting
magic_ev8.25 = {
	title = blob_name
	desc = ev8.25.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = beg
	}
	immediate = {
		save_scope_as = this0
	}

	option = {
		name = ev8.24.0.a
		hidden_effect = {
			scope:demon = {
				move_to_pool = yes
			}
		}
		add_courtier = scope:demon
		scope:demon = {
			add_trait = loyal
		}
		blob_joins_you_effect = yes
	}
	option = {
		name = ev8.25.0.a
		trigger_event = magic_ev.18
		stress_impact = {
			sadistic = massive_stress_loss
			compassionate = massive_stress_gain
		}
		if = {
			limit = {
				number_of_personality_traits < 4
				NOR = {
					has_trait = compassionate
					has_trait = sadistic
					has_trait = callous
				}
			}
			random = {
				chance = 10
				add_trait = sadistic
			}
		}
	}
}

#Blob - at court 1
magic_ev8.26 = {
	title = blob_name
	desc = ev8.26.desc
	theme = realm
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = admiration
	}
	trigger = {
		OR = {
			any_courtier_or_guest = {
				has_character_flag = blob_flag
				is_imprisoned = no
			}
			any_vassal = {
				has_character_flag = blob_flag
				is_imprisoned = no
			}
		}
		is_imprisoned = no
	}
	on_trigger_fail = {
		if = {
			limit = {
				is_alive = yes
				any_living_character = {
					has_character_flag = blob_flag
				}
			}
			trigger_event = {
				id = magic_ev8.26
				months = 2
			}
		}
	}
	
	option = {
		name = ev8.26.0.a
		add_stress = medium_stress_loss
		hidden_effect = {
			trigger_event = {
				id = magic_ev8.27
				months = { 2 3 }
			}
		}
	}
}
#Blob - at court 2
magic_ev8.27 = {
	title = blob_name
	desc = ev8.27.desc
	theme = realm
	left_portrait = root

	trigger = {
		OR = {
			any_courtier_or_guest = {
				has_character_flag = blob_flag
				is_imprisoned = no
			}
			any_vassal = {
				has_character_flag = blob_flag
				is_imprisoned = no
			}
		}
		is_imprisoned = no
	}
	on_trigger_fail = {
		if = {
			limit = {
				is_alive = yes
				any_living_character = {
					has_character_flag = blob_flag
				}
			}
			trigger_event = {
				id = magic_ev8.27
				months = 2
			}
		}
	}
	immediate = {
		add_character_modifier = {
			modifier = shining_mansion_modifier
			years = 2
		}
		if = {
			limit = {
				has_royal_court = yes
			}
			change_current_court_grandeur = medium_court_grandeur_gain
		}
		else = {
			add_prestige = medium_prestige_gain
		}
	}
	option = {
		name = ev8.27.0.a
	}
	option = {
		name = ev8.27.0.b
	}
	after = {
		hidden_effect = {
			trigger_event = {
				id = magic_ev8.28
				months = { 2 4 }
			}

			trigger_event = {
				id = magic_ev8.30
				months = { 4 6 }
			}
		}
	}
}

#Blob - at court 3A (magic sense)
magic_ev8.28 = {
	title = ev4.0.title
	desc = ev4.0.desc
	theme =  mental_health
	left_portrait = root
	trigger = {
		has_perk = magical_senses_perk
	}
	option = {
		name = ev4.0.a
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev4.0.b
		trigger = {
			has_trait = archmage
		}
		trait = archmage
		custom_tooltip = ev4.0.b_ct
		trigger_event = magic_ev8.29
		ai_chance = {
			base = 20
		}
	}
	option = {
		name = ev4.0.e
		
		custom_tooltip = ev4.0.e_ct
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = senses_overload3
				}
				remove_character_flag = senses_overload3
			}
			add_character_flag = {
				flag = senses_overload3
				years = 10
			}
		}
		
		ai_chance = {
			base = 1
		}
	}
}
#Blob - at court 3B (magic sense)
magic_ev8.29 = {
	title = ev4.0.title
	desc = ev8.29.desc
	theme =  mental_health
	left_portrait = root
	trigger = {
		has_perk = magical_senses_perk
	}
	option = {
		name = ev8.29.0.a
	}
	
}

#Blob - at court 4 - Mefisto
magic_ev8.30 = {
	type = letter_event
	opening = ev8.30.opening
	desc = ev8.30.desc
	sender = scope:mefistoX

	trigger = {
		any_living_character = {
			has_character_flag = mefisto_devil
			is_imprisoned = no
		}
		OR = {
			any_courtier_or_guest = {
				has_character_flag = blob_flag
				is_imprisoned = no
			}
			any_vassal = {
				has_character_flag = blob_flag
				is_imprisoned = no
			}
		}
		is_imprisoned = no
	}
	on_trigger_fail = {
		trigger_event = {
			id = magic_ev8.31
			months = 1
		}
	}
	immediate = {
		hidden_effect = {
			random_living_character = {
				limit = {
					has_character_flag = mefisto_devil
					is_imprisoned = no
				}
				save_scope_as = mefistoX
			}
			random_living_character = {
				limit = {
					has_character_flag = blob_flag
				}
				set_relation_rival = scope:mefistoX
			}
			trigger_event = {
				id = magic_ev8.31
				months = 1
			}
		}
	}
	option = {
		name = ev8.30.0.a
	}
	option = {
		name = ev8.30.0.b
	}
}

#Blob - at court 5
magic_ev8.31 = {
	title = ev8.31.title
	desc = ev8.31.desc
	theme = witchcraft
	override_background = {
		reference = bedchamber
	}
	left_portrait = root

	trigger = {
		OR = {
			any_courtier_or_guest = {
				has_character_flag = blob_flag
				is_imprisoned = no
			}
			any_vassal = {
				has_character_flag = blob_flag
				is_imprisoned = no
			}
		}
		is_imprisoned = no
	}
	on_trigger_fail = {
		if = {
			limit = {
				is_alive = yes
				any_living_character = {
					has_character_flag = blob_flag
				}
			}
			trigger_event = {
				id = magic_ev8.31
				months = 2
			}
		}
	}
	option = {
		name = ev8.31.0.a
		trigger_event = magic_ev8.32
	}
}
#Blob - at court 6
magic_ev8.32 = {
	title = ev8.31.title
	desc = ev8.32.desc
	theme = witchcraft
	override_background = {
		reference = corridor_night
	}
	left_portrait = root

	option = {
		name = ev8.32.0.a
		custom_tooltip = ev8.32.0.a_ct
		add_stress = minor_stress_gain
		trigger_event = magic_ev8.33
	}
}
#Blob - at court 7
magic_ev8.33 = {
	title = blob_name
	desc = ev8.33.desc
	theme = witchcraft
	override_background = {
		reference = dungeon
	}
	left_portrait = root
	right_portrait = scope:blob

	immediate = {
		hidden_effect = {
			random_living_character = {
				limit = {
					has_character_flag = blob_flag
				}
				save_scope_as = blob
			}
		}
	}

	option = {
		name = ev8.33.0.a
		trigger_event = magic_ev8.34
	}
}
#Blob - at court 8
magic_ev8.34 = {
	title = blob_name
	desc = ev8.34.desc
	theme = witchcraft
	override_background = {
		reference = dungeon
	}
	left_portrait = {
		character = root
		animation = shock
	}
	right_portrait = {
		character = scope:blob
		animation = spymaster
	}
	immediate = {
		hidden_effect = {
			blob_transformation_effect = yes
		}
	}

	option = {
		name = ev8.34.0.a
		trigger_event = magic_ev8.35
	}
}
#Blob - at court 8
magic_ev8.35 = {
	title = blob_name2
	desc = ev8.35.desc
	theme = witchcraft
	override_background = {
		reference = dungeon
	}
	left_portrait = root
	right_portrait = {
		character = scope:blob
		animation = scheme
	}
	

	option = {
		name = ev8.35.0.a
		trigger_event = magic_ev8.36
	}
}
#Blob - at court 9
magic_ev8.36 = {
	title = blob_name2
	desc = ev8.36.desc
	theme = witchcraft
	override_background = {
		reference = dungeon
	}
	left_portrait = root
	right_portrait = {
		character = scope:blob
		animation = schadenfreude
	}
	lower_center_portrait = scope:demon2
	lower_right_portrait = scope:demon3
	immediate = {
		hidden_effect = {
			create_character = {
				employer = ROOT
				gender_female_chance = 30
				template = generic_demon_character
				save_scope_as = demon2
				after_creation = {
					set_sexuality = bisexual
					give_witch_secret_or_trait_effect = yes
					add_trait_xp = {
						trait = demon
						value = { 10 25 }
					}
					set_source4demon = yes
				}
			}
			create_character = {
				employer = ROOT
				gender_female_chance = 30
				template = generic_demon_character
				save_scope_as = demon3
				after_creation = {
					set_sexuality = bisexual
					give_witch_secret_or_trait_effect = yes
					add_trait_xp = {
						trait = demon
						value = { 10 25 }
					}
					set_source4demon = yes
				}
			}
		}
	}
	option = {
		name = ev8.36.0.b	#I'll try to cast a double banishment spell.
		trigger = {
			custom_description = {
				text = power_needed_custom
				OR = {
					has_trait = archmage
					has_trait = demon
				}
				can_use_banish_spell = yes
				can_spend_standard_ps_trigger = yes
			}
			
		}
		show_as_unavailable = {
			OR = {
				has_trait = archmage
				has_trait = demon
			}
			can_use_banish_spell = yes
		}
		add_internal_flag = special
		
		spend_standard_ps_effect = yes
		duel = {
			skill = learning
			value = 25
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = ev8.36.0.a_ct
				custom_tooltip = ev8.36.0.a_ct3
				hidden_effect = {
					send_interface_toast = {
						title=ev3.52.a_1
						custom_tooltip = ev8.36.0.a_ct
						custom_tooltip = ev8.36.0.a_ct3
					}
					scope:demon2 = {
						death = natural
					}
					scope:demon3 = {
						death = natural
					}
					trigger_event = magic_ev8.37
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					death = {
						killer = scope:demon2
						death_reason = death_murder
					}
				}
				blob_becomes_ruler_effect = yes
			}
		}
	}
	option = {
		name = ev8.36.0.c	#The Shadow Step spell will confuse them.
		trigger = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
				OR = {
					has_character_flag = shadowstep_flag
					AND = {
						has_trait = archmage
						any_equipped_character_artifact = {
							has_variable = magic_crown
						}
					}
				}
			}
			
		}
		show_as_unavailable = {
			OR = {
				has_character_flag = shadowstep_flag
				AND = {
					has_trait = archmage
					any_equipped_character_artifact = {
						has_variable = magic_crown
					}
				}
			}
		}
		add_internal_flag = special
		
		spend_standard_ps_effect = yes
		custom_tooltip = ev8.36.0.a_ct
		scope:demon2 = {
			add_character_modifier = {
				modifier = confused_modifier
				days = 7
			}
		}
		scope:demon3 = {
			add_character_modifier = {
				modifier = confused_modifier
				days = 7
			}
		}
		hidden_effect = {
			trigger_event = magic_ev8.37
		}
	}
	option = {
		name = ev5.28.0.s6	#FIRE STORM
		trigger = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
				OR = {
					AND = {
						has_trait = demon
						has_trait_xp = {
							trait = demon
							value > 74
						}
					}
					has_character_flag = firestorm_spell_flag
				}
			}
			
		}
		show_as_unavailable = {
			OR = {
				AND = {
					has_trait = demon
					has_trait_xp = {
						trait = demon
						value > 74
					}
				}
				has_character_flag = firestorm_spell_flag
			}
		}
		add_internal_flag = special
		
		spend_standard_ps_effect = yes
		custom_tooltip = ev8.36.0.a_ct
		scope:demon2 = {
			add_trait = wounded_3
		}
		scope:demon3 = {
			add_trait = wounded_3
		}
		hidden_effect = {
			trigger_event = magic_ev8.37
		}
	}
	option = {
		name = ev8.36.0.d	#Ancient Singularity will simply burn them.
		trigger = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
				any_character_artifact = {
					OR = {
						has_artifact_modifier = singularity_modifier5
						has_artifact_modifier = singularity_modifierX
					}
				}
			}
			
		}
		show_as_unavailable = {
			any_character_artifact = {
				OR = {
					has_artifact_modifier = singularity_modifier5
					has_artifact_modifier = singularity_modifierX
				}
			}
		}
		add_internal_flag = special
		spend_standard_ps_effect = yes
		custom_tooltip = ev8.36.0.a_ct
		scope:demon2 = {
			death = natural
		}
		scope:demon3 = {
			death = natural
		}
		random = {
			chance = 50
			location.county = {
				add_county_modifier = {
					modifier = magic_damaged_walls_modifier
					years = 2
				}
			}
		}
		hidden_effect = {
			trigger_event = magic_ev8.37
		}
	}
	option = {
		name = ev5.28.0.a	#Power strike, now!
		trigger = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
				OR = {
					has_trait = archmage
					has_trait = demon
				}
			}
		}
		show_as_unavailable = {
			OR = {
				has_trait = archmage
				has_trait = demon
			}
		}
		spend_standard_ps_effect = yes
		random_list = {
			8 = {
				custom_tooltip = ev8.36.0.a_ct
				custom_tooltip = ev8.36.0.a_ct2
				hidden_effect = {
					send_interface_toast = {
						title=ev3.52.a_1
						custom_tooltip = ev8.36.0.a_ct
						give_me_more_wounds_effect = yes
					}
					trigger_event = magic_ev8.37
				}
			}
			2 = {
				send_interface_toast = {
					title=ev3.52.a_2
					death = {
						killer = scope:demon2
						death_reason = death_murder
					}
				}
				blob_becomes_ruler_effect = yes
			}
		}
	}
	
	
	option = {
		name = ev8.36.0.a	#Answer with blade
		duel = {
			skill = prowess
			value = 70
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = ev8.36.0.a_ct
				custom_tooltip = ev8.36.0.a_ct2
				hidden_effect = {
					send_interface_toast = {
						title=ev3.52.a_1
						custom_tooltip = ev8.36.0.a_ct
						give_me_more_wounds_effect = yes
					}
					trigger_event = magic_ev8.37
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev3.52.a_2
					death = {
						killer = scope:demon2
						death_reason = death_murder
					}
				}
				blob_becomes_ruler_effect = yes
			}
		}
	}
	
}

#Blob - at court 10
magic_ev8.37 = {
	title = blob_name2
	#desc = ev8.37.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:demon2
					scope:demon2 = {
						is_alive = yes
					}
				}
				desc = ev8.37.desc
			}
			desc = ev8.37.desc2
		}
	}
	theme = witchcraft
	override_background = {
		reference = dungeon
	}
	left_portrait = {
		character = root
		animation = anger
	}
	right_portrait = {
		character = scope:blob
		animation = spymaster
	}
	trigger = {
		is_alive = yes
	}
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					exists = scope:demon2
					scope:demon2 = {
						is_alive = yes
					}
				}
				scope:demon2 = {
					move_to_pool = yes
				}
			}
			if = {
				limit = {
					exists = scope:demon3
					scope:demon3 = {
						is_alive = yes
					}
				}
				scope:demon3 = {
					move_to_pool = yes
				}
			}
		}
	}

	option = {
		name = ev8.37.0.a
		hidden_effect = {
			trigger_event = magic_ev8.38
		}
	}
}
#Blob - at court 11
magic_ev8.38 = {
	title = blob_name2
	desc = ev8.38.desc
	theme = witchcraft
	override_background = {
		reference = dungeon
	}
	left_portrait = {
		character = root
		animation = anger
	}
	right_portrait = {
		character = scope:blob
		animation = disgust
	}
	trigger = {
		is_alive = yes
	}
	immediate = {
		hidden_effect = {
			add_character_flag = {
				flag = fight_against_blob_flag
				months = 1
			}
		}
	}
	option = {
		name = ev4.36.0.a	#"So let's fight."
		custom_tooltip = mage_duel_duel_ct
		configure_start_mage_duel_effect = {
			MD_ATTACKER = root
			MD_DEFENDER = scope:blob
		}
	}
}

#familiar change
magic_ev8.39 = {
	title = ev8.39.title
	desc = ev8.39.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		OR = {
			has_character_modifier = witch_familiar_modifier1
			has_character_modifier = witch_familiar_modifier2
			has_character_modifier = witch_familiar_modifier3
			has_character_modifier = witch_familiar_modifier4
			has_character_modifier = witch_familiar_modifier5
		}
	}
	immediate = {
		hidden_effect = {
			random_list = {
				1 = {
					trigger = {
						NOT = {
							has_character_modifier = witch_familiar_modifier1
						}
					}
					add_character_flag = temporary_familiar_option_flag1
				}
				1 = {
					trigger = {
						NOT = {
							has_character_modifier = witch_familiar_modifier2
						}
					}
					add_character_flag = temporary_familiar_option_flag2
				}
				1 = {
					trigger = {
						NOT = {
							has_character_modifier = witch_familiar_modifier3
						}
					}
					add_character_flag = temporary_familiar_option_flag3
				}
				1 = {
					trigger = {
						NOT = {
							has_character_modifier = witch_familiar_modifier4
						}
					}
					add_character_flag = temporary_familiar_option_flag4
				}
				1 = {
					trigger = {
						NOT = {
							has_character_modifier = witch_familiar_modifier5
						}
					}
					add_character_flag = temporary_familiar_option_flag5
				}
			}
		}
	}
	option = {
		name = ev8.39.0.a
		if = {
			limit = {
				has_character_modifier = witch_familiar_modifier1
			}
			remove_character_modifier = witch_familiar_modifier1
		}
		else_if = {
			limit = {
				has_character_modifier = witch_familiar_modifier2
			}
			remove_character_modifier = witch_familiar_modifier2
		}
		else_if = {
			limit = {
				has_character_modifier = witch_familiar_modifier3
			}
			remove_character_modifier = witch_familiar_modifier3
		}
		else_if = {
			limit = {
				has_character_modifier = witch_familiar_modifier4
			}
			remove_character_modifier = witch_familiar_modifier4
		}
		else_if = {
			limit = {
				has_character_modifier = witch_familiar_modifier5
			}
			remove_character_modifier = witch_familiar_modifier5
		}
		if = {
			limit = {
				has_character_flag = temporary_familiar_option_flag1
			}
			add_character_modifier = witch_familiar_modifier1
		}
		else_if = {
			limit = {
				has_character_flag = temporary_familiar_option_flag2
			}
			add_character_modifier = witch_familiar_modifier2
		}
		else_if = {
			limit = {
				has_character_flag = temporary_familiar_option_flag3
			}
			add_character_modifier = witch_familiar_modifier3
		}
		else_if = {
			limit = {
				has_character_flag = temporary_familiar_option_flag4
			}
			add_character_modifier = witch_familiar_modifier4
		}
		else_if = {
			limit = {
				has_character_flag = temporary_familiar_option_flag5
			}
			add_character_modifier = witch_familiar_modifier5
		}
	}
	option = {
		name = ev8.39.0.b
		show_as_tooltip = {
			if = {
				limit = {
					has_character_modifier = witch_familiar_modifier1
				}
				remove_character_modifier = witch_familiar_modifier1
			}
			else_if = {
				limit = {
					has_character_modifier = witch_familiar_modifier2
				}
				remove_character_modifier = witch_familiar_modifier2
			}
			else_if = {
				limit = {
					has_character_modifier = witch_familiar_modifier3
				}
				remove_character_modifier = witch_familiar_modifier3
			}
			else_if = {
				limit = {
					has_character_modifier = witch_familiar_modifier4
				}
				remove_character_modifier = witch_familiar_modifier4
			}
			else_if = {
				limit = {
					has_character_modifier = witch_familiar_modifier5
				}
				remove_character_modifier = witch_familiar_modifier5
			}
		}
		random_list = {
			1 = {
				trigger = {
					NOR = {
						has_character_modifier = witch_familiar_modifier1
						has_character_flag = temporary_familiar_option_flag1
					}
				}
				add_character_modifier = witch_familiar_modifier1
			}
			1 = {
				trigger = {
					NOR = {
						has_character_modifier = witch_familiar_modifier2
						has_character_flag = temporary_familiar_option_flag2
					}
				}
				add_character_modifier = witch_familiar_modifier2
			}
			1 = {
				trigger = {
					NOR = {
						has_character_modifier = witch_familiar_modifier3
						has_character_flag = temporary_familiar_option_flag3
					}
				}
				add_character_modifier = witch_familiar_modifier3
			}
			1 = {
				trigger = {
					NOR = {
						has_character_modifier = witch_familiar_modifier4
						has_character_flag = temporary_familiar_option_flag4
					}
				}
				add_character_modifier = witch_familiar_modifier4
			}
			1 = {
				trigger = {
					NOR = {
						has_character_modifier = witch_familiar_modifier5
						has_character_flag = temporary_familiar_option_flag5
					}
				}
				add_character_modifier = witch_familiar_modifier5
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_modifier = witch_familiar_modifier1
				}
				remove_character_modifier = witch_familiar_modifier1
			}
			else_if = {
				limit = {
					has_character_modifier = witch_familiar_modifier2
				}
				remove_character_modifier = witch_familiar_modifier2
			}
			else_if = {
				limit = {
					has_character_modifier = witch_familiar_modifier3
				}
				remove_character_modifier = witch_familiar_modifier3
			}
			else_if = {
				limit = {
					has_character_modifier = witch_familiar_modifier4
				}
				remove_character_modifier = witch_familiar_modifier4
			}
			else_if = {
				limit = {
					has_character_modifier = witch_familiar_modifier5
				}
				remove_character_modifier = witch_familiar_modifier5
			}
		}
	}
	option = {
		name = ev8.39.0.c
		add_stress = minor_stress_loss
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = temporary_familiar_option_flag1
				}
				remove_character_flag = temporary_familiar_option_flag1
			}
			if = {
				limit = {
					has_character_flag = temporary_familiar_option_flag2
				}
				remove_character_flag = temporary_familiar_option_flag2
			}
			if = {
				limit = {
					has_character_flag = temporary_familiar_option_flag3
				}
				remove_character_flag = temporary_familiar_option_flag3
			}
			if = {
				limit = {
					has_character_flag = temporary_familiar_option_flag4
				}
				remove_character_flag = temporary_familiar_option_flag4
			}
			if = {
				limit = {
					has_character_flag = temporary_familiar_option_flag5
				}
				remove_character_flag = temporary_familiar_option_flag5
			}
		}
	}
}
#restores Heresiarch if needed
magic_ev8.40 = {
	hidden = yes
	trigger = {
		is_alive = yes
	}
	immediate = {
		if = {
			limit = {
				NOT = {
					has_trait = heresiarch
				}
			}
			add_trait = heresiarch
		}
		trigger_event = {
			id = magic_ev8.40
			years = 10
		}
	}
}

#Grand Coalition invitation
magic_ev8.41 = {
	type = letter_event
	opening = ev8.41.opening
	desc = ev8.41.desc
	sender = scope:attacker

	trigger = {
		is_imprisoned = no
		exists = scope:war
		NOR = {
			scope:defender.liege = ROOT
			scope:attacker = ROOT
			scope:defender = ROOT
		}
	}
	option = {
		name = ev8.41.0.a
		add_prestige = medium_prestige_gain
		scope:war = {
			add_attacker = ROOT
		}
		ai_chance = {
			base = 5
			modifier = {
				add = 10
				OR = {
					has_trait = brave
					has_trait = witch_hunter
				}
			}
			modifier = {
				add = 10
				has_trait = sadistic
			}
			modifier = {
				add = 5
				has_trait = callous
			}
			modifier = {
				add = -5
				is_witch_trigger = yes
			}
			modifier = {
				add = 100
				OR = {
					has_relation_rival = scope:defender
					has_relation_nemesis = scope:defender
				}
			}
		}
	}
	option = {
		name = ev8.41.0.b
		ai_chance = {
			base = 0
			modifier = {
				add = 10
				has_trait = craven
			}
			modifier = {
				add = 5
				has_trait = compassionate
				NOT = {
					has_trait = just
				}
			}
			#modifier = {
			#	add = 20
			#	OR = {
			#		is_witch_trigger = yes
			#		has_trait = witch_hunter2
			#	}
			#}
			modifier = {
				add = 1000
				OR = {
					has_relation_friend = scope:defender
					has_relation_best_friend = scope:defender
					has_relation_lover = scope:defender
					has_relation_soulmate = scope:defender
					has_relation_mmaster = scope:defender
					has_relation_mminion = scope:defender
					has_relation_rival = scope:attacker
					has_relation_nemesis = scope:attacker
					scope:attacker = {
						has_strong_hook = root
					}
				}
			}
		}
	}
}
#Grand Coalition begins
magic_ev8.42 = {
	title = ev8.42.title
	desc = ev8.42.desc
	theme = realm
	left_portrait = {
		character = root
		animation = spymaster
	}
	lower_right_portrait = scope:recipient
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			scope:recipient = {
				if = {
					limit = {
						NOT = {
							has_character_flag = may_has_wh_coalition_war_flag
						}
					}
					add_character_flag = {
						flag = may_has_wh_coalition_war_flag
						years = 3
					}
				}
			}
		}
	}
	option = {
		name = epidemic_events.1020.a # It's worth a try.
		scope:recipient = {
			trigger_event = {
				id = magic_ev8.43
				days = 3
			}
		}
		if = {
			limit = {
				is_ai = yes
				NOT = {
					has_character_modifier = amp_modifier
				}
			}
			add_character_modifier = {
				modifier = amp_modifier
				years = 10
			}
		}
		if = {
			limit = {
				is_ai = yes
				NOT = {
					has_character_modifier = double_guards_modifier
				}
			}
			add_character_modifier = {
				modifier = double_guards_modifier
				years = 10
			}
		}
	}
}
#Grand Coalition ultimatum
magic_ev8.43 = {
	type = letter_event
	opening = ev8.43.opening
	desc = ev8.43.desc
	sender = scope:actor
	option = {
		name = ev8.43.0.c
		trigger = {
			OR = {
				has_trait = wrathful
				has_trait = irritable
			}
		}
		add_prestige = minor_prestige_gain
		custom_tooltip = ev8.43.0.a_ct
		hidden_effect = {
			scope:actor = {
				trigger_event = {
					id = magic_ev8.44
					days = 7
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev8.43.0.a
		custom_tooltip = ev8.43.0.a_ct
		hidden_effect = {
			scope:actor = {
				trigger_event = {
					id = magic_ev8.44
					days = 7
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev8.43.0.b
		add_stress = minor_stress_gain
		scope:actor = {
			send_interface_toast = {
				title = ev8.43.0.b_title
				imprison = {
					target = ROOT
					type = dungeon
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
}

#Grand Coalition preparations
magic_ev8.44 = {
	title = ev8.42.title
	desc = ev8.44.desc
	theme = realm
	left_portrait = {
		character = root
		animation = spymaster
	}
	lower_right_portrait = scope:recipient
	trigger = {
		is_alive = yes
		is_imprisoned = no
	}
	on_trigger_fail = {
		if = {
			limit = {
				is_imprisoned = yes
			}
			trigger_event = {
				id = magic_ev8.44
				months = 1
			}
		}
	}
	option = {
		name = ev8.44.0.a
		if = {
			limit = {
				is_ai = no
			}
			remove_short_term_gold = 200
		}
		
		spawn_army = {
			name = event_troop_default_name
			men_at_arms = {
				type = horse_archers
				stacks = 2
			}
			men_at_arms = {
				type = armored_footmen
				stacks = 5
			}
			men_at_arms = {
				type = bowmen
				stacks = 5
			}
			men_at_arms = {
				type = light_footmen
				stacks = 5
			}
			men_at_arms = {
				type = teutonic_knights
				stacks = 5
			}
			men_at_arms = {
				type = pikemen_unit
				stacks = 5
			}
			location = root.capital_province
			uses_supply = yes
  	 		inheritable = no
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev8.44.0.b
		ai_chance = {
			base = 0
		}
	}
	after = {
		trigger_event = {
			id = magic_ev8.45
			months = 2
		}
	}
}

#Grand Coalition - may strike
magic_ev8.45 = {
	title = ev8.42.title
	desc = ev8.45.desc
	theme = realm
	left_portrait = {
		character = root
		animation = spymaster
	}
	lower_right_portrait = scope:recipient
	trigger = {
		is_alive = yes
		is_ruler = yes
		is_imprisoned = no
		#is_at_war = no
		NOT = {
			is_at_war_with = scope:recipient
		}
		exists = scope:recipient
		scope:recipient = {
			is_alive = yes
			is_independent_ruler = yes
			is_imprisoned = no
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				exists = scope:recipient
				OR = {
					is_imprisoned = yes
					is_at_war_with = scope:recipient
					scope:recipient = {
						is_imprisoned = yes
					}
				}
			}
			trigger_event = {
				id = magic_ev8.45
				months = 1
			}
		}
	}
	option = {
		name = ev8.45.0.a
		every_character_war = {
			end_war = white_peace
		}
		hidden_effect = {
			if = {
				limit = {
					has_truce = scope:recipient
				}
				cancel_truce_both_ways = scope:recipient
			}
		}
		start_war = {
			target = scope:recipient
			casus_belli = against_the_witch_war
		}
	}
	option = {
		name = ev7.96.e	 #"This is not the right time."
		custom_tooltip = ev8.45.0.b_ct
		hidden_effect = {
			trigger_event = {
				id = magic_ev8.45
				months = 3
			}
		}
	}
}
#mass healing feedback
magic_ev8.46 = {
	title = ev8.46.title
	desc = ev8.46.desc
	theme = realm
	left_portrait = root

	option = {
		name = ev8.46.0.a
		trigger = {
			NOT = {
				root = scope:mass_healer_ultimate_spell
			}
		}
	}
	option = {
		trigger = {
			root = scope:mass_healer_ultimate_spell
			has_trait = arrogant
		}
		name = ev8.46.0.b
		add_prestige = massive_prestige_gain
		add_stress = medium_stress_loss
	}
	option = {
		trigger = {
			root = scope:mass_healer_ultimate_spell
		}
		name = ev5.21.0.b	#"I did a good job."
		if = {
			limit = {
				NOT = {
					has_trait = sadistic
				}
			}
			add_stress = medium_stress_loss
		}
	}
}

#Mage Summit - AC show...
magic_ev8.47 = {
	type = activity_event
	title = singularity_name
	desc = ev8.47.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	right_portrait = {
		character = scope:witch0
		animation = admiration
	}

	trigger = {
		is_alive = yes
		is_ai = no
		any_character_artifact = {
			OR = {
				has_artifact_modifier = singularity_modifier5
				has_artifact_modifier = singularity_modifierX
			}
		}
		scope:activity = {
			any_attending_character = {
				is_ai = yes
				NOR = {
					THIS = ROOT
					has_relation_rival = ROOT
					has_relation_nemesis = ROOT
					has_relation_mminion = ROOT
				}
				OR = {
					has_focus = witch_focus
					has_trait = true_witch
				}
			}
		}
	}
	cooldown = {
		years = 100
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						is_ai = yes
						NOR = {
							THIS = ROOT
							has_relation_rival = ROOT
							has_relation_nemesis = ROOT
							has_relation_mminion = ROOT
						}
						OR = {
							has_focus = witch_focus
							has_trait = true_witch
						}
					}
					save_scope_as = witch0
				}
			}
		}
	}
	
	option = {
		name = ev8.47.0.a
		trigger_event = magic_ev8.48
	}
	option = {
		name = ev7.107.b	#"This is a bad idea."
		scope:witch0 = {
			add_opinion = {
				target = ROOT
				modifier = refusal_opinion
				opinion = -50
			}
		}
	}
}

#Mage Summit - AC show, part 2.
magic_ev8.48 = {
	type = activity_event
	title = singularity_name
	desc = ev8.48.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = {
		character = root
		animation = shock
	}
	right_portrait = {
		character = scope:witch0
		animation = fear
	}

	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						is_ai = yes
						is_adult = yes
						has_any_basic_magic_prot_trigger = no
					}
					save_scope_as = random_vic
				}
			}
		}
		if = {
			limit = {
				exists = scope:random_vic
			}
			scope:random_vic = {
				death = {
					killer = scope:witch0
					death_reason = death_accident
				}
			}
		}
		location.county = {
			add_county_modifier = {
				modifier = magic_damaged_walls_modifier
				years = 1
			}
		}
	}
	
	option = {
		#name = ev5.21.0.a	#damn!
		name = ev8.48.0.a
		#add_stress = medium_stress_gain
		#scope:witch0 = {
		#	add_stress = medium_stress_gain
		#}
		scope:activity = {
			every_attending_character = {
				limit = {
					NOR = {
						has_trait = brave
						has_trait = callous
					}
				}
				add_stress = medium_stress_gain
			}
		}
	}
}

#Corruption ongoing 6.
magic_ev8.49 = {
	type = character_event
	title = corruption
	desc = ev8.49.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = scope:owner
		animation = spymaster
	}
	right_portrait = scope:target

	trigger = {
		exists = scope:scheme
		scope:target = {
			NOT = {
				has_character_flag = corruption_6_ongoing_flag
			}
		}
	}

	
	option = {
		name = ev8.49.0.a
		scope:scheme = {
			add_scheme_modifier = {
				type = resisting_corruption_modifier
			}
		}
	}
	option = {
		name = ev8.49.0.b
		trigger = {
			has_trait = schemer
		}
		trait = schemer
		scope:scheme = {
			add_scheme_progress = -1
		}
	}
	after = {
		hidden_effect = {
			scope:target = {
				add_character_flag = {
					flag = corruption_6_ongoing_flag
					years = 3
				}
			}
		}
	}
}

#duel with landless mage
magic_ev8.50 = {
	title = host_dinner_events.1041.title	#The Challenge
	desc = ev8.50.desc
	theme = realm
	left_portrait = root
	right_portrait = {
		character = scope:mage1
		animation = disapproval
	}
	trigger = {
		is_alive = yes
		is_ai = no
		is_imprisoned = no
		has_trait = archmage
		any_character_artifact = {
			has_variable = magic1
		}
	}
	immediate = {
		hidden_effect = {
			random_living_character = {
				limit = {
					is_ai = yes
					is_pool_character = yes
					has_trait = archmage
					NOT = {
						has_character_flag = special_magic_character
					}
				}
				save_scope_as = mage1									
			}
			if = {
				limit = {
					NOT = {
						exists = scope:mage1
					}
				}
				random_living_character = {
					limit = {
						is_ai = yes
						is_landed_or_landless_administrative = no
						has_trait = archmage
						NOT = {
							has_character_flag = special_magic_character
						}
						OR = {
							NOT = {
								exists = house
							}
							AND = {
								exists = house
								NOT = {
									house = root.house
								}
							}
						}
					}
					save_scope_as = mage1									
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:mage1
					}
				}
				random_ruler = {
					limit = {
						is_ai = yes
						has_trait = archmage
						NOT = {
							has_character_flag = special_magic_character
						}
						OR = {
							NOT = {
								exists = house
							}
							AND = {
								exists = house
								NOT = {
									house = root.house
								}
							}
						}
					}
					save_scope_as = mage1									
				}
			}

			if = {
				limit = {
					NOT = {
						exists = scope:mage1
					}
				}
				create_character = {
					location = root.location
					template = wandering_mage_character
					faith =root.faith
					culture = root.culture
					save_scope_as = mage1
					after_creation = {
						give_witch_secret_or_trait_effect = yes
						add_trait_xp = {
							trait = lifestyle_traveler
							track = travel
							value = { 40 80 }
						}
						add_trait_xp = {
							trait = lifestyle_traveler
							track = danger
							value = { 40 80 }
						}
						add_perk = protective_runes_perk
						add_perk = magical_senses_perk
						add_perk = magical_experiments_p1_perk
						add_perk = mage_tower_p2_perk
						add_perk = mind_control_p6_perk
						add_perk = forbidden_ritual_p7_perk
						add_perk = fate_weaver_p10_perk
						add_perk = magic_triangulation_p5_perk
						add_perk = combat_spells_p3_perk
						add_perk = healer_p9_perk
						add_perk = summoner_p8_perk
						add_perk = mage_p4_perk
						set_random_spell_id = yes
						if = {
							limit = {
								NOT = {	has_trait = archmage	}
							}
							add_trait = archmage
						}
						add_trait_xp = {
							trait = archmage
							track = secret_knowledge
							value = { 1 25 }
						}
						add_trait_xp = {
							trait = archmage
							track = combat_magic
							value = 60
						}
						add_trait_xp = {
							trait = archmage
							track = power_saturation
							value = 100
						}
					}
				}
			}
			else = {
				scope:mage1 = {
					gain_huge_ps_effect = yes
					gain_huge_ps_effect = yes
				}
			}
		}
	}
	option = {
		name = ev8.50.0.a
		stress_impact = {
			brave = minor_stress_loss
			craven = major_stress_gain
			wrathful = minor_stress_loss
			arrogant = minor_stress_loss
		}
		custom_tooltip = start_duel_ct
		configure_start_mage_duel_effect = {
			MD_ATTACKER = root
			MD_DEFENDER = scope:mage1
		}
	}
	option = {
		name = ev8.50.0.b
		stress_impact = {
			brave = minor_stress_gain
			paranoid = minor_stress_loss
			calm = minor_stress_loss
			humble = medium_stress_loss
		}
		add_prestige = -100
	}
}